// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/DataAggregation/js/UI/PageContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Evented dojo/query dojo/dom-class dojo/Deferred dojo/_base/xhr dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/PageContainer.html jimu/dijit/ViewStack".split(" "),function(r,c,g,p,u,x,v,y,w,z,l,h,n,a){return r([l,h,x],{templateString:n,selected:"",tabs:null,average:!1,nls:null,baseClass:"jimu-tab3",declaredClass:"PageContainer",
views:[],_currentIndex:-1,_homeIndex:0,theme:"",styleColor:"",altHomeIndex:0,nextDisabled:!1,_backLabels:[],constructor:function(b){c.mixin(this,b);this.theme=this.appConfig.theme.name;this._darkThemes=["DartTheme","DashboardTheme"];this.own(u.subscribe("appConfigChanged",c.hitch(this,this._onAppConfigChanged)));this.own(u.subscribe("builder/styleChanged",c.hitch(this,this._onBuilderStyleChanged)))},postCreate:function(){this.inherited(arguments);this.displayControllerOnStart||this.toggleController(!0);
this._validateIsDark(this.appConfig)},startup:function(){this.inherited(arguments);this._started=!0;this._initSelf();this.selected?this.selectView(this.selected):0<this.views.length&&this.selectView(this._homeIndex);this._backLabels=[]},_onBuilderStyleChanged:function(b){this.setStyleColor(b.styleColor)},_onAppConfigChanged:function(b,a,m){this.appConfig=b?b:this.appConfig;switch(a){case "themeChange":this._validateIsDark(b);this.emit("theme-change",b,a,m);break;case "layoutChange":this.emit("layout-change",
b,a,m);break;case "styleChange":this._validateIsDark(b);this.emit("style-change",b,a,m);break;case "widgetChange":this.emit("widget-change",b,a,m);break;case "mapChange":this.emit("map-change",b,a,m)}},_validateIsDark:function(b){this._setThemeAndColors(b).then(c.hitch(this,function(){this.updateImageNodes();this._updateViewTheme(this.theme);for(var b=0;b<this.views.length;b++){var a=this.views[b];a.theme=this.theme;a.updateImageNodes()}}))},_setThemeAndColors:function(b){var a=new w;b=b&&b.theme&&
b.theme.name?b:this.appConfig;this.theme=b.theme.name;this._getStyleColor(b.theme.styles[0]).then(c.hitch(this,function(b){this.style=b;this._darkThemes="light"===b.name&&"DashboardTheme"===this.theme?["DartTheme"]:["DartTheme","DashboardTheme"];this.isDarkTheme=-1<this._darkThemes.indexOf(this.theme);this.styleColor=b.styleColor;a.resolve(!0)}));return a},_getStyleColor:function(b){var a=new w,m=b?b:this.appConfig.theme.styles[0];z.get({url:"./themes/"+this.theme+"/manifest.json",handleAs:"json",
load:c.hitch(this,function(b){b=b.styles;for(var e=0;e<b.length;e++){var d=b[e];d.name===m&&a.resolve(d)}})});return a},selectView:function(b,a){!a&&0<b&&(a=this.getSelectedTitle(),(a=this.getViewByTitle(a))&&this._backLabels[this._backLabels.length-1]!==a.label&&b!==a.index&&(this._backLabels.push(a.label),this.backDisabled=!1));this.viewStack.switchView(b);this._updateDomNodes(b);this._currentIndex=b;this.emit("view-changed",b)},showShelter:function(){p.setStyle(this.shelter,"display","block")},
hideShelter:function(){p.setStyle(this.shelter,"display","none")},_initSelf:function(){this.viewStack?this.viewStack._currentView=void 0:this.viewStack=new a(null,this.containerNode);this._initViews()},_initViews:function(){g.forEach(this.views,c.hitch(this,function(b){this.addView(b)}))},_prevView:function(){this._navView("back-view")},_homeView:function(){this._navView("home-view")},_nextView:function(){this._navView("next-view")},_navView:function(b){var a=this.getSelectedTitle(),m=this.getViewByTitle(a),
f="home-view"===b&&m.altHomeIndex?m.altHomeIndex:this._homeIndex,e,q=!1;if("back-view"===b&&0<this._backLabels.length){var k;for(e=this._backLabels.length-1;0<=e&&(!(k=this.getViewByTitle(this._backLabels[e]))||this._backLabels[e]===a);e--)this._backLabels.splice(e,1);e=k.index;q=!0}"next-view"===b&&"undefined"===typeof m&&0<this._backLabels.length&&(this._currentIndex=(m=this.getViewByTitle(this._backLabels[this._backLabels.length-1]))&&m.index?m.index:this._currentIndex);"undefined"===typeof e&&
(e="next-view"===b?m.altNextIndex:"back-view"===b?m.altBackIndex:void 0);var t;"undefined"!==typeof e&&"home-view"!==b?t=this.getViewByIndex(e):"next-view"===b?this._currentIndex<this.viewCount-1&&(t=this.getViewByIndex(this._currentIndex+1)):"back-view"===b?t=this._currentIndex-1<=this._homeIndex?this.getViewByIndex(this._homeIndex):this.getViewByIndex(this._currentIndex-1):(f!==this._homeIndex&&this._backLabels&&0<this._backLabels.length&&(q=!0),t=this.getViewByIndex(f));t&&(a={currentView:m,navView:t},
this.emit(b,a),m.validate?m.validate(b,a).then(c.hitch(this,function(a){a&&this._navigate(t.index,q,m.index,b,t.label)})):this._navigate(t.index,q,m.index,b,t.label))},_navigate:function(a,d,m,f,e){0<m&&"next-view"===f&&this._backLabels[this._backLabels.length-1]!==this.views[m].label&&(this._backLabels.push(this.views[m].label),this.backDisabled=!1);if(d){for(d=this._backLabels.length-1;0<=d;d--)if(this._backLabels[d]===e){this._backLabels.splice(d,1);break}0===this._backLabels.length&&(this.backDisabled=
!0)}this._currentIndex=a;this.selectView(a,!0);this.emit("nav-view",a)},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},getViewByIndex:function(a){if(this.views.length>a)return this.views[a]},getViewByTitle:function(a){for(var b=0;b<this.views.length;b++){var m=this.views[b];if(m.label===a)return m}},_updateControl:function(a,d){d?p.addClass(a,"control-disbaled"):p.removeClass(a,"control-disbaled")},_updateViews:function(){this.viewCount=
this.views.length;for(var a=0;a<this.views.length;a++){var d=this.views[a];d.setStyleColor(this.styleColor);"undefined"!==typeof d.index&&d.index!==a&&this.emit("view-index-change",{oldIndex:d.index,newIndex:a});d.index=a}this.emit("views-updated",this)},addView:function(a){a.pageContainer=this;this._containsView(a.label)||this.views.push(a);this.viewStack.getViewByLabel(a.label)||this.viewStack.addView(a);this._updateViews();this.emit("view-added",a)},removeViewByTitle:function(a){a=this.getViewByTitle(a);
this.removeViewByIndex(a.index)},removeView:function(a){this.removeViewByIndex(a.index)},removeViewByIndex:function(a){var b=this.getViewByIndex(a),m=b.label;this.viewStack.removeView(b);this.views.splice(a,1);this._updateViews();this._backLabels=this._backLabels.filter(function(a){return a!==m});0===this._backLabels.length&&(this.backDisabled=!0);this._navView("next-view");this.emit("view-removed",b)},_clearViews:function(){g.forEach(this.views,c.hitch(this,function(a){this.viewStack.removeView(a)}));
this.views=[];this._backLabels=[]},_containsView:function(a){for(var b=0;b<this.views.length;b++)if(this.views[b].label===a)return!0;return!1},setStyleColor:function(a){this.styleColor=a;g.forEach(this.views,c.hitch(this,function(b){b.styleColor=a}))},updateImageNodes:function(){var a=this.isDarkTheme;this._updateImageNode(a,"bg-back-img","bg-back-img-white");this._updateImageNode(a,"bg-home-img","bg-home-img-white");this._updateImageNode(a,"bg-next-img","bg-next-img-white")},_updateDomNodes:function(a){var b=
this.views[a],m=this._homeIndex,f=this.backDisabled?this.backDisabled:a===this._homeIndex?!0:!1;this._updateControl(this.backTd,f);this._updateControl(this.backImage,f);f=a===m?!0:!1;this._updateControl(this.homeTd,f);this._updateControl(this.homeImage,f);b=b&&"undefined"!==typeof b.altNextIndex;a=this.nextDisabled?this.nextDisabled:a!==m||this.nextDisabled?b?!1:this.nextDisabled:!1;this._updateControl(this.nextTd,a);this._updateControl(this.nextImage,a)},_updateImageNode:function(a,d,m){var b=a?
d:m,e=a?m:d;a=v("."+b,this.domNode);g.forEach(a,function(a){y.remove(a,b);y.add(a,e)})},_updateViewTheme:function(a){this.theme=a;g.forEach(this.views,c.hitch(this,function(b){b.theme=a}))},toggleController:function(a){this.controlTable&&(a?y.contains(this.controlTable,"display-none")||y.add(this.controlTable,"display-none"):y.contains(this.controlTable,"display-none")&&y.remove(this.controlTable,"display-none"))},reset:function(){this._clearViews();this.views=[];this._currentIndex=-1;this._homeIndex=
0;this.nextDisabled=!1;this.backDisabled=!0;this.selected="";this._validateIsDark(this.appConfig)}})})},"widgets/DataAggregation/js/UI/Home":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Home.html dojo/on dojo/dom-construct dojo/dom-class ../csvStore ./Addresses ./Coordinates ./FieldMapping esri/lang jimu/dijit/Popup".split(" "),function(r,c,g,p,u,x,v,y,w,
z,l,h,n,a,b,d,m,f){return r([u,x,v,y],{baseClass:"cf-home",declaredClass:"CriticalFacilities.Home",templateString:w,_started:null,label:"Home",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",styleColor:"",_geocodeSources:null,_fsFields:[],_singleFields:[],_multiFields:[],_childViews:[],singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,disabled:!1,userName:"",constructor:function(a){c.mixin(this,a);this._initBaseArgs()},_initBaseArgs:function(){this._baseArgs={nls:this.nls,map:this.map,
parent:this.parent,config:this.config,appConfig:this.appConfig,theme:this.theme}},postCreate:function(){this.inherited(arguments);this.pageInstruction.innerHTML=m.substitute({layer:this.parent.editLayer.name},this.nls.startPage.startPageInstructions)},startup:function(){this._started=!0;this.inDrop=!1;(this.fileNode.disabled=this.disabled)&&h.add(this.uploadLabel,"disabled");this.parent.domNode&&(this.own(z(this.parent.domNode,"dragenter",this.onDragEnter)),this.own(z(this.parent.domNode,"dragover",
this.onDragOver)),this.own(z(this.parent.domNode,"drop",c.hitch(this,this.onDrop))));this.own(z(this.map.container,"dragenter",this.onDragEnter));this.own(z(this.map.container,"dragover",this.onDragOver));this.own(z(this.map.container,"drop",c.hitch(this,this.onDrop)));this.own(z(this.fileNode,"change",c.hitch(this,this.onDrop)))},onShown:function(){},_clearResults:function(a){a||(this.map.infoWindow.hide(),this.inDrop=!1)},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){},
validate:function(a,b){var e=new p;"next-view"===a?e.resolve(this._nextView(b)):"back-view"===a?this._backView(b).then(function(a){e.resolve(a)}):this._homeView(b).then(function(a){e.resolve(a)});return e},_nextView:function(a){a.navView.label===this.pageContainer.views[1].label&&this.pageContainer.toggleController(!1);return!0},_backView:function(a){var e=new p;a.navView.label===this.label&&(this.pageContainer.toggleController(!0),e.resolve(!0));return e},_homeView:function(a){var e=new p;a.navView.label===
this.label&&(this.pageContainer.toggleController(!0),e.resolve(!0));return e},_clearMapping:function(){this.parent._locationMappingComplete=!1;this.parent._fieldMappingComplete=!1},onDragEnter:function(a){a.preventDefault()},onDragOver:function(a){a.preventDefault()},onDrop:function(a){if(this.disabled)this.parent._userCanEdit?(a=this.parent._getMessages(),this.parent._showPopup(a)):this.parent.showEditMessage();else if(!this.inDrop){this.inDrop=!0;this.csvStore&&this.csvStore.clear();var e;a.dataTransfer?
(a.preventDefault(),e=a.dataTransfer.files):a.currentTarget&&(e=a.currentTarget.files);e&&0<e.length?(a=e[0],-1!==a.name.indexOf(".csv")?(this.csvStore=new n({file:a,fsFields:this._fsFields,map:this.map,geocodeSources:this._geocodeSources,nls:this.nls,appConfig:this.appConfig,editLayer:this.parent.editLayer,symbol:this.parent._symbol,parent:this.parent}),this.csvStore.handleCsv().then(c.hitch(this,function(a){this._updatePageContainer(a);this.inDrop=!1}))):this.inDrop=!1):this.inDrop=!1}},_initCoordinatesView:function(a){return new b(c.mixin({fields:this._getFields(a,
!0),xField:"X"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],yField:"Y"===this.config.xyFields[0].fieldName?this.config.xyFields[0]:this.config.xyFields[1],firstField:this.config.xyFields[0].fieldName},this._baseArgs))},_initAddressView:function(e){return new a(c.mixin({singleFields:this._singleFields,multiFields:this._multiFields,fields:this._getFields(e,!1),multiEnabled:this.multiEnabled,singleEnabled:this.singleEnabled},this._baseArgs))},_initFieldMappingView:function(a){return new d(c.mixin({targetFields:a.fsFields,
sourceFields:this._getFields(a,!1)},this._baseArgs))},_getFields:function(a,b){var e=[];g.forEach(a.fields,function(d){var k=a.fieldTypes[d];(b&&k&&(k.supportsInt||k.supportsFloat)||!b)&&e.push({label:d,value:d,type:k})});return e},_updatePageContainer:function(a){this.pageContainer.getViewByTitle("StartPage").csvStore=this.csvStore;if(this.xyEnabled){var b=this._initCoordinatesView(a);this.pageContainer.addView(b)}if(this.singleEnabled||this.multiEnabled)b=this._initAddressView(a),this.pageContainer.addView(b);
a=this._initFieldMappingView(a);this.pageContainer.addView(a);this.pageContainer._nextView()},verifyClearSettings:function(a){var b=new p;if(a.navView.label===this.label){var e;if(this.parent._locationMappingComplete||this.parent._fieldMappingComplete||this.parent._tempResultsAdded)e=this.nls.warningsAndErrors.settingsCleared;if(e){var d=l.create("div");l.create("div",{className:"cf-warning-icon",style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},d);var m="padding-"+
(window.isRTL?"right":"left")+": 50px;";l.create("div",{innerHTML:e,style:m},d);l.create("div",{innerHTML:this.nls.warningsAndErrors.proceed,style:"padding-top:10px; "+m},d);var B=new f({width:325,autoHeight:!0,content:d,buttons:[{label:this.nls.yes,onClick:c.hitch(this,function(){this._clearMapping();this._clearStore(!0);this.pageContainer.toggleController(!0);B.close();B=null;b.resolve(!0)})},{label:this.nls.no,classNames:["jimu-btn-vacation"],onClick:c.hitch(this,function(){this.pageContainer.selectView(a.currentView.index);
B.close();B=null;b.resolve(!1)})}],onClose:function(){B=null}})}else this.pageContainer.toggleController(!0),this._clearStore(!0),b.resolve(!0)}else b.resolve(!0);return b},_clearStore:function(a){this.csvStore&&this.csvStore.clear();this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures();this.fileForm.reset();a&&(this.parent._initPageContainer(!0),this.inDrop=!1)}})})},"widgets/DataAggregation/js/csvStore":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/DeferredList dojo/Evented dojox/data/CsvStore dojo/store/Observable dojo/store/Memory esri/graphicsUtils esri/geometry/webMercatorUtils esri/geometry/Point esri/layers/FeatureLayer esri/tasks/locator esri/tasks/query esri/SpatialReference esri/dijit/PopupTemplate esri/geometry/geometryEngine esri/tasks/ProjectParameters esri/tasks/GeometryService esri/request jimu/utils moment/moment".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b,d,m,f,e,q,k,t,A){return r([x],{file:null,map:null,spatialReference:null,fsFields:[],duplicateTestFields:[],geocodeSources:[],duplicateData:[],data:null,editLayer:null,parent:null,separatorCharacter:null,csvStore:null,storeItems:null,matchedFeatureLayer:null,mappedArrayFields:null,unMatchedFeatureLayer:null,duplicateFeatureLayer:null,addrFieldName:"",xFieldName:"",yFieldName:"",symbol:null,matchFieldPrefix:"MatchField_",_internalFields:[],_removeLocators:[],constructor:function(a){g.mixin(this,
a);this.useAddr=!0;this.objectIdField="ObjectID";this.nls=a.nls;this.minScore=90;this._getDuplicateFields(this.fsFields);this.spatialReference=this.map.spatialReference;this.decimalSeperator=/^1(.+)1$/.exec(t.localizeNumber(1.1))[1].toString()},_getDuplicateFields:function(a){var b=[];c.forEach(a,function(a){a.duplicate&&b.push(a.name)});this.duplicateTestFields=b},handleCsv:function(){var a=new p;if(this.file&&!this.file.data){var b=new FileReader;b.onload=g.hitch(this,function(){this.data=b.result;
this._processCsvData().then(function(b){a.resolve(b)})});b.readAsText(this.file)}return a},_processCsvData:function(){var a=new p;this._convertSources();this._getSeparator();this._getCsvStore().then(function(b){a.resolve(b)});return a},processForm:function(){this._internalFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState"];this._matchFields=[];var a=new p;this._locateData(this.useAddr).then(g.hitch(this,function(b){var e=[],d=[],k=[],f={},t=0,q=0;0<this._removeLocators.length&&
(this._removeLocators.sort(function(a,b){return b-a}),c.forEach(this._removeLocators,g.hitch(this,function(a){this._geocodeSources.splice(a,1)})));for(var m=function(a,b,e,d){var k=a;-1===[null,void 0,""].indexOf(a)&&a.indexOf&&-1<a.indexOf(b)&&(e=e.filter(function(a){return a.keyField===d}))&&e.hasOwnProperty("length")&&1===e.length&&(k=a.toString?a.toString().replace(b,"."):a);return k},A=Object.keys(b),C=0;C<A.length;C++){var B={},n=b[A[C]],l=this.storeItems[n.csvIndex];c.forEach(this.fsFields,
g.hitch(this,function(a){if(this.mappedArrayFields.hasOwnProperty(a.name))if(this.mappedArrayFields[a.name]){var b=this.csvStore.getValue(l,this.mappedArrayFields[a.name]);if(a.domainValues){var e=a.domainValues.filter(g.hitch(this,function(a){return a.label===b}));B[a.name]=e&&0<e.length?e[0].value:b}else B[a.name]="."===this.decimalSeperator||this.useAddr?b:m(b,this.decimalSeperator,this._currentAddressFields,this.mappedArrayFields[a.name])}else B[a.name]=void 0}));c.forEach(this._currentAddressFields,
g.hitch(this,function(a){var b=this.matchFieldPrefix+a.keyField;if("undefined"!==typeof a.value){var e=this.csvStore.getValue(l,a.value);B[b]="."===this.decimalSeperator||this.useAddr?e:m(e,this.decimalSeperator,this._currentAddressFields,a.keyField)}else B[b]=void 0;this._matchFields.push(b)}));n&&n.score>this.minScore?(B.ObjectID=C-t-q,B.matchScore=n.score,e.push({geometry:n.location,attributes:g.clone(B)})):n.isDuplicate?(B.ObjectID=q,B.DestinationOID=n.featureAttributes[this.editLayer.objectIdField],
B.matchScore=100,B.hasDuplicateUpdates=!1,B.duplicateState="no-change",k.push({geometry:n.location,attributes:g.clone(B)}),f[q]=n.featureAttributes,q++):(B.ObjectID=t,B.matchScore=n.score?n.score:0,d.push({geometry:n.location&&n.location.type?n.location:new h(0,0,this.spatialReference),attributes:g.clone(B)}),t++)}this.matchedFeatureLayer=this._initLayer(e,this.file.name.replace(".csv",""));0<k.length&&(this.duplicateFeatureLayer=this._initLayer(k,this.file.name.replace(".csv","")+"_Duplicate"));
0<d.length&&(this.unMatchedFeatureLayer=this._initLayer(d,this.file.name.replace(".csv","")+"_UnMatched"));a.resolve({matchedLayer:this.matchedFeatureLayer,unMatchedLayer:this.unMatchedFeatureLayer,duplicateLayer:this.duplicateFeatureLayer,duplicateLookupList:f})}),function(b){a.reject(b,!0)});return a},_initLayer:function(a,b){a=this._generateFC(a);b=new n(a,{id:b,editable:!0,outFields:["*"]});this._initPopup(b);this.map.addLayers([b]);return b},_initPopup:function(a){var b={title:a.id+": {"+this.labelField+
"}"},e=[];c.forEach(a.fields,g.hitch(this,function(a){a.name!==this.objectIdField&&-1===this._internalFields.indexOf(a.name)&&-1===this._matchFields.indexOf(a.name)&&e.push({fieldName:a.name,visible:!0})}));b.fieldInfos=e;a.infoTemplate=new m(b)},_findDuplicates:function(){var a=new p;this._getAllLayerFeatures(this.editLayer,this.fsFields).then(g.hitch(this,function(b){this.keys=Object.keys(this.mappedArrayFields);this.oidField=this.editLayer.objectIdField;var e=[],d=[],k=this.duplicateTestFields;
k&&k.hasOwnProperty("length")&&0<k.length&&c.forEach(this.storeItems,g.hitch(this,function(a){var b={compareValues:{},fileId:a._csvId,featureId:-1};c.forEach(k,g.hitch(this,function(e){var k=this.mappedArrayFields[e];"undefined"!==typeof k&&(b.compareValues[e]=this.csvStore.getValue(a,k),-1===d.indexOf(e)&&d.push(e))}));0<Object.keys(b.compareValues).length&&e.push(b)}));var f=[];0<e.length&&c.forEach(e,g.hitch(this,function(a){c.forEach(b,g.hitch(this,function(b){var e={};c.forEach(d,g.hitch(this,
function(a){var d=b.attributes[a];e[a]=-1===[null,void 0].indexOf(d)&&d.toString?d.toString():d}));if(JSON.stringify(a.compareValues)===JSON.stringify(e)){var k=b.attributes[this.oidField];-1!==a.featureId?(a.hasMultiDuplicates=!0,"undefined"===typeof a.featureIds?(a.featureIds=[a.featureId,k],a.features=[a.feature,b]):(a.featureIds.push(k),a.features.push(b))):(a.featureId=k,a.feature=b,f.push(a))}}))}));a.resolve(f)}));return a},_getAllLayerFeatures:function(a,e){var d=new p,k=[this.editLayer.objectIdField];
c.forEach(e,function(a){a.name&&k.push(a.name)});2>k.length&&(k=e);var f=a.maxRecordCount;e=new b;e.where="1\x3d1";a.queryIds(e).then(function(e){var t=[],q,m;if(e&&0<e.length){q=0;for(m=e.length;q<m;q+=f){var A=new b;A.outFields=k;A.objectIds=e.slice(q,q+f);A.returnGeometry=!0;t.push(a.queryFeatures(A))}(new u(t)).then(g.hitch(this,function(a){if(a){for(var b=[],e=0;e<a.length;e++)a[e][1].features&&b.push.apply(b,a[e][1].features.map(function(a){return{geometry:a.geometry,attributes:a.attributes}}));
d.resolve(b)}}))}else d.resolve([])},function(a){console.error(a);d.resolve({type:"error",message:a})});return d},_locateData:function(a){var b=new p;this._findDuplicates().then(g.hitch(this,function(e){this.duplicateData=e;if(a){var d=g.hitch(this,function(a,b,e){var k=new p,f=this._geocodeSources[b],t=f.locator;t.outSpatialReference=this.spatialReference;var q=[],m=[],A=0,h,B;h=0;B=a.length;for(;h<B;h+=500){var C=a.slice(h,h+500),n=[];(f.singleEnabled||f.multiEnabled)&&c.forEach(C,g.hitch(this,
function(a){var b=a._csvId,d=null,k;a:for(k in this.duplicateData){var t=this.duplicateData[k];if(t.fileId===b){d=g.mixin({},t);delete this.duplicateData[k];break a}}var q={};q.OBJECTID=b;this.useMultiFields?c.forEach(this.multiFields,g.hitch(this,function(b){this._currentAddressFields=this.multiFields;if(b.value!==this.nls.noValue){var e=this.csvStore.getValue(a,b.value);q[b.keyField]=e}else q[b.keyField]=void 0})):this.singleFields[0].value!==this.nls.noValue&&(this._currentAddressFields=this.singleFields,
k=this.csvStore.getValue(a,this.singleFields[0].value),"undefined"===typeof k&&(k=typeof k+b),q[f.singleLineFieldName]=k);k=g.mixin({},q);k=JSON.stringify(k);if(null===d)n.push(q),e[k]={index:A,csvIndex:b,location:{}},A+=1;else if(null!==d){var t=d.feature.geometry,m=d.feature.attributes;if(-1!==[null,void 0].indexOf(t)&&d.features){var h=0;a:for(;h<d.features.length;h++){var B=d.features[h];if(-1===[null,void 0].indexOf(B.geometry)){t=B.geometry;m=B.attributes;break a}}}e[k]={index:-1,csvIndex:b,
isDuplicate:!0,location:g.mixin({},t),featureAttributes:m}}}));this.useMultiFields&&f.multiEnabled||!this.useMultiFields&&f.singleEnabled?m.push(t.addressesToLocations({addresses:n,countryCode:f.countryCode,outFields:["ResultID","Score"]})):(C=new p,C.reject(this.nls.warningsAndErrors.notConfigured,!0),m.push(C))}var l=Object.keys(e);(new u(m)).then(g.hitch(this,function(t){this.minScore=this._geocodeSources[b]?this._geocodeSources[b].minCandidateScore:90;b+=1;var m=this._geocodeSources.length>b;
if(t&&t.length&&t[0].length&&!1===t[0][0])if(1<t[0].length&&console.error(t[0][1]),(this.useMultiFields&&f.multiEnabled||!this.useMultiFields&&f.singleEnabled)&&this.parent.locatorError(this._geocodeSources[b-1].locator.url,!1),this._removeLocators.push(b-1),m)d(this._remainingStoreItems||this.storeItems,b,this._currentFinalResults||{}).then(g.hitch(this,function(a){k.resolve(a)}));else return 1<this._geocodeSources.length?k.resolve(e):k.reject(this.nls.warningsAndErrors.noMoreLocators),k.promise;
else if(t){var A=this.minScore,h=0;c.forEach(t,g.hitch(this,function(b){b=b[1];c.forEach(b,function(a){a.ResultID=a.attributes.ResultID});b=y(new w({data:b,idProperty:"ResultID"})).query({},{sort:[{attribute:"ResultID"}]});c.forEach(b,g.hitch(this,function(b){for(var d in l){var k=l[d];if(e[k]&&e[k].index===h){b.attributes.Score<A?m?(q.push(a[e[k].csvIndex]),delete e[k]):e[k].score=b.attributes.Score:(e[k].location=b.location,e[k].score=b.attributes.Score,delete e[k].index);delete l[d];break}}h+=
1}))}));if(m&&0<q.length)this._remainingStoreItems=q,this._currentFinalResults=e,d(q,b,e).then(g.hitch(this,function(a){k.resolve(a)}));else return k.resolve(e),k.promise}}),g.hitch(this,function(a){console.log(a);b+=1;if(this._geocodeSources.length>b)d(this._remainingStoreItems||this.storeItems,b,this._currentFinalResults||{}).then(g.hitch(this,function(a){k.resolve(a)}));else return 1<this._geocodeSources.length?k.resolve(e):k.reject(this.nls.warningsAndErrors.noMoreLocators),k.promise}));return k});
this._removeLocators=[];d(this.storeItems,0,{}).then(g.hitch(this,function(a){b.resolve(a)}))}else this._currentAddressFields=[{keyField:this.xFieldName,label:this.xFieldName,value:this.xFieldName},{keyField:this.yFieldName,label:this.yFieldName,value:this.yFieldName}],this._xyData({storeItems:this.storeItems,csvStore:this.csvStore,xFieldName:this.xFieldName,yFieldName:this.yFieldName,wkid:this.spatialReference.wkid}).then(g.hitch(this,function(a){if(this.isGeographic&&!this.map.spatialReference.isWebMercator()&&
4326!==this.spatialReference.wkid){var e=[];c.forEach(a,function(a){e.push(a.location)});var d=1<e.length?f.union(e):f.buffer(e[0],100,9001);this._projectPoints(d,e).then(function(e){for(var d=0;d<a.length;d++)a[d].location=e[d];b.resolve(a)})}else b.resolve(a)}),function(a){b.reject(a)})}));return b},_xyData:function(a){var b=new p,e=[],d=a.csvStore;c.forEach(a.storeItems,g.hitch(this,function(b){var k=b._csvId,f=null,t;a:for(t in this.duplicateData){var q=this.duplicateData[t];if(q.fileId===k){f=
g.mixin({},q);delete this.duplicateData[t];break a}}var m={};t=d.getAttributes(b);c.forEach(t,function(a){m[a]=d.getValue(b,a)});t=!1;var A,h;null!==f&&f.feature&&f.feature.geometry?(q=f.feature.geometry,t=!0,h=f.feature.attributes):(f=d.getValue(b,a.xFieldName),A=d.getValue(b,a.yFieldName),"."!==this.decimalSeperator&&(f=-1!==[null,void 0,""].indexOf(f)?void 0:f.toString().replace(this.decimalSeperator,"."),A=-1!==[null,void 0,""].indexOf(A)?void 0:A.toString().replace(this.decimalSeperator,".")),
f=parseFloat(f),A=parseFloat(A),q=this._getGeometry(f,A),A=isNaN(f)||isNaN(A)?0:100);q&&e.push({attributes:m,location:q,csvIndex:k,score:A,isDuplicate:t,featureAttributes:h})}));b.resolve(e);return b},_getGeometry:function(a,b){"undefined"===typeof this.isGeographic&&(this.isGeographic=/(?=^[-]?\d{1,3}\.)^[-]?\d{1,3}\.\d+|(?=^[-]?\d{4,})|^[-]?\d{1,3}/.exec(a)?!0:!1);a=new h(isNaN(a)?0:a,isNaN(b)?0:b);this.isGeographic&&this.spatialReference.isWebMercator()?a=l.geographicToWebMercator(a):a.spatialReference=
this.isGeographic&&4326!==this.spatialReference.wkid?new d(4326):new d({wkid:this.spatialReference.wkid});return a},_projectPoints:function(a,b){var d=new p;this.gsvc=new q(this.appConfig.geometryService);a={url:this.gsvc.url+"/findTransformations",content:{f:"json",inSR:a.spatialReference.wkid,outSR:this.spatialReference.wkid,extentOfInterest:JSON.stringify(a.getExtent().toJson())},handleAs:"json",callbackParamName:"callback"};k(a,{usePost:!1}).then(g.hitch(this,function(a){a=(a=a&&a.transformations?
a.transformations:void 0)&&0<a.length?a[0].wkid:void 0;var k=new e;k.outSR=this.spatialReference;k.geometries=b;k.transformForward=!0;k.transformation=a;this.gsvc.project(k,g.hitch(this,function(a){d.resolve(a)}),function(a){d.reject(a)})}),function(a){d.reject(a)});return d},_generateFC:function(a){var b={layerDefinition:{geometryType:"esriGeometryPoint",spatialReference:this.spatialReference,objectIdField:this.objectIdField,type:"Feature Layer",drawingInfo:{renderer:{type:"simple",symbol:this.symbol}},
fields:[{name:this.objectIdField,alias:this.objectIdField,type:"esriFieldTypeOID"}]},featureSet:{features:a,geometryType:"esriGeometryPoint"}};c.forEach(this.fsFields,g.hitch(this,function(a){b.layerDefinition.fields.push({name:a.name,alias:a.label,type:a.value,editable:!0,domain:null})}));return b},clear:function(){this._removeLayer(this.matchedFeatureLayer);this._removeLayer(this.unMatchedFeatureLayer);this._removeLayer(this.duplicateFeatureLayer);this.storeItems=this.csvStore=this.separatorCharacter=
this.data=this.fsFields=this.file=void 0;this.duplicateData=[];this.mappedArrayFields=this.duplicateFeatureLayer=this.unMatchedFeatureLayer=this.matchedFeatureLayer=void 0;this.useAddr=!0;this.yFieldName=this.xFieldName=this.addrFieldName=""},_removeLayer:function(a){a&&(this.map.removeLayer(a),a.clear())},_getSeparator:function(){var a=this.data.indexOf("\n"),b=g.trim(this.data.substr(0,a)),e=0,d="";c.forEach([",","      ",";","|"],function(a){var k=b.split(a).length;k>e&&(e=k,d=a)});this.separatorCharacter=
d},_getCsvStore:function(){var a=new p;this.csvStore=new v({data:this.data,separator:this.separatorCharacter});this.csvStore.fetch({onComplete:g.hitch(this,function(b){this.storeItems=b;this._fetchFieldsAndUpdateForm(this.storeItems,this.csvStore,this.fsFields).then(function(b){a.resolve(b)})}),onError:function(b){console.error("Error fetching items from CSV store: ",b);a.reject(b)}});return a},_fetchFieldsAndUpdateForm:function(a,b,e){var d=new p,k=b._attributes,f=this.decimalSeperator,t={};c.forEach(k,
function(e){c.forEach(a,function(a){var d=!0,k=!0,q=!0,m=!0,h;t.hasOwnProperty(e)&&(k=t[e].supportsInt,q=t[e].supportsFloat,m=t[e].supportsDate,h=t[e].maxLength,k||q||m||(d=!1));var C=b.getValue(a,e);if(C){a=C.toString().length;var B=A(C);if(d){d=-1!==[null,void 0,""].indexOf(C);if(!d&&(m=m&&B.isValid()))if(B=C)try{m=!isNaN((new Date(B)).getTime())}catch(E){console.error(E),m=!1}else m=-1<[null,void 0,""].indexOf(B)?!0:!1;t[e]={supportsDate:m,supportsInt:d?k:!isNaN(parseInt(C,10))&&parseInt(C,10).toString().length===
a&&k};"."!==f&&(C=d?"":C.toString().replace(f,"."));t[e].supportsFloat=d?q:!isNaN(parseFloat(C))&&parseFloat(C).toString().length===a&&q}k=t[e];k.maxLength=h;"undefined"===typeof k.maxLength?k.maxLength=a:k.maxLength<a&&(k.maxLength=a)}})});d.resolve({fields:k,fieldTypes:t,fsFields:e});return d},_zoomToData:function(a,b){if(a&&0<a.length)try{var e=z.graphicsExtent(a);b?this.map.setExtent(e.expand(1.9),!0):this.map.setExtent(e,!0)}catch(D){console.log(D.message)}},_convertSources:function(){this.geocodeSources&&
0<this.geocodeSources.length&&(this._geocodeSources=c.map(this.geocodeSources,g.hitch(this,function(b){if(b&&b.url&&"locator"===b.type)return{locator:new a(b.url||""),outFields:["ResultID","Score"],singleLineFieldName:b.singleLineFieldName||"",name:t.stripHTML(b.name||""),placeholder:t.stripHTML(b.placeholder||""),countryCode:b.countryCode||"",addressFields:b.addressFields,singleEnabled:b.singleEnabled||!1,multiEnabled:b.multiEnabled||!1,minCandidateScore:b.minCandidateScore||90}})))}})})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),
function(r,c,g,p,u,x){c=c("dojox.data.CsvStore",null,{constructor:function(c){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;c.url&&(this.url=c.url);this._csvData=c.data;c.label?this.label=c.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=c.identifier;""===this.identifier?
delete this.identifier:this._idMap={};"separator"in c&&(this.separator=c.separator);"urlPreventCache"in c&&(this.urlPreventCache=c.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(c){if(!this.isItem(c))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(c){c=this.getIdentity(c);this.identifier&&(c=this._idMap[c]);return c},getValue:function(c,g,p){this._assertIsItem(c);var v=
p;if("string"===typeof g)g=this._attributeIndexes[g],null!=g&&(v=this._dataArray[this._getIndex(c)][g]||p);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return v},getValues:function(c,g){return(c=this.getValue(c,g))?[c]:[]},getAttributes:function(c){this._assertIsItem(c);var g=[];c=this._dataArray[this._getIndex(c)];for(var v=0;v<c.length;v++)""!==c[v]&&g.push(this._attributes[v]);return g},hasAttribute:function(c,g){this._assertIsItem(c);
if("string"===typeof g)return g=this._attributeIndexes[g],c=this._dataArray[this._getIndex(c)],"undefined"!==typeof g&&g<c.length&&""!==c[g];throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(c,g,p){var v=void 0;"string"===typeof p&&(v=u.patternToRegExp(p,!1));return this._containsValue(c,g,p,v)},_containsValue:function(c,g,p,r){c=this.getValues(c,g);for(g=0;g<c.length;++g){var l=c[g];if("string"===typeof l&&r)return null!==
l.match(r);if(p===l)return!0}return!1},isItem:function(c){if(c&&c[this._storeProp]===this)if(c=c[this._idProp],this.identifier){if(this._dataArray[this._idMap[c]])return!0}else if(0<=c&&c<this._dataArray.length)return!0;return!1},isItemLoaded:function(c){return this.isItem(c)},loadItem:function(c){},getFeatures:function(){return this._features},getLabel:function(c){if(this.label&&this.isItem(c))return this.getValue(c,this.label)},getLabelAttributes:function(c){return this.label?[this.label]:null},
_fetchItems:function(c,p,r){var v=this,l=function(a,d){var b=null;if(a.query){var f,e,b=[],q=a.queryOptions?a.queryOptions.ignoreCase:!1,k={};for(f in a.query)e=a.query[f],"string"===typeof e&&(k[f]=u.patternToRegExp(e,q));for(q=0;q<d.length;++q){var t=!0,A=d[q];for(f in a.query)e=a.query[f],v._containsValue(A,f,e,k[f])||(t=!1);t&&b.push(A)}}else b=d.slice(0,d.length);p(b,a)};if(this._loadFinished)l(c,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:c,
filter:l});else{this._loadInProgress=!0;var h=g.get({url:v.url,handleAs:"text",preventCache:v.urlPreventCache});h.addCallback(function(a){try{v._processData(a),l(c,v._arrayOfAllItems),v._handleQueuedFetches()}catch(d){r(d,c)}});h.addErrback(function(a){v._loadInProgress=!1;if(r)r(a,c);else throw a;});var n=null;c.abort&&(n=c.abort);c.abort=function(){var a=h;a&&-1===a.fired&&(a.cancel(),a=null);n&&n.call(c)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,l(c,this._arrayOfAllItems)}catch(b){r(b,
c)}else{var a=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(r)r(a,c);else throw a;}},close:function(c){},_getArrayOfArraysFromCsvFileContents:function(c){if(r.isString(c)){var g=/^\s+/g,p=/\s+$/g,v=/""/g,l=[],h=this._splitLines(c);for(c=0;c<h.length;++c){var n=h[c];if(0<n.length){for(var n=n.split(this.separator),a=0;a<n.length;){var b=n[a].replace(g,""),d=b.replace(p,""),m=d.charAt(0),f=d.charAt(d.length-1),e=d.charAt(d.length-2),q=d.charAt(d.length-
3);if(2===d.length&&'""'==d)n[a]="";else if('"'==m&&('"'!=f||'"'==f&&'"'==e&&'"'!=q)){if(a+1===n.length)return;n[a]=b+this.separator+n[a+1];n.splice(a+1,1)}else'"'==m&&'"'==f&&(d=d.slice(1,d.length-1),d=d.replace(v,'"')),n[a]=d,a+=1}l.push(n)}}this._attributes=l.shift();for(c=0;c<this._attributes.length;c++)this._attributeIndexes[this._attributes[c]]=c;this._dataArray=l}},_splitLines:function(c){var g=[],p,v="",l=!1;for(p=0;p<c.length;p++){var h=c.charAt(p);switch(h){case '"':l=!l;v+=h;break;case "\r":l?
v+=h:(g.push(v),v="",p<c.length-1&&"\n"==c.charAt(p+1)&&p++);break;case "\n":l?v+=h:(g.push(v),v="");break;default:v+=h}}""!==v&&g.push(v);return g},_processData:function(c){this._getArrayOfArraysFromCsvFileContents(c);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(c=0;c<this._dataArray.length;c++){var g=c;this.identifier&&(g=this._dataArray[c][this._attributeIndexes[this.identifier]],
this._idMap[g]=c);this._arrayOfAllItems.push(this._createItemFromIdentity(g))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(c){var g={};g[this._storeProp]=this;g[this._idProp]=c;return g},getIdentity:function(c){return this.isItem(c)?c[this._idProp]:null},fetchItemByIdentity:function(c){var r,v=c.scope?c.scope:p.global;if(this._loadFinished)r=this._createItemFromIdentity(c.identity),this.isItem(r)||(r=null),c.onItem&&c.onItem.call(v,r);else{var u=this;if(""!==this.url)this._loadInProgress?
this._queuedFetches.push({args:c}):(this._loadInProgress=!0,r=g.get({url:u.url,handleAs:"text"}),r.addCallback(function(g){try{u._processData(g);var h=u._createItemFromIdentity(c.identity);u.isItem(h)||(h=null);c.onItem&&c.onItem.call(v,h);u._handleQueuedFetches()}catch(n){c.onError&&c.onError.call(v,n)}}),r.addErrback(function(g){this._loadInProgress=!1;c.onError&&c.onError.call(v,g)}));else if(this._csvData)try{u._processData(u._csvData),u._csvData=null,r=u._createItemFromIdentity(c.identity),u.isItem(r)||
(r=null),c.onItem&&c.onItem.call(v,r)}catch(l){c.onError&&c.onError.call(v,l)}}},getIdentityAttributes:function(c){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var c=0;c<this._queuedFetches.length;c++){var g=this._queuedFetches[c],p=g.filter,r=g.args;p?p(r,this._arrayOfAllItems):this.fetchItemByIdentity(g.args)}this._queuedFetches=[]}}});r.extend(c,x);return c})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l){r=r(z,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(h){this._geocodeHandler=c.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=c.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=c.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},
outSpatialReference:null,setOutSpatialReference:function(c){this.outSpatialReference=c},_geocodeHandler:function(c,n,a,b,d){try{var m=c.candidates,f;n=[];var e,q=m.length,k=c.spatialReference,t;for(e=0;e<q;e++){f=m[e];if(t=f.location)t.spatialReference=k;n[e]=new l(f)}this._successHandler([n],"onAddressToLocationsComplete",a,d)}catch(A){this._errorHandler(A,b,d)}},_geocodeAddressesHandler:function(c,n,a,b,d){try{var m=c.locations;n=[];var f,e=m.length,q=c.spatialReference,k;for(f=0;f<e;f++){if(k=
m[f].location)k.spatialReference=q;n[f]=new l(m[f])}this._successHandler([n],"onAddressesToLocationsComplete",a,d)}catch(t){this._errorHandler(t,b,d)}},addressToLocations:function(h,n,a,b,d){var m,f,e,q,k,t,A;h.address&&(b=a,a=n,n=h.outFields,d=h.searchExtent,A=h.countryCode,m=h.magicKey,f=h.distance,t=h.categories,h.location&&this.normalization&&(e=h.location.normalize()),q=h.maxLocations,k=h.forStorage,h=h.address);d&&(d=d.shiftCentralMeridian());var B=this.outSpatialReference;h=this._encode(c.mixin({},
this._url.query,h,{f:"json",outSR:B&&u.toJson(B.toJson()),outFields:n&&n.join(",")||null,searchExtent:d&&u.toJson(d.toJson()),category:t&&t.join(",")||null,countryCode:A||null,magicKey:m||null,distance:f||null,location:e||null,maxLocations:q||null,forStorage:k||null}));var C=this._geocodeHandler,g=this._errorHandler,l=new p(w._dfdCanceller);l._pendingDfd=y({url:this._url.path+"/findAddressCandidates",content:h,callbackParamName:"callback",load:function(e,d){C(e,d,a,b,l)},error:function(a){g(a,b,l)}});
return l},suggestLocations:function(h){var n;n=new p(w._dfdCanceller);h.hasOwnProperty("location")&&this.normalization&&(h.location=h.location.normalize());h.searchExtent&&(h.searchExtent=h.searchExtent.shiftCentralMeridian());h=this._encode(c.mixin({},this._url.query,{f:"json",text:h.text,maxSuggestions:h.maxSuggestions,searchExtent:h.searchExtent&&u.toJson(h.searchExtent.toJson()),category:h.categories&&h.categories.join(",")||null,countryCode:h.countryCode||null,location:h.location||null,distance:h.distance||
null},{f:"json"}));h=y({url:this._url.path+"/suggest",content:h,callbackParamName:"callback"});n._pendingDfd=h;h.then(c.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);n.resolve(a)}),c.hitch(this,function(a){this._errorHandler(a);n.reject(a)}));return n},addressesToLocations:function(h,n,a){var b=this.outSpatialReference,d=[],m=h.categories,f=h.countryCode;g.forEach(h.addresses,function(a,b){d.push({attributes:a})});h=this._encode(c.mixin({},this._url.query,{category:m&&
m.join(",")||null,sourceCountry:f||null},{addresses:u.toJson({records:d})},{f:"json",outSR:b&&u.toJson(b.toJson())}));var e=this._geocodeAddressesHandler,q=this._errorHandler,k=new p(w._dfdCanceller);k._pendingDfd=y({url:this._url.path+"/geocodeAddresses",content:h,callbackParamName:"callback",load:function(b,d){e(b,d,n,a,k)},error:function(b){q(b,a,k)}});return k},_reverseGeocodeHandler:function(c,n,a,b,d){try{var m=new l({address:c.address,location:c.location,score:100});this._successHandler([m],
"onLocationToAddressComplete",a,d)}catch(f){this._errorHandler(f,b,d)}},locationToAddress:function(h,n,a,b){h&&this.normalization&&(h=h.normalize());var d=this.outSpatialReference;h=this._encode(c.mixin({},this._url.query,{outSR:d&&u.toJson(d.toJson()),location:h&&u.toJson(h.toJson()),distance:n,f:"json"}));var m=this._reverseGeocodeHandler,f=this._errorHandler,e=new p(w._dfdCanceller);e._pendingDfd=y({url:this._url.path+"/reverseGeocode",content:h,callbackParamName:"callback",load:function(d,k){m(d,
k,a,b,e)},error:function(a){f(a,b,e)}});return e},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});x("extend-esri")&&c.setObject("tasks.Locator",r,v);return r})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(r,c,g,p,u){r=r(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(g){c.mixin(this,
g);this.location=new u(this.location)}});g("extend-esri")&&c.setObject("tasks.AddressCandidate",r,p);return r})},"widgets/DataAggregation/js/UI/Addresses":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dojo/on dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Addresses.html dijit/form/Select dijit/form/RadioButton".split(" "),function(r,c,g,p,u,x,v,y,w,z,l,h,n){return r([y,
w,z,l],{baseClass:"cf-addresses",declaredClass:"CriticalFacilities.Addresses",templateString:h,_started:null,label:"Addresses",parent:null,nls:null,map:null,appConfig:null,config:null,singleFields:[],multiFields:[],fields:[],useSingle:!0,useMulti:!1,theme:"",styleColor:"",singleEnabled:!1,multiEnabled:!1,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);this._initControls()},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=
!1},validate:function(a,b){var d=new x;"next-view"===a?d.resolve(this._nextView(b)):"back-view"===a?d.resolve(this._backView(b)):this._homeView(b).then(function(a){d.resolve(a)});return d},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=
this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(a){if(a.currentView.label===this.label){a=this._getResults();var b=!1;g.forEach(a.fields,function(a){"undefined"!==typeof a.value&&null!==a.value&&""!==a.value&&(b=!0)});this.parent._locationMappingComplete=b;this.emit("location-mapping-update",b)}return!0},_backView:function(a){a.currentView.label===this.label&&(this.parent._locationMappingComplete=!1,this.emit("location-mapping-update",
!1));return!0},_homeView:function(a){var b=new x;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_rdoSingleAddressClick:function(){this.rdoSingleAddress.set("checked",!0)},_rdoSingleAddressChanged:function(a){this.useSingle=a;this._toggleVisibility(this.singleFieldTable,a)},_rdoMultiAddressClick:function(){this.rdoMultiAddress.set("checked",!0)},_rdoMultiAddressChanged:function(a){this.useMulti=a;this._toggleVisibility(this.multiFieldTable,
a)},_toggleVisibility:function(a,b){var d=b?"display-table-row-group":"display-none";u.contains(a,d)||u.add(a,d);b=b?"display-none":"display-table-row-group";u.contains(a,b)&&u.remove(a,b)},_initControls:function(){this.own(v(this.rdoSingleAddress,"change",c.hitch(this,this._rdoSingleAddressChanged)));this.own(v(this.rdoMultiAddress,"change",c.hitch(this,this._rdoMultiAddressChanged)));var a=this.singleEnabled,b=this.multiEnabled;a&&b?(this.rdoSingleAddress.set("checked",this.useSingle),this._toggleVisibility(this.singleFieldTable,
this.useSingle),this.rdoMultiAddress.set("checked",this.useMulti),this._toggleVisibility(this.multiFieldTable,this.useMulti),this._setFields(this.singleFields,this.fields,this.singleFieldTable),this._setFields(this.multiFields,this.fields,this.multiFieldTable),u.contains(this.singleSubTaskHintTr,"bottom-border-bold")&&u.remove(this.singleSubTaskHintTr,"bottom-border-bold"),u.add(this.singleSubTaskHintTr,"bottom-border")):a?(this.useSingle=!0,this.useMulti=!1,this._setFields(this.singleFields,this.fields,
this.singleFieldTable),this._initTableDisplay([this.multiAddressRow,this.mainInstructionRow,this.singleRadioRow],[this.singleFieldHintTd,this.singleFieldTableRow],[],[this.singleSubTaskHintTd])):b&&(this.useMulti=!0,this.useSingle=!1,this._setFields(this.multiFields,this.fields,this.multiFieldTable),this._initTableDisplay([this.singleAddressRow,this.mainInstructionRow,this.multiRadioRow],[this.multiFieldHintTd,this.multiFieldTableRow],[],[this.multiSubTaskHintTd]))},_initTableDisplay:function(a,b,
d,m){g.forEach(a,c.hitch(this,function(a){this._toggleVisibility(a,!1)}));g.forEach(b,c.hitch(this,function(a){u.add(a,"no-padding")}));g.forEach(d,c.hitch(this,function(a){u.add(a,"pad-bottom-10")}));g.forEach(m,function(a){u.contains(a,"pad-left-20")&&u.remove(a,"pad-left-20");u.add(a,"pad-left-5")})},_setFields:function(a,b,d){var m=0;g.forEach(a,c.hitch(this,function(f){var e=p.create("tr",{},d);e.keyField=f.value;e.label=f.label;var q=p.create("td",{className:"field-control-td pad-left-15"},
e);p.create("div",{className:"main-text float-left min-width-80",innerHTML:f.label},q);var q=p.create("td",{className:"field-control-td"},e),k=new n({name:"field"+m,fieldName:f.label,className:"field-control"}),t=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],A=this._getDefaultFieldName(b,f);g.forEach(b,function(a){t.push({label:a.label,value:a.value,selected:a.value===A})});k.addOption(t);k.placeAt(q);k.startup();e.fieldControl=k;m+=1;1<a.length&&u.add(e,"bottom-border")}))},
_getDefaultFieldName:function(a,b){b=b.isRecognizedValues;for(var d=0;d<b.length;d++)for(var m=b[d],f=0;f<a.length;f++){var e=a[f];if(e.value.toString().toUpperCase()===m.toString().toUpperCase())return e.value}},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){},_getResults:function(){var a=[],b={},d=this.nls.warningsAndErrors.noValue;g.forEach((this.useSingle?this.singleFieldTable:this.multiFieldTable).rows,function(m){var f=m.fieldControl.get("value"),e=m.label;m=m.keyField;
f!==d?(a.push({keyField:m,value:f,label:e}),b[m]=f):(a.push({keyField:m,value:void 0,label:e}),b[m]=void 0)});return{type:this.useSingle?"single":"multi",fields:a,mappedArrayFields:b}}})})},"widgets/DataAggregation/js/UI/Coordinates":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/Coordinates.html dojo/_base/array dijit/form/Select".split(" "),function(r,
c,g,p,u,x,v,y,w,z,l){return r([u,x,v,y],{baseClass:"cf-coordinates",declaredClass:"CriticalFacilities.Coordinates",templateString:w,_started:null,label:"Coordinates",parent:null,nls:null,map:null,appConfig:null,config:null,fields:[],xField:null,yField:null,theme:"",styleColor:"",firstField:"",constructor:function(h){c.mixin(this,h)},postCreate:function(){this.inherited(arguments);this._initUI()},_initUI:function(){"X"===this.firstField?(this._initXField(),this._initYField()):(this._initYField(),this._initXField());
this._setFields(this.fields,this.xField,this.yField)},_initXField:function(){var c=this._initSelectTd(this.xField.label+":");this.lblX=c.label;this.selectX=new l({name:"selectX",style:"min-width: 200px"});this.selectX.placeAt(c.select);this.selectX.startup()},_initYField:function(){var c=this._initSelectTd(this.yField.label+":");this.lblY=c.label;this.selectY=new l({name:"selectY",style:"min-width: 200px"});this.selectY.placeAt(c.select);this.selectY.startup()},_initSelectTd:function(c){var h=p.create("tr",
{className:"bottom-border"},this.coordinateTable),a=p.create("td",{className:"field-control-td pad-left-10"},h),a=p.create("div",{className:"main-text float-left"},a);a.innerHTML=c;return{select:p.create("td",{className:"float-right field-control-td"},h),label:a}},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(c,n){var a=new g;"next-view"===c?a.resolve(this._nextView(n)):"back-view"===c?a.resolve(this._backView(n)):
this._homeView(n).then(function(b){a.resolve(b)});return a},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"),this._locationTypeView=this.pageContainer.getViewByTitle("LocationType"),this._startPageView&&this._locationTypeView?(this.altNextIndex=this._startPageView.index,this.altBackIndex=this._locationTypeView.index):this._startPageView&&(this.altBackIndex=this.altNextIndex=this._startPageView.index))},_nextView:function(c){c.currentView.label===
this.label&&(c=0<this._getResults().fields.length,this.parent._locationMappingComplete=c,this.emit("location-mapping-update",c));return!0},_backView:function(c){c.currentView.label===this.label&&(this.parent._locationMappingComplete=!1,this.emit("location-mapping-update",!1));return!0},_homeView:function(c){var h=new g;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(a){h.resolve(a)});return h},_setFields:function(c,n,a){var b=this._getDefaultFieldName(c,n),d=this._getDefaultFieldName(c,
a),m=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],f=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}];z.forEach(c,function(a){m.push({label:a.label,value:a.value,selected:b===a.value});f.push({label:a.label,value:a.value,selected:d===a.value})});this.selectX.addOption(m);this.selectY.addOption(f)},_getDefaultFieldName:function(c,n){n=n.isRecognizedValues;for(var a=0;a<n.length;a++)for(var b=n[a],d=0;d<c.length;d++){var m=
c[d];if(m.value.toString().toUpperCase()===b.toString().toUpperCase())return m.value}},setStyleColor:function(c){this.styleColor=c},updateImageNodes:function(){},_getResults:function(){return{type:"xy",fields:this.selectX.value!==this.nls.warningsAndErrors.noValue&&this.selectY.value!==this.nls.warningsAndErrors.noValue?[{targetField:"X",sourceField:this.selectX.value},{targetField:"Y",sourceField:this.selectY.value}]:[]}}})})},"widgets/DataAggregation/js/UI/FieldMapping":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FieldMapping.html jimu/dijit/SimpleTable dijit/form/Select".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n){return r([v,y,w,z],{baseClass:"cf-field-mapping",declaredClass:"CriticalFacilities.FieldMapping",templateString:l,_started:null,label:"FieldMapping",parent:null,nls:null,map:null,appConfig:null,config:null,targetFields:[],sourceFields:[],_fieldsTable:null,theme:"",styleColor:"",constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);this._initFieldsTable();this._initFields(this.targetFields)},startup:function(){this._started=!0;
this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},_updateAltIndexes:function(){this.pageContainer&&!this._startPageView&&(this._startPageView=this.pageContainer.getViewByTitle("StartPage"))&&(this.altBackIndex=this.altNextIndex=this._startPageView.index)},validate:function(a,b){var d=new x;"next-view"===a?d.resolve(this._nextView(b)):"back-view"===a?d.resolve(this._backView(b)):this._homeView(b).then(function(a){d.resolve(a)});return d},_nextView:function(a){if(a.currentView.label===
this.label){var b=this._getResults(),d=!1;a=Object.keys(b.results).map(function(a){return b.results[a]});g.forEach(a,function(a){"undefined"!==typeof a&&null!==a&&""!==a&&(d=!0)});this.parent._fieldMappingComplete=d;this.emit("field-mapping-update",d,b.results)}return!0},_backView:function(a){a.currentView.label===this.label&&(this.parent._fieldMappingComplete=!1,this.emit("field-mapping-update",!1));return!0},_homeView:function(a){var b=new x;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});
return b},_initFieldsTable:function(){var a=[{name:"targetField",type:"extension",hidden:!0,create:c.hitch(this,this._createTargetField),setValue:c.hitch(this,this._setTargetFieldValue),getValue:c.hitch(this,this._getTargetFieldValue)},{name:"target",title:this.nls.fieldMapping.targetField,type:"text","class":"task-instruction-row"},{name:"label",title:this.nls.fieldMapping.sourceField,type:"extension",hidden:!1,create:c.hitch(this,this._createSelect),setValue:c.hitch(this,this._setSelectValue),getValue:c.hitch(this,
this._getSelectValue)}];this._fieldsTable=new h({fields:a,selectable:!1,autoHeight:!0,_rowHeight:"LaunchpadTheme"===this.appConfig.theme.name?36:30});this._fieldsTable.placeAt(this.fieldMappingTable);this._fieldsTable.startup()},_setTargetFieldValue:function(a,b){a.targetField=b},_getTargetFieldValue:function(a){return a.targetField},_createSelect:function(a){var b=new n({style:{display:"table",width:"100%",height:"28px"}}),d=a.parentNode.cells[0].targetField,m=this._getSupportedFields(this.sourceFields,
d.type,d.length),f=[{label:this.nls.warningsAndErrors.noValue,value:this.nls.warningsAndErrors.noValue}],e=this._getDefaultFieldName(m,d);g.forEach(m,function(a){f.push({label:a.label,value:a.value,selected:e===a.value})});b.addOption(f);a.fieldsSelect=b;p.place(b.domNode,a);u.add(a,"float-left");u.add(a,"width-all")},_getSelectValue:function(a){return a.fieldsSelect.get("value")},_setSelectValue:function(a,b){a.fieldsSelect.set("value",b)},_initFields:function(a){g.forEach(a,c.hitch(this,function(a){this._fieldsTable.addRow({target:a.label,
targetField:a})}))},_getSupportedFields:function(a,b,d){return a.filter(function(a){if(a.type){var f=a.type.supportsInt,e=a.type.supportsFloat,q=a.type.supportsDate;a=a.type.maxLength;return"date"!==b&&a>d?!1:"other"===b||"domain"===b?!0:"int"===b||"domainInt"===b?f:"float"===b?e:"date"===b?q:!1}return!1})},_getDefaultFieldName:function(a,b){b=b.isRecognizedValues;for(var d=0;d<b.length;d++)for(var m=b[d],f=0;f<a.length;f++){var e=a[f];if(e.value.toString().toUpperCase()===m.toString().toUpperCase())return e.value}},
setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){},_getResults:function(){var a=this._fieldsTable.getRows(),b={},d=this.nls.warningsAndErrors.noValue,m=!1,f;g.forEach(a,function(a){var e=a.cells[2].fieldsSelect.getValue();e!==d?(a=a.cells[0].targetField.name,b[a]=e,m||(f=a,m=!0)):b[a.cells[0].targetField.name]=void 0});return{results:b,labelField:f}}})})},"widgets/DataAggregation/js/UI/StartPage":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/StartPage.html dojo/dom-class dojo/query esri/lang ./Review jimu/utils".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b){return r([x,v,y,w],{baseClass:"cf-startpage",declaredClass:"CriticalFacilities.StartPage",templateString:z,_started:null,label:"StartPage",parent:null,nls:null,map:null,appConfig:null,config:null,theme:"",styleColor:"",state:"mapping",csvStore:null,_syncFields:{},singleEnabled:!1,multiEnabled:!1,xyEnabled:!1,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.locationAndFieldHint.innerHTML=n.substitute({layerName:this.parent.editLayer.name},
this.nls.startPage.locationAndFieldHint)},startup:function(){this._started=!0;this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0;this.updateImageNodes()},onShown:function(){this._initDependencies();this._validateStatus();this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},setStyleColor:function(a){this.styleColor=a},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",f=a?"next-arrow-img-white":
"next-arrow-img",a=h("."+b,this.domNode);g.forEach(a,function(a){l.remove(a,b);l.add(a,f)})},validate:function(a,b){var d=new u;"next-view"===a?d.resolve(this._nextView(b)):"back-view"===a?d.resolve(this._backView()):"home-view"===a&&this._homeView(b).then(function(a){d.resolve(a)});return d},_nextView:function(a){a.navView.label===this.label&&this.pageContainer.toggleController(!1);if(this.parent._locationMappingComplete&&this.parent._fieldMappingComplete)return this.nextDisabled=!0,!1;this.pageContainer.backDisabled=
!1;return!0},_backView:function(){return 0<this.pageContainer._backLabels.length},_homeView:function(a){var b=new u;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_locationMappingClick:function(){this._validateStatus();this._setViewByTitle(this.xyEnabled&&(this.multiEnabled||this.singleEnabled)?"LocationType":this.xyEnabled?"Coordinates":"Addresses")},_schemaMappingClick:function(){this._validateStatus();this._setViewByTitle("FieldMapping")},
_setViewByTitle:function(a){a=this.pageContainer.getViewByTitle(a);this.pageContainer.selectView(a.index)},_initDependencies:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView&&!this._fieldMappingView){this.xyEnabled&&(this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates"),this.own(p(this._coordinatesView,"location-mapping-update",c.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()}))));if(this.singleEnabled||this.multiEnabled)this._addressView=
this.pageContainer.getViewByTitle("Addresses"),this.own(p(this._addressView,"location-mapping-update",c.hitch(this,function(a){this.parent._locationMappingComplete=a;this._validateStatus()})));this._fieldMappingView=this.pageContainer.getViewByTitle("FieldMapping");this.own(p(this._fieldMappingView,"field-mapping-update",c.hitch(this,function(a){this.parent._fieldMappingComplete=a;this._validateStatus()})));(this._locationTypeView=this.xyEnabled&&(this.singleEnabled||this.multiEnabled)?this.pageContainer.getViewByTitle("LocationType"):
this.xyEnabled?this._coordinatesView:this._addressView)&&!this.parent._locationMappingComplete&&(this.altNextIndex=this._locationTypeView.index)}},_validateStatus:function(){this._updateNode(this.locationMappingComplete,this.parent._locationMappingComplete);this._updateNode(this.fieldMappingComplete,this.parent._fieldMappingComplete);var a=this.pageContainer.backDisabled=!1;this.parent._locationMappingComplete&&this.parent._fieldMappingComplete&&"mapping"===this.state?(a=!0,this.pageContainer.nextDisabled=
!0):!this.parent._locationMappingComplete&&this._locationTypeView?this.altNextIndex=this._locationTypeView.index:!this.parent._fieldMappingComplete&&this._fieldMappingView&&(this.altNextIndex=this._fieldMappingView.index);a||(this.pageContainer.nextDisabled=!1);this._updateNode(this.addToMapButton,a)},_updateNode:function(a,b){b?l.contains(a,"display-none")&&l.remove(a,"display-none"):l.contains(a,"display-none")||l.add(a,"display-none")},_addToMapClick:function(){this._updateNode(this.addToMapButton,
!1);this._updateNode(this.progressNode,!0);var a=this._fieldMappingView._getResults(),b=this._locationTypeView._getResults();this._syncFields=this._checkFields(a.results,b);this._locateFeatures(a,b)},_checkFields:function(a,b){var d={};b&&b.fields&&g.forEach(b.fields,function(b){var e=b.value?b.value:b.sourceField;b=b.keyField?b.keyField:b.sourceField;if("undefined"!==typeof e&&"undefined"!==typeof b&&!d.hasOwnProperty(e)&&a)for(var k=Object.keys(a),t=0;t<k.length;t++)if(a[k[t]]===e){d[b]={layerFieldName:k[t]};
break}});return d},_locateFeatures:function(a,b){this.csvStore.useMultiFields="multi"===b.type?!0:!1;this.csvStore.mappedArrayFields=a.results;this.csvStore.labelField=a.labelField;if("single"===b.type)this.csvStore.addrFieldName=b.fields[0].keyField,this.csvStore.singleFields=b.fields;else if("multi"===b.type)this.csvStore.multiFields=b.fields;else if("xy"===b.type){this.csvStore.useAddr=!1;var d=b.fields[0];b=b.fields[1];this.csvStore.xFieldName="X"===d.targetField?d.sourceField:b.sourceField;this.csvStore.yFieldName=
"Y"===b.targetField?b.sourceField:d.sourceField}this.csvStore.processForm().then(c.hitch(this,function(b){this._addResultView({matchedFeatures:this._formatFeatures(b.matchedLayer,a.labelField),matchedLayer:b.matchedLayer,unMatchedFeatures:this._formatFeatures(b.unMatchedLayer,a.labelField),unMatchedLayer:b.unMatchedLayer,duplicateFeatures:this._formatFeatures(b.duplicateLayer,a.labelField,b.duplicateLookupList),duplicateLayer:b.duplicateLayer});this.state="review";this._reviewView=this.pageContainer.getViewByTitle("Review");
this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!0;this.pageContainer._backLabels=[];this.pageContainer.altHomeIndex=this._reviewView.index;this._updateNode(this.progressNode,!1);this.pageContainer.selectView(this._reviewView.index,!0);this.pageContainer._backLabels=[]}),c.hitch(this,function(a){console.log(a);this._updateNode(this.progressNode,!1)}))},_formatFeatures:function(a,m,f){var e=[];if(a){var d=a.objectIdField;this._currentFields=a.fields;g.forEach(a.graphics,c.hitch(this,
function(a){var k=[],q;f&&(q=f[a.attributes[d]]);g.forEach(Object.keys(a.attributes),c.hitch(this,function(e){var d=this._currentFields.filter(function(a){return a.name===e}),t=a.attributes[e],f=!1;"."!==this.csvStore.decimalSeperator&&(f=d&&d.hasOwnProperty("length")&&1===d.length&&d[0].hasOwnProperty("type")&&"esriFieldTypeDouble"===d[0].type)&&(t=-1===[null,void 0,""].indexOf(t)?t.toString().replace(this.csvStore.decimalSeperator,"."):t);d={name:e,label:d&&d.hasOwnProperty("length")&&1===d.length&&
d[0].alias?d[0].alias:e,formattedValue:f&&-1===[null,void 0].indexOf(t)?b.localizeNumber(t):t,value:t,needsFormat:f};q&&(d.duplicateFieldInfo={value:q[e]});k.push(d)}));var h=k.filter(function(a){return a.name===m&&a.needsFormat});e.push({label:h&&h.hasOwnProperty("length")&&1===h.length?h[0].formattedValue:a.attributes[m],fieldInfo:k,geometry:a.geometry,address:""})}))}return e},_addResultView:function(b){var d=new a({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,
matchedList:b.matchedFeatures,unMatchedList:b.unMatchedFeatures,duplicateList:b.duplicateFeatures,theme:this.theme,csvStore:this.csvStore,editLayer:this.parent.editLayer,matchedLayer:b.matchedLayer,unMatchedLayer:b.unMatchedLayer,duplicateLayer:b.duplicateLayer,duplicateLookupList:b.duplicateLookupList,_syncFields:this._syncFields});this.pageContainer.addView(d);this._zoomToAllFeatures([b.matchedLayer,b.unMatchedLayer,b.duplicateLayer])},_zoomToAllFeatures:function(a){var b=[];g.forEach(a,function(a){if(a&&
a.graphics)for(var e=0;e<a.graphics.length;e++)b.push(a.graphics[e])});this.csvStore._zoomToData(b)}})})},"widgets/DataAggregation/js/UI/Review":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/text!./templates/Review.html dojo/query dojo/on ./FeatureList jimu/dijit/Message jimu/CSVUtils esri/toolbars/edit esri/lang esri/graphic".split(" "),function(r,c,g,p,u,
x,v,y,w,z,l,h,n,a,b,d,m,f){return r([u,x,v,y],{baseClass:"cf-review",declaredClass:"CriticalFacilities.Review",templateString:z,_started:null,label:"Review",parent:null,nls:null,map:null,appConfig:null,config:null,matchedList:[],unMatchedList:[],duplicateList:[],theme:"",styleColor:"",csvStore:null,editLayer:null,matchedLayer:null,unMatchedLayer:null,duplicateLayer:null,_editToolbar:null,_syncFields:{},_currentIndex:0,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);
this._initReviewRows();this._editToolbar=new d(this.map);this.reviewDuplicateHint.innerHTML=m.substitute({layerName:this.editLayer.name},this.nls.review.reviewDuplicateHint);this.reviewDataHint.innerHTML=m.substitute({layerName:this.editLayer.name},this.nls.review.reviewDataHint)},startup:function(){this._started=!0;this._initNavPages();this._updateIndexesList();this.updateImageNodes();this.altNextIndex=this.altNextIndexes[this._currentIndex];this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?
this._currentIndex+1:0;this.own(h(this.pageContainer,"nav-view",c.hitch(this,this._navView)))},onShown:function(){this.pageContainer.backDisabled=0<this.pageContainer._backLabels.length?!1:!0},_navView:function(a){a===this.index&&(this._updateIndexesList(),this._currentIndex<this.altNextIndexes.length?(this.altNextIndex=this.altNextIndexes[this._currentIndex],this._currentIndex=this._currentIndex+1<this.altNextIndexes.length?this._currentIndex+1:0):(this._currentIndex=0,this.altNextIndex=this.altNextIndexes[this._currentIndex]))},
validate:function(a,b){var e=new w;"next-view"===a?e.resolve(this._nextView()):"back-view"===a?e.resolve(this._backView(b)):this._homeView(b).then(function(a){e.resolve(a)});return e},_nextView:function(){return!0},_backView:function(a){return 0<this.pageContainer._backLabels.length?!0:a.navView>this.index},_homeView:function(a){var b=new w;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_updateIndexesList:function(){this.altNextIndexes=[];
0<this.unMatchedList.length&&this.altNextIndexes.push(this._unMatchedListView.index);0<this.duplicateList.length&&this.altNextIndexes.push(this._duplicateListView.index);0<this.matchedList.length&&this.altNextIndexes.push(this._matchedListView.index)},_initNavPages:function(){this.pageContainer&&(this._addMatchedFeaturesList(),0<this.unMatchedList.length&&this._addUnmatchedFeatureList(),0<this.duplicateList.length&&this._addDuplicateFeatureList());this.pageContainer.selectView(this.index,!0)},_addMatchedFeaturesList:function(){this.matchedFeatureList=
this._initFeatureList(this.matchedList,this.matchedLayer,"MatchedFeatures",this.nls.review.reviewMatchedHint,this.nls.review.reviewMatched,!1);this.pageContainer.addView(this.matchedFeatureList);this._updateNode(this.submitButton,0<this.matchedList.length);this._matchedListView=this.pageContainer.getViewByTitle(this.matchedFeatureList.label);this.own(h(this.matchedFeatureList,"feature-list-updated",c.hitch(this,function(a){this.matchedCount.innerHTML=a;this._initReviewRow(this.matchedList,[this.matchedHintRow,
this.matchedControlRow],this.matchedCount);this._updateNode(this.submitButton,0<this.matchedList.length)})))},_addUnmatchedFeatureList:function(){this.unMatchedFeatureList=this._initFeatureList(this.unMatchedList,this.unMatchedLayer,"UnMatchedFeatures",this.nls.review.reviewUnMatchedHint,this.nls.review.reviewUnMatched,!1);this.pageContainer.addView(this.unMatchedFeatureList);this._unMatchedListView=this.pageContainer.getViewByTitle(this.unMatchedFeatureList.label);this.own(h(this.unMatchedFeatureList,
"feature-list-updated",c.hitch(this,function(a){this.unMatchedCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._unMatchedListView)})))},_addDuplicateFeatureList:function(){var a=m.substitute({layerName:this.editLayer.name},this.nls.review.reviewDuplicateHint);this.duplicateFeatureList=this._initFeatureList(this.duplicateList,this.duplicateLayer,"DuplicateFeatures",a,this.nls.review.reviewDuplicate,!0);this.pageContainer.addView(this.duplicateFeatureList);this._duplicateListView=this.pageContainer.getViewByTitle(this.duplicateFeatureList.label);
this.own(h(this.duplicateFeatureList,"feature-list-updated",c.hitch(this,function(a){this.duplicateCount.innerHTML=a;0===a&&this.pageContainer.removeView(this._duplicateListView)})))},_initFeatureList:function(a,b,k,d,f,c){return new n({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,hint:d,_title:f,label:k,features:a,theme:this.theme,isDuplicate:c,layer:b,_editToolbar:this._editToolbar,csvStore:this.csvStore,_syncFields:this._syncFields})},_initReviewRows:function(){this._initReviewRow(this.matchedList,
[this.matchedHintRow,this.matchedControlRow],this.matchedCount);this._initReviewRow(this.unMatchedList,[this.unMatchedHintRow,this.unMatchedControlRow],this.unMatchedCount);this._initReviewRow(this.duplicateList,[this.duplicateHintRow,this.duplicateControlRow],this.duplicateCount)},_initReviewRow:function(a,b,k){0<a.length?(g.forEach(b,function(a){p.contains(a,"display-none")&&p.remove(a,"display-none")}),k.innerHTML=a.length):g.forEach(b,function(a){p.contains(a,"display-none")||p.add(a,"display-none")})},
_updateReviewRows:function(a){this._initReviewRows();(a="unmatched"===a&&this.unMatchedFeatureList?this.unMatchedFeatureList:"duplicate"===a&&this.duplicateFeatureList?this.duplicateFeatureList:void 0)&&a.features&&0===a.features.length&&this.pageContainer.selectView(this.index,!0)},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",k=a?"next-arrow-img-white":"next-arrow-img",a=l("."+b,this.domNode);g.forEach(a,function(a){p.remove(a,b);p.add(a,
k)})},_download:function(){var a;0<this.matchedList.length&&(a=this.csvStore.matchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.matchedFeatureLayer,a));0<this.unMatchedList.length&&(a=this.csvStore.unMatchedFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.unMatchedFeatureLayer,a));0<this.duplicateList.length&&(a=this.csvStore.duplicateFeatureLayer.id.replace(".csv",""),this._export(this.csvStore.duplicateFeatureLayer,a))},_export:function(a,d){var e=[];g.forEach(a.graphics,
function(a){e.push(a.attributes)});var t={};t.datas=e;t.fromClient=!1;t.withGeometry=!1;t.outFields=a.fields;t.formatDate=!0;t.formatCodedValue=!0;t.formatNumber=!1;b.exportCSVFromFeatureLayer(d,a,t)},_submit:function(){this._updateNode(this.submitButton,!1);this._updateNode(this.progressNode,!0);var b=this._getFeatures(this.csvStore.matchedFeatureLayer),d=this._getFeatures(this.csvStore.duplicateFeatureLayer);this.editLayer.applyEdits(b,d,null,c.hitch(this,function(a,b){this._validateResults(a);
this._validateResults(b);this._updateNode(this.progressNode,!1);this._disableUI();this.csvStore._zoomToData(this.editLayer.graphics,!0)}),c.hitch(this,function(){new a({type:"Error",message:this.nls.warningsAndErrors.saveError})}))},_validateResults:function(b){var e=[],k=[];b&&b.hasOwnProperty("length")&&0<b.length&&(g.forEach(b,function(a){"undefined"!==typeof a.success&&(a.success?e.push(a):k.push(a))}),0<k.length&&(b=0===e.length?this.nls.review.noFeaturesSaved:m.substitute({num:k.length},this.nls.review.someFeaturesNotSaved),
new a({message:b})))},_disableUI:function(){this._updateNode(this.submitButton,!0);p.add(this.submitButton,"control-disbaled");p.add(this.reviewRowTable,"control-disbaled");p.add(this.pageContainer.nextTd,"control-disbaled");p.add(this.pageContainer.backTd,"control-disbaled");this.map.infoWindow&&this.map.infoWindow.clearFeatures&&this.map.infoWindow.clearFeatures()},_getFeatures:function(a){var b=[],e=this.csvStore.objectIdField;a&&a.graphics&&g.forEach(a.graphics,c.hitch(this,function(a){a.hasOwnProperty("_graphicsLayer")&&
delete a._graphicsLayer;a.hasOwnProperty("_layer")&&delete a._layer;var k=a.attributes;this._deleteProp(k,e);k.hasOwnProperty("hasDuplicateUpdates")&&k.hasOwnProperty("duplicateState")?k.hasDuplicateUpdates&&"make-change"===k.duplicateState&&(k.hasOwnProperty("DestinationOID")&&(k[this.editLayer.objectIdField]=k.DestinationOID),this._deleteProp(k,"hasDuplicateUpdates"),this._deleteProp(k,"duplicateState"),this._deleteProp(k,"matchScore"),this._deleteProp(k,"DestinationOID"),g.forEach(this.csvStore._matchFields,
c.hitch(this,function(a){this._deleteProp(k,a)})),b.push(a.toJson?new f(a.toJson()):a)):(this._deleteProp(k,"matchScore"),this._deleteProp(k,"DestinationOID"),b.push(a.toJson?new f(a.toJson()):a))}));return 0<b.length?b:null},_deleteProp:function(a,b){a.hasOwnProperty(b)&&delete a[b]},_navigateHome:function(){var a=this.pageContainer.getViewByTitle("Home");a._clearStore(!0);a._clearMapping();this.pageContainer.toggleController(!0);this.pageContainer.selectView(a.index)},_updateNode:function(a,b){b?
p.contains(a,"display-none")&&p.remove(a,"display-none"):p.contains(a,"display-none")||p.add(a,"display-none")},setStyleColor:function(a){this.styleColor=a},_reviewMatched:function(){this.pageContainer.selectView(this._matchedListView.index)},_reviewUnMatched:function(){this.pageContainer.selectView(this._unMatchedListView.index)},_reviewDuplicate:function(){this.pageContainer.selectView(this._duplicateListView.index)}})})},"widgets/DataAggregation/js/UI/FeatureList":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/FeatureList.html dojo/query dojo/Deferred dojo/on ./Feature".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a){return r([x,v,y,w],{baseClass:"cf-feature-list",declaredClass:"CriticalFacilities.FeatureList",templateString:z,label:"FeatureList",parent:null,nls:null,map:null,appConfig:null,config:null,features:[],updateFeatures:[],hint:"",theme:"",styleColor:"",type:"",isDuplicate:!1,layer:null,_editToolbar:null,_syncFields:{},_started:!1,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHint.innerHTML=this.hint;this.pageTitle.innerHTML=
this._title},onShown:function(){this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1},startup:function(){this._started=!0;this._initFeatureList(this.features);this._updateAltIndexes();this.updateImageNodes();this.own(n(this,"feature-list-updated",c.hitch(this,this._updateAltIndexes)));this.own(n(this.pageContainer,"view-index-change",c.hitch(this,this._indexChanged)))},validate:function(a,d){var b=new h;"next-view"===a?b.resolve(this._nextView()):"back-view"===a?b.resolve(this._backView()):
this._homeView(d).then(function(a){b.resolve(a)});return b},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(a){var b=new h;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});return b},_indexChanged:function(a){this._updateAltIndexes();a.oldIndex===this.altNextIndex&&(this.altNextIndex=a.newIndex)},_updateAltIndexes:function(){this.pageContainer&&!this._reviewView&&(this._reviewView=this.pageContainer.getViewByTitle("Review"))&&
(this.altHomeIndex=this.altBackIndex=this._reviewView.index);if(this.featureListTable&&this.featureListTable.rows){var a=this.featureListTable.rows;if(a.length&&0<a.length){var d=a[0].featureView,a=a[a.length-1].featureView;this.altNextIndex=d.index;this.finalFeatureIndex=a.index;a.altNextIndex=this._reviewView.index;d.altBackIndex=this.index}}},_initFeatureList:function(a){var b=0;this.featureListTable.rows.length!==this.features.length&&g.forEach(a,c.hitch(this,function(a){this._initRow(a,b);b+=
1}))},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,d=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",a=l("."+d,this.domNode);g.forEach(a,function(a){u.remove(a,d);u.add(a,c)})},setStyleColor:function(a){this.styleColor=a},_initFeatureView:function(b,d){b=new a({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,label:d,altBackIndex:this.index,isDuplicate:this.isDuplicate,feature:b,theme:this.theme,layer:this.layer,
_editToolbar:this._editToolbar,csvStore:this.csvStore,_parentFeatureList:this,pageContainer:this.pageContainer,pageHint:this.nls.review.reviewFeatureHint,pageTitle:b.label});this.pageContainer.addView(b);return this.pageContainer.getViewByTitle(d)},_initRow:function(a,d){var b=p.create("tr",{className:"bottom-border feature-list-row",onclick:c.hitch(this,function(a){this.pageContainer.selectView(a.currentTarget.featureView.index)})},this.featureListTable);b.featureView=this._initFeatureView(a,this.label+
"_"+d);b.fieldInfo=a.fieldInfo;for(d=0;d<a.fieldInfo.length;d++){var f=a.fieldInfo[d];if(f.name===this.layer.objectIdField){b._featureOID=f.value;break}}d=p.create("td",{className:"pad-10"},b);b.featureView.featureListLabel=p.create("div",{className:"main-text float-left text-left",innerHTML:a.label},d);a=p.create("td",{className:"width-15"},b);p.create("div",{className:"next-arrow float-right next-arrow-img"},a)},removeFeature:function(a,d){for(var b=new h,f=this.featureListTable.rows,e=0;e<f.length;e++){var q=
f[e];if(q._featureOID===d){this.pageContainer._backLabelClone=c.clone(this.pageContainer._backLabels);this.pageContainer.removeView(q.featureView);this.featureListTable.deleteRow(e);a=this.features.indexOf(a);-1<a&&this.features.splice(a,1);this.emit("feature-list-updated",this.features.length);e===this.features.length&&this.pageContainer.selectView(this.altBackIndex);break}}b.resolve("feature-removed");return b},resetFeatureList:function(){if(0<this.featureListTable.rows.length){for(var a=this.featureListTable.rows.length;0<
a;a--)this.pageContainer.removeView(this.featureListTable.rows[a-1].featureView),this.featureListTable.deleteRow(a-1);this.altNextIndex=void 0;this._initFeatureList(this.features);this._updateAltIndexes();this.pageContainer._backLabels=this.pageContainer._backLabelClone;this.updateImageNodes()}},addFeature:function(a){this.features.push(a);this.emit("feature-list-updated",this.features.length)}})})},"widgets/DataAggregation/js/UI/Feature":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dijit/form/ValidationTextBox dijit/form/Select dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/query dijit/form/DateTextBox dojo/text!./templates/Feature.html dojo/Deferred ./FeatureToolbar esri/tasks/query jimu/dijit/Popup jimu/utils esri/lang".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b,d,m,f,e,q){return r([y,w,z,l],{baseClass:"cf-feature",declaredClass:"CriticalFacilities.Feature",templateString:a,_started:null,label:"Feature",parent:null,nls:null,map:null,appConfig:null,config:null,_featureToolbar:null,fields:[],feature:null,fileAddress:{},isDuplicate:!1,isDuplicateLocated:!1,isUnMatchedLocated:!1,isUnMatched:!1,_useGeomFromFile:!1,_useGeomFromLayer:!0,_useValuesFromFile:!1,_useValuesFromLayer:!0,_featureExpanded:!1,_locationExpanded:!1,theme:"",
styleColor:"black",layer:null,_changedFileAttributeRows:[],_changedLayerAttributeRows:[],_changedAddressRows:[],_editToolbar:null,_featureQuery:null,_skipFields:[],csvStore:null,constructor:function(a){c.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHintDiv.innerHTML=this.pageHint;this.pageTitleDiv.innerHTML=this.pageTitle;this._initUnMatched();this._initToolbar(this.featureToolbar);this._updateAltIndexes()},_initUnMatched:function(){if((this.isUnMatched=-1!==this.label.indexOf("UnMatchedFeatures"))&&
this.feature.fieldInfo&&this.feature.fieldInfo.length)for(var a=0;a<this.feature.fieldInfo.length;a++){var b=this.feature.fieldInfo[a];"matchScore"===b.name&&(this.isUnMatchedLocated=0!==b.value)}},_updateAltIndexes:function(){if(this.pageContainer){var a=this.pageContainer.getViewByTitle("Review");a&&(this.altHomeIndex=a.index)}},_initSkipFields:function(a){this._skipFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState",this.layer.objectIdField];g.forEach(a,c.hitch(this,function(a){-1<
a.name.indexOf(this.csvStore.matchFieldPrefix)&&this._skipFields.push(a.name)}))},startup:function(){var a=this.feature.fieldInfo;this._initSkipFields(a);this._initRows(a,this.featureControlTable);this.isDuplicate?this._initDuplicateReview(a):this._initStandardReview();this._getFeature().then(c.hitch(this,function(a){this._feature=a;this._featureToolbar._panToAndSelectFeature(a);!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1)}));this._getEditFeature().then(c.hitch(this,
function(a){this._editFeature=a;this.isDuplicate&&this._editFeature&&this._editFeature.geometry&&this._toggleLocationControls(!0)}));this.onShown()},onShown:function(){this._isReviewed=!0;this._showView();this._featureToolbar._panToAndSelectFeature(this.isDuplicate&&this._useGeomFromLayer?this._editFeature:this._feature);this.isShowing=!0;this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1;!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1);this.isDuplicate&&
this._useGeomFromFile&&"make-change"===this._duplicateFlag.fromSelect.value&&this._toggleEditControls(!1)},onHidden:function(){this.isShowing=!1},validate:function(a,e){var k=new b;"next-view"===a?k.resolve(this._nextView()):"back-view"===a?k.resolve(this._backView()):this._homeView(e).then(function(a){k.resolve(a)});return k},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(a){var e=new b;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){e.resolve(a)});
return e},_showView:function(){u.remove(this.featureTitleTable,"display-none");u.remove(this.featureTable,"display-none");u.remove(this.featureToggleTable,"display-none");u.remove(this.locationSyncTable,"display-none");u.remove(this.locationControlTable,"display-none");u.remove(this.locationControlToggleTable,"display-none");u.remove(this.featureToolbarTable,"display-none");this.isDuplicate&&u.remove(this.reviewText,"display-none");this._updateInfoRows()},_getFeature:function(){var a=new b,e=this.layer.objectIdField,
d=this.feature.fieldInfo.filter(function(a){return a.name===e});this._featureQuery=new m;this._featureQuery.objectIds=[d[0].value];this.layer.queryFeatures(this._featureQuery).then(c.hitch(this,function(b){a.resolve(b.features[0])}));return a},_getEditFeature:function(){var a=new b,e=this.feature.fieldInfo.filter(function(a){return"DestinationOID"===a.name});e&&0<e.length?(this._editQuery=new m,this._editQuery.objectIds=[e[0].value],this.parent.editLayer.queryFeatures(this._editQuery).then(c.hitch(this,
function(b){a.resolve(b.features[0])}))):a.resolve();return a},_initStandardReview:function(){this._useValuesFromFile=!0;this._useValuesFromLayer=!1},_initDuplicateReview:function(a){this._initDuplicateSelect();this._initDuplicateReviewRows(a);u.add(this.featureToolbar,"display-none")},_initDuplicateSelect:function(){var a=new v({style:{display:"table","min-width":"100px",height:"28px"},options:[{label:this.nls.review.duplicateAction,value:"no-change",selected:!0},{label:this.nls.review.duplicateModify,
value:"make-change"},{label:this.nls.review.duplicateSave,value:"not-duplicate"}],onChange:c.hitch(this,this._updateDuplicateUI)});this._duplicateFlag.fromSelect=a;p.place(a.domNode,this._duplicateFlag);a.startup();this._toggleEditControls(!0)},_updateDuplicateUI:function(a){this._updateDuplicateAttributes(a,null);"make-change"===a?u.remove(this.featureToolbar,"display-none"):u.add(this.featureToolbar,"display-none");this._toggleEditControls("make-change"===a?!1:!0);"not-duplicate"===a&&this._showShouldLocateFeaturePopup().then(c.hitch(this,
function(b){b?(this.resetAddressValues(this._featureToolbar._originalValues,a),this._featureToolbar._locateFeature(!0).then(c.hitch(this,function(){var a=new f({titleLabel:this.nls.review.featureLocated,width:400,autoHeight:!0,content:p.create("div",{innerHTML:this.nls.warningsAndErrors.itemMoveMatch,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.ok,onClick:c.hitch(this,c.hitch(this,function(){a.close();a=null}))}],onClose:c.hitch(this,function(){a=null;this._featureToolbar._save(!0)})})}))):
this._duplicateFlag.fromSelect.set("value","no-change")}))},_updateDuplicateAttributes:function(a,b){this._feature.attributes.duplicateState=null!==a?a:this._feature.attributes.duplicateState;this._feature.attributes.hasDuplicateUpdates=null!==b?b:this._feature.attributes.hasDuplicateUpdates},_showShouldLocateFeaturePopup:function(){var a=new b,e=p.create("div");p.create("div",{innerHTML:this.nls.warningsAndErrors.itemWillBeLocated,style:"padding-bottom: 10px;"},e);p.create("div",{innerHTML:this.nls.warningsAndErrors.proceed},
e);var d=new f({titleLabel:this.nls.review.locateFeature,width:400,autoHeight:!0,content:e,buttons:[{label:this.nls.yes,onClick:c.hitch(this,function(){d.close();d=null;a.resolve(!0)})},{label:this.nls.no,onClick:c.hitch(this,function(){d.close();d=null;a.resolve(!1)})}],onClose:function(){d=null}});return a},_initDuplicateReviewRows:function(a){var b=p.create("tr",{className:"bottom-border",isHeaderRow:!0},this.reviewTable);p.create("td",{className:"text-left"},b);var e=p.create("td",{className:"text-left"},
b);p.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},e);b=p.create("td",{className:"text-left"},b);p.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},b);g.forEach(a,c.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var b=p.create("tr",{className:"bottom-border",isLabelRow:!0,isControlRow:!0},this.reviewTable);b.fieldName=a.name;b.parent=this;var e=p.create("td",{className:"field-control-td text-left"},
b);p.create("div",{className:"main-text float-left",innerHTML:a.label},e);this._initLabel(b,a.duplicateFieldInfo.value,!1,!1);this._initLabel(b,a.value,!0,!1)}}))},_initToolbar:function(a){this._featureToolbar=new d({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,feature:this.feature,theme:this.theme,layer:this.layer,featureView:this,_editToolbar:this._editToolbar,csvStore:this.csvStore,_stageLayer:this.csvStore.matchedFeatureLayer,styleColor:this.styleColor,
pageContainer:this.pageContainer});this._featureToolbar.placeAt(a);this._featureToolbar.startup()},_initRows:function(a,b){if(this.isDuplicate){this._initSelectRow(this.nls.review.use,this.locationControlTable,this._useGeomChanged,"geom");this._initSelectRow(this.nls.review.use,this.featureControlTable,this._useValuesChanged,"values");var e=p.create("tr",{className:"bottom-border",isHeaderRow:!0},b);p.create("td",{className:"text-left"},e);var d=p.create("td",{className:"text-left"},e);p.create("div",
{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},d);e=p.create("td",{className:"text-left"},e);p.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},e)}(this._syncEnabled=0<Object.keys(this._parentFeatureList._syncFields).length)?this._syncFields=this._parentFeatureList._syncFields:u.add(this.syncFields,"display-none");var k=0;g.forEach(a,c.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var e=
p.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!0,rowIndex:k},b);e.fieldName=a.name;e.parent=this;var d=p.create("td",{className:"field-control-td text-left field-row-width pad-left-5"},e);p.create("div",{className:"main-text float-left",innerHTML:a.label},d);this.isDuplicate&&this._initValidationBox(e,a.duplicateFieldInfo.value,!1,!1);this._initValidationBox(e,a.value,!0,!1);k+=1}}));this.addressFields=this.csvStore.useMultiFields?this.csvStore.multiFields:this.csvStore.useAddr?
this.csvStore.singleFields:this.getXYFields();g.forEach(this.addressFields,c.hitch(this,function(a){var b=p.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!1,isAddressRow:!0},this.locationControlTable);b.label=a.label;b.keyField=a.keyField;b.parent=this;var e=p.create("td",{className:"field-control-td text-left pad-left-5"},b);p.create("div",{className:"main-text float-left",innerHTML:a.label},e);var d=this.csvStore.matchFieldPrefix,e=this.feature.fieldInfo.filter(function(b){return b.name===
d+a.keyField})[0];this._initValidationBox(b,e.value,!1,!0)}))},_syncAddressInfo:function(){if(!this._featureToolbar._syncDisabled){var a=this._getAddress();this._updateAddressFields(a,!0);this._featureToolbar._hasAddressEdit=!1;this._featureToolbar._updateSync(!0)}},_locate:function(){this._featureToolbar._locate()},getXYFields:function(){this._featureToolbar._isAddressFeature=!1;var a=this.parent._pageContainer.getViewByTitle("Coordinates"),b=a.xField,a=a.yField;this._featureToolbar.xField=this.csvStore.xFieldName;
this._featureToolbar.yField=this.csvStore.yFieldName;return[{keyField:this.csvStore.xFieldName,label:b.label,value:this.csvStore.xFieldName},{keyField:this.csvStore.yFieldName,label:a.label,value:this.csvStore.yFieldName}]},_updateAddressFields:function(a,b){this._address=a;b?g.forEach(this.locationControlTable.rows,c.hitch(this,function(a){if(this._syncFields.hasOwnProperty(a.keyField))for(var b=this._syncFields[a.keyField],e=0;e<this.featureControlTable.rows.length;e++){var d=this.featureControlTable.rows[e];
if(d.isEditRow&&d.fieldName===b.layerFieldName){a=this.csvStore.matchFieldPrefix+a.keyField;a=this._address&&this._address.hasOwnProperty(a)?this._address[a]:"";this.isDuplicate&&this._useValuesFromLayer?(d.layerValueTextBox.set("value",a),d.layerValueTextBox.emit("keyUp")):(d.fileValueTextBox.set("value",a),d.fileValueTextBox.emit("keyUp"));break}}})):g.forEach(this.locationControlTable.rows,c.hitch(this,function(a){var b=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":a.keyField;
a.addressValueTextBox&&(this.csvStore.useAddr||(b=this.csvStore.xFieldName===b?"x":"y"),b=this._address&&this._address.hasOwnProperty(b)?this._address[b]:"",a.addressValueTextBox.set("value",b))}))},_validateAddressDifference:function(){var a=!1;this.locationControlTable&&g.forEach(this.locationControlTable.rows,c.hitch(this,function(b){if(this._syncFields&&this._syncFields.hasOwnProperty(b.keyField)&&!a){var e=b.addressValueTextBox.displayedValue;b=this._syncFields[b.keyField];for(var d=0;d<this.featureControlTable.rows.length;d++){var k=
this.featureControlTable.rows[d];if(k.isEditRow&&k.fieldName===b.layerFieldName&&!a){a=this.isDuplicate&&this._useValuesFromLayer?k.layerValueTextBox.displayedValue!==e:k.fileValueTextBox.displayedValue!==e;break}}}}));return a},_getAddress:function(){this._address={};g.forEach(this.locationControlTable.rows,c.hitch(this,function(a){a.addressValueTextBox&&(this._address[this.csvStore.matchFieldPrefix+a.keyField]=a.addressValueTextBox.value)}));return this._address},_getAddressFieldsValues:function(){var a=
{};g.forEach(this.locationControlTable.rows,function(b){b.addressValueTextBox&&(a[b.keyField]=b.addressValueTextBox.value)});return a},_initLabel:function(a,b,e,d){var k=this._getField(a),f=p.create("td",{className:"field-control-td field-row-width2"},a),q=new x({style:{width:"100%",height:"32px"},title:b,invalidMessage:this.nls.review.valuesDoNotMatch});q.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(q,b,d,k);q.set("value",b);q.set("readonly",!0);q.placeAt(f);q.startup();
q.isFile=e;q.isAddress=d;q.row=a;q.parent=this;e?(a.fileValueTextBox=q,a.fileValue=b):d?(a.addressValueTextBox=q,a.addressValue=b):(a.layerValueTextBox=q,a.layerValue=b);e&&(q.validator=this._valuesMatch,q.validate())},_initValidationBox:function(a,b,d,f){var k=this._getField(a),c=p.create("td",{className:"field-control-td",colspan:this.isDuplicate?1:2},a),t;if(k&&k.type&&"date"===k.type){t=k.fieldInfo&&k.fieldInfo.format?k.fieldInfo:void 0;b=-1===[null,void 0,""].indexOf(b)?new Date(b):void 0;var m=
-1===[null,void 0,""].indexOf(b)?!0:!1;t=new n({style:{width:"100%",height:"32px"},title:m?t?e.localizeDateByFieldInfo(b,t):e.localizeDate(b):"",onChange:this._onChange})}else if(k&&k.domainValues){t=function(a){var b;-1<k.values.indexOf(a)&&(b=k.domainValues.filter(function(b){return b.label===a}));return b&&-1<b.length?b[0].value:a};b=-1<[null,void 0,""].indexOf(b)?"":-1<k.codes.indexOf(b)?b:t(b);var A=[{label:this.nls.review.selectValue,value:null,selected:!0}],h=b;g.forEach(k.domainValues,function(a){if(b.toString()===
a.value.toString()||b.toString()===a.label.toString())h=a.label;A.push({label:a.label,value:a.value})});t=new v({style:{width:"100%",height:"32px"},options:A,onChange:this._onChange,title:h});c.style.overflow="hidden"}else t=new x({style:{width:"100%",height:"32px"},title:b});t.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(t,b,f,k);t.set("intermediateChanges",!0);t.set("value",this.isDuplicate&&f?"":b);t.placeAt(c);t.startup();t.isFile=d;t.isAddress=f;t.row=a;t.featureToolbar=
this._featureToolbar;if(!f){var B;k&&k.length&&(B=q.substitute({num:k.length},this.nls.warningsAndErrors.rangeMessage));t.invalidLengthMessage=B;t.invalidTypeMessage=this.nls.warningsAndErrors.invalidMessage;t.fieldLength=k.length;t.fieldType=k.type;t.fieldNullable=k.nullable;k&&k.type&&"date"!==k.type&&(t.validator=this._valuesValidForType)}t.parent=this;d?(a.fileValueTextBox=t,a.fileValue=b):f?(a.addressValueTextBox=t,a.addressValue=b):(a.layerValueTextBox=t,a.layerValue=b);t.on("keyUp",function(a){var b;
a="undefined"!==typeof a.target.value?this.parent._getValue(a.target.value):"date"===this.fieldType?"":this.value;if(this.isAddress)a=a!==this.parent._getValue(this.row.addressValue),b=this.parent._changedAddressRows.indexOf(this.row.rowIndex),-1===b&&a?this.parent._changedAddressRows.push(this.row.rowIndex):-1<b&&!a&&this.parent._changedAddressRows.splice(b,1),this.parent.emit("address-change",0<this.parent._changedAddressRows.length);else if(b=this.validate(),this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);
var e=this.parent._getValue(this.row.layerValue);a=this.isFile?a!==b:a!==e;e=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;b=e.indexOf(this.row.rowIndex);-1===b&&a?e.push(this.row.rowIndex):-1<b&&!a&&e.splice(b,1);var d=!0;g.forEach(this.parent.featureControlTable.rows,function(a){"undefined"===typeof a._isValid||a._isValid||(d=!1)});d?this.parent.emit("attribute-change",0<e.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)})},
_getField:function(a){for(var b,e=0;e<this.csvStore.fsFields.length;e++){var d=this.csvStore.fsFields[e];if(d.name===a.fieldName){b=d;break}}return b},_addLocalizeFloatSupport:function(a,b,d,f){"."!==a.decimalSeperator&&(d&&!this.csvStore.useAddr||f&&f.type&&"float"===f.type)&&(a.title=-1!==[null,void 0,""].indexOf(b)?"":isNaN(b)||"."===a.decimalSeperator?b:e.localizeNumber(b),a.format=function(a){return-1!==[null,void 0,""].indexOf(a)||isNaN(a)?a:e.localizeNumber(a).toString().replace(".","")},a.parse=
function(a){return a&&a.toString&&-1<a.toString().indexOf(this.decimalSeperator)?a.toString().replace(this.decimalSeperator,"."):a})},_onChange:function(a){var b;a="undefined"!==typeof a?this.parent._getValue(a):"date"===this.fieldType?"":this.value;b=this.validate();if(this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);var e=this.parent._getValue(this.row.layerValue);a=this.isFile?a.toString()!==b.toString():a.toString()!==e.toString();e=this.isFile?this.parent._changedFileAttributeRows:
this.parent._changedLayerAttributeRows;b=e.indexOf(this.row.rowIndex);-1===b&&a?e.push(this.row.rowIndex):-1<b&&!a&&e.splice(b,1);var d=!0;g.forEach(this.parent.featureControlTable.rows,function(a){"undefined"===typeof a._isValid||a._isValid||(d=!1)});d?this.parent.emit("attribute-change",0<e.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)},_valuesValidForType:function(a){var b=a.toString();if(b.length>this.fieldLength)return this.invalidMessage=this.invalidLengthMessage,
!1;if(0===b.length)return"undefined"!==typeof this.fieldNullable?this.fieldNullable:!0;this.invalidMessage=this.invalidTypeMessage;switch(this.fieldType){case "int":return/^-?[0-9]+$/.exec(a);case "float":return"."!==this.decimalSeperator?/^-?[0-9]+[.,]?[0-9]*$/.exec(a):/^-?[0-9]+[.]?[0-9]*$/.exec(a);case "date":if(a)try{return!isNaN((new Date(a)).getTime())}catch(A){return console.error(A),!1}else return!0;case "domainInt":return/^-?[0-9]+$/.exec(a);case "domain":return!0;case "other":return!0}},
_valuesMatch:function(){return this.row.fileValueTextBox&&this.row.layerValueTextBox?this.row.fileValueTextBox.value===this.row.layerValueTextBox.value:!0},_validateValues:function(){var a=!0;g.forEach(this.featureControlTable.rows,c.hitch(this,function(b){if(b.isEditRow){"undefined"===typeof b._isValid||b._isValid||(a=!1);var e="date"===b.fileValueTextBox.fieldType&&b.fileValueTextBox.value.toString()===b.fileValueTextBox._invalidDate?"":this._getValue(b.fileValueTextBox.value),d=this._getValue(b.fileValue),
f="date"===b.layerValueTextBox.fieldType&&b.layerValueTextBox.value.toString()===b.layerValueTextBox._invalidDate?"":this._getValue(b.layerValueTextBox.value),k=this._getValue(b.layerValue);b.parent._useValuesFromFile&&(e===d&&e===k||this._changedFileAttributeRows.push(b.rowIndex));b.parent._useValuesFromLayer&&f!==k&&this._changedLayerAttributeRows.push(b.rowIndex)}}));var b=this._useValuesFromFile?this._changedFileAttributeRows:this._changedLayerAttributeRows;a?this.emit("attribute-change",0<b.length):
this._featureToolbar._updateSave(!0)},_getValue:function(a){return-1===[null,void 0,""].indexOf(a)?a:""},_validateGeoms:function(){var a=this._featureToolbar._hasAttributeEdit,b=this._featureToolbar._hasGeometryEdit;this._useGeomFromLayer?this._featureToolbar._updateSaveAndCancel(!a):b?this._featureToolbar._updateSaveAndCancel(!a&&!b):this._featureToolbar._updateSaveAndCancel(!a)},_initSelectRow:function(a,b,e,d){b=p.create("tr",{className:"task-instruction-row bottom-border",isRadioRow:!0,isEditRow:!1},
b);b.radioButtons=[];b.useType=d;d=p.create("td",{},b);p.create("div",{className:"main-text float-left pad-left-5",innerHTML:a},d);this._createSelect(b,e)},_createSelect:function(a,b){var e=p.create("td",{colspan:2,className:"field-control-td"},a);b=new v({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.fromLayer,value:"layer",selected:!0},{label:this.nls.review.fromFile,value:"file"}],onChange:c.hitch(this,b)});a.fromSelect=b;p.place(b.domNode,e);b.startup()},_useGeomChanged:function(a){this._useGeomFromFile=
a="file"===a;this._useGeomFromLayer=!a;a&&this.resetAddressValues(this._featureToolbar._originalValues);a&&!this._hasBeenLocatedForFile?this._hasBeenLocatedForFile||this._featureToolbar._locateFeature().then(c.hitch(this,function(a){this._featureToolbar._originalValues.duplicateGeometry=a.feature.geometry;this._hasBeenLocatedForFile=!0;var b=[a.feature,this._editFeature];if(a.feature.geometry.x!==this._editFeature.geometry.x||a.feature.geometry.y!==this._editFeature.geometry.y)this.map&&this.map.extent&&
this.map.extent.contains?this.map.extent.contains(a.feature.geometry)&&this.map.extent.contains(this._editFeature.geometry)||this.csvStore._zoomToData(b):this.csvStore._zoomToData(b);this._featureToolbar._flashFeatures(b);this._validateGeoms()})):(this._featureToolbar._updateFeature(this._useGeomFromFile?this._featureToolbar._originalValues.duplicateGeometry:this._editFeature.geometry,!1,!0),this._featureToolbar._flashFeatures([a?this._feature:this._editFeature]),this._validateGeoms());this._useGeomFromLayer&&
this._updateAddressFields(this._featureToolbar._originalValues.editAddress,!1);this._toggleLocationControls(!1);this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleFeature:function(){if(this._featureExpanded=!this._featureExpanded)this._locationExpanded=!1;this._updateInfoRows()},_toggleLocation:function(){if(this._locationExpanded=!this._locationExpanded)this._featureExpanded=!1;this._updateInfoRows()},_updateInfoRows:function(){this._updateRow(this._featureExpanded,
this.featureInformation,this.toggleFeature);this._updateRow(this._locationExpanded,this.locationInformation,this.toggleLocation)},_updateRow:function(a,b,e){var d=["bg-toggle-up-img","bg-toggle-up-img-white"],f=["bg-toggle-down-img","bg-toggle-down-img-white"];a?u.remove(b,"display-none"):u.add(b,"display-none");this._updateImageNode(a?d:f,a?f:d,e)},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",e=a?"next-arrow-img-white":"next-arrow-img",
d=h("."+b,this.domNode);g.forEach(d,function(a){u.remove(a,b);u.add(a,e)});b=a?"bg-toggle-up-img":"bg-toggle-up-img-white";e=a?"bg-toggle-up-img-white":"bg-toggle-up-img";d=h("."+b,this.domNode);g.forEach(d,function(a){u.remove(a,b);u.add(a,e)});b=a?"bg-toggle-down-img":"bg-toggle-down-img-white";e=a?"bg-toggle-down-img-white":"bg-toggle-down-img";d=h("."+b,this.domNode);g.forEach(d,function(a){u.remove(a,b);u.add(a,e)})},_updateImageNode:function(a,b,e){var d=this.pageContainer.isDarkTheme;u.remove(e,
d?b[1]:b[0]);u.add(e,d?a[1]:a[0])},_toggleLocationControls:function(a){var b=this.isDuplicate&&this._useGeomFromLayer?!0:a;this.locationControlTable&&g.forEach(this.locationControlTable.rows,function(e){e.fromSelect&&e.fromSelect.set("disabled",a);e.isAddressRow&&e.addressValueTextBox&&e.addressValueTextBox.set("disabled",b)});b?this._featureToolbar._disableEdit():this._featureToolbar._enableEdit()},_useValuesChanged:function(a){this._useValuesFromFile=a="file"===a;this._useValuesFromLayer=!a;this._toggleEnabled(a);
this._validateValues();this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleEnabled:function(a){g.forEach(this.featureControlTable.rows,function(b){b.isRadioRow||(b.fileValueTextBox&&b.fileValueTextBox.set("disabled",!a),b.layerValueTextBox&&b.layerValueTextBox.set("disabled",a))})},_toggleEditControls:function(a){this.featureControlTable&&g.forEach(this.featureControlTable.rows,function(b){b.isRadioRow&&b.fromSelect.set("disabled",a);b.isEditRow&&(b.fileValueTextBox&&
(a?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromFile?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate||b.fileValueTextBox.set("disabled",a)),b.layerValueTextBox&&(a?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromLayer?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate||b.layerValueTextBox.set("disabled",a)))});this._toggleLocationControls(a)},resetAttributeValues:function(){g.forEach(this.featureControlTable.rows,
c.hitch(this,function(a){a.fileValueTextBox&&a.fileValueTextBox.set("value",a.fileValue);a.layerValueTextBox&&a.layerValueTextBox.set("value",a.layerValue)}));this._changedFileAttributeRows=[];this._changedLayerAttributeRows=[]},resetAddressValues:function(a,b){g.forEach(this.locationControlTable.rows,c.hitch(this,function(e){var d=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":e.keyField;e.addressValueTextBox&&(d=this.isDuplicate&&this._useGeomFromLayer&&"not-duplicate"!==b?a.editAddress&&
a.editAddress.hasOwnProperty(d)?a.editAddress[d]:void 0:e.addressValue,e.addressValueTextBox.set("value",d))}))},resetGeometry:function(a){this._feature.geometry=a;this.feature.geometry=a;this._featureToolbar._updateLayer(this.layer,null,[this._feature],null,!1,!0).then(c.hitch(this,function(){this._featureToolbar._flashFeatures([this._feature])}));this.resetFromLayerRows()},resetFromLayerRows:function(){this.isDuplicate&&(this._featureToolbar._fileGeometryModified||(this._useGeomFromLayer=!0),this._featureToolbar._fileValuesModified||
(this._useValuesFromLayer=!0),g.forEach(this.featureControlTable.rows,c.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})),g.forEach(this.locationControlTable.rows,c.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&!this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})))},setStyleColor:function(a){this.styleColor=a;this._featureToolbar.styleColor=
a}})})},"widgets/DataAggregation/js/UI/FeatureToolbar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/query dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dojo/on dojox/gfx/fx dojo/text!./templates/FeatureToolbar.html esri/toolbars/edit jimu/dijit/Message jimu/dijit/Popup jimu/portalUtils jimu/utils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/Color esri/graphic esri/geometry/webMercatorUtils esri/request".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b,d,m,f,e,q,k,t,A,B){return r([w,z,p],{templateString:n,baseClass:"cf-feature-toolbar",declaredClass:"FeatureToolbar",label:"FeatureToolbar",parent:null,nls:null,map:null,appConfig:null,config:null,feature:null,layer:null,theme:"",locators:[],styleColor:"",featureView:null,_editToolbar:null,csvStore:null,_isAddressFeature:!0,_stageLayer:null,constructor:function(a){c.mixin(this,a);this._syncDisabled=this._locateDisabled=this._cancelDisabled=this._saveDisabled=
!0;this._hasAttributeEdit=!1;this.own(l(this.featureView,"attribute-change",c.hitch(this,this._attributeChange)));this._hasAddressEdit=!1;this.own(l(this.featureView,"address-change",c.hitch(this,this._addressChange)));this._hasGeometryEdit=!1;this.own(l(this._editToolbar,"graphic-move-stop",c.hitch(this,this._graphicMoveStop)));this.own(l(this.featureView,"address-located",c.hitch(this,this._graphicMoveStop)));this.locator=this._getLocator(0);this._initOriginalValues()},postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._started=!0;this.updateImageNodes()},_getLocator:function(a){for(var b;a<this.csvStore._geocodeSources.length;a++)if(this.locatorSource=this.csvStore._geocodeSources[a],this.locatorSource.locator.locationToAddress){b=this.locatorSource.locator;this._locatorIndex=a;break}b&&(b.outSpatialReference=this.map.spatialReference,b.countryCode=this.locatorSource.countryCode);return b},_initOriginalValues:function(){this._originalValues=c.clone(this.featureView.feature)},
_attributeChange:function(a){this._hasAttributeEdit=a;this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit));this._updateSync(!this.featureView._validateAddressDifference())},_addressChange:function(a){this._hasAddressEdit=a;this._updateLocate(!a)},_graphicMoveStop:function(a){this.featureView.isShowing&&(this._hasGeometryEdit=!0,this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?
this._updateSaveAndCancel(!this._hasAttributeEdit):this._updateSaveAndCancel(!(this._hasAttributeEdit||this._hasGeometryEdit)),this.map.infoWindow.setFeatures(this.featureView._feature),this.map.infoWindow.select(0),a?this._reverseLocate(a.graphic.geometry).then(c.hitch(this,function(){this._hasAddressEdit=!0;this._updateLocate(!0);this.featureView._validateAddressDifference()&&this._updateSync(!1);this.locator=this._getLocator(0)}),function(a){this.locator=this._getLocator(0);new b(a)}):this.featureView._validateAddressDifference()&&
this._updateSync(!1))},_reverseLocate:function(a){var b=new y;if(this._isAddressFeature){var e=this.parent.portal?this.parent.portal:this.appConfig.portalUrl?m.getPortal(this.appConfig.portalUrl):null,d=this.locatorSource&&this.locatorSource.isEsriLocator;B({url:this.locator.url+"/reverseGeocode",content:{f:"json",location:JSON.stringify(a),distance:100,outSR:JSON.stringify(a.spatialReference),forStorage:d?this.featureView.isDuplicate&&!this.featureView.isDuplicateLocated||this.featureView.isUnMatched&&
!this.featureView.isUnMatchedLocated:!1,token:d?e&&e.credential&&e.credential.token?e.credential.token:null:null},callbackParamName:"callback"}).then(c.hitch(this,function(a){this.featureView._updateAddressFields(a.address,!1);b.resolve({address:a.address})}),c.hitch(this,function(e){this._getNextLocator()?this._reverseLocate(a).then(function(a){b.resolve(a)}):(this.featureView._updateAddressFields({},!1),b.reject({message:e.message}))}))}else a.spatialReference.isWebMercator&&a.spatialReference.isWebMercator()&&
(e=A.webMercatorToGeographic(a)),this.featureView._updateAddressFields(e||a,!1),b.resolve({geometry:a});return b},_enableEdit:function(){this._editToolbar.activate(a.MOVE,this.featureView._feature)},_disableEdit:function(){this._editToolbar.deactivate()},_undoEdits:function(){this._hasAttributeEdit&&(this.featureView.resetAttributeValues(),this._hasAttributeEdit=!1);this._hasAddressEdit&&(this.featureView.resetAddressValues(this._originalValues),this._hasAddressEdit=!1);this._hasGeometryEdit?(this.featureView.resetGeometry(this._originalValues.geometry),
this._hasGeometryEdit=!1):this.featureView.resetFromLayerRows();this._updateSync(!this.featureView._validateAddressDifference());this._updateLocate(!0)},_locate:function(){this._locateDisabled||this._locateFeature().then(c.hitch(this,function(){this._hasAddressEdit=!1;this._updateLocate(!0)}))},_cancel:function(){if(!this._cancelDisabled)var a=new d({titleLabel:this.nls.featureToolbar.cancelTitle,width:400,autoHeight:!0,content:v.create("div",{innerHTML:this.nls.featureToolbar.cancelMessage,style:"padding-bottom: 10px;"}),
buttons:[{label:this.nls.yes,onClick:c.hitch(this,function(){a.close();a=null;this._undoEdits();this._updateSaveAndCancel(!0);this._panToAndSelectFeature(this.featureView.isDuplicate&&this.featureView._useGeomFromLayer?this.featureView._editFeature:this.featureView._feature)})},{label:this.nls.no,onClick:c.hitch(this,function(){a.close()})}],onClose:c.hitch(this,function(){a=null})})},_save:function(a){var b=this.featureView._feature;if(!this._saveDisabled||!0===a){!0!==a&&(this._setFieldValues(this.featureView),
this._setAddressValues(this.featureView),this.featureView.feature.geometry=b.geometry,this._originalValues.geometry=b.geometry,this.featureView.isDuplicate&&(this._originalValues.duplicateGeometry=b.geometry));if(-1===this.featureView.label.indexOf("UnMatched")&&-1===this.featureView.label.indexOf("DuplicateFeatures"))this._updateLayer(this._stageLayer,null,[b],null,!0,!1).then(c.hitch(this,function(a){a&&"success"===a.status&&this._updateFeatureListLabel(b)}));else if(this.featureView.isDuplicate&&
!0!==a)this.featureView._updateDuplicateAttributes(null,!0),this._updateLayer(this.layer,null,[b],null,!0,!1).then(c.hitch(this,function(a){a&&"success"===a.status&&this._updateFeatureListLabel(b)}));else{var e=b.attributes[this.layer.objectIdField];this._updateLayer(this.layer,null,null,[b],!0,!1).then(c.hitch(this,function(d){d&&"success"===d.status&&this.featureView._parentFeatureList.removeFeature(this.featureView.feature,e).then(c.hitch(this,function(){g.forEach(this.featureView._skipFields,
c.hitch(this,function(a){delete b.attributes[a]}));this._updateLayer(this._stageLayer,[b],null,null,!0,!1).then(c.hitch(this,function(e){e&&"success"===e.status&&(e.hasOwnProperty("objectId")&&(this.featureView.feature.fieldInfo.filter(c.hitch(this,function(a){return a.name===this._stageLayer.objectIdField}))[0].value=e.objectId),this.featureView.feature.label=b.attributes[this.csvStore.labelField],e=this.parent._pageContainer.getViewByTitle("Review"),e.matchedFeatureList.addFeature(this.featureView.feature),
e.matchedFeatureList.resetFeatureList(),e._updateReviewRows(!0===a?"duplicate":"unmatched"))}))}))}))}!0!==a&&this._updateSaveAndCancel(!0)}},_updateFeatureListLabel:function(a){var b=this.csvStore.labelField;a=a.attributes[b];var e=f.stripHTML(a.toString?a.toString():"");e!==this.featureView.featureListLabel.innerHTML&&("."!==this.csvStore.decimalSeperator&&(a=this.feature.fieldInfo.filter(function(a){return a.name===b&&a.needsFormat&&-1===[null,void 0].indexOf(e)}))&&a.hasOwnProperty("length")&&
0<a.length&&(e=f.localizeNumber(e),a[0].formattedValue=e),this.featureView.featureListLabel.innerHTML=e,this.featureView.pageTitleDiv.innerHTML=e)},_updateLayer:function(a,e,d,f,q,k){var m=new y;a.applyEdits(e,d,f).then(c.hitch(this,function(a){var b={status:"success"};this.featureView.isDuplicate&&(this._hasGeometryEdit&&this.featureView._useGeomFromFile&&(this._fileGeometryModified=!0),this._hasAttributeEdit&&this.featureView._useValuesFromFile&&(this._fileValuesModified=!0));q&&(this._hasAttributeEdit=
this._hasGeometryEdit=!1);a&&a.hasOwnProperty("length")&&0<a.length&&a[0].hasOwnProperty("objectId")&&(b.objectId=a[0].objectId);!k&&d&&d.hasOwnProperty("length")&&0<d.length&&(a=this.featureView.parent._pageContainer.getViewByTitle("Review"),a._updateNode(a.submitButton,!0));m.resolve(b)}),c.hitch(this,function(a){new b({message:this.nls.warningsAndErrors.saveError});m.resolve({status:"error",error:a})}));return m},_setFieldValues:function(a){var b=a._useValuesFromFile,e=b?a._changedFileAttributeRows:
a._changedLayerAttributeRows,d=a._feature,f=a.feature;g.forEach(a.featureControlTable.rows,function(a){if(a.isEditRow&&-1<e.indexOf(a.rowIndex)||a.parent&&a.parent.isDuplicate&&!b){var q=a.parent.isDuplicate&&!b?a.layerValueTextBox:a.fileValueTextBox;d.attributes[a.fieldName]=q.value;f.fieldInfo.filter(function(b){return b.name===a.fieldName})[0].value=q.value;a.parent.isDuplicate&&!b?a.layerValue=q.value:a.fileValue=q.value;if(q.textbox)q.textbox.title=q.value;else if(q.domNode){var c=q.attr("displayedValue");
q.domNode.title=c?c:q.value}}})},_setAddressValues:function(a){var b=a._getAddress(),e=this.csvStore.matchFieldPrefix;a.isDuplicate&&a._useGeomFromLayer||g.forEach(a.addressFields,function(d){var f=e+d.keyField;a.feature.fieldInfo.filter(function(a){return a.name===f})[0].value=b[f];for(var q,c=0;c<a.locationControlTable.rows.length&&(q=a.locationControlTable.rows[c],!q.isAddressRow||q.keyField!==d.keyField);c++);q.addressValueTextBox.textbox?q.addressValueTextBox.textbox.title=b[f]:q.addressValueTextBox.domNode&&
(d=q.addressValueTextBox.attr("displayedValue"),q.addressValueTextBox.domNode.title=d?d:q.addressValueTextBox.value);q.addressValue=b[f]})},_updateFeature:function(a,b,e){var d=this.featureView;d.feature.geometry=a;d._feature.geometry=a;a=[d._feature];d.isDuplicate?(d.isDuplicateLocated||(d.isDuplicateLocated=!0),this._hasGeometryEdit=d._editFeature.geometry.x!==d._feature.geometry.x||d._editFeature.geometry.y!==d._feature.geometry.y):d.isUnMatched&&!d.isUnMatchedLocated&&(d.isUnMatchedLocated=!0);
b||this._updateLayer(d.layer,null,a,null,!1,e).then(c.hitch(this,function(a){a&&"success"===a.status&&(this._panToAndSelectFeature(d._feature),d.emit("address-located"))}))},_locateFeature:function(a){var e=new y,d=this.featureView._getAddressFieldsValues();if(this._isAddressFeature){var f=this.parent.portal?this.parent.portal:this.appConfig.portalUrl?m.getPortal(this.appConfig.portalUrl):null;this._addressToLocation({address:d,countryCode:this.locatorSource.countryCode,outFields:["ResultID","Score"],
forStorage:this.featureView.isDuplicate&&!this.featureView.isDuplicateLocated||this.featureView.isUnMatched&&!this.featureView.isUnMatchedLocated,token:f&&f.credential&&f.credential.token?f.credential.token:null}).then(c.hitch(this,function(b){this.locator=this._getLocator(0);this._updateFeature(b.location,a,!0);e.resolve({feature:this.featureView.feature,address:b.address})}),function(a){new b({message:a.message})})}else d=this.csvStore._getGeometry(d[this.xField],d[this.yField]),this._updateFeature(d,
a,!0),e.resolve({feature:this.featureView.feature,geometry:d});return e},_addressToLocation:function(a){var b=new y;a.maxLocations=1;this.locator.addressToLocations(a,c.hitch(this,function(e){var d=this.csvStore.minScore,f;e&&0<e.length?(g.forEach(e,function(a){"undefined"===typeof f&&a.score>=d&&(f=a);f&&a.score>f.score&&(f=a)}),f?b.resolve(f):this._getNextLocator()?this._addressToLocation(a).then(function(a){b.resolve(a)}):b.reject({message:this.nls.warningsAndErrors.cannotLocate})):this._getNextLocator()?
this._addressToLocation(a).then(function(a){b.resolve(a)}):b.reject({message:this.nls.warningsAndErrors.cannotLocate})}),function(a){b.reject(a)});return b},_getNextLocator:function(){var a=!1,b=this._locatorIndex+1;b<this.csvStore._geocodeSources.length&&(this.locator=this._getLocator(b),a="undefined"!==typeof this.locator);return a},_flashFeatures:function(a){var b;g.forEach(a,c.hitch(this,function(a){if(a.geometry){var d=k.fromHex(this.styleColor),f=c.clone(d);f.a=.4;d=new e(e.STYLE_CIRCLE,15,
new q(q.STYLE_SOLID,d,1),f);a=new t(a.geometry,d);this.map.graphics.add(a);b=a.getLayer?a.getLayer():b;(a=a.getDojoShape())&&h.animateStroke({shape:a,duration:900,color:{start:a.strokeStyle.color,end:a.strokeStyle.color},width:{start:25,end:0}}).play()}}));setTimeout(c.hitch(this,function(b){b&&b.clear&&(b.clear(),a&&(a[0]._layer&&a[0]._layer.infoTemplate||a[0].infoTemplate)&&(this.map.infoWindow.setFeatures(a),this.map.infoWindow.select(0)))}),1200,b)},_panToAndSelectFeature:function(a){if(a&&a.geometry){var b=
this.map.getMaxZoom(),e=Math.round(.25*b);this.map.centerAndZoom(a.geometry,0<b-e?b-e:b).then(c.hitch(this,function(){this._flashFeatures([a])}))}},setStyleColor:function(a){this.styleColor=a},_updateCancel:function(a){this._cancelDisabled=a;this._updateImageNode("bg-cancel","bg-cancel-white","bg-cancel-disabled",this._cancelDisabled,this.domNode)},_updateSaveAndCancel:function(a){this._updateSave(a);this._updateCancel(a)},_updateSave:function(a){this._saveDisabled=a;this._updateImageNode("bg-save",
"bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode)},_updateLocate:function(a){this._locateDisabled=a;this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode)},_updateSync:function(a){this._syncDisabled=a;this.featureView.syncFields&&this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode)},updateImageNodes:function(){this._updateImageNode("bg-cancel","bg-cancel-white",
"bg-cancel-disabled",this._cancelDisabled,this.domNode);this._updateImageNode("bg-save","bg-save-white","bg-save-disabled",this._saveDisabled,this.domNode);this._updateImageNode("bg-locate","bg-locate-white","bg-locate-disabled",this._locateDisabled,this.featureView.domNode);this._updateImageNode("bg-sync","bg-sync-white","bg-sync-disabled",this._syncDisabled,this.featureView.domNode)},_updateImageNode:function(a,b,e,d,f){var q=this.pageContainer.isDarkTheme,c=d?e:q?b:a,k=q?b:a;d=!1;q=u("."+a,f);
q.hasOwnProperty("length")&&0===q.length?q=u("."+e,f):(d=!0,k=a);!d&&q.hasOwnProperty("length")&&0===q.length?q=u("."+b,f):d||(d=!0,k=e);g.forEach(q,function(a){x.remove(a,k);x.add(a,c)})}})})},"dojox/gfx/fx":function(){define("dojo/_base/lang ./_base ./matrix dojo/_base/Color dojo/_base/array dojo/_base/fx dojo/_base/connect dojo/sniff".split(" "),function(r,c,g,p,u,x,v,y){function w(a,b){this.start=a;this.end=b}function z(a,b,d){this.start=a;this.end=b;this.units=d}function l(a,b){this.start=a;
this.end=b;this.temp=new p}function h(a){this.values=a;this.length=a.length}function n(a,b){this.values=a;this.def=b?b:{}}function a(a,b){this.stack=a;this.original=b}function b(a,b,d,k){if(a.values)return new h(a.values);var e,f;f=a.start?c.normalizeColor(a.start):e=b?d?b[d]:b:k;a.end?a=c.normalizeColor(a.end):(e||(e=b?d?b[d]:b:k),a=e);return new l(f,a)}var d=c.fx={};w.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};z.prototype.getValue=function(a){return(this.end-this.start)*
a+this.start+this.units};l.prototype.getValue=function(a){return p.blendColors(this.start,this.end,a,this.temp)};h.prototype.getValue=function(a){return this.values[Math.min(Math.floor(a*this.length),this.length-1)]};n.prototype.getValue=function(a){var b=r.clone(this.def),d;for(d in this.values)b[d]=this.values[d].getValue(a);return b};a.prototype.getValue=function(a){var b=[];u.forEach(this.stack,function(e){if(e instanceof g.Matrix2D)b.push(e);else if("original"==e.name&&this.original)b.push(this.original);
else if("matrix"==e.name){if(e.start instanceof g.Matrix2D&&e.end instanceof g.Matrix2D){var d=new g.Matrix2D,f;for(f in e.start)d[f]=(e.end[f]-e.start[f])*a+e.start[f];b.push(d)}}else e.name in g&&(d=g[e.name],"function"!=typeof d?b.push(d):(f=u.map(e.start,function(b,d){return(e.end[d]-b)*a+b}),d=d.apply(g,f),d instanceof g.Matrix2D&&b.push(d)))},this);return b};var m=new p(0,0,0,0);d.animateStroke=function(a){a.easing||(a.easing=x._defaultEasing);var e=new x.Animation(a),d=a.shape,f;v.connect(e,
"beforeBegin",e,function(){f=d.getStroke();var e=a.color,q={},c;e&&(q.color=b(e,f,"color",m));(e=a.style)&&e.values&&(q.style=new h(e.values));if(e=a.width){var k=e,g=f;k.values?c=new h(k.values):(e=k.start?k.start:c=g?g.width:1,k.end?c=k.end:"number"!=typeof c&&(c=g?g.width:1),c=new w(e,c));q.width=c}(e=a.cap)&&e.values&&(q.cap=new h(e.values));if(e=a.join)e.values?q.join=new h(e.values):(c=e.start?e.start:f&&f.join||0,e=e.end?e.end:f&&f.join||0,"number"==typeof c&&"number"==typeof e&&(q.join=new w(c,
e)));this.curve=new n(q,f)});v.connect(e,"onAnimate",d,"setStroke");return e};d.animateFill=function(a){a.easing||(a.easing=x._defaultEasing);var e=new x.Animation(a),d=a.shape,f;v.connect(e,"beforeBegin",e,function(){f=d.getFill();var e=a.color;e&&(this.curve=b(e,f,"",m))});v.connect(e,"onAnimate",d,"setFill");return e};d.animateFont=function(a){a.easing||(a.easing=x._defaultEasing);var b=new x.Animation(a),d=a.shape,f;v.connect(b,"beforeBegin",b,function(){f=d.getFont();var b=a.style,e={},q,c;b&&
b.values&&(e.style=new h(b.values));(b=a.variant)&&b.values&&(e.variant=new h(b.values));(b=a.weight)&&b.values&&(e.weight=new h(b.values));(b=a.family)&&b.values&&(e.family=new h(b.values));(b=a.size)&&b.units&&(q=parseFloat(b.start?b.start:d.font&&d.font.size||"0"),c=parseFloat(b.end?b.end:d.font&&d.font.size||"0"),e.size=new z(q,c,b.units));this.curve=new n(e,f)});v.connect(b,"onAnimate",d,"setFont");return b};d.animateTransform=function(b){b.easing||(b.easing=x._defaultEasing);var e=new x.Animation(b),
d=b.shape,f;v.connect(e,"beforeBegin",e,function(){f=d.getTransform();this.curve=new a(b.transform,f)});v.connect(e,"onAnimate",d,"setTransform");if("svg"===c.renderer&&(9<=y("ie")||y("ff")))var m=[v.connect(e,"onBegin",e,function(){for(var a=d.getParent();a&&a.getParent;)a=a.getParent();a&&(d.__svgContainer=a.rawNode.parentNode,d.__svgRoot=a.rawNode,d.__svgRoot&&d.__svgRoot.getAttribute&&(d.__svgWidth=parseInt(d.__svgRoot.getAttribute("width"),10),isNaN(d.__svgWidth)&&delete d.__svgWidth))}),v.connect(e,
"onAnimate",e,function(){try{if(d.__svgContainer){var a=d.__svgContainer.style.visibility;d.__svgContainer.style.visibility="visible";d.__svgContainer.style.visibility=a;var b=d.__svgWidth;if(!isNaN(b))try{d.__svgRoot.setAttribute("width",b-5E-6),d.__svgRoot.setAttribute("width",b)}catch(C){}}}catch(C){}}),v.connect(e,"onEnd",e,function(){u.forEach(m,v.disconnect);if(d.__svgContainer){var a=d.__svgContainer;if(null==a.getAttribute("__gotVis")){a.setAttribute("__gotVis",!0);var b=d.__svgContainer.style.visibility,
e=d.__svgRoot,f=d.__svgWidth;a.style.visibility="visible";setTimeout(function(){try{a.style.visibility=b;a.removeAttribute("__gotVis");a=null;try{isNaN(f)||(e.setAttribute("width",f-5E-6),e.setAttribute("width",f))}catch(D){}}catch(D){}},100)}}delete d.__svgContainer;delete d.__svgRoot;delete d.__svgWidth})];return e};return d})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b,d,m,f,e,q,k){var t=c(n,{declaredClass:"esri.toolbars.Edit",constructor:function(a,b){this._map=a;this._tool=0;if(this._map.loaded)this._scratchGL=a.graphics;else var d=p.connect(this._map,"onLoad",this,function(){p.disconnect(d);d=null;this._scratchGL=this._map.graphics});a=v("esri-mobile");this._defaultOptions=g.mixin({vertexSymbol:new f(f.STYLE_CIRCLE,a?20:12,new e(e.STYLE_SOLID,new x([0,0,0,.5]),1),new x([128,128,128])),ghostVertexSymbol:new f(f.STYLE_CIRCLE,
a?18:10,new e(e.STYLE_SOLID,new x([0,0,0,.5]),1),new x([255,255,255,.75])),ghostLineSymbol:new e(e.STYLE_DOT,new x([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:a?24:16,boxLineSymbol:new e(e.STYLE_DASH,new x([64,64,64]),1),boxHandleSymbol:new f(f.STYLE_SQUARE,a?16:9,new e(e.STYLE_SOLID,new x([0,0,0,.5]),1),new x([255,255,255,.75])),textAnchorSymbol:new f(f.STYLE_CIRCLE,10,null,new x([255,0,0]))},b||{})},activate:function(a,b,e){this.deactivate();this._graphic=b;this._options=
g.mixin(g.mixin({},this._defaultOptions),e||{});var d=t.MOVE;e=t.EDIT_VERTICES;var f=t.SCALE,c=t.ROTATE,q=t.EDIT_TEXT,k=!1,m=!1,h=!1,n=this._map,l=n.spatialReference,A=b.geometry.spatialReference;this._geo=!(!l||!A||l.equals(A)||!l.isWebMercator()||4326!==A.wkid);this._isTextPoint=this._prepareTextSymbolEditing(b,a);(a&d)===d&&(k=this._enableMove(b));d=(a&f)===f;c=(a&c)===c;if(d||c)h=this._enableBoxEditing(b,d,c);(a&e)===e&&(m=this._enableVertexEditing(b));(a&q)===q&&this._enableTextEditing(b);if(!(k||
m||h))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=a)this._mapPanEndHandle=p.connect(n,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=p.connect(n,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,b);n.snappingManager&&(k||m)&&n.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var a=this._tool,b=this._graphic;if(a){var e=
!!this._modified;this._clear();p.disconnect(this._mapPanEndHandle);p.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(a,b,{isModified:e});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(a,b){},onDeactivate:function(a,b,e){},
onGraphicMoveStart:function(a){},onGraphicFirstMove:function(a){this._modified=!0},onGraphicMove:function(a,b){},onGraphicMoveStop:function(a,b){},onGraphicClick:function(a,b){},onVertexMoveStart:function(a,b){},onVertexFirstMove:function(a,b){this._modified=!0},onVertexMove:function(a,b,e){},onVertexMoveStop:function(a,b,e){},onVertexAdd:function(a,b){this._modified=!0},onVertexClick:function(a,b){},onVertexMouseOver:function(a,b){},onVertexMouseOut:function(a,b){},onVertexDelete:function(a,b){this._modified=
!0},onTextEditStart:function(a,b){},onTextEditEnd:function(a){},onScaleStart:function(a){},onScaleFirstMove:function(a){this._modified=!0},onScale:function(a,b){},onScaleStop:function(a,b){},onRotateStart:function(a){},onRotateFirstMove:function(a){this._modified=!0},onRotate:function(a,b){},onRotateStop:function(a,b){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(a,b){if("point"===a.geometry.type||"multipoint"===a.geometry.type){var e=a.getLayer(),d=e.renderer,e=a.symbol||e._getSymbol(a);!e&&(d.hasVisualVariables("sizeInfo",!1)||d.hasVisualVariables("colorInfo",!1)||d.hasVisualVariables("opacityInfo",!1))&&d.addBreak&&
d.infos&&1===d.infos.length&&(e=d.infos[0].symbol||d.defaultSymbol);if(e&&"textsymbol"===e.type){if((b&t.SCALE)===t.SCALE||(b&t.ROTATE)===t.ROTATE||(b&t.EDIT_TEXT)===t.EDIT_TEXT){a.setSymbol(new q(e.toJson()));var f=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(a),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){f._boxEditor&&f._boxEditor.refresh()})):
r(["../dijit/SymbolEditor"],function(b){if(!f._textSymbolEditor){var e;e=f._options.textSymbolEditorHolder?y.create("div",null,f._options.textSymbolEditorHolder):y.create("div",null,f._map.root);f._textSymbolEditor=new b({graphic:a},e);b=f._textSymbolEditor.domNode.parentNode.id;w.set(f._textSymbolEditor.domNode,{position:"map_root"===b?"absolute":"relative",left:"map_root"===b?f._map.width/2-100+"px":"5px",top:"20px","z-index":50});f._textSymbolEditor.startup();f._textSymbolEditor.createForm(a);
f._textSymbolEditor.show();f._textSymbolEditor.on("symbol-change",function(){f._boxEditor&&f._boxEditor.refresh()})}})}if((b&t.MOVE)===t.MOVE||(b&t.ROTATE)===t.ROTATE||(b&t.SCALE)===t.SCALE)this._textAnchor=new k(a.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(a){var e=this._map;switch(a.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new b(a,e,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(a){var b=
this._map;switch(a.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=d.create(a,b,this),!0}return!1},_enableBoxEditing:function(b,e,d){var f=this._map,c=b.geometry.type;return"polyline"===c||"polygon"===c||this._isTextPoint?(this._boxEditor=new a(b,f,this,e,d,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(a){return this._isTextPoint?(this._textEditor=new m(a,this._map,this),p.connect(this._textEditor,"onEditStart",g.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var a=this._graphicMover;a&&(a.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var a=this._vertexEditor;a&&(a.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var a=this._boxEditor;a&&(a.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(a,b,e){e&&this._refreshMoveables()},_refreshMoveables:function(a){var b=u.filter([this._graphicMover,this._vertexEditor,this._boxEditor],l.isDefined);u.forEach(b,function(b){b.refresh(a)})},_beginOperation:function(a){u.forEach(this._getAffectedTools(a),function(a){a.suspend()})},_endOperation:function(a){u.forEach(this._getAffectedTools(a),function(a){a.resume()})},_getAffectedTools:function(a){var b=[];switch(a){case "MOVE":b=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":b=[this._boxEditor];break;case "BOX":b=[this._vertexEditor]}return b=u.filter(b,l.isDefined)}});g.mixin(t,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});v("extend-esri")&&g.setObject("toolbars.Edit",t,z);return t})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b,d,m){r=r(null,{declaredClass:"esri.toolbars._Box",constructor:function(a,b,d,k,m,h,n){this._graphic=a;this._map=b;this._toolbar=d;this._scale=k;this._rotate=m;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=h;a=d._options;this._markerSymbol=a.boxHandleSymbol;this._lineSymbol=a.boxLineSymbol;this._moveStartHandler=c.hitch(this,this._moveStartHandler);this._firstMoveHandler=c.hitch(this,this._firstMoveHandler);
this._moveStopHandler=c.hitch(this,this._moveStopHandler);this._moveHandler=c.hitch(this,this._moveHandler);this._isTextPoint=n;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){g.forEach(this._getAllGraphics(),function(a){a.hide()})},resume:function(){g.forEach(this._getAllGraphics(),function(a){a.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
g.forEach(this._connects,p.disconnect);var a=this._toolbar._scratchGL;this._anchors&&g.forEach(this._anchors,function(b){a.remove(b.graphic);(b=b.moveable)&&b.destroy()});this._box&&a.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var a=this._map,b=this._toolbar._scratchGL,d=this._getBoxCoords(),k=new n(a.spatialReference),t=c.clone(g.filter(d,function(a,b){return 8!==b&&0===b%2}));t[0]&&t.push([t[0][0],t[0][1]]);k.addPath(t);this._rotate&&
k.addPath([d[1],d[8]]);this._box?this._box.setGeometry(k):(this._box=new m(k,this._lineSymbol),b.add(this._box));this._anchors?g.forEach(this._anchors,function(b,e){this._scale||(e=8);var f=new h(d[e],a.spatialReference);b.graphic.setGeometry(f);var f=b.moveable,c=b.graphic.getDojoShape();c&&(f?c!==f.shape&&(f.destroy(),b.moveable=this._getMoveable(b.graphic,e)):b.moveable=this._getMoveable(b.graphic,e))},this):(this._anchors=[],this._connects=[],g.forEach(d,function(e,d){!this._scale&&8>d||(e=new h(e,
a.spatialReference),e=new m(e,this._markerSymbol),this._isTextPoint&&1===d%2&&e.hide(),b.add(e),this._anchors.push({graphic:e,moveable:this._getMoveable(e,d)}))},this))}else this._cleanUp()},_getBoxCoords:function(a){var b=this._map,d,f=[],m,h,n;if(this._isTextPoint){d=this._graphic.getNode().getBoundingClientRect();var l=b.__container.getBoundingClientRect();d=[{x:d.left-l.left,y:d.top-l.top},{x:d.right-l.left,y:d.top-l.top},{x:d.right-l.left,y:d.bottom-l.top},{x:d.left-l.left,y:d.bottom-l.top}]}else d=
this._getTransformedBoundingBox(this._graphic);g.forEach(d,function(e,d,c){m=e;(h=c[d+1])||(h=c[0]);n={x:(m.x+h.x)/2,y:(m.y+h.y)/2};a||(m=b.toMap(m),n=b.toMap(n));f.push([m.x,m.y]);f.push([n.x,n.y])});this._rotate&&(d=c.clone(f[1]),d=a?{x:d[0],y:d[1]}:b.toScreen({x:d[0],y:d[1],spatialReference:b.spatialReference}),d.y-=this._toolbar._options.rotateHandleOffset,a||(d=b.toMap(d)),f.push([d.x,d.y]));return f},_getTransformedBoundingBox:function(a){var b=this._map,d=a.geometry.getExtent(),f=a.geometry.spatialReference;
a=new h(d.xmin,d.ymax,f);d=new h(d.xmax,d.ymin,f);a=b.toScreen(a);d=b.toScreen(d);return[{x:a.x,y:a.y},{x:d.x,y:a.y},{x:d.x,y:d.y},{x:a.x,y:d.y}]},_getAllGraphics:function(){var a=[this._box];this._anchors&&g.forEach(this._anchors,function(b){a.push(b.graphic)});return a=g.filter(a,l.isDefined)},_getMoveable:function(a,b){var e=a.getDojoShape();if(e)return a=new y(e),a._index=b,this._connects.push(p.connect(a,"onMoveStart",this._moveStartHandler)),this._connects.push(p.connect(a,"onFirstMove",this._firstMoveHandler)),
this._connects.push(p.connect(a,"onMoveStop",this._moveStopHandler)),a.onMove=this._moveHandler,(e=e.getEventSource())&&v.set(e,"cursor",this._toolbar._cursors["box"+b]),a},_moveStartHandler:function(a){this._toolbar["on"+(8===a.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(a){this._toolbar._deactivateScrollWheel();var b=a.host._index,d=this._wrapOffset=a.host.shape._wrapOffsets[0]||0,f=this._graphic.getLayer().getNavigationTransform(),m;a=g.map(this._getBoxCoords(!0),
function(a){return{x:a[0]+d,y:a[1]}});m=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:a[1].x,y:a[3].y};this._centerCoord=w.multiplyPoint(w.invert(f),m);if(8===b)m=w.multiplyPoint(w.invert(f),a[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,m)),this._startLine=[this._centerCoord,m],this._moveLine=c.clone(this._startLine);else if(m=w.multiplyPoint(w.invert(f),a[b]),f=w.multiplyPoint(w.invert(f),a[(b+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,
m)),this._firstMoverToAnchor=Math.sqrt((m.x-this._centerCoord.x)*(m.x-this._centerCoord.x)+(m.y-this._centerCoord.y)*(m.y-this._centerCoord.y)),this._startBox=f,this._startBox.width=a[4].x-a[0].x,this._startBox.height=a[4].y-a[0].y,this._moveBox=c.clone(this._startBox),this._xfactor=m.x>f.x?1:-1,this._yfactor=m.y>f.y?1:-1,1===b||5===b)this._xfactor=0;else if(3===b||7===b)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===b?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},
_moveHandler:function(a,b){a=a.host._index;var d=this._defaultEventArgs,e,f,c;d.angle=0;d.scaleX=1;d.scaleY=1;if(8===a)e=this._startLine,f=this._moveLine,c=f[1],c.x+=b.dx,c.y+=b.dy,b=this._getAngle(e,f),this._isTextPoint&&(b+=this._graphic.symbol.angle),f=w.rotategAt(b,e[0]),this._graphic.getDojoShape().setTransform(f),d.transform=f,d.angle=b,d.around=e[0];else{e=this._startBox;f=this._moveBox;f.width+=b.dx*this._xfactor;f.height+=b.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(e=f.x+
this._xfactor*f.width,f=f.y+this._yfactor*f.height,e=Math.sqrt((e-this._centerCoord.x)*(e-this._centerCoord.x)+(f-this._centerCoord.y)*(f-this._centerCoord.y)),this._scaleRatio=b=c=e/this._firstMoverToAnchor,e=this._centerCoord):(b=f.width/e.width,c=f.height/e.height,e={x:e.x,y:e.y});if(isNaN(b)||Infinity===b||-Infinity===b)b=1;if(isNaN(c)||Infinity===c||-Infinity===c)c=1;f=w.scaleAt(b,c,e);if(this._isTextPoint){var m=w.rotategAt(this._graphic.symbol.angle,e);this._graphic.getDojoShape().setTransform([m,
f])}else this._graphic.getDojoShape().setTransform(f);d.transform=f;d.scaleX=b;d.scaleY=c;d.around=e}this._toolbar["on"+(8===a?this._rotateEvent:this._scaleEvent)](this._graphic,d)},_moveStopHandler:function(a){this._toolbar._activateScrollWheel();var e=this._graphic,f=this._toolbar,c=f._geo?b.geographicToWebMercator(e.geometry):e.geometry,m=c.spatialReference,h=e.getDojoShape(),n=h.getTransform(),g=e.getLayer().getNavigationTransform();this._isTextPoint?(e=this._graphic.symbol,8===a.host._index?
e.angle+=this._getAngle(this._startLine,this._moveLine):e.font.setSize(Math.round(e.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(e)):(c=c.toJson(),this._updateSegments(c.paths||c.rings,n,g,m),h.setTransform(null),c=d.fromJson(c),e.setGeometry(f._geo?b.webMercatorToGeographic(c,!0):c));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;f._endOperation("BOX");this._defaultEventArgs.transform=n;f["on"+(8===a.host._index?this._rotateEvent:
this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(a,b,d,c){var e=this._map,f=this._wrapOffset||0;g.forEach(a,function(a){g.forEach(a,function(a){this._updatePoint(a,c,f,w,e,d,b)},this)},this)},_updatePoint:function(a,b,d,c,m,h,n){b=m.toScreen({x:a[0],y:a[1],spatialReference:b},!0);b.x+=d;b=c.multiplyPoint([h,n,c.invert(h)],b);b.x-=d;d=m.toMap(b);a[0]=d.x;a[1]=d.y},_getAngle:function(a,b){return 180*Math.atan2(b[0].y-b[1].y,b[0].x-b[1].x)/Math.PI-180*Math.atan2(a[0].y-
a[1].y,a[0].x-a[1].x)/Math.PI},_deNormalizePoint:function(a,b){var d=this._map._getFrameWidth();if(-1===d)return a;for(a={x:a.x,y:a.y};Math.abs(a.x-b.x)>=d;)a.x=a.x<b.x?a.x+d:a.x-d;var e=Math.abs(a.x-b.x);Math.abs(a.x-b.x+d)<e?a.x+=d:Math.abs(a.x-b.x-d)<e&&(a.x-=d);return a}});x("extend-esri")&&c.setObject("toolbars._Box",r,z);return r})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(r,c,g,p,u,x,v,y,w,z){return c("dojox.gfx.Moveable",null,{constructor:function(c,h){this.shape=c;this.delay=h&&0<h.delay?h.delay:0;this.mover=h&&h.mover?h.mover:w;this.leftButtonOnly=h&&h.leftButtonOnly;this.events=[this.shape.on(x.press,r.hitch(this,"onMouseDown"))]},destroy:function(){g.forEach(this.events,function(c){c.remove()});this.events=this.shape=null},onMouseDown:function(c){this.delay?(this.events.push(this.shape.on(x.move,r.hitch(this,"onMouseMove")),this.shape.on(x.release,r.hitch(this,
"onMouseUp"))),this._lastX=c.clientX,this._lastY=c.clientY):this.leftButtonOnly&&!z.isLeft(c)||new this.mover(this.shape,c,this);p.stop(c)},onMouseMove:function(c){var h=c.clientY;if(Math.abs(c.clientX-this._lastX)>this.delay||Math.abs(h-this._lastY)>this.delay)this.onMouseUp(c),new this.mover(this.shape,c,this);p.stop(c)},onMouseUp:function(c){this.events.pop().remove()},onMoveStart:function(c){u.publish("/gfx/move/start",c);v.add(y.body(),"dojoMove")},onMoveStop:function(c){u.publish("/gfx/move/stop",
c);v.remove(y.body(),"dojoMove")},onFirstMove:function(c){},onMove:function(c,h,n){this.onMoving(c,h,n);this.shape.applyLeftTransform(h);this.onMoved(c,h)},onMoving:function(c,h){},onMoved:function(c,h){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(r,c,g,p,u,x){return g("dojox.gfx.Mover",null,{constructor:function(c,g,w){this.shape=c;this.lastX=g.clientX;this.lastY=g.clientY;c=this.host=w;g=
document;w=p(g,u.move,r.hitch(this,"onFirstMove"));this.events=[p(g,u.move,r.hitch(this,"onMouseMove")),p(g,u.release,r.hitch(this,"destroy")),p(g,"dragstart",r.hitch(x,"stop")),p(g,"selectstart",r.hitch(x,"stop")),w];if(c&&c.onMoveStart)c.onMoveStart(this)},onMouseMove:function(c){var g=c.clientX,p=c.clientY;this.host.onMove(this,{dx:g-this.lastX,dy:p-this.lastY},c);this.lastX=g;this.lastY=p;x.stop(c)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){c.forEach(this.events,
function(c){c.remove()});var g=this.host;if(g&&g.onMoveStop)g.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(r,c,g,p,u,x,v,y,w,z,l,h,n,a){var b=r(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(a,b,c,e){this.graphic=a;this.map=b;this.toolbar=c;this.tempPt=e;this._enableGraphicMover();this._moved=!1},refresh:function(a){var b=this.graphic.getDojoShape();!b||!a&&b._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var a=this.graphic,c=a.getDojoShape();c&&(c._hostGraphic=a,this._moveable=new x(c,{mover:b.Mover}),this._moveStartHandle=
g.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=g.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=g.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=g.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(a=c.getEventSource())&&u.set(a,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var a=this._moveable;if(a){g.disconnect(this._moveStartHandle);g.disconnect(this._firstMoveHandle);
g.disconnect(this._movingHandle);g.disconnect(this._moveStopHandle);var b=a.shape;b&&(b._hostGraphic=null,(b=b.getEventSource())&&u.set(b,"cursor","inherit"));a.destroy()}this._moveable=null},_moveStartHandler:function(){var a=this.graphic,b=this.map;this._startTx=a.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&b.snappingManager&&b.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(a)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(a,b,c){a=a.shape.getTransform();b=this.map;var d;l("esri-pointer")?d=b.navigationManager.pointerEvents._processTouchEvent(c,c):c&&"pointermove"===c.type&&(d=z.prototype._processTouchEvent.call({map:b},c,c));d&&b.snappingManager&&b.snappingManager._onSnappingMouseMoveHandler(d);this.tempPt&&this.tempPt.getDojoShape().setTransform(a);this.toolbar.onGraphicMove(this.graphic,a)},_moveStopHandler:function(b){var d=this.graphic,c=this.toolbar,e=this.map,q=c._geo?h.geographicToWebMercator(d.geometry):
d.geometry,k=q.type,g=d.getDojoShape(),l=g.getTransform();if(p.toJson(l)!==p.toJson(this._startTx)){this._moved=!0;switch(k){case "point":var k=[l,y.invert(this._startTx)],r;e.snappingManager&&(r=e.snappingManager._snappingPoint);q=r||e.toMap(y.multiplyPoint(k,e.toScreen(q,!0)));e.snappingManager&&e.snappingManager._killOffSnapping();break;case "polyline":q=this._updatePolyGeometry(q,q.paths,l);break;case "polygon":q=this._updatePolyGeometry(q,q.rings,l)}g.setTransform(null);d.setGeometry(c._geo?
h.webMercatorToGeographic(q,!0):q);this.tempPt&&this.tempPt.setGeometry(new a(d.geometry.toJson()))}else this._moved=!1;c._endOperation("MOVE");c.onGraphicMoveStop(d,l);this._moved||(b=b.__e,e=this.map.position,b=new n(b.pageX-e.x,b.pageY-e.y),c.onGraphicClick(d,{screenPoint:b,mapPoint:this.map.toMap(b)}))},_updatePolyGeometry:function(a,b,c){var d=this.map,f=a.getPoint(0,0),d=d.toMap(d.toScreen(f).offset(c.dx,c.dy));c=d.x-f.x;for(var f=d.y-f.y,m,h,g,d=0;d<b.length;d++)for(h=b[d],m=0;m<h.length;m++)g=
a.getPoint(d,m),a.setPoint(d,m,g.offset(c,f));return a}});b.Mover=r(v,{declaredClass:"esri.toolbars._Mover",constructor:function(a,b,c){this.__e=b}});l("extend-esri")&&(c.setObject("toolbars._GraphicMover",b,w),c.setObject("toolbars._Mover",b.Mover,w));return b})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),
function(r,c,g,p,u,x,v,y,w,z,l,h){var n=r(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,b,d){this.graphic=a;this.map=b;this.toolbar=d;a=d._options;this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;b=a.ghostLineSymbol;this._lineStroke={style:b.style,width:b.width,color:b.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),
this._addControllers()):(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=g.connect(w,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=g.connect(w,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),
this._symbol1);this._canAdd&&(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=g.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=g.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new x({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new v({label:h.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),
this._deleteHandle=g.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){g.disconnect(this._firstMoveHandle);g.disconnect(this._moveStopHandle);g.disconnect(this._mouseOverHandle);g.disconnect(this._mouseOutHandle);g.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=
this._mpVertexMovers=null},_add:function(a,b,d){var c,f,e=this.graphic,h=[];for(c=0;c<a.length;c++){var k=a[c],g=[];for(f=0;f<k.length;f++)g.push(new w(k[f],b,e,c,f,k.length,this,d));h.push(g)}return h},_remove:function(a){a&&p.forEach(a,function(a){p.forEach(a,function(a){a.destroy()})})},_refresh:function(a){a&&p.forEach(a,function(a){p.forEach(a,function(a){a.refresh()})})},_isNew:function(a){return-1===p.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var b=this._findMover(a);b&&(this.toolbar.onVertexMouseOver(this.graphic,b._getInfo()),b._placeholder||(this._selectedMover=b,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=
this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var b,d=[];b=this._mpVertexMovers;p.forEach(this._vertexMovers,function(a){d=d.concat(a)});b&&p.forEach(b,function(a){d=d.concat(a)});
for(b=0;b<d.length;b++){var c=d[b];if(c.graphic===a)return c}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(a,b){var d=this._isNew(a);b&&(b.dx||b.dy)?(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,d),this._canAdd&&(d?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES")):
!d&&this._canAdd&&this._showRelatedMidpoints(a)},_showRelatedMidpoints:function(a){var b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),d=this._mpVertexMovers[a.segIndex];for(a=0;a<b.length;a++){var c=d[b[a]];c.graphic.show();c.refresh()}},_hideRelatedMidpoints:function(a){var b=this._getAdjacentMidpoints(a.ptIndex,a.segLength),d=this._mpVertexMovers[a.segIndex];for(a=0;a<b.length;a++)d[b[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var b,d=this._getAdjacentMidpoints(a.ptIndex,a.segLength),
c=this._mpVertexMovers[a.segIndex];for(b=0;b<d.length;b++){var f=this._getAdjacentVertices(d[b],a.segLength),e=a.relatedGraphic.geometry.getPoint(a.segIndex,f[0]),f=a.relatedGraphic.geometry.getPoint(a.segIndex,f[1]),e=new z({x:(e.x+f.x)/2,y:(e.y+f.y)/2,spatialReference:e.spatialReference.toJson()});c[d[b]].graphic.setGeometry(e)}},_addMidpoints:function(a){var b=a.segIndex,d=a.ptIndex,c=a.segLength,f=d+1,e,h=c+1;this._mpVertexMovers[b].splice(d,1);var k=this._vertexMovers[b];for(e=0;e<f;e++)k[e].segLength+=
1;for(e=f;e<k.length;e++)k[e].ptIndex+=1,k[e].segLength+=1;a.ptIndex=f;a.segLength=k.length+1;k.splice(f,0,a);a.graphic.setSymbol(this._symbol1);k=this._mpVertexMovers[b];for(e=0;e<d;e++)k[e].segLength+=1;for(e=d;e<c-1;e++)k[e].ptIndex+=1,k[e].segLength+=1;f=this._getAdjacentVertices(d,h);b=this._getAdjacentVertices(d+1,h);c=a.relatedGraphic.geometry.getPoint(a.segIndex,f[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,f[1]);f=new z({x:(c.x+e.x)/2,y:(c.y+e.y)/2,spatialReference:c.spatialReference.toJson()});
c=a.relatedGraphic.geometry.getPoint(a.segIndex,b[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,b[1]);b=new z({x:(c.x+e.x)/2,y:(c.y+e.y)/2,spatialReference:c.spatialReference.toJson()});c=new w(f,this._symbol2,this.graphic,a.segIndex,d,h,this,!0);a=new w(b,this._symbol2,this.graphic,a.segIndex,d+1,h,this,!0);k.splice(d,0,c,a)},_deleteVertex:function(a){var b,d=a.ptIndex,c=this._vertexMovers[a.segIndex];for(b=0;b<d;b++)--c[b].segLength;for(b=d+1;b<c.length;b++){var f=c[b];--f.ptIndex;--f.segLength}c.splice(d,
1);b=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,b)}});c.mixin(n,{create:function(a,b,d){switch(a.geometry.type){case "multipoint":return new n.MultipointVertexEditor(a,b,d);case "polyline":return new n.PolylineVertexEditor(a,b,d);case "polygon":return new n.PolygonVertexEditor(a,b,d)}}});n.MultipointVertexEditor=r(n,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=g.connect(w,"onMoveStart",this,this._moveStartHandler);
g.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);g.disconnect(this._moveStartHandle)},_getSegments:function(a){var b=a.points,d=[],c=a.spatialReference;for(a=0;a<b.length;a++){var f=b[a];d.push(new z({x:f[0],y:f[1],spatialReference:c.toJson()}))}return[d]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,b,d,c,f){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var b=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(b,
a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var b=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(b,a._getInfo())},_findMover:function(a){var b=[].concat(this._vertexMovers[0]),d=a.target;for(a=0;a<b.length;a++){var c=b[a];if(c.graphic.getDojoShape().getNode()===d)return c}},_moveStartHandler:function(a){var b=a.ptIndex,d=a.segLength-1,c=a.relatedGraphic.geometry.points;a=c.splice(b,1);c.push(a[0]);
c=this._vertexMovers[0];for(a=d;a>b;a--)--c[a].ptIndex;a=c.splice(b,1);c.push(a[0]);a[0].ptIndex=d},_moveStopHandler:function(a){this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,b,d,c,f,e,h,k){a=b.geometry;k?a.removePoint(f):a.setPoint(f,d);b.setGeometry(a)},_deleteMidpoints:function(a){}});n.PolylineVertexEditor=r(n,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(a){var b,d,c=a.paths,f=[];for(b=0;b<c.length;b++){var e=c[b],h=[];for(d=0;d<e.length;d++)h.push(a.getPoint(b,d));f.push(h)}return f},_getMidpointSegments:function(a){var b,d,c=a.paths,f=[],e=a.spatialReference;for(b=0;b<c.length;b++){var h=c[b],k=[];for(d=0;d<h.length-1;d++){var g=a.getPoint(b,d),n=a.getPoint(b,d+1),g=new z({x:(g.x+n.x)/2,y:(g.y+n.y)/2,spatialReference:e.toJson()});k.push(g)}f.push(k)}return f},_getControlPoints:function(a,b,d,c,f){var e=this.map,h,k;this._isNew(a)?
(a=c,c+=1,0<=a&&(h=e.toScreen(b.getPoint(d,a))),c<=f&&(k=e.toScreen(b.getPoint(d,c)))):(a=c-1,c+=1,0<=a&&(h=e.toScreen(b.getPoint(d,a))),c<f&&(k=e.toScreen(b.getPoint(d,c))));return[h,k]},_getAdjacentMidpoints:function(a,b){var d=[],c=a-1;0<=c&&d.push(c);a<b-1&&d.push(a);return d},_getAdjacentVertices:function(a,b){return[a,a+1]},_deleteMidpoints:function(a){var b=this._mpVertexMovers[a.segIndex],d=b.length-1,c=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),f,e=c[0];for(f=0;f<e;f++)--b[f].segLength;
for(f=e+1;f<b.length;f++){var h=b[f];--h.ptIndex;--h.segLength}if(1===c.length)b.splice(e,1)[0].destroy();else for(h=this._getAdjacentVertices(e,d),f=a.relatedGraphic.geometry.getPoint(a.segIndex,h[0]),h=a.relatedGraphic.geometry.getPoint(a.segIndex,h[1]),f=new z({x:(f.x+h.x)/2,y:(f.y+h.y)/2,spatialReference:f.spatialReference.toJson()}),a=new w(f,this._symbol2,this.graphic,a.segIndex,e,d,this,!0),b=b.splice(e,c.length,a),f=0;f<b.length;f++)b[f].destroy()},_updateRelatedGraphic:function(a,b,d,c,f,
e,h,k){a=b.geometry;h?a.insertPoint(c,f+1,l.fromJson(d.toJson())):k?a.removePoint(c,f):a.setPoint(c,f,l.fromJson(d.toJson()));b.setGeometry(a)}});n.PolygonVertexEditor=r(n,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(a){var b,d,c=a.rings,f=[];for(b=0;b<c.length;b++){var e=c[b],h=[];for(d=0;d<e.length-1;d++)h.push(a.getPoint(b,d));f.push(h)}return f},_getMidpointSegments:function(a){var b,d,c=a.rings,f=[],e=a.spatialReference;for(b=0;b<c.length;b++){var h=c[b],
k=[];for(d=0;d<h.length-1;d++){var g=a.getPoint(b,d),n=a.getPoint(b,d+1),g=new z({x:(g.x+n.x)/2,y:(g.y+n.y)/2,spatialReference:e.toJson()});k.push(g)}f.push(k)}return f},_getControlPoints:function(a,b,d,c,f){var e=this.map;this._isNew(a)?a=c:(a=c-1,a=0>a?(f+a)%f:a);c=(c+1)%f;f=e.toScreen(b.getPoint(d,a));b=e.toScreen(b.getPoint(d,c));return[f,b]},_getAdjacentMidpoints:function(a,b){var d=a-1;return[0>d?(b+d)%b:d,a]},_getAdjacentVertices:function(a,b){return[a,(a+1)%b]},_deleteMidpoints:function(a){var b=
a.ptIndex,d=this._mpVertexMovers[a.segIndex],c=d.length-1,f=this._getAdjacentMidpoints(b,a.segLength).sort(),e,h;h=f[0];var k=f[f.length-1];if(0===b)for(e=this._getAdjacentVertices(c-1,c),b=a.relatedGraphic.geometry.getPoint(a.segIndex,e[0]),e=a.relatedGraphic.geometry.getPoint(a.segIndex,e[1]),b=new z({x:(b.x+e.x)/2,y:(b.y+e.y)/2,spatialReference:b.spatialReference.toJson()}),a=new w(b,this._symbol2,this.graphic,a.segIndex,c-1,c,this,!0),d.splice(k,1,a)[0].destroy(),d.splice(h,1)[0].destroy(),f=
0;f<d.length-1;f++)h=d[f],--h.ptIndex,--h.segLength;else{e=this._getAdjacentVertices(h,c);b=a.relatedGraphic.geometry.getPoint(a.segIndex,e[0]);e=a.relatedGraphic.geometry.getPoint(a.segIndex,e[1]);b=new z({x:(b.x+e.x)/2,y:(b.y+e.y)/2,spatialReference:b.spatialReference.toJson()});a=new w(b,this._symbol2,this.graphic,a.segIndex,h,c,this,!0);k=d.splice(h,f.length,a);for(f=0;f<k.length;f++)k[f].destroy();for(f=0;f<h;f++)--d[f].segLength;for(f=h+1;f<d.length;f++)h=d[f],--h.ptIndex,--h.segLength}},_updateRelatedGraphic:function(a,
b,d,c,f,e,h,k){a=b.geometry;h?a.insertPoint(c,f+1,l.fromJson(d.toJson())):k?(a.removePoint(c,f),0===f&&a.setPoint(c,e-1,l.fromJson(a.getPoint(c,0).toJson()))):(a.setPoint(c,f,l.fromJson(d.toJson())),0===f&&a.setPoint(c,e,l.fromJson(d.toJson())));b.setGeometry(a)}});u("extend-esri")&&(c.setObject("toolbars._GraphicVertexEditor",n,y),c.setObject("toolbars._MultipointVertexEditor",n.MultipointVertexEditor,y),c.setObject("toolbars._PolylineVertexEditor",n.PolylineVertexEditor,y),c.setObject("toolbars._PolygonVertexEditor",
n.PolygonVertexEditor,y));return n})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(r,c,g,p,u,x,v,y,w,z,l,h){r=r(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(c,a,b,d,h,f,e,g){this.point=c;this.symbol=a;this.relatedGraphic=b;this.segIndex=d;this.ptIndex=h;this.segLength=
f;this.editor=e;this.map=e.map;this._scratchGL=e.toolbar._scratchGL;this._placeholder=g||!1;this._type=b.geometry.type;this._init();this._enable()},refresh:function(c){if(c||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var c=new z(this.point.toJson()),
c=new l(c,this.symbol);switch(this._type){case "multipoint":c._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(c)}this.graphic=c},_enable:function(){var c=this.graphic.getDojoShape();c&&(c._hasMover=!0,this._moveable=this._getMoveable(c),(c=c.getEventSource())&&u.set(c,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var c=this._moveable;if(c){g.disconnect(this._startHandle);
g.disconnect(this._firstHandle);g.disconnect(this._movingHandle);g.disconnect(this._stopHandle);var a=c.shape;a&&(a=a.getEventSource())&&u.set(a,"cursor","inherit");c.destroy();this._moveable=null}},_needRefresh:function(){var c=this.graphic.getDojoShape(),a=!1;if(c)switch(this._type){case "multipoint":var b=this.relatedGraphic.getDojoShape();b&&(b=b.children[this.ptIndex],c!==b&&(this.graphic._shape=b,a=!0));break;case "polyline":case "polygon":a=!c._hasMover}return a},_getMoveable:function(c){c=
new x(c,p("mac")&&p("ff")&&!w("esri-touch")&&{leftButtonOnly:!0});this._startHandle=g.connect(c,"onMoveStart",this,this._moveStartHandler);this._firstHandle=g.connect(c,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=g.connect(c,"onMoving",this,this._movingHandler);this._stopHandle=g.connect(c,"onMoveStop",this,this._moveStopHandler);return c},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(c){var a=this.map;a.snappingManager&&a.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();c.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(c){var a=c.shape,b=this._getControlEdges(),d=this._scratchGL._div,h,f=[],e=c.host.shape._wrapOffsets[0]||0;for(h=0;h<b.length;h++){var g=b[h];
g.x1+=e;g.x2+=e;f.push([d.createLine({x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2}).setStroke(this.editor._lineStroke),g.x1,g.y1,g.x2,g.y2])}a._lines=f;c.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(c,a,b){a=this.map;var d;w("esri-pointer")?d=a.navigationManager.pointerEvents._processTouchEvent(b,b):b&&"pointermove"===b.type&&(d=y.prototype._processTouchEvent.call({map:a},b,b));d&&a.snappingManager&&
a.snappingManager._onSnappingMouseMoveHandler(d);b=c.shape;c=b.getTransform();b=b._lines;for(d=0;d<b.length;d++)a=b[d],a[0].setShape({x1:a[1]+c.dx,y1:a[2]+c.dy,x2:a[3],y2:a[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),c)},_moveStopHandler:function(c){c=c.shape;var a=this.editor.toolbar,b=c.getTransform(),d=this.map,g=this.graphic,f=a._geo?h.geographicToWebMercator(g.geometry):g.geometry;a._activateScrollWheel();var e,q=c._lines;if(q){for(e=0;e<q.length;e++)q[e][0].removeShape();
c._lines=null}e=!1;var q=!0,k=this._getInfo();b&&(b.dx||b.dy)?this._placeholder&&(this._placeholder=!1,e=!0):q=!1;var n;d.snappingManager&&(n=d.snappingManager._snappingPoint);n=n||d.toMap(d.toScreen(f).offset(b.dx,b.dy));d.snappingManager&&d.snappingManager._killOffSnapping();c.setTransform(null);g.setGeometry(a._geo?h.webMercatorToGeographic(n,!0):n);this.constructor.onMoveStop(this,b);a.onVertexMoveStop(this.relatedGraphic,k,b);if(!q)a.onVertexClick(this.relatedGraphic,k);if(e)a.onVertexAdd(this.relatedGraphic,
this._getInfo())},_getControlEdges:function(){var c=this.map,a=this.relatedGraphic.geometry,b=this.segIndex,d=this.ptIndex,h=this.segLength,f=this._scratchGL.getNavigationTransform(),e=f.dx,f=f.dy,g=c.toScreen(this.graphic.geometry),c=g.x-e,g=g.y-f,k=[],a=this.editor._getControlPoints(this,a,b,d,h);a[0]&&k.push({x1:c,y1:g,x2:a[0].x-e,y2:a[0].y-f});a[1]&&k.push({x1:c,y1:g,x2:a[1].x-e,y2:a[1].y-f});return k}});w("extend-esri")&&c.setObject("toolbars.VertexMover",r,v);c.mixin(r,{onMoveStart:function(){},
onFirstMove:function(){},onMoveStop:function(){}});return r})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(r,c,g,p,u,x,v,y,w,z){r=r(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(c,h,g){this._graphic=c;this._map=h;this._toolbar=g;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},
onEditEnd:function(){},_enable:function(c){this._editBox?(g.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=g.connect(c.getLayer(),"onDblClick",this,function(h){this._map.navigationManager.setImmediateClick(!1);h.graphic==c&&(p.stop(h),g.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(c))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(g.disconnect(this._addEditBoxHandler),
this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(l,h){if(!this._editBox){var n;l.symbol.text||(l.symbol.text="Tempt text",l.setSymbol(l.symbol),n="");var a=this._createInputTextStyle(l,this._map);""!==n&&(n=h||l.symbol.text);this._editBox=x.create("input",{type:"text",value:n});y.set(this._editBox,a);v.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();
this._editBoxKeyHandler=g.connect(this._editBox,"onkeyup",c.hitch(this,function(a){a.keyCode!=w.ENTER&&a.keyCode!==w.TAB||this._disable()}));this._editBoxBlurHandler=g.connect(this._editBox,"onblur",c.hitch(this,function(a){this._disable()}));l.symbol.text="";l.setSymbol(l.symbol);l.hide();var b=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",c.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(a){y.set(b,{left:this._editBoxLeft+
a.delta.x+"px",top:this._editBoxTop+a.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(y.get(b,"left"));this._editBoxTop=parseFloat(y.get(b,"top"))});this.onEditStart(l,this._editBox);this._toolbar.onTextEditStart(l,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(g.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);
this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(g.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(c,h){h=c.getDojoShape().getTransformedBoundingBox();var g=c.getLayer(),g=g.hasLocalNavigationTransform()?{dx:0,
dy:0}:g.getNavigationTransform(),a=c.symbol.font;return{"font-family":a.family,"font-size":a.size+"px","font-style":a.style,"font-variant":a.variant,"font-weight":a.weight,left:h[0].x+g.dx+"px",top:h[0].y+g.dy+"px",width:Math.abs(h[0].x-h[1].x)/Math.cos(c.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var c=this._graphic.symbol;c.text=this._editBox.value;this._graphic.setSymbol(c)}else this._graphic.getLayer().remove(this._graphic)}});
u("extend-esri")&&c.setObject("toolbars.TextEditor",r,z);return r})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),function(r,c,g,p,u,x,v,y,w,z,l,h){function n(a){var b=c.clone(a.attributes);(a=a.geometry)&&"point"===a.type&&("x"in b?b._x=a.x:b.x=a.x,"y"in b?b._y=a.y:b.y=a.y);return b}r.exportCSV=function(a,b,d){return r._createCSVStr(b,
d).then(function(b){return r._download(a+".csv",b)})};r.exportCSVFromFeatureLayer=function(a,b,d){d=d||{};return r._getExportData(b,{datas:d.datas,objectIds:d.objectIds,fromClient:d.fromClient,withGeometry:d.withGeometry,outFields:d.outFields,filterExpression:d.filterExpression,outSpatialReference:d.outSpatialReference,arcadeExpressions:d.arcadeExpressions}).then(function(c){return r._formattedData(b,c,{formatNumber:d.formatNumber,formatDate:d.formatDate,formatCodedValue:d.formatCodedValue,richText:{clearFormat:d.richTextFieldsToClear&&
!!d.richTextFieldsToClear.length,fieldsToClear:d.richTextFieldsToClear||[]},popupInfo:d.popupInfo}).then(function(b){return r.exportCSV(a,b.datas,b.columns)})})};r.exportCSVByAttributes=function(a,b,d,h){h=c.mixin({},h);h.datas=d;return r.exportCSVFromFeatureLayer(a,b,h)};r.exportCSVByGraphics=function(a,b,d,c){d=g.map(d,function(a){return a.attributes});return r.exportCSVByAttributes(a,b,d,c)};r._createCSVStr=function(a,b){var d=new x,c="",f=0,e=0,h="",k="";try{b=g.map(b,function(a){return"string"===
typeof a?{name:a}:a});g.forEach(b,function(a){a=a.alias||a.name;-1<a.toString().indexOf(",")&&(a='"'+a+'"');c=c+h+a;h=","});for(var c=c+"\r\n",f=a.length,e=b.length,n=0;n<f;n++){for(var h="",l=0;l<e;l++)(k=a[n][b[l].name])||"number"===typeof k||(k=""),k&&/[",\r\n]/g.test(k)&&(k='"'+k.replace(/(")/g,'""')+'"'),c=c+h+k,h=",";c+="\r\n"}d.resolve(c)}catch(B){console.error(B),d.resolve("")}return d};r._isIE11=function(){return 11===v.has("ie")};r._isEdge=function(){return v.has("edge")};r._getDownloadUrl=
function(a){return window.Blob&&window.URL&&window.URL.createObjectURL?(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};r._download=function(a,b){var d=new x;try{if(u("ie")&&10>u("ie")){var c=window.top.open("about:blank","_blank");c.document.write("sep\x3d,\r\n"+b);c.document.close();c.document.execCommand("SaveAs",!0,a);c.close()}else if(10===u("ie")||r._isIE11()||r._isEdge()){var f=new Blob(["\ufeff"+b],{type:"text/csv"});
navigator.msSaveBlob(f,a)}else{var e=p.create("a",{href:r._getDownloadUrl(b),target:"_blank",download:a},document.body);if(u("safari")){var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0);e.dispatchEvent(h)}else e.click();p.destroy(e)}d.resolve()}catch(k){d.reject(k)}return d};r._getExportData=function(a,b){var d=new x,h=null,f=[],e=b.datas,q=b.withGeometry,k=!!b.arcadeExpressions,h=b.outFields;h&&h.length||(h=a.fields);h=c.clone(h);if(q&&!(e&&0<e.length)){k?(f=g.filter(a.fields,
function(a){return-1===a.name.indexOf("expression/")}),f=c.clone(f)):f=c.clone(h);var l="",l=-1!==h.indexOf("x")?"_x":"x";h.push({name:l,alias:l,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});l=-1!==h.indexOf("y")?"_y":"y";h.push({name:l,alias:l,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}e&&0<e.length?(k&&(e=r._getAttrsWithExpressionsBatch(e,b.arcadeExpressions)),d.resolve({data:e||[],outFields:h})):b.fromClient?(e=g.map(a.graphics,function(a){a=
q?n(a):c.clone(a);return a=k?r._getAttrsWithExpressions(a,b.arcadeExpressions):a}),d.resolve({data:e||[],outFields:h})):r._getExportDataFromServer(a,f,b).then(function(a){k&&(a=r._getAttrsWithExpressionsBatch(a,b.arcadeExpressions));d.resolve({data:a||[],outFields:h})});return d};r._getExportDataFromServer=function(a,b,d){var c=new x;if("esri.layers.FeatureLayer"!==a.declaredClass)return c.resolve([]),c;var f=new w(a.url),e=new z;e.where=d.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||
"1\x3d1";0<b.length?(a=g.map(b,function(a){return a.name}),e.outFields=a):e.outFields=["*"];e.objectIds=d.objectIds;e.returnGeometry=d.withGeometry;e.outSR=d.spatialReference;f.execute(e,function(a){a=g.map(a.features,function(a){return n(a)});c.resolve(a)},function(a){console.error(a);c.resolve([])});return c};r._formattedData=function(a,b,d){var c=new x,f=[],e=b.data;b=b.outFields;for(var h=0,k=e.length;h<k;h++){for(var n={},l=0;l<b.length;l++){var p=b[l];n[p.name]=r._getExportValue(e[h][p.name],
p,a.objectIdField,a.typeIdField,e[h][a.typeIdField],a.types,d)}f.push(n)}a=g.map(b,function(a){return{alias:a.alias,name:a.name}});c.resolve({datas:f,columns:a});return c};r._getExportValue=function(a,b,d,c,f,e,h){function k(a){if(q&&y.isDefined(q.fieldInfos))for(var b=0,d=q.fieldInfos.length;b<d;b++){var e=q.fieldInfos[b];if(e.fieldName===a)return e.format}return null}function n(a){for(var b=0,d=m.length;b<d;b++)if(m[b].fieldName===a)return!0;return!1}var q=h.popupInfo,m=h.richText.fieldsToClear,
l=!!b.domain&&h.formatCodedValue,p="esriFieldTypeDate"===b.type&&h.formatDate,r=d&&b.name===d;c=c&&b.name===c;n="esriFieldTypeString"===b.type&&h.richText.clearFormat&&n(b.name);return p?v.fieldFormatter.getFormattedDate(a,k(b.name)):c?v.fieldFormatter.getTypeName(a,e):l?v.fieldFormatter.getCodedValue(b.domain,a):n?a?(b=document.createElement("span"),b.innerHTML=a,b.textContent||b.innerText||""):a:l||p||r||c||n?a:(h=null,d&&e&&0<e.length&&(d=(d=g.filter(e,function(a){return a.id===f}))&&d[0])&&d.domains&&
d.domains[b.name]&&d.domains[b.name].codedValues&&(h=v.fieldFormatter.getCodedValue(d.domains[b.name],a)),null!==h?h:a)};r._getAttrsWithExpressions=function(a,b){var d=c.getObject("expressionInfos",!1,b);b=c.getObject("layerDefinition",!1,b);var g=new l(null,null,a);return h.customExpr.getAttributesFromCustomArcadeExpr(d,g,b)||a};r._getAttrsWithExpressionsBatch=function(a,b){var d=[];return d=g.map(a,function(a){return r._getAttrsWithExpressions(a,b)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),
function(r,c,g,p,u,x,v,y,w,z){var l={readExprInfo:{}};l.readExprInfo.getArcadeProfilesByType=function(c,g,a){c={map:c,layer:g};return"render"===a?l.readExprInfo._getArcadeRender(c):"label"===a?l.readExprInfo._getArcadeLabel(c):"infoTemplate"===a?l.readExprInfo._getArcadeInfoTemplate(c):l.readExprInfo._getAllArcade(c)};l.readExprInfo._getArcadeRender=function(c){return l.readExprInfo._lookupArcadeRender({layers:l.readExprInfo._checkPassInLayer(c)})};l.readExprInfo._getArcadeInfoTemplate=function(c){return l.readExprInfo._lookupArcadeInfoTemplate({layers:l.readExprInfo._checkPassInLayer(c)})};
l.readExprInfo._getArcadeLabel=function(c){return l.readExprInfo._lookupArcadeLabel({layers:l.readExprInfo._checkPassInLayer(c)})};l.readExprInfo._getAllArcade=function(c){var h=l.readExprInfo._getArcadeRender(c),a=l.readExprInfo._getArcadeInfoTemplate(c);c=l.readExprInfo._getArcadeLabel(c);return{render:h,infoTemplate:a,label:c}};l.readExprInfo._checkPassInLayer=function(c){var h=[];return h="undefined"!==typeof c?"undefined"!==typeof c.layer?null!==c.layer&&""!==c.layer?l.readExprInfo._getAllMapLayers(c):
l.readExprInfo._getAllMapLayers():l.readExprInfo._getAllMapLayers():l.readExprInfo._getAllMapLayers()};l.readExprInfo._getAllMapLayers=function(c){var h="",a=[],b=z.getInstance();c&&c.layer&&(h=c.layer.id);""!==h?(c=b.getNodeById(h))&&a.push(c._layerInfo.layerObject):b.traversal(function(b){"undefined"!==typeof b._layerInfo.layerObject.type?-1===b._layerInfo.layerObject.type.indexOf("tile")&&a.push(b._layerInfo.layerObject):a.push(b._layerInfo.layerObject)});return a};l.readExprInfo._lookupArcadeRender=
function(h){var g=[];0<h.layers.length&&r.forEach(h.layers,c.hitch(this,function(a){var b={};if("undefined"!==typeof a.renderer){var d=a.renderer;"undefined"!==typeof d.valueExpression&&(b.layer=a.id,b.valueExpression=d.valueExpression,b.valueExpressionTitle=d.valueExpressionTitle,"undefined"!==typeof d.values&&(b.values=d.values),"undefined"!==typeof d.visualVariables&&(b.visualVariables=d.visualVariables));1<Object.keys(b).length&&b.constructor===Object?g.push(b):g.push({layer:a.id,valueExpression:null,
valueExpressionTitle:null,values:null,visualVariables:null})}}));return g};l.readExprInfo._lookupArcadeInfoTemplate=function(h){var g=[];0<h.layers.length&&r.forEach(h.layers,c.hitch(this,function(a){var b={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var d in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(d)&&
"undefined"!==typeof a.infoTemplates[d].infoTemplate.info.expressionInfos){var c=a.infoTemplates[d].infoTemplate;0<c.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=c.info.expressionInfos)}1<Object.keys(b).length&&b.constructor===Object?g.push(b):g.push({layer:a.id,expressionInfos:null})}));return g};l.readExprInfo._lookupArcadeLabel=function(h){var g=[];0<h.layers.length&&r.forEach(h.layers,c.hitch(this,function(a){var b={};"undefined"!==typeof a.labelingInfo&&r.forEach(a.labelingInfo,
c.hitch(this,function(d){"undefined"!==typeof d.name&&(b.layer=a.id,b.name=d.name,b.labelingInfo=d,b.expression=d.labelExpressionInfo.expression)}));1<Object.keys(b).length&&b.constructor===Object?g.push(b):g.push({layer:a.id,name:null,labelingInfo:null,expression:null})}));return g};l.customExpr={};l.customExpr.getAttributesFromCustomArcadeExpr=function(c,g,a){c=l.InfoTemplate._parseArcadeExpressions(c);return l.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(g,c,a)};l.customExpr.getAttributesValueFromCustomArcadeExprBatch=
function(c,n,a){var b=[],d;for(d in n)b.push(n[d]);n=l.InfoTemplate._parseArcadeExpressions(c);c=l.InfoTemplate._getExprNamesArrayFromPopupExprInfos(c);c.relationships=null;c.parsedExpressions=n;var h=new g;l.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(b,c,a).then(function(a){h.resolve(a)});return h};l.InfoTemplate={};l.InfoTemplate.getAttributesFromInfoTemplate=function(c,g,a){var b={fields:[]};g.layerObject&&g.layerObject.fields&&(b.fields=g.layerObject.fields);c=l.readExprInfo.getArcadeProfilesByType(c,
g,"infoTemplate")[0].expressionInfos;if(!c)return a.attributes;c=l.InfoTemplate._parseArcadeExpressions(c);return l.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,c,b)};l.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(c,n,a){var b={fields:[]};n.layerObject&&n.layerObject.fields&&(b.fields=n.layerObject.fields);var d=[],h;for(h in a)d.push(a[h]);c=l.readExprInfo.getArcadeProfilesByType(c,n,"infoTemplate")[0].expressionInfos;var f=new g;if(!c)return f.resolve([]),f;
a=l.InfoTemplate._parseArcadeExpressions(c);h=null;h=n.getPopupInfo().description;null!==h?(h=l.InfoTemplate._convertPopupDescToFieldNamesArray(h),h.relationships=l.InfoTemplate._getRelationshipQueries(n)):(h=l.InfoTemplate._getExprNamesArrayFromPopupExprInfos(c),h.relationships=null);h.parsedExpressions=a;l.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,h,b).then(function(a){f.resolve(a)});return f};l.InfoTemplate._getRelationshipQueries=function(c){var h=!1,a={},b=/\d+/,d;if(d=c.getPopupInfo().description.match(/\{relationships\/\d+\//gm))h=
!0,r.forEach(d,function(d){var f=d.match(b)[0];a.hasOwnProperty(f)||(d=new y,d.outFields=["*"],d.relationshipId=f,d.returnGeometry=!1,a[f]={operLayer:c,relatedQuery:d})});return h?a:null};l.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(c){var h=[],a;for(a in c)h.push("${expression/"+c[a].name+"}");return h};l.InfoTemplate._convertPopupDescToFieldNamesArray=function(c){c=l.InfoTemplate._convertEndParasToEOLs(c);c=l.InfoTemplate._convertBreaksToEOLs(c);c=l.InfoTemplate._sanitizeNoTags(c).trim();
c=c.replace(/\{/gi,"${");c=c.replace(/\u00a0/gi," ");c=c.split("\n");return c=r.map(c,function(c){return c.trim()})};l.InfoTemplate._sanitizeNoTags=function(c){var h;h=w.sanitizeHTML(c);c=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var a;do a=h,h=h.replace(c,"");while(h!==a);return h=h.replace(/</g,"\x26lt;")};l.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=
function(c,n,a){var b=new g,d=[],h=[],f=0;n.relationships?(r.forEach(c,function(b){l.InfoTemplate._objEach(n.relationships,function(c,d){var e=new g,f=c.relatedQuery,k;h.push(e);k=b.attributes[c.operLayer.layerObject.objectIdField];f.objectIds=[k];c.operLayer.layerObject.queryRelatedFeatures(f,function(c){var f=[];c[k]&&c[k].features&&(c=c[k].features,r.forEach(c,function(c){var e=[],h,g,k;h=b.attributes;g="relationships/"+d+"/";l.InfoTemplate._objEach(c.attributes,function(a,b){k=g+b;h[k]=a});r.forEach(n,
function(c){e.push(u.substitute(c,l.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,n.parsedExpressions,a),l.InfoTemplate._useEmptyStringForNull))});f.push(e)}));e.resolve(f)})})}),p(h).then(function(a){r.forEach(a,function(a){r.forEach(a,function(a){++f;d.push(a)})});console.log(f+" related address features found");b.resolve(d)})):(r.forEach(c,function(b){var c=[];r.forEach(n,function(d){c.push(u.substitute(d,l.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,n.parsedExpressions,
a),l.InfoTemplate._useEmptyStringForNull))});d.push(c)}),b.resolve(d));return b};l.InfoTemplate._parseArcadeExpressions=function(c){var h;Array.isArray(c)&&0<c.length&&(h={},r.forEach(c,function(a){h[a.name]=x.parseScript(a.expression)}));return h};l.InfoTemplate._initArcadeContext=function(c,g){var a={vars:{}};a.vars.$feature=v.createFromGraphicLikeObject(c.geometry,c.attributes,g);return a};l.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(h,g,a){var b,d;b=c.mixin({},h.attributes);
if(g)for(d in h=l.InfoTemplate._initArcadeContext(h,a),g)a=x.executeScript(g[d],h),b["expression/"+d]=a?a.toString():"";return b};l.InfoTemplate._convertEndParasToEOLs=function(c){var h=c;c=c.match(/<\/p>/gi);r.forEach(c,function(a){h=h.replace(a,"\n")});return h};l.InfoTemplate._convertBreaksToEOLs=function(c){var h=c;c=c.match(/<br\s*\/?>/gi);r.forEach(c,function(a){h=h.replace(a,"\n")});return h};l.InfoTemplate._useEmptyStringForNull=function(c){return c?c:""};l.InfoTemplate._objEach=function(c,
g,a){for(var b in c)c.hasOwnProperty(b)&&g.call(a,c[b],b)};return l})},"widgets/DataAggregation/js/UI/LocationType":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/Deferred dojo/on dojo/text!./templates/LocationType.html dijit/form/RadioButton".split(" "),function(r,c,g,p,u,x,v,y,w){return r([g,p,u,x],{baseClass:"cf-location-type",declaredClass:"CriticalFacilities.LocationType",templateString:w,_started:null,
label:"LocationType",parent:null,nls:null,map:null,appConfig:null,config:null,useAddress:!0,useCoordinates:!1,theme:"",styleColor:"",_coordinatesView:void 0,_addressView:void 0,constructor:function(g){c.mixin(this,g)},postCreate:function(){this.inherited(arguments);this._initRadioButtons()},_initRadioButtons:function(){this.own(y(this.rdoAddress,"change",c.hitch(this,this._rdoAddressChanged)));this.own(y(this.rdoCoordinates,"change",c.hitch(this,this._rdoCoordinateChanged)));this.rdoAddress.set("checked",
this.useAddress);this.rdoCoordinates.set("checked",this.useCoordinates)},startup:function(){this._started=!0;this._updateAltIndexes()},onShown:function(){this.pageContainer.nextDisabled=!1},validate:function(c,g){var h=new v;"next-view"===c?h.resolve(this._nextView()):"back-view"===c?h.resolve(this._backView()):this._homeView(g).then(function(c){h.resolve(c)});return h},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(c){var g=new v;this.pageContainer.getViewByTitle("Home").verifyClearSettings(c).then(function(c){g.resolve(c)});
return g},_updateAltIndexes:function(){if(this.pageContainer&&!this._coordinatesView&&!this._addressView){this._coordinatesView=this.pageContainer.getViewByTitle("Coordinates");this._addressView=this.pageContainer.getViewByTitle("Addresses");var c=this.rdoAddress.get("checked");this._addressView&&this._coordinatesView&&(this._addressView.altBackIndex=this.index,this._coordinatesView.altBackIndex=this.index,this.altNextIndex=c?this._addressView.index:this._coordinatesView.index)}},_rdoAddressClick:function(){this.rdoAddress.set("checked",
!0)},_rdoAddressChanged:function(c){this.useAddress=c;this._addressView&&this._coordinatesView&&(this.altNextIndex=c?this._addressView.index:this._coordinatesView.index);this.parent._locationMappingComplete=!1},_rdoCoordinateClick:function(){this.rdoCoordinates.set("checked",!0)},_rdoCoordinateChanged:function(c){this.useCoordinates=c;this._addressView&&this._coordinatesView&&(this.altNextIndex=c?this._coordinatesView.index:this._addressView.index);this.parent._locationMappingComplete=!1},setStyleColor:function(c){this.styleColor=
c},updateImageNodes:function(){},_getResults:function(){return this.useAddress?this._addressView._getResults():this._coordinatesView._getResults()}})})},"widgets/DataAggregation/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/DataAggregation/js/UI/templates/PageContainer.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"controlTr" style\x3d"line-height:20px;"\x3e\r\n          \x3c!--BACK--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-left" data-dojo-attach-point\x3d"backTd" data-dojo-attach-event\x3d"onclick:_prevView"\x3e\r\n            \x3cdiv class\x3d"float-left bg-img bg-back-img margin-right-5" data-dojo-attach-point\x3d"backImage"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.back}" label\x3d"${nls.back}"\x3e${nls.back}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--HOME--\x3e\r\n          \x3ctd nowrap align\x3d"center" class\x3d"page-item-td-center" data-dojo-attach-point\x3d"homeTd" data-dojo-attach-event\x3d"onclick:_homeView"\x3e\r\n            \x3cdiv\x3e\r\n              \x3cdiv class\x3d"bg-home bg-home-img" data-dojo-attach-point\x3d"homeImage"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3c!--NEXT--\x3e\r\n          \x3ctd nowrap class\x3d"page-item-td-right" data-dojo-attach-point\x3d"nextTd" data-dojo-attach-event\x3d"onclick:_nextView"\x3e\r\n            \x3cdiv class\x3d"float-right bg-img bg-next-img margin-left-5" data-dojo-attach-point\x3d"nextImage"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"page-item-div main-text" title\x3d"${nls.next}" label\x3d"${nls.next}"\x3e${nls.next}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Home.html":'\x3cdiv style\x3d"height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv class\x3d"bottom-border-mid" data-dojo-attach-point\x3d"schemaMapInstructions"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"pageInstruction" class\x3d"main-instruction"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"main-instruction startpage-hint"\x3e${nls.startPage.startPageHint}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"upload-tab-node" data-dojo-attach-point\x3d"uploadTabNode"\x3e\r\n    \x3cdiv class\x3d"schema-map-instructions" data-dojo-attach-point\x3d"schemaMapInstructions"\x3e\r\n      \x3cdiv class\x3d"usage-instruction"\x3e\r\n        ${nls.startPage.dragDrop}\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"drop-or-browse"\x3e\r\n        ${nls.startPage.or}\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"browseContainer"\x3e\r\n        \x3cform class\x3d"file-form" enctype\x3d"multipart/form-data" method\x3d"post"\r\n              data-dojo-attach-point\x3d"fileForm"\x3e\r\n          \x3clabel for\x3d"${id}_file" class\x3d"jimu-btn"\r\n                 data-dojo-attach-point\x3d"uploadLabel"\x3e${nls.startPage.browse}\x3c/label\x3e\r\n          \x3cinput id\x3d"${id}_file" name\x3d"file" type\x3d"file" class\x3d"upload-input"\r\n                 data-dojo-attach-point\x3d"fileNode" /\x3e\r\n        \x3c/form\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"warning-instruction" data-dojo-attach-point\x3d"loadWarning"\x3e\r\n      \x3cspan\x3e${nls.warningsAndErrors.loadWarning}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"credit-warning-container"\x3e\r\n    \x3ca class\x3d"credit-warning" target\x3d"_blank" href\x3d"http://www.esri.com/software/arcgis/arcgisonline/credits"\x3e${nls.warningsAndErrors.consumesCredits}\x3c/a\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Addresses.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" \x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row" data-dojo-attach-point\x3d"mainInstructionRow"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.address.addressPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-point\x3d"singleAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"singleFieldHintTd"\x3e\r\n          \x3c!--table for single field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoSingleAddressClick" data-dojo-attach-point\x3d"singleRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                         class\x3d"jimu-radio-btn"\r\n                         id\x3d"rdo-single"\r\n                         type\x3d"radio"\r\n                         data-dojo-attach-point\x3d"rdoSingleAddress"\r\n                         title\x3d"${nls.address.singleField}" /\x3e\r\n                  \x3clabel class\x3d"main-text" for\x3d"rdo-single"\x3e${nls.address.singleField}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border-bold sub-task-hint panel-title-hint" data-dojo-attach-point\x3d"singleSubTaskHintTr"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left" data-dojo-attach-point\x3d"singleSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.singleFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border"\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"singleFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"singleFieldTable"\x3e\r\n                    \x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"multiAddressRow"\x3e\r\n        \x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"multiFieldHintTd"\x3e\r\n          \x3c!--table for multi field--\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody\x3e\r\n              \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoMultiAddressClick" data-dojo-attach-point\x3d"multiRadioRow"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-10 field-control-td"\x3e\r\n                  \x3cinput name\x3d"addr" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                         class\x3d"jimu-radio-btn"\r\n                         id\x3d"rdo-multi"\r\n                         type\x3d"radio"\r\n                         data-dojo-attach-point\x3d"rdoMultiAddress"\r\n                         title\x3d"${nls.address.multiField}" /\x3e\r\n                  \x3clabel class\x3d"main-text" for\x3d"rdo-multi"\x3e${nls.address.multiField}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr class\x3d"bottom-border sub-task-hint panel-title-hint"\x3e\r\n                \x3ctd colspan\x3d"2" class\x3d"pad-left-20 panel-title-hint-td float-left" data-dojo-attach-point\x3d"multiSubTaskHintTd"\x3e\r\n                  \x3cspan class\x3d"instruction"\x3e${nls.address.multiFieldHint}\x3c/span\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd data-dojo-attach-point\x3d"multiFieldTableRow"\x3e\r\n                  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n                    \x3ccolgroup\x3e\r\n                      \x3ccol width\x3d"40%" /\x3e\r\n                      \x3ccol width\x3d"60%" /\x3e\r\n                    \x3c/colgroup\x3e\r\n                    \x3ctbody data-dojo-attach-point\x3d"multiFieldTable"\x3e\x3c/tbody\x3e\r\n                  \x3c/table\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Coordinates.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"coordinateTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.coordinates.coordinatesPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FieldMapping.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row bottom-border-bold"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.fieldMapping.fieldMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"pad-top-10"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"fieldMappingTable"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/StartPage.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.startPage.locationAndField}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationAndFieldHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-event\x3d"onClick:_locationMappingClick"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"display-none done-mark" data-dojo-attach-point\x3d"locationMappingComplete"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row" \x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.locationMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"task-row" data-dojo-attach-event\x3d"onClick:_schemaMappingClick"\x3e\r\n        \x3ctd class\x3d"field-control-td"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.mapping.schemaMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"display-none done-mark" data-dojo-attach-point\x3d"fieldMappingComplete"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-top-10 task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.mapping.schemaMappingHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right display-none" data-dojo-attach-point\x3d"addToMapButton" data-dojo-attach-event\x3d"onClick:_addToMapClick"\x3e${nls.buttons.addToMap}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Review.html":'\x3cdiv class\x3d"pad-left-5 no-select" style\x3d"height: 100%"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0" data-dojo-attach-point\x3d"reviewRowTable"\x3e\r\n    \x3ctbody\x3e\r\n\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.review.reviewData}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"reviewDataHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"unMatchedControlRow" data-dojo-attach-event\x3d"onclick:_reviewUnMatched"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewUnMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"unMatchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"unMatchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"unMatchedHintTd" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewUnMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"duplicateControlRow" data-dojo-attach-event\x3d"onclick:_reviewDuplicate"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewDuplicate}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"duplicateCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"duplicateHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"duplicateHintTd" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"reviewDuplicateHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n      \x3ctr class\x3d"pad-bottom-10 task-row" data-dojo-attach-point\x3d"matchedControlRow" data-dojo-attach-event\x3d"onclick:_reviewMatched"\x3e\r\n        \x3ctd class\x3d"field-control-td width-100"\x3e\r\n          \x3cdiv class\x3d"task-text"\x3e${nls.review.reviewMatched}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-right-15 float-right main-text field-control-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"matchedCount"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"width-15"\x3e\r\n          \x3cdiv class\x3d"next-arrow float-right next-arrow-img"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border pad-bottom-10 task-instruction-row" data-dojo-attach-point\x3d"matchedHintRow"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"instruction-padding"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.review.reviewMatchedHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv class\x3d"pad-top-10"\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right" data-dojo-attach-point\x3d"submitButton" data-dojo-attach-event\x3d"onclick:_submit"\x3e${nls.buttons.submit}\x3c/div\x3e\r\n    \x3cdiv class\x3d"float-right bg-loading-img bg-loading pad-top-10 display-none" data-dojo-attach-point\x3d"progressNode"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"jimu-btn float-right margin-right-15" data-dojo-attach-point\x3d"downloadButton" data-dojo-attach-event\x3d"onclick:_download"\x3e${nls.buttons.download}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/FeatureList.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHint"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\r\n          \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"featureListTable"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/Feature.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n\r\n  \x3c!-- Title table --\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureTitleTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitleDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHintDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--Feature toolbar table--\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureToolbarTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"reviewRowRecordTd" class\x3d"pad-bottom-10 pad-top-10"\x3e\r\n          \x3cspan class\x3d"float-left main-text pad-right-10 display-none pad-left-5" data-dojo-attach-point\x3d"reviewText" style\x3d"line-height:30px;"\x3e${nls.review.item}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_duplicateFlag" class\x3d"pad-bottom-10 duplicate-flag"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-bottom-10 pad-top-10 feature-toolbar-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"featureToolbar"\x3e\r\n\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--feature toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"featureToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-event\x3d"onclick:_toggleFeature"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.feature}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" nowrap class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"featureTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5" data-dojo-attach-point\x3d"toggleFeature"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"featureInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--feature controls table--\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"featureTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"30%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"featureControlTable"\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3c!--location toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"locationControlToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-event\x3d"onclick:_toggleLocation"\x3e\r\n        \x3ctd class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.locationInfo}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"locationTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5" data-dojo-attach-point\x3d"toggleLocation"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"locationInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--location toolbar--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationSyncTable"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n          \x3ctd class\x3d"field-control-td pad-left-5"\x3e\r\n            \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationHint"\x3e${nls.review.locationControlHint}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"field-control-td" title\x3d"${nls.review.sync}"\x3e\r\n            \x3cdiv class\x3d"float-right bg-ft-img bg-sync feature-toolbar-btn" data-dojo-attach-point\x3d"syncFields" data-dojo-attach-event\x3d"onclick:_syncAddressInfo"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd title\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3cdiv class\x3d"bg-ft-img bg-locate feature-toolbar-btn float-right" data-dojo-attach-point\x3d"locateButton" data-dojo-attach-event\x3d"onclick:_locate"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n    \x3c!--location controls table--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationControlTable"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"65%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n',
"url:widgets/DataAggregation/js/UI/templates/FeatureToolbar.html":'\x3cdiv class\x3d"float-right no-select"\x3e\r\n  \x3ctable class\x3d"control-table table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"feature-toolbar-row"\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.cancel}"\x3e\r\n          \x3cdiv class\x3d"bg-ft-img bg-cancel feature-toolbar-btn" data-dojo-attach-event\x3d"onclick:_cancel"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd title\x3d"${nls.featureToolbar.save}"\x3e\r\n          \x3cdiv class\x3d"float-right bg-ft-img bg-save feature-toolbar-btn" data-dojo-attach-event\x3d"onclick:_save"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/js/UI/templates/LocationType.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n  \x3ctable class\x3d"page-table" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text"\x3e${nls.mapping.locationMapping}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd colspan\x3d"3" class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction"\x3e${nls.locationMapping.locationMappingPageHint}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-row task-instruction-row" data-dojo-attach-event\x3d"onClick:_rdoAddressClick"\x3e\r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 class\x3d"jimu-radio-btn"\r\n                 id\x3d"rdo-address"\r\n                 type\x3d"radio"\r\n                 data-dojo-attach-point\x3d"rdoAddress"\r\n                 title\x3d"${nls.locationMapping.useAddress}" /\x3e\r\n          \x3clabel class\x3d"main-text" for\x3d"rdo-address"\x3e${nls.locationMapping.useAddress}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useAddressHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"task-instruction-row task-row" data-dojo-attach-event\x3d"onClick:_rdoCoordinateClick"\x3e\r\n        \x3ctd class\x3d"field-control-td pad-left-10"\x3e\r\n          \x3cinput name\x3d"lt" data-dojo-type\x3d"dijit/form/RadioButton"\r\n                 class\x3d"jimu-radio-btn"\r\n                 id\x3d"rdo-coordinate"\r\n                 type\x3d"radio"\r\n                 data-dojo-attach-point\x3d"rdoCoordinates"\r\n                 title\x3d"${nls.locationMapping.useCoordinates}" /\x3e\r\n          \x3clabel class\x3d"main-text" for\x3d"rdo-coordinate"\x3e${nls.locationMapping.useCoordinates}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd class\x3d"pad-left-20 pad-bottom-10"\x3e\r\n          \x3cspan class\x3d"instruction"\x3e${nls.locationMapping.useCoordinatesHint}\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:widgets/DataAggregation/Widget.html":'\x3cdiv style\x3d"width: 100%; height: 100%;" class\x3d"no-select"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"pageNavigation"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:widgets/DataAggregation/css/style.css":".jimu-widget-critical-facilities .disabled{cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .credit-warning{color: #86909c; margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .credit-warning-container{margin-top: 20px; margin-bottom: 10px; position: absolute; bottom: 0px;}.jimu-widget-critical-facilities .processing {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center center; height: 22px; width: 100%;}.jimu-widget-critical-facilities-ui .no-select {-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}.jimu-widget-critical-facilities-ui .font-size-large {font-size: 16px;}.jimu-widget-critical-facilities-ui .font-size-med {font-size: 14px;}.jimu-widget-critical-facilities-ui .bottom-border {border-bottom: 1px solid;}.jimu-widget-critical-facilities-ui .bottom-border-bold {border-bottom: 3px solid;}.jimu-widget-critical-facilities-ui .bottom-border-mid {border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .width-all {width: 100%;}.jimu-widget-critical-facilities-ui .table-layout {table-layout: fixed;}.jimu-widget-critical-facilities-ui .feature-toolbar-btn {padding: 10px; display: block;}.jimu-widget-critical-facilities-ui .feature-toolbar-row {line-height: 25px;}.jimu-widget-critical-facilities-ui .duplicate-col-headers {overflow: hidden; width: 100%; white-space: normal !important; line-height: 1.5; text-align: center;}.jimu-widget-critical-facilities-ui .page-item-td {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .float-left {float: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-left {float: right;}.jimu-widget-critical-facilities-ui .float-right {float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .float-right {float: left;}.jimu-widget-critical-facilities-ui .text-left {text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .text-left {text-align: right;}.jimu-widget-critical-facilities-ui .field-row-width {word-break: break-word;}.jimu-widget-critical-facilities-ui .field-row-width2 {word-break: break-word;}.jimu-widget-critical-facilities-ui .pad-side-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-side-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .bg-home-img {background-image: url('../images/home_black.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home-img-white {background-image: url('../images/home_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-center:hover .bg-home-img-white {background-image: url('../images/home_hover.png');}.jimu-widget-critical-facilities-ui .bg-home {width: 20px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.jimu-widget-critical-facilities-ui .bg-img {width: 12px; height: 20px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .toggle-expand-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .bg-img-toggle {width: 16px; height: 12px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-nav {cursor: pointer; min-width: 0; white-space: nowrap;}.jimu-widget-critical-facilities-ui .bg-toggle-down-img {background-image: url('../images/nav_down_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-down-img-white {background-image: url('../images/nav_down_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-down-img-white {background-image: url('../images/nav_down_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img {background-image: url('../images/nav_up_black.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .bg-toggle-up-img-white {background-image: url('../images/nav_up_white.png');}.jimu-widget-critical-facilities-ui .toggle-expand-row:hover .bg-toggle-up-img-white {background-image: url('../images/nav_up_hover.png');}.jimu-widget-critical-facilities-ui .feature-toolbar-td {width: 58px;}.jimu-widget-critical-facilities-ui .duplicate-flag {padding-bottom: 9px; float: left; display: inline-table;}.jimu-widget-critical-facilities-ui .bg-ft-img {width: 15px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.jimu-widget-critical-facilities-ui .bg-locate {background-image: url('../images/locate_black.png');}.jimu-widget-critical-facilities-ui .bg-locate:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-white {background-image: url('../images/locate_white.png');}.jimu-widget-critical-facilities-ui .bg-locate-white:hover {background-image: url('../images/locate_hover.png');}.jimu-widget-critical-facilities-ui .bg-locate-disabled {background-image: url('../images/locate_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-save {background-image: url('../images/save_black.png');}.jimu-widget-critical-facilities-ui .bg-save:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-white {background-image: url('../images/save_white.png');}.jimu-widget-critical-facilities-ui .bg-save-white:hover {background-image: url('../images/save_hover.png');}.jimu-widget-critical-facilities-ui .bg-save-disabled {background-image: url('../images/save_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-sync {background-image: url('../images/sync_black.png');}.jimu-widget-critical-facilities-ui .bg-sync:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-white {background-image: url('../images/sync_white.png');}.jimu-widget-critical-facilities-ui .bg-sync-white:hover {background-image: url('../images/sync_hover.png');}.jimu-widget-critical-facilities-ui .bg-sync-disabled {background-image: url('../images/sync_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .bg-cancel {background-image: url('../images/cancel_black.png');}.jimu-widget-critical-facilities-ui .bg-cancel:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white {background-image: url('../images/cancel_white.png');}.jimu-widget-critical-facilities-ui .bg-cancel-white:hover {background-image: url('../images/cancel_hover.png');}.jimu-widget-critical-facilities-ui .bg-cancel-disabled {background-image: url('../images/cancel_disabled.png'); cursor: default;}.jimu-widget-critical-facilities-ui .feature-list-row {}.jimu-widget-critical-facilities-ui .feature-list-row:hover {cursor:pointer;}.jimu-widget-critical-facilities-ui .feature-list-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png'); cursor: pointer;}.jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_left_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img {background-image: url('../images/nav_right_black.png');}.jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_left_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-back-img-white {background-image: url('../images/nav_right_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-left:hover .bg-back-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right {cursor: pointer; min-width: 0; white-space: nowrap; text-align: left;}.jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_right_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .bg-next-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .page-item-td-right:hover .bg-next-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .jimu-tab3 .page-item-td.jimu-state-active {color: #48494B;}.jimu-widget-critical-facilities-ui .control-node {padding-bottom: 10px; border-bottom: 2px solid;}.jimu-widget-critical-facilities-ui .container-node {padding-top: 10px;}.jimu-widget-critical-facilities-ui .control-disbaled {opacity: .3; cursor: default; pointer-events: none;}.jimu-widget-critical-facilities-ui .min-width-200 {min-width: 200px;}.jimu-widget-critical-facilities-ui .main-text {font-weight: bold; display: inline-block;}.jimu-widget-critical-facilities-ui .panel-title-td {padding: 0px 0px 5px 0px;}.jimu-widget-critical-facilities-ui .panel-title-text {font-weight: bold; display: inline-block; font-size: 15px;}.jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-bottom: 10px; padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint-td {padding-right: 5px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .main-instruction {color: #898989; font-size: 13px;}.jimu-widget-critical-facilities-ui .instruction {color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .instruction-padding {padding-left: 15px; padding-bottom: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .instruction-padding {padding-right: 15px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .width-100 {width: 100%;}.jimu-widget-critical-facilities-ui .pad-10 {padding: 10px;}.jimu-widget-critical-facilities-ui .pad-top-10 {padding-top: 10px;}.jimu-widget-critical-facilities-ui .pad-bottom-10 {padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .pad-left-5 {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-5 {padding-right: 5px;}.jimu-widget-critical-facilities-ui .pad-left-10 {padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-10 {padding-right: 10px;}.jimu-widget-critical-facilities-ui .pad-left-15 {padding-left: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-15 {padding-right: 15px;}.jimu-widget-critical-facilities-ui .pad-left-20 {padding-left: 20px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-20 {padding-right: 20px;}.jimu-widget-critical-facilities-ui .pad-left-30 {padding-left: 30px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-left-30 {padding-right: 30px;}.jimu-widget-critical-facilities-ui .pad-right-10 {padding-right: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-10 {padding-left: 10px;}.jimu-widget-critical-facilities-ui .pad-right-15 {padding-right: 15px !important;}.jimu-rtl .jimu-widget-critical-facilities-ui .pad-right-15 {padding-left: 15px !important;}.jimu-widget-critical-facilities-ui .margin-right-5 {margin-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-5 {margin-left: 5px;}.jimu-widget-critical-facilities-ui .margin-left-5 {margin-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-left-5 {margin-right: 5px;}.jimu-widget-critical-facilities-ui .margin-right-15 {margin-right: 15px;}.jimu-rtl .jimu-widget-critical-facilities-ui .margin-right-15 {margin-left: 15px;}.jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: right;}.jimu-rtl .jimu-widget-critical-facilities-ui .field-control {min-width: 150px; width: 100%; float: left;}.jimu-widget-critical-facilities-ui .field-control-td {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .sub-field-control-td {padding-bottom: 10px; padding-left: 10px;}.jimu-rtl .jimu-widget-critical-facilities-ui .sub-field-control-td {padding-right: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .min-width-80 {min-width: 80px;}.jimu-widget-critical-facilities-ui .task-text {float: left; padding-left: 10px; font-weight: bold; font-size: 14px;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-text {float: right; padding-right: 10px; font-weight: bold; font-size: 14px;}.jimu-widget-critical-facilities-ui .task-row {cursor: pointer;}.jimu-widget-critical-facilities-ui .dijitSelectLabel {text-align: left; text-overflow: ellipsis; overflow: hidden;}.jimu-widget-critical-facilities-ui .next-arrow {width: 15px; height: 16px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer;}.jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_right_black.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img {background-image: url('../images/nav_left_black.png');}.jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_right_white.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .next-arrow-img-white {background-image: url('../images/nav_left_white.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_right_hover.png');}.jimu-rtl .jimu-widget-critical-facilities-ui .task-row:hover .next-arrow-img-white {background-image: url('../images/nav_left_hover.png');}.jimu-widget-critical-facilities-ui .sub-task-hint {text-align: left; margin: auto; line-height: 20px; color: #898989; font-size: 11px;}.jimu-widget-critical-facilities-ui .panel-title-hint {padding-left: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .panel-title-hint {padding-right: 5px;}.jimu-widget-critical-facilities-ui .task-instruction-row {text-align: left; margin: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .task-instruction-row {text-align: right; margin: auto;}.jimu-widget-critical-facilities-ui .page-table {width: 100%; border-collapse: collapse; font-size: 13px;}.jimu-widget-critical-facilities-ui .width-15 {width: 15px;}.jimu-widget-critical-facilities-ui .display-none {display: none;}.jimu-widget-critical-facilities-ui .display-table-row-group {display: table-row-group;}.jimu-widget-critical-facilities-ui .no-padding {padding: 0px;}.jimu-widget-critical-facilities-ui .cf-page-container {position: relative; width: 100%;}.jimu-widget-critical-facilities-ui .cf-home .disabled {cursor: default; background-color: #a0acbf;}.jimu-widget-critical-facilities-ui .cf-home .upload-tab-node {margin-top: 20px;}.jimu-widget-critical-facilities-ui .cf-home .schema-map-instructions {text-align: center;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse {display: block; margin-top: 10px; margin-bottom: 10px; font-size: 11px; color: #898989; line-height: 20px; position: relative;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; left: 0;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:before,.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {content: \"\"; display: block; height: 1px; width: 45%; background: #eee; position: absolute; top: 9px; right: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: 0; left: auto;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse:after {right: auto; left: 0;}.jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-right: 5px;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .drop-or-browse b {display: inline-block; padding-left: 5px;}.jimu-widget-critical-facilities-ui .cf-home .file-form {display: inline-block;}.jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-right: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-rtl .jimu-widget-critical-facilities-ui .cf-home .file-form label {display: inline-block; font-size: 11px; text-transform: uppercase; padding: 5px; margin-left: 5px; min-width: 180px; line-height: 20px; white-space: normal;}.jimu-widget-critical-facilities-ui .cf-home .upload-input {display: none;}.jimu-widget-critical-facilities-ui .cf-home .warning-instruction {color: firebrick; display: none;}.jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-size: 14px; font-weight: bold;}.jimu-widget-critical-facilities-ui .cf-home .startpage-hint {padding-top: 10px; padding-bottom: 10px;}.jimu-widget-critical-facilities-ui .cf-home .bottom {padding-top: 10px; padding-bottom: 10px;}.jimu-popup .cf-warning-icon {width: 30px; height: 30px; position: relative; background-size: contain; background-repeat: no-repeat; margin-top: 10px; background-image: url('../images/warning.png');} .jimu-widget-critical-facilities-ui .cf-home .address-search {display: inline-block;}.jimu-widget-critical-facilities-ui .esriCTSearchOuterContainer {padding: 0px 0px 15px 0px; clear: both;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv {float: left; clear: both; margin-right: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchHeader {margin-bottom: 10px;}.jimu-widget-critical-facilities-ui .esriCTSearchDiv .arcgisSearch {float: left; width: 100% !important;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer {width: 100%; height: 35px;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {width: 170px; padding: 6px 24px 6px 12px !important;}.esriRtl .jimu-widget-critical-facilities-ui .arcgisSearch .searchGroup .searchInput {padding: 6px 12px 6px 24px !important;}.jimu-widget-critical-facilities-ui .arcgisSearch .searchBtn {padding: 6px;}.jimu-widget-critical-facilities-ui .jimu-widget-search .arcgisSearch .searchGroup .searchInputGroup .searchInput {width: auto;}.jimu-widget-critical-facilities-ui .esriCTSearchContainer .searchClear {top: 2px !important;}.jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: right; margin-right: 10px; background-repeat: no-repeat;}.jimu-rtl .jimu-widget-critical-facilities-ui .done-mark {background-image: url('../images/check.png'); width: 15px; height: 16px; position: relative; background-size: contain; float: left; margin-left: 10px; background-repeat: no-repeat;}.jimu-widget-critical-facilities-ui .bg-loading {background-image: url('../css/images/loading.gif');}.jimu-widget-critical-facilities-ui .bg-loading-img {width: 75px; height: 15px; position: relative; background-size: contain; background-repeat: no-repeat; cursor: pointer; margin: auto;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-cell {border-bottom: none !important; padding-top: 1px; padding-bottom: 1px; height: 33px;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .simple-table-row {border-bottom: 1px solid #ddd !important;}.LaunchpadTheme .jimu-widget-critical-facilities-ui .dijitTextBoxDisabled .dijitInputInner {color: black !important;}.DartTheme .jimu-widget-critical-facilities-ui .dijitTextBoxDisabled .dijitInputInner {color: #8e8d8d !important;}.DartTheme .jimu-popup {color: white !important;}.DartTheme .jimu-popup .title {color: white !important;}.DartTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-row .normal-text-div {color: white !important;}.DartTheme .jimu-widget-critical-facilities-ui .jimu-simple-table .simple-table-row:hover .normal-text-div {color: black !important;}.DartTheme .jimu-widget-critical-facilities-ui .main-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .panel-title-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .task-text {font-weight: normal !important;}.DartTheme .jimu-rtl .jimu-widget-critical-facilities-ui .task-text {font-weight: normal !important;}.DartTheme .jimu-widget-critical-facilities-ui .cf-home .usage-instruction {font-weight: normal !important;}",
"*now":function(r){r(['dojo/i18n!*preload*widgets/DataAggregation/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array jimu/BaseWidget dojo/Deferred dojo/DeferredList dojo/dom-construct jimu/LayerStructure jimu/portalUtils jimu/dijit/Message jimu/dijit/Popup esri/lang esri/request ./js/UI/PageContainer ./js/UI/Home ./js/UI/StartPage ./js/UI/LocationType jimu/utils".split(" "),function(r,c,g,p,u,x,v,y,w,z,l,h,n,a,b,d,m,f){return r([p],{baseClass:"jimu-widget-critical-facilities-ui",portal:null,editLayer:null,_configLayerInfo:null,_url:"",_geocodeSources:null,
_fsFields:null,_singleFields:null,_multiFields:null,_pageContainer:null,_userCanEdit:!0,_userHasCredits:!1,_hasLocators:!0,_locationMappingComplete:!1,_fieldMappingComplete:!1,_tempResultsAdded:!1,postCreate:function(){this.inherited(arguments);this.nls=c.mixin(this.nls,window.jimuNls.common);this._initEditLayerNode();this.editLayerNode&&this._initUserProperties().then(c.hitch(this,function(){this._initThemeAndConfig()}))},_initUserProperties:function(){var a=new u;this.validatePrivileges().then(c.hitch(this,
function(b){this._userCanEdit=b.canEdit;this._userHasCredits=b.hasCredits;this._userCanEdit&&this._userHasCredits?a.resolve(!0):this._alertUser().then(c.hitch(this,function(b){this._hasLocators=b;a.resolve(!0)}))}));return a},_initEditLayerNode:function(){this._configLayerInfo=this.config.layerSettings.layerInfo;this.layerStructure=y.getInstance();this.editLayerNode=this.layerStructure.getNodeById(this._configLayerInfo.featureLayer.id);-1!==[null,void 0].indexOf(this.editLayerNode)&&this._showNoEditLayerMessage()},
_showNoEditLayerMessage:function(){this._userHasCredits=this._userCanEdit=!1;var a=[this.nls.startPage.appropriateCredentials+"\x3c/br\x3e\x3c/br\x3e",this.nls.startPage.or+"\x3c/br\x3e\x3c/br\x3e",h.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.shared)];this._showPopup(a,h.substitute({layerName:this.config.layerSettings.layerInfo.featureLayer.title},this.nls.startPage.unableToAccess))},_initThemeAndConfig:function(){this._initConfigInfo();this._initEditLayerInfo().then(c.hitch(this,
function(){this._initBaseArgs();this._initPageContainer(!1)}))},_alertUser:function(){var a=new u;this._userCanEdit?this._removeWorldLocator(!0).then(function(b){a.resolve(0<b.length)}):(this.showEditMessage(),a.resolve(!1));return a},_removeWorldLocator:function(){var a=new u,b=[],d=[];g.forEach(this.config.sources,function(a){d.push(a.url);b.push(n({url:a.url,content:{f:"json"},handleAs:"json"}))});(new x(b)).then(c.hitch(this,function(b){if(b){for(var e=[],f=[],h=0;h<b.length;h++)f.push(this._validateLocator(b[h][1],
d[h]));(new x(f)).then(c.hitch(this,function(b){g.forEach(b,c.hitch(this,function(a){a[1]&&e.push(a[1])}));this._updateSources(e);a.resolve(this.config.sources)}))}}));return a},_validateLocator:function(a,b){var d=new u;a&&a.locatorProperties?a.locatorProperties.isAGOWorldLocator?(a=(a=/\/[0-9A-Fa-f]{32}\//.exec(b))&&a.length?a[0].substr(1).slice(0,-1):!1)?n({url:this.appConfig.portalUrl+"sharing/rest/content/items/"+a,content:{f:"json"},handleAs:"json"}).then(c.hitch(this,function(a){d.resolve(a.access&&
"public"===a.access?!1:b)}),function(a){console.log(a)}):d.resolve(b):d.resolve(!1):d.resolve(b);return d},_updateSources:function(a){if(0<a.length){var b=[];this.config.sources=this.config.sources.filter(function(c){if(-1===a.indexOf(c.url))return!0;b.push(c.name);return!1});var c=this._getMessages(b);this._showPopup(c,h.substitute({widgetName:this.label},this.nls.startPage.cannotUseLocator))}},_getMessages:function(a){var b=[],d="";a?g.forEach(a,c.hitch(this,function(a){d+=h.substitute({widgetName:this.label,
locator:a},this.nls.startPage.userCredits);d+="\x3c/br\x3e\x3c/br\x3e"})):(d+=this.nls.startPage.notEnoughCredits,d+="\x3c/br\x3e\x3c/br\x3e");""!==d&&(b.push(d),b.push(this.nls.startPage.contactAdmin+"\x3c/br\x3e\x3c/br\x3e"),0<this.config.sources.length&&(d="",g.forEach(this.config.sources,c.hitch(this,function(a){d+=h.substitute({locator:a.name},this.nls.startPage.canUseLocator);d+="\x3c/br\x3e\x3c/br\x3e"})),b.push(d)));return b},_showPopup:function(a,b){var d=v.create("div");v.create("div",{className:"cf-warning-icon",
style:"float: "+(window.isRTL?"right; margin-left":"left; margin-right")+": 10px;"},d);for(var e="padding-"+(window.isRTL?"right":"left")+": 50px;",f=0;f<a.length;f++)v.create("div",{innerHTML:a[f],style:(0===f?"padding-top:10px; ":"")+e+"word-wrap: break-word;"},d);var h=new l({width:500,autoHeight:!0,content:d,titleLabel:b,buttons:[{label:this.nls.ok,onClick:c.hitch(this,function(){h.close();h=null})}],onClose:function(){h=null}})},_initBaseArgs:function(){this._baseArgs={nls:this.nls,map:this.map,
parent:this,config:this.config,appConfig:this.appConfig,theme:this.theme,styleColor:this.styleColor,singleEnabled:this.singleEnabled,multiEnabled:this.multiEnabled,xyEnabled:this.xyEnabled}},onAppConfigChanged:function(a,b,c){switch(b){case "widgetChange":this._clearResults()}},_initConfigInfo:function(){if(this._configLayerInfo){this._valid=!0;this._url=this._configLayerInfo.featureLayer.url;this._geocodeSources=this.config.sources;this._symbol=this.config.layerSettings.symbol;this.xyEnabled=this.config.xyEnabled;
this.singleEnabled=this.multiEnabled=!1;this._fsFields=[];g.forEach(this._configLayerInfo.fieldInfos,c.hitch(this,function(a){a&&a.visible&&this._fsFields.push({name:a.fieldName,label:a.label,value:a.type,isRecognizedValues:a.isRecognizedValues,duplicate:a.duplicate})}));var a=function(a,b){g.forEach(a.isRecognizedValues,function(a){-1===b.isRecognizedValues.indexOf(a)&&b.isRecognizedValues.push(a)})};this._singleFields=[];this._multiFields=[];var b=[],d=[],f=[],h=[];this._geocodeSources&&g.forEach(this._geocodeSources,
c.hitch(this,function(e){this.singleEnabled=this.singleEnabled?this.singleEnabled:e.singleEnabled;this.multiEnabled=this.multiEnabled?this.multiEnabled:e.multiEnabled;if(e.singleEnabled){var k=e.singleAddressFields[0],l=k.label||k.alias,q=f.indexOf(l),m=k.fieldName||k.name,n=h.indexOf(m);-1<q||-1<n?a(k,this._singleFields[-1<q?q:n]):(f.push(l),h.push(m),this._singleFields.push({label:l,value:m,type:"STRING",isRecognizedValues:k.isRecognizedValues}))}e.multiEnabled&&(g.forEach(e.addressFields,c.hitch(this,
function(c){if(c&&c.visible){var e=c.label||c.alias,f=b.indexOf(e),h=c.fieldName||c.name,g=d.indexOf(h);-1<f||-1<g?(e=this._multiFields[-1<f?f:g],"undefined"===typeof e.fieldList?e.fieldList=[e.value,h]:e.fieldList.push(h),a(c,this._multiFields[-1<f?f:g])):(b.push(e),d.push(h),this._multiFields.push({label:e,value:h,type:"STRING",isRecognizedValues:c.isRecognizedValues}))}})),this.multiEnabled=0<this._multiFields.length)}))}},_initEditLayerInfo:function(){var a=new u;this.editLayerNode.getLayerObject().then(c.hitch(this,
function(b){this.infoTemplate=this.editLayerNode.getInfoTemplate();this.editLayer=b;this.editLayerDefinition=f.getFeatureLayerDefinition(b);this._updateFsFields(this.editLayer,this.infoTemplate);a.resolve(!0)}));return a},_updateFsFields:function(a,b){var c=a.typeIdField,d=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle"],e=["esriFieldTypeDouble"],h=this.editLayer||this.editLayerDefinition;g.forEach(this._fsFields,function(g){var k=0;a:for(;k<a.fields.length;k++){var l=a.fields[k];
if(l.name===g.name){g.domain=l.domain;g.length=l.length;g.isTypeIdField=g.name===c;g.subtypes=a.subtypes;var m=!0,k=g.domain,n=!0,q;if(k||g.isTypeIdField)q=f.getCodedValueListForCodedValueOrSubTypes(h,g.name,{});if(q){g.domainValues=q;g.codes=[];g.values=[];for(var p=0;p<q.length;p++){var r=q[p];g.codes.push(r.value);n&&(n=!isNaN(parseInt(r.label,10))&&!isNaN(parseFloat(r.label))&&parseFloat(r.label).toString().length===r.label.toString().length);g.values.push(r.label)}p=0;b:for(;p<q.length;p++)if(m=
q[p].value,m=!isNaN(parseInt(m,10))&&parseInt(m,10).toString().length===m.toString().length,!m)break b}q=l.type;g.type=-1<d.indexOf(q)&&n?"int":-1<e.indexOf(q)&&n?"float":"esriFieldTypeDate"===q?"date":k&&m&&n?"domainInt":k?"domain":"other";g.esriFieldType=q;if("date"===g.type){b:{if(b&&b.info&&b.info.fieldInfos)for(k=b.info.fieldInfos,n=0;n<k.length;n++)if(q=k[n],q.fieldName===g.name){k=q;break b}k=void 0}g.fieldInfo=k}g.nullable=l.nullable;break a}}})},_initPageContainer:function(b){this._initHomeView(b).then(c.hitch(this,
function(b){this._pageContainer?(this._tempResultsAdded=this._fieldMappingComplete=this._locationMappingComplete=!1,this._pageContainer.reset(),this._pageContainer.displayControllerOnStart=!1,this._pageContainer.toggleController(!0)):this._pageContainer=new a({nls:this.nls,appConfig:this.appConfig,displayControllerOnStart:!1,parent:this,styleColor:this.styleColor},this.pageNavigation);var c=this._initStartPageView();b=[b,c];this.xyEnabled&&(this.multiEnabled||this.singleEnabled)&&(c=this._initLocationTypeView(),
b.push(c));this._pageContainer.views=b;this._pageContainer.startup()}))},_initHomeView:function(a){var b=new u;a?this._initUserProperties().then(c.hitch(this,function(){b.resolve(this._getHome())})):b.resolve(this._getHome());return b},_getHome:function(){return new b(c.mixin({_geocodeSources:this._geocodeSources,_fsFields:this._fsFields,_singleFields:this._singleFields,_multiFields:this._multiFields,userName:this.userName,disabled:!this._userCanEdit||!this._userHasCredits&&!this._hasLocators},this._baseArgs))},
_initStartPageView:function(){return new d(this._baseArgs)},_initLocationTypeView:function(){return new m(this._baseArgs)},_clearResults:function(){if(this._pageContainer){var a=this._pageContainer.getViewByTitle("Home");a&&(a._clearStore(!0),a._clearMapping())}},validatePrivileges:function(){var a=new u;this.portal=this.portal||w.getPortal(this.appConfig.portalUrl);this.portal.getUser().then(c.hitch(this,function(b){this.userName=b.username;this.userCredits="undefined"!==typeof b.availableCredits?
b.availableCredits:"undefined"!==typeof this.portal.availableCredits?this.portal.availableCredits:0;this._checkLayerEditable(0<this.userCredits).then(function(b){a.resolve(b)})}),c.hitch(this,function(b){console.log(b);this._checkLayerEditable(!1).then(function(b){a.resolve(b)})}));return a},_checkLayerEditable:function(a){var b=new u;this.editLayerNode.isEditable().then(c.hitch(this,function(c){b.resolve({canEdit:c,hasCredits:a})}));return b},showEditMessage:function(){var a=[];"undefined"!==typeof this.userName?
a=[this.nls.startPage.userPrivilege+"\x3c/br\x3e\x3c/br\x3e",this.nls.startPage.contactAdminEdit]:(this.portal=this.portal||w.getPortal(this.appConfig.portalUrl),a=[h.substitute({layerName:this.editLayer.name},this.nls.startPage.noAnonymousEdit+"\x3c/br\x3e\x3c/br\x3e"),h.substitute({org:this.portal.name},this.nls.startPage.pleaseLogin)]);this._showPopup(a,this.nls.startPage.invalidEdit)},locatorError:function(a,b){a=[a+"\x3c/br\x3e\x3c/br\x3e"];b&&a.push(h.substitute({locator:b},this.nls.startPage.canUseLocator));
this._showPopup(a,this.nls.warningsAndErrors.locatorError)}})});