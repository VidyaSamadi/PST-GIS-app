// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/ParcelDrafter/PlanSettings":function(){define("dojo/_base/declare dojo/_base/array jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./PlanSettings.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/query ./utils jimu/utils libs/storejs/store dijit/form/Select".split(" "),function(g,b,a,d,e,f,p,l,r,v,q,k){return g([a,d,p],{baseClass:"jimu-widget-ParcelDrafter-PlanSettings",templateString:e,selectedPlanSettings:{},planSettingsOptions:f.clone(v.planSettingsOptions),
planSettingsKey:null,constructor:function(a){f.mixin(this,a)},startup:function(){var a=this._retriveFromLocalCache();a||(a={areaUnits:this.planSettingsOptions.areaUnits[0],circularCurveParameters:this.planSettingsOptions.circularCurveParameters[0],directionOrAngleType:this.planSettingsOptions.directionOrAngleType[0],directionOrAngleUnits:this.planSettingsOptions.directionOrAngleUnits[0],distanceAndLengthUnits:this.planSettingsOptions.distanceAndLengthUnits[0]});this._loadOptionsForDropDown(this.directionOrAngleType,
this.planSettingsOptions.directionOrAngleType,a.directionOrAngleType);this._loadOptionsForDropDown(this.directionOrAngleUnits,this.planSettingsOptions.directionOrAngleUnits,a.directionOrAngleUnits);this._loadOptionsForDropDown(this.distanceAndLengthUnits,this.planSettingsOptions.distanceAndLengthUnits,a.distanceAndLengthUnits);this._loadOptionsForDropDown(this.areaUnits,this.planSettingsOptions.areaUnits,a.areaUnits);this._loadOptionsForDropDown(this.circularCurveParameters,this.planSettingsOptions.circularCurveParameters,
a.circularCurveParameters);this.onPlansettingsChanged()},postCreate:function(){this.inherited(arguments);this.planSettingsKey=this.getKey();this.selectedPlanSettings={};this.planSettingsOptions=f.clone(v.planSettingsOptions);l.add(this.domNode,"esriCTPlanSettingsContainer esriCTFullWidth");setTimeout(f.hitch(this,this._setBackgroundColorForDartTheme),500)},_setBackgroundColorForDartTheme:function(){var a,b,d;if("DartTheme"===this.appConfig.theme.name)for(a=r(".dijitSelect .dijitButtonContents",this.planSettingsNode),
d=r(".dijitSelect .dijitArrowButton",this.planSettingsNode),b=0;b<a.length&&b<d.length;b++)l.add(a[b],"dijitButtonContentsDartTheme"),l.add(d[b],"dijitArrowButtonDartTheme")},_loadOptionsForDropDown:function(a,d,k){var n=[],e;b.forEach(d,f.hitch(this,function(a){e={value:a,label:this.nls.planSettings[a]||window.jimuNls.units[a]};k===a&&(e.selected=!0);n.push(e)}));a.addOption(n)},_isSettingsChanged:function(){var a=!1;this.selectedPlanSettings.directionOrAngleType!==this.directionOrAngleType.get("value")?
a=!0:this.selectedPlanSettings.directionOrAngleUnits!==this.directionOrAngleUnits.get("value")?a=!0:this.selectedPlanSettings.distanceAndLengthUnits!==this.distanceAndLengthUnits.get("value")?a=!0:this.selectedPlanSettings.areaUnits!==this.areaUnits.get("value")?a=!0:this.selectedPlanSettings.circularCurveParameters!==this.circularCurveParameters.get("value")&&(a=!0);return a},onClose:function(){if(this._isSettingsChanged())this.onPlansettingsChanged()},onPlansettingsChanged:function(){this.selectedPlanSettings=
{directionOrAngleType:this.directionOrAngleType.get("value"),directionOrAngleUnits:this.directionOrAngleUnits.get("value"),distanceAndLengthUnits:this.distanceAndLengthUnits.get("value"),areaUnits:this.areaUnits.get("value"),circularCurveParameters:this.circularCurveParameters.get("value")};this._saveToLocalCache(this.selectedPlanSettings);this.emit("planSettingsChanged",this.selectedPlanSettings)},_saveToLocalCache:function(a){try{k.set(this.planSettingsKey,a)}catch(w){console.log("ParcelDrafter: Error in storeing settings to local cache.")}},
_retriveFromLocalCache:function(){var a=null;try{a=k.get(this.planSettingsKey)}catch(w){console.log("ParcelDrafter: Error in retriving settings from local cache.")}return a},getKey:function(){return"ParcelDrafterPlanSettings."+encodeURIComponent(q.getAppIdFromUrl())+"."+this.widgetId}})})},"widgets/ParcelDrafter/utils":function(){define([],function(){var g={bearingFieldPlaces:2,planSettingsOptions:{directionOrAngleType:["northAzimuth","southAzimuth","quadrantBearing"],directionOrAngleUnits:["decimalDegree",
"degreeMinuteSeconds"],distanceAndLengthUnits:["uSSurveyFeet","meters"],areaUnits:["squareUSSurveyFeet","acres","squareMeters"],circularCurveParameters:["radiusAndChordLength","radiusAndArcLength"]},getQuadrant:function(b){return{"-1":"NE","-2":"SE","-3":"SW","-4":"NW"}[b]},getQuadrantShortcut:function(b){b=b.toUpperCase();return{NE:"-1",SE:"-2",SW:"-3",NW:"-4"}[b]},getQuadrantShortcutFromDD:function(b){var a;0<=b&&90>=b?a="-1":90<b&&180>=b?a="-2":180<b&&270>b?a="-3":270<=b&&360>b&&(a="-4");return a},
getQuadrantAngleFromNADD:function(b){b=g.getQuadrantAngleAndShortcut(b);return b.quadrant.charAt(0)+b.quadrantAngle+b.quadrant.charAt(1)},getSouthAzimuthFromNorthAzimuth:function(b){var a;180<b?a=b-180:180>b?a=b+180:180===b&&(a=0);return a},DMStoDD:function(b){var a,d,e;a=Math.abs(parseFloat(b.degree));d=parseFloat(b.minutes);e=parseFloat(b.seconds);a=a+d/60+e/3600;b.isNegative&&(a*=-1);return a},DDtoDMS:function(b){var a,d;a=3600*b.angle;b=Math.round(a%60);b=60==b?0:b;d=(a-b)/60;a=Math.round(d%60);
a=60==a?0:a;return{degree:Math.round((d-a)/60),minutes:a,seconds:b}},getBearingObjForFormat0:function(b){var a,d;a={};a.degree=parseInt(b[1],10);a.minutes=parseInt(b[2]||0,10);a.seconds=parseInt(b[3]||0,10);a.quadrant=g.getQuadrant("-"+b[4]);a.quadrantShortcut="-"+b[4];"string"===typeof b[1]&&(d="-"===b[1].charAt(0));a.decimalDegrees=g.DMStoDD({degree:a.degree,minutes:a.minutes,seconds:a.seconds,isNegative:d});return a},getBearingObjForFormat1:function(b){var a,d;a={};a.degree=parseInt(b[2],10);a.minutes=
parseInt(b[3]||0,10);a.seconds=parseInt(b[4]||0,10);a.quadrant=b[1]+b[5];a.quadrantShortcut=g.getQuadrantShortcut(b[1]+b[5]);"string"===typeof b[2]&&(d="-"===b[2].charAt(0));a.decimalDegrees=g.DMStoDD({degree:a.degree,minutes:a.minutes,seconds:a.seconds,isNegative:d});return a},getBearingObjForFormat2:function(b){var a,d;a={};a.degree=parseInt(b[2],10);a.minutes=parseInt(b[3]||0,10);a.seconds=parseInt(b[4]||0,10);a.quadrant=b[1]+b[5];a.quadrantShortcut=g.getQuadrantShortcut(b[1]+b[5]);"string"===
typeof b[2]&&(d="-"===b[2].charAt(0));a.decimalDegrees=g.DMStoDD({degree:a.degree,minutes:a.minutes,seconds:a.seconds,isNegative:d});return a},getBearingObjForFormat3:function(b){var a,d;a={};a.degree=parseInt(b[1],10);a.minutes=parseInt(b[2]||0,10);a.seconds=parseInt(b[3]||0,10);"string"===typeof b[1]&&(d="-"===b[1].charAt(0));a.decimalDegrees=g.DMStoDD({degree:a.degree,minutes:a.minutes,seconds:a.seconds,isNegative:d});a.quadrantShortcut=g.getQuadrantShortcutFromDD(a.decimalDegrees);a.quadrant=
g.getQuadrant(a.quadrantShortcut);return a},getBearingObjForFormat4:function(b){var a,d;a=g.DDtoDMS({angle:b[1]});d={};d.degree=a.degree;d.minutes=a.minutes;d.seconds=a.seconds;d.decimalDegrees=b[1];d.quadrantShortcut=g.getQuadrantShortcutFromDD(d.decimalDegrees);d.quadrant=g.getQuadrant(d.quadrantShortcut);return d},getBearingObjForFormat5:function(b){var a,d;a={};a.degree=parseInt(b[1],10);a.minutes=parseInt(b[2]||0,10);a.seconds=parseInt(b[3]||0,10);"string"===typeof b[1]&&(d="-"===b[1].charAt(0));
a.decimalDegrees=g.DMStoDD({degree:a.degree,minutes:a.minutes,seconds:a.seconds,isNegative:d});a.quadrantShortcut=g.getQuadrantShortcutFromDD(a.decimalDegrees);a.quadrant=g.getQuadrant(a.quadrantShortcut);return a},getBearingObjForFormat6:function(b){var a,d;a={};a.degree=parseInt(b[1],10);a.minutes=parseInt(b[2]||0,10);a.seconds=parseInt(b[3]||0,10);a.quadrantShortcut=b[4];a.quadrant=g.getQuadrant(a.quadrantShortcut);"string"===typeof b[1]&&(d="-"===b[1].charAt(0));a.decimalDegrees=g.DMStoDD({degree:a.degree,
minutes:a.minutes,seconds:a.seconds,isNegative:d});return a},getBearingObjForFormat7:function(b){var a,d;a={};a.decimalDegrees=b[2];d=g.DDtoDMS({angle:a.decimalDegrees});a.degree=parseInt(d.degree,10);a.minutes=parseInt(d.minutes||0,10);a.seconds=parseInt(d.seconds||0,10);a.quadrant=b[1]+b[3];a.quadrantShortcut=g.getQuadrantShortcut(a.quadrant);return a},getBearingObjForFormat8:function(b){var a,d;a={};a.decimalDegrees=b[1];d=g.DDtoDMS({angle:a.decimalDegrees});a.degree=parseInt(d.degree,10);a.minutes=
parseInt(d.minutes||0,10);a.seconds=parseInt(d.seconds||0,10);a.quadrantShortcut=b[2];a.quadrant=g.getQuadrant(a.quadrantShortcut);return a},getQuadrantAngleAndShortcut:function(b){var a={};0<=b&&90>=b?(a.quadrantAngle=b,a.quadrant="NE"):90<b&&180>=b?(a.quadrantAngle=180-b,a.quadrant="SE"):180<b&&270>b?(a.quadrantAngle=b-180,a.quadrant="SW"):270<=b&&360>b&&(a.quadrantAngle=360-b,a.quadrant="NW");return a},roundSeconds:function(b){b=Number(b);return 10>b?"0"+b:b},showFixedPlacesAfterDecimal:function(b,
a){var d=0;a||(a=2);b=b.toString();d=b.indexOf(".");0<d&&(b=b.slice(0,d+a+1));return Number(b)},honourPopupRounding:function(b,a){var d;if(isNaN(b)||null===b)b=4;d=Math.pow(10,b);a=Math.round(a*d)/d;return a=a.toFixed(b)},convertBearingToOutputFormats:function(b){var a,d,e,f,p;a={};d={};360===b.degree&&(b.degree=0);a=b.decimalDegrees;360===a&&(a=0);d.naDD=a;d.naDDRound=g.honourPopupRounding(g.bearingFieldPlaces,a);360===Number(d.naDDRound)&&(d.naDDRound=0);e=10>b.minutes?"0"+b.minutes:b.minutes;f=
b.seconds;0<Number(e)&&0<Number(g.roundSeconds(f))?d.naDMS=b.degree+"-"+e+"-"+g.roundSeconds(f):0===Number(e)&&0<Number(g.roundSeconds(f))?d.naDMS=b.degree+"-"+e+"-"+g.roundSeconds(f):0<Number(e)&&0===Number(g.roundSeconds(f))?d.naDMS=b.degree+"-"+e+"-00":0===Number(e)&&0===Number(g.roundSeconds(f))&&(d.naDMS=b.degree+"-00-00");b=g.getQuadrantAngleAndShortcut(a);d.qb3DD=b.quadrant.charAt(0)+b.quadrantAngle+b.quadrant.charAt(1);d.qb3DDRound=b.quadrant.charAt(0)+g.honourPopupRounding(g.bearingFieldPlaces,
b.quadrantAngle)+b.quadrant.charAt(1);e=g.DDtoDMS({angle:b.quadrantAngle});f=10>e.minutes?"0"+e.minutes:e.minutes;p=e.seconds;0<Number(f)&&0<Number(g.roundSeconds(p))?d.qb3DMS=b.quadrant.charAt(0)+e.degree+"-"+f+"-"+g.roundSeconds(p)+b.quadrant.charAt(1):0===Number(f)&&0<Number(g.roundSeconds(p))?d.qb3DMS=b.quadrant.charAt(0)+e.degree+"-"+f+"-"+g.roundSeconds(p)+b.quadrant.charAt(1):0<Number(f)&&0===Number(g.roundSeconds(p))?d.qb3DMS=b.quadrant.charAt(0)+e.degree+"-"+f+"-00"+b.quadrant.charAt(1):
0===Number(f)&&0===Number(g.roundSeconds(p))&&(d.qb3DMS=b.quadrant.charAt(0)+e.degree+"-00-00"+b.quadrant.charAt(1));a=g.getSouthAzimuthFromNorthAzimuth(a);360===a&&(a=0);d.saDD=a;d.saDDRound=g.honourPopupRounding(g.bearingFieldPlaces,a);360===Number(d.saDDRound)&&(d.saDDRound=0);a=g.DDtoDMS({angle:a});360===a.degree&&(a.degree=0);b=10>a.minutes?"0"+a.minutes:a.minutes;e=a.seconds;0<Number(b)&&0<Number(g.roundSeconds(e))?d.saDMS=a.degree+"-"+b+"-"+g.roundSeconds(e):0===Number(b)&&0<Number(g.roundSeconds(e))?
d.saDMS=a.degree+"-"+b+"-"+g.roundSeconds(e):0<Number(b)&&0===Number(g.roundSeconds(e))?d.saDMS=a.degree+"-"+b+"-00":0===Number(b)&&0===Number(g.roundSeconds(e))&&(d.saDMS=a.degree+"-00-00");return d},getBearingDetailsOfRequiredFormat:function(b,a){var d={};switch(a){case 0:d=g.getBearingObjForFormat0(b);break;case 1:d=g.getBearingObjForFormat1(b);break;case 2:d=g.getBearingObjForFormat2(b);break;case 3:d=g.getBearingObjForFormat3(b);break;case 4:d=g.getBearingObjForFormat4(b);break;case 5:d=g.getBearingObjForFormat5(b);
break;case 6:d=g.getBearingObjForFormat6(b);break;case 7:d=g.getBearingObjForFormat7(b);break;case 8:d=g.getBearingObjForFormat8(b)}return g.convertBearingToOutputFormats(d)},getBearingFormatArr:function(){var b=[];b.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\-(0|[0-5]?\d)\-(0|[0-5]\d))?\-([1-4])$/,type:"degreeMinuteSeconds"});b.push({regex:/^([nNsS])((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\-(0|[0-5]?\d)\-(0|[0-5]\d))?([eEwW])$/,type:"degreeMinuteSeconds"});b.push({regex:/^([nNsS])((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\.([0-5]\d)(?:([0-5]\d))?)?([eEwW])$/,
type:"degreeMinuteSeconds"});b.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\.([0-5]\d)(?:([0-5]\d))?)?$/,type:"degreeMinuteSeconds"});b.push({regex:/^((?:(?:\-?)(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0)(?:\.\d+)?)|(?:\-?)(?:\.\d+))$/,type:"decimalDegree"});b.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\-(0|[0-5]?\d)\-((?:[0-5]\d)))?$/,type:"degreeMinuteSeconds"});b.push({regex:/^((?:\-)?(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0))(?:\.([0-5]\d)(?:([0-5]\d))?)?(\-[1-4])$/,type:"degreeMinuteSeconds"});
b.push({regex:/^([nNsS])((?:(?:\-?)(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0)(?:\.\d+)?)|(?:\-?)(?:\.\d+))([eEwW])$/,type:"decimalDegree"});b.push({regex:/^((?:(?:\-?)(?:3[0-5]\d|[12]\d{2}|[0-9]\d?|0)(?:\.\d+)?)|(?:\-?)(?:\.\d+))(\-[1-4])$/,type:"decimalDegree"});return b},getNorthAzimuthAngle:function(b,a){a=a.toUpperCase();b=Number(b);switch(a){case "-1":case "NE":return(b+360)%360;case "-2":case "SE":return(540-b)%360;case "-3":case "SW":return(540+b)%360;case "-4":case "NW":return(360-b)%360}},convertBearingToNorthAzimuth:function(b,
a,d){switch(a){case 0:a=g.getBearingObjForFormat0(b);a=g.getNorthAzimuthAngle(a.decimalDegrees,"-"+b[4]);a=g.DDtoDMS({angle:a});b[1]=a.degree;b[2]=a.minutes;b[3]=a.seconds;break;case 1:a=g.getBearingObjForFormat1(b);a=g.getNorthAzimuthAngle(a.decimalDegrees,b[1]+b[5]);a=g.DDtoDMS({angle:a});b[2]=a.degree;b[3]=a.minutes;b[4]=a.seconds;break;case 2:a=g.getBearingObjForFormat2(b);a=g.getNorthAzimuthAngle(a.decimalDegrees,b[1]+b[5]);a=g.DDtoDMS({angle:a});b[2]=a.degree;b[3]=a.minutes;b[4]=a.seconds;break;
case 3:"northAzimuth"===d.directionOrAngleType||"quadrantBearing"===d.directionOrAngleType?(a=g.getBearingObjForFormat3(b),a=g.getNorthAzimuthAngle(a.decimalDegrees,"-1"),a=g.DDtoDMS({angle:a}),b[1]=a.degree,b[2]=a.minutes,b[3]=a.seconds):"southAzimuth"===d.directionOrAngleType&&(a=g.getBearingObjForFormat3(b),a=g.getNorthAzimuthAngle(a.decimalDegrees,"-3"),a=g.DDtoDMS({angle:a}),b[1]=a.degree,b[2]=a.minutes,b[3]=a.seconds);break;case 4:"northAzimuth"===d.directionOrAngleType||"quadrantBearing"===
d.directionOrAngleType?b[1]=g.getNorthAzimuthAngle(b[1],"-1"):"southAzimuth"===d.directionOrAngleType&&(b[1]=g.getNorthAzimuthAngle(b[1],"-3"));break;case 5:"northAzimuth"===d.directionOrAngleType?(a=g.getBearingObjForFormat5(b),a=g.getNorthAzimuthAngle(a.decimalDegrees,"-1"),a=g.DDtoDMS({angle:a}),b[1]=a.degree,b[2]=a.minutes,b[3]=a.seconds):"southAzimuth"===d.directionOrAngleType?(a=g.getBearingObjForFormat5(b),a=g.getNorthAzimuthAngle(a.decimalDegrees,"-3"),a=g.DDtoDMS({angle:a}),b[1]=a.degree,
b[2]=a.minutes,b[3]=a.seconds):"quadrantBearing"===d.directionOrAngleType&&(b=null);break;case 6:a=g.getBearingObjForFormat6(b);a=g.getNorthAzimuthAngle(a.decimalDegrees,b[4]);a=g.DDtoDMS({angle:a});b[1]=a.degree;b[2]=a.minutes;b[3]=a.seconds;break;case 7:b[2]=g.getNorthAzimuthAngle(b[2],b[1]+b[3]);break;case 8:b[1]=g.getNorthAzimuthAngle(b[1],b[2])}return b},categorizeBearingFormat:function(b,a){var d,e,f;b=b.toString();d=g.getBearingFormatArr();for(f=0;f<d.length;f++)if(d[f].type===a.directionOrAngleUnits&&
(e=d[f].regex.exec(b.trim()))&&0<e.length){e=g.convertBearingToNorthAzimuth(e,f,a);break}if(!e)for(f=0;f<d.length;f++)if(d[f].type!==a.directionOrAngleUnits&&(e=d[f].regex.exec(b.trim()))&&0<e.length){e=g.convertBearingToNorthAzimuth(e,f,a);break}return e?g.getBearingDetailsOfRequiredFormat(e,f):null},metersToUSSurveyFeet:function(b){b=Number(b);return 3.28083333333*b},usSurveyFeetToMeters:function(b){b=Number(b);return.304800609601*b},feetToUSSurveyFeet:function(b){b=Number(b);return g.metersToUSSurveyFeet(.3048*
b)},feetToMeters:function(b){b=Number(b);return.3048*b},usSurveyFeetToFeet:function(b){b=Number(b);return 1.000001999999281*b},metersToFeet:function(b){b=Number(b);return 3.280839895*b},getLengthObjForFormat0:function(b,a){var d;d={};"uSSurveyFeet"===a?(d.uSSurveyFeet=Number(b[0]),d.uSSurveyFeetRound=Math.round(1E4*d.uSSurveyFeet)/1E4,d.meters=g.usSurveyFeetToMeters(b[0]),d.metersRound=Math.round(1E4*d.meters)/1E4,d.feet=g.usSurveyFeetToFeet(d.uSSurveyFeet),d.feetRound=Math.round(1E4*d.feet)/1E4):
"meters"===a&&(d.uSSurveyFeet=g.metersToUSSurveyFeet(b[0]),d.uSSurveyFeetRound=Math.round(1E4*d.uSSurveyFeet)/1E4,d.meters=Number(b[0]),d.metersRound=Math.round(1E4*d.meters)/1E4,d.feet=g.metersToFeet(d.meters),d.feetRound=Math.round(1E4*d.feet)/1E4);return d},getLengthObjForFormat1:function(b){var a;a={};a.uSSurveyFeet=Number(b[2]);a.uSSurveyFeetRound=Math.round(1E4*a.uSSurveyFeet)/1E4;a.meters=g.usSurveyFeetToMeters(b[2]);a.metersRound=Math.round(1E4*a.meters)/1E4;a.feet=g.usSurveyFeetToFeet(a.uSSurveyFeet);
a.feetRound=Math.round(1E4*a.feet)/1E4;return a},getLengthObjForFormat2:function(b){var a;a={};a.uSSurveyFeet=g.metersToUSSurveyFeet(b[2]);a.uSSurveyFeetRound=Math.round(1E4*a.uSSurveyFeet)/1E4;a.meters=Number(b[2]);a.metersRound=Math.round(1E4*a.meters)/1E4;a.feet=g.metersToFeet(a.meters);a.feetRound=Math.round(1E4*a.feet)/1E4;return a},getLengthObjForFormat3:function(b){var a;a={};a.uSSurveyFeet=g.feetToUSSurveyFeet(b[2]);a.uSSurveyFeetRound=Math.round(1E4*a.uSSurveyFeet)/1E4;a.meters=g.feetToMeters(b[2]);
a.metersRound=Math.round(1E4*a.meters)/1E4;a.feet=Number(b[2]);a.feetRound=Math.round(1E4*a.feet)/1E4;return a},categorizeLengthFormat:function(b,a){var d,e,f;d=[];b=b.toString();d.push(/^((\-?)((0?|([1-9]\d*))(\.\d+)?))$/);d.push(/^(((\-?)((0?|([1-9]\d*))(\.\d+)?))(ft|FT|fT|Ft))$/);d.push(/^(((\-?)((0?|([1-9]\d*))(\.\d+)?))(m|M))$/);for(f=0;f<d.length&&!((e=d[f].exec(b.trim()))&&0<e.length);f++);e?(b=g.getLengthOfRequiredFormat(e,f,a))&&isNaN(b.meters)&&(b=null):b=null;return b},categorizeLengthFormatForFeet:function(b){var a,
d,e;a=[];b=b.toString();a.push(/^((\-?)((0?|([1-9]\d*))(\.\d+)?))$/);for(e=0;e<a.length&&!((d=a[e].exec(b.trim()))&&0<d.length);e++);return d?g.getLengthObjForFormat3(d):null},getLengthOfRequiredFormat:function(b,a,d){var e={};switch(a){case 0:e=g.getLengthObjForFormat0(b,d);break;case 1:e=g.getLengthObjForFormat1(b);break;case 2:e=g.getLengthObjForFormat2(b)}return e}};return g})},"widgets/ParcelDrafter/XYInput":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./XYInput.html dojo/on dojo/_base/lang dojo/Evented esri/geometry/Point dijit/form/ValidationTextBox".split(" "),
function(g,b,a,d,e,f,p,l){return g([b,a,p],{baseClass:"jimu-widget-ParcelDrafter-XYInput",templateString:d,constructor:function(a){f.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.spatialReference=this.map.getLayer(this.config.polygonLayer.id).spatialReference;this.xRowWrapper.title=this.nls.xyInput.explanation+" ("+this.spatialReference.latestWkid+")";this.yRowWrapper.title=this.nls.xyInput.explanation+" ("+this.spatialReference.latestWkid+")";this.own(e(this.xyStartButton,"click",
f.hitch(this,function(){this.emit("newPoint",this.project(this.newTraverseX.value,this.newTraverseY.value))})))},project:function(a,b){return new l(a,b,this.spatialReference)}})})},"widgets/ParcelDrafter/NewTraverse":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./NewTraverse.html dojo/_base/lang dojo/_base/array dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dnd/Source dojo/on dijit/form/ValidationTextBox ./SymbolSelector ./MiscloseDetails ./ParcelTools ./PlanInfo ./geometryUtils ./utils esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/graphicsUtils dojo/dom-attr dojo/query esri/SpatialReference dojo/keys dijit/focus dijit/TooltipDialog dijit/popup dojo/Deferred esri/geometry/Extent esri/geometry/Point dojo/dom-geometry".split(" "),
function(g,b,a,d,e,f,p,l,r,v,q,k,n,w,E,D,F,u,x,m,G,H,L,B,C,y,z,A,I,K,M,N,O,J){return g([b,a,d],{baseClass:"jimu-widget-ParcelDrafter",templateString:e,parcelLinesGraphicsLayer:null,parcelPointsGraphicsLayer:null,parcelPolygonGraphicsLayer:null,lineLayerSpatialReference:null,polygonLayerSpatialReference:null,_itemList:[],_nodes:[],_dndContainer:null,startPoint:null,_startPointForNextLine:null,_planSettings:null,_arrayOfAllBoundaryLines:[],_rotationAngle:0,_scaleValue:1,polygonDeleteArr:[],polylineDeleteArr:[],
_popupDialog:null,_popupCoords:null,numberFieldTypes:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],lengthFieldPlaces:2,radiusFieldPlaces:2,miscloseDistanceFieldPlaces:2,postCreate:function(){this.numberFieldTypes=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"];this.polygonDeleteArr=[];this.polylineDeleteArr=[];this._arrayOfAllBoundaryLines=[];this._nodes=[];this._itemList=[];l.add(this.domNode,"esriCTNewTraverseGrid");
this._addGraphicsLayer();this._createTraverseGrid();this._setValidatorForInitialRow();this._handleEventsOnInitialRow();this._symbolSelector=this._createLineSelector(this.lineSymbolNode,null);this.own(k(this.screenDigitizationNode,"click",f.hitch(this,this._onDigitizationButtonClicked)));this.own(k(this.updateRotationPointNode,"click",f.hitch(this,this._onUpdateRotationPointButtonClicked)));this.own(k(this.zoomToNode,"click",f.hitch(this,this._onZoomButtonClicked)));this.own(k(this.expandCollapseNode,
"click",f.hitch(this,this._onExpandCollapseClicked)));this.own(k(this.addButton,"click",f.hitch(this,function(){this._addNewItem(!1)})));this._createMiscloseDetails();this._createParcelTools();this._createPlanInfo();this._createTooltip();this.config.polylineLayer&&this.config.polylineLayer.popupInfo&&this.config.polylineLayer.popupInfo.fieldInfos&&p.forEach(this.config.polylineLayer.popupInfo.fieldInfos,f.hitch(this,function(c){c.fieldName===this.config.polylineLayer.bearing.name&&c.format&&(x.bearingFieldPlaces=
c.format.places);c.fieldName===this.config.polylineLayer.distance.name&&c.format&&(this.lengthFieldPlaces=c.format.places);c.fieldName===this.config.polylineLayer.radius.name&&c.format&&(this.radiusFieldPlaces=c.format.places)}));this.config.polygonLayer&&this.config.polygonLayer.popupInfo&&this.config.polygonLayer.popupInfo.fieldInfos&&p.forEach(this.config.polygonLayer.popupInfo.fieldInfos,f.hitch(this,function(c){c.fieldName===this.config.polygonLayer.miscloseDistance.name&&c.format&&(this.miscloseDistanceFieldPlaces=
c.format.places)}))},_addGraphicsLayer:function(){this.parcelPolygonGraphicsLayer=new H;this.parcelLinesGraphicsLayer=new H;this.parcelPointsGraphicsLayer=new H;this.rotationPointsGraphicsLayer=new H;this.own(k(this.parcelPointsGraphicsLayer,"click",f.hitch(this,function(c){l.contains(this.updateRotationPointNode,"esriCTEnableButton")&&(this._setRotationPoint(c.graphic.attributes.rowIndex,c.graphic.geometry),this._showRotationPoint())})));this.map.addLayer(this.parcelPolygonGraphicsLayer);this.map.addLayer(this.parcelLinesGraphicsLayer);
this.map.addLayer(this.parcelPointsGraphicsLayer);this.map.addLayer(this.rotationPointsGraphicsLayer)},_setValidatorForInitialRow:function(){this.bearingNode.validator=f.hitch(this,function(c){return this._bearingValidator(c,["*","*tb"])});this.bearingNode.invalidMessage=this.nls.newTraverse.invalidBearingMessage;this.lengthNode.validator=f.hitch(this,function(c){if("*"===c&&this._itemList&&0<this._itemList.length)return!0;if(""===this.radiusNode.get("value")&&0>parseFloat(c))return this.lengthNode.invalidMessage=
this.nls.newTraverse.negativeLengthMessage,!1;this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;return this._lengthValidator(c)});this.lengthNode.invalidMessage=this.nls.newTraverse.invalidLengthMessage;this.radiusNode.validator=f.hitch(this,function(c){var a;if("*"===c&&this._itemList&&0<this._itemList.length)return!0;a=this._radiusValidator(c);if(""!==c)if((c=this.lengthNode.isValid())&&a){if(!this._validateLengthRadiusProportion(a,c))return null;a&&(c=this.lengthNode.value,
this.lengthNode.reset(),this.lengthNode.set("value",c))}else a=null;return a});this.radiusNode.invalidMessage=this.nls.newTraverse.invalidRadiusMessage},_bearingValidator:function(c,a){return-1!==a.indexOf(c)&&this._itemList&&0<this._itemList.length?!0:this._validateBearing(c,a)},_lengthValidator:function(c,a){return""===c||"0"===c||0===c?!1:this._validateLength(c,a)},_radiusValidator:function(c,a){return""===c?!0:this._validateLength(c,a)},_handleEventsOnInitialRow:function(){this.own(k(this.bearingNode,
"keypress",f.hitch(this,this._bearingValueEntered)));this.own(k(this.lengthNode,"keypress",f.hitch(this,this._lengthValueEntered)));this.own(k(this.radiusNode,"keypress",f.hitch(this,this._radiusValueEntered)))},_copyPrevValue:function(c){switch(c){case "Bearing":c=this.bearingNode.get("value");"*"===c&&0<this._itemList.length&&(c=this._itemList[this._itemList.length-1].BearingConversions?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-1].BearingConversions):this._itemList[this._itemList.length-
1].Bearing,this.bearingNode.set("value",c));break;case "Length":c=this.lengthNode.get("value");"*"===c&&0<this._itemList.length&&(c="radiusAndArcLength"===this._planSettings.circularCurveParameters&&this._itemList[this._itemList.length-1].ArcLengthConversions?this._itemList[this._itemList.length-1].ArcLengthConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-1].LengthConversions?this._itemList[this._itemList.length-1].LengthConversions[this._planSettings.distanceAndLengthUnits]:
this._itemList[this._itemList.length-1].Length,this.lengthNode.set("value",c));break;case "Radius":c=this.radiusNode.get("value"),"*"===c&&0<this._itemList.length&&(c=this._itemList[this._itemList.length-1].RadiusConversions?this._itemList[this._itemList.length-1].RadiusConversions[this._planSettings.distanceAndLengthUnits]:this._itemList[this._itemList.length-1].Radius,this.radiusNode.set("value",c))}},_bearingValueEntered:function(c){c=c.charCode||c.keyCode;c===z.ENTER||c===z.TAB?(this.bearingNode.get("value"),
this._copyPrevValue("Bearing"),c===z.ENTER&&this.bearingNode.isValid()?A.focus(this.lengthNode):this.bearingNode.validate(!1)):setTimeout(f.hitch(this,function(){this.bearingNode.validate(!1)}),100)},_lengthValueEntered:function(c){c=c.charCode||c.keyCode;c===z.ENTER||c===z.TAB?(this.lengthNode.get("value"),this._copyPrevValue("Length"),c===z.ENTER&&this.lengthNode.isValid()?A.focus(this.radiusNode):this.lengthNode.validate(!1)):setTimeout(f.hitch(this,function(){this.lengthNode.validate(!1)}),100)},
_radiusValueEntered:function(c){c=c.charCode||c.keyCode;c===z.ENTER||c===z.TAB?(c=this.radiusNode.get("value"),this._copyPrevValue("Radius"),""===c||this.radiusNode.isValid()?this.bearingNode.isValid()?this.lengthNode.isValid()?(this._addNewItem(),A.focus(this.bearingNode)):(this.lengthNode.validate(!1),A.focus(this.lengthNode)):(this.bearingNode.validate(!1),A.focus(this.bearingNode)):this.radiusNode.validate(!1)):setTimeout(f.hitch(this,function(){this.radiusNode.validate(!1)}),100)},_validateBearing:function(c){return(c=
x.categorizeBearingFormat(c,this._planSettings))?c:null},_validateLength:function(c,a){switch(a){case "feets":c=x.categorizeLengthFormatForFeet(c);break;case "meters":c=x.categorizeLengthFormat(c,"meters");break;case "uSSurveyFeet":c=x.categorizeLengthFormat(c,"uSSurveyFeet");break;default:c=x.categorizeLengthFormat(c,this._planSettings.distanceAndLengthUnits)}return c?c:null},_validateLengthRadiusProportion:function(c,a){return c&&a&&(c=c[this._planSettings.distanceAndLengthUnits],a=a[this._planSettings.distanceAndLengthUnits],
0!==c&&(c=2*parseFloat(Math.abs(c)),"radiusAndArcLength"===this._planSettings.circularCurveParameters&&(c*=Math.PI),c<parseFloat(Math.abs(a))))?null:!0},_getValidatedValues:function(c,a,b){var h={},t;c?(h=c,a&&("Bearing"!==a&&h.BearingConversions&&(h.Bearing=this._getBearingAccordingToPlanSettings(h.BearingConversions)),"Length"!==a&&h.LengthConversions&&(h.Length=h.LengthConversions[this._planSettings.distanceAndLengthUnits]),"Radius"!==a&&h.RadiusConversions&&(h.Radius=h.RadiusConversions[this._planSettings.distanceAndLengthUnits]),
"Bearing"===a&&"*tb"===h.Bearing.toString().toLowerCase()&&0<this._itemList.length&&0!==b&&(h.isTB=!0))):(this._copyPrevValue("Bearing"),this._copyPrevValue("Length"),this._copyPrevValue("Radius"),h.LineSymbol=this._symbolSelector.selectedSymbol,h.Bearing=this.bearingNode.get("value"),h.Length=this.lengthNode.get("value"),h.Radius=this.radiusNode.get("value"),"*tb"===h.Bearing.toString().toLowerCase()&&0<this._itemList.length?h.isTB=!0:h.isTB=!1);if(""!==f.trim(h.Bearing.toString())&&""!==f.trim(h.Length.toString())&&
((a=this._validateBearing(h.Bearing))||h.isTB)){h.BearingConversions=a;if(""===f.trim(h.Length.toString())&&""===f.trim(h.Radius.toString()))return null;if(""!==f.trim(h.Length.toString()))if((a=this._validateLength(h.Length))&&0!==a.meters){if(""!==f.trim(h.Radius.toString()))if(t=this._validateLength(h.Radius)){if(!this._validateLengthRadiusProportion(t,a))return null;h.RadiusConversions=t}else return null;else{if(0>parseInt(a.meters,10))return null;h.RadiusConversions=null}h.LengthConversions=
a}else return null;h.RadiusConversions&&(h=this._createValuesForArc(h));h.isTB&&(c=c&&!isNaN(b)?this._itemList[b-1]:this._itemList[this._itemList.length-1],h=this._setTangentBearing(h,c))}else return null;return h},_setTangentBearing:function(c,a){var b,h;h=f.clone(this._planSettings);h.directionOrAngleType="northAzimuth";h.directionOrAngleUnits="decimalDegree";b=a.BearingConversions.naDD;a.RadiusConversions&&0!==a.RadiusConversions.meters&&(b=u.chordBearingToTangentBearing(b,a.RadiusConversions.meters,
a.ChordLengthConversions.meters));c.RadiusConversions&&0!==c.RadiusConversions.meters?(b=u.tangentBearingToChordBearing(b,c.RadiusConversions.meters,c.ChordLengthConversions.meters),c.Bearing=b,c.BearingConversions=x.categorizeBearingFormat(c.Bearing,h)):a.RadiusConversions&&0!==a.RadiusConversions.meters?(c.Bearing=b,c.BearingConversions=x.categorizeBearingFormat(c.Bearing,h)):(c.Bearing=a.Bearing,c.BearingConversions=f.clone(a.BearingConversions));return c},_updateTBFromIndex:function(c){var a;
for(a=!1;c<this._itemList.length;c++)if(this._itemList[c]&&this._itemList[c].isTB)this._itemList[c]=this._setTangentBearing(this._itemList[c],this._itemList[c-1]),a=!0;else break;return a},_onZoomButtonClicked:function(){this._setExtentToLayer(this.parcelLinesGraphicsLayer,!0)},_onExpandCollapseClicked:function(){l.toggle(this.traverseGrid,"esriCTHidden");l.contains(this.expandCollapseNode,"esriCTExpand")?(B.set(this.expandCollapseNode,"title",this.nls.planSettings.collapseGridTooltipText),l.replace(this.expandCollapseNode,
"esriCTCollapse","esriCTExpand")):(B.set(this.expandCollapseNode,"title",this.nls.planSettings.expandGridTooltipText),l.replace(this.expandCollapseNode,"esriCTExpand","esriCTCollapse"))},setRotation:function(c){var a;a=this.startPoint;this._rotationPointInfo&&this._rotationPointInfo.rotationPoint&&(a=this._rotationPointInfo.rotationPoint);c=u.getRotationAngleBetweenPoints(a,c);0<this._itemList.length&&(a=0,this._rotationPointInfo&&this._rotationPointInfo.rotationPointIndex<this._itemList.length&&
(a=this._rotationPointInfo.rotationPointIndex),c-=this._itemList[a].BearingConversions.naDDRound);360===c&&(c=0);this._parcelToolInstance.setRotation(c)},setScaling:function(c){c=u.getScaleDistanceBetweenPoints(this.startPoint,c);this.distance?(c/=this.distance,.1>c&&(c=.1),this._parcelToolInstance.setScale(c)):this.distance=c},_addNewItem:function(c){var a,b;(a=this._getValidatedValues())?(c&&this._rotationAngle&&(b=a.BearingConversions.naDD-this._rotationAngle,b=this.getAngleFromDDTOQB(360<=b?b%
360:b),a.Bearing=b,a.BearingConversions=this._validateBearing(b)),b=f.trim(a.Radius.toString()),this._itemList.push(a),this._createRow(a,this._itemList.length-1),this._resetEntryRow(c),""===b||"0"===b||0===b?this._drawStraightLine(a,!0):this._drawArc(a,!0),this._showHideTraverseTools(),this.appliedCompassRule&&this.setParcelClosure()):this.bearingNode.isValid()?""!==this.lengthNode.get("value")&&this.lengthNode.isValid()?""===this.radiusNode.get("value")||this.radiusNode.isValid()||(A.focus(this.radiusNode),
this.radiusNode.validate(!1)):(A.focus(this.lengthNode),this.lengthNode.validate(!1)):(A.focus(this.bearingNode),this.bearingNode.validate(!1))},_createValuesForArc:function(c){var a;c.RadiusConversions?(a=c.RadiusConversions.meters,"radiusAndArcLength"===this._planSettings.circularCurveParameters?(c.ArcLength=c.LengthConversions.meters,c.ArcLengthConversions=f.clone(c.LengthConversions),c.ChordLength=u.getChordLengthFromArcLength(c.ArcLength,a),c.ChordLengthConversions=this._validateLength(c.ChordLength,
"meters")):(c.ChordLength=c.LengthConversions.meters,c.ChordLengthConversions=f.clone(c.LengthConversions),c.ArcLength=u.getArcLengthFromChordLength(c.ChordLength,a),c.ArcLengthConversions=this._validateLength(c.ArcLength,"meters"))):("radiusAndArcLength"===this._planSettings.circularCurveParameters&&c.ArcLengthConversions&&(c.Length=c.ArcLength,c.LengthConversions=f.clone(c.ArcLengthConversions)),c.ChordLength=0,c.ChordLengthConversions=null,c.ArcLength=0,c.ArcLengthConversions=null);return c},_onDigitizationButtonClicked:function(){l.toggle(this.screenDigitizationNode,
"esriCTEnableButton");l.contains(this.screenDigitizationNode,"esriCTEnableButton")?(this.emit("activateDigitizationTool"),this.deActivateUpdateRotationPointTool()):this.emit("deActivateDigitizationTool")},_onUpdateRotationPointButtonClicked:function(){l.toggle(this.updateRotationPointNode,"esriCTEnableButton");l.contains(this.updateRotationPointNode,"esriCTEnableButton")?(this.emit("activateUpdateRotationPointTool"),this.deActivateDigitizationTool()):this.emit("deActivateUpdateRotationPointTool")},
_createMiscloseDetails:function(){this._misCloseDetailsInstance=new E({nls:this.nls,config:this.config,appConfig:this.appConfig,numberFieldTypes:this.numberFieldTypes,validateNumericField:this.validateNumericField},r.create("div",{},this.misCloseDetailsNode));this._misCloseDetailsInstance.setMiscloseDetails(null)},_createParcelTools:function(){this._parcelToolInstance=new D({nls:this.nls,config:this.config},r.create("div",{},this.parcelToolsNode));this.own(this._parcelToolInstance.on("rotateGeometries",
f.hitch(this,function(c){c!==this._rotationAngle&&(this._rotationAngle=c,this._rotationPointInfo&&this._rotationPointInfo.rotationPoint?this._updateStartPointFromRotationPoint():this._itemList&&0<this._itemList.length&&this.setStartPoint(this.startPoint))})));this.own(this._parcelToolInstance.on("scaleGeometries",f.hitch(this,function(c){c!==this._scaleValue&&(this._scaleValue=c,this._rotationPointInfo&&this._rotationPointInfo.rotationPoint?this._updateStartPointFromRotationPoint():this._itemList&&
0<this._itemList.length&&this.setStartPoint(this.startPoint))})));this.own(this._parcelToolInstance.on("toggleRotating",f.hitch(this,function(c){this.emit("toggleRotating",c)})));this.own(this._parcelToolInstance.on("toggleScaling",f.hitch(this,function(c){this.emit("toggleScaling",c)})))},_createPlanInfo:function(){this._planInfoInstance=new F({map:this.map,nls:this.nls,config:this.config,loading:this.loading,numberFieldTypes:this.numberFieldTypes,validateNumericField:this.validateNumericField,geometryService:this.geometryService,
parcelPolygonGraphicsLayer:this.parcelPolygonGraphicsLayer,parcelLinesGraphicsLayer:this.parcelLinesGraphicsLayer,polylineLayerUnit:u.getUnitValueForSR(this.lineLayerSpatialReference),polygonLayerUnit:u.getUnitValueForSR(this.polygonLayerSpatialReference)},r.create("div",{},this.planInfoNode));this.own(this._planInfoInstance.on("cancelTraversedParcel",f.hitch(this,function(){this.emit("cancelTraverse")})));this.own(this._planInfoInstance.on("showMessage",f.hitch(this,function(c){this._showMessage(c)})));
this.own(this._planInfoInstance.on("saveTraversedParcel",f.hitch(this,function(){var c;this.closePopup();if(this._itemList&&0<this._itemList.length){var a;a=this._misCloseDetailsInstance.traverseStatedArea.get("value").trim();c=this._planInfoInstance.validateParcelDetails(a);c.status?(""===this._misCloseDetailsInstance.traverseStatedArea.get("value")&&(a=null),c={},c.itemList=this._itemList,c.statedArea=a,c.rotation=this._rotationAngle,c.scale=this._scaleValue,c.appliedCompassRule=this.appliedCompassRule,
c.miscloseDetails=this._misCloseDetailsInstance.getMiscloseDetails(),c.polygonDeleteArr=this.polygonDeleteArr,c.polylineDeleteArr=this.polylineDeleteArr,c.planSettings=this._planSettings,this._planInfoInstance.saveData(c)):this._showMessage(c.message)}else this._showMessage(this.nls.newTraverse.enterValidParcelInfoMessage)})));this.own(this._planInfoInstance.on("displayMainPageAfterSave",f.hitch(this,function(){this.emit("displayMainPageAfterSave")})))},_createTraverseGrid:function(){var c;this._nodes=
[];r.empty(this.traverseGrid);this._dndContainer=new q(this.traverseGrid,{skipForm:!0,singular:!0});this._dndContainer.copyState=function(){return!1};for(c=0;c<this._itemList.length;c++)this._createRow(this._itemList[c],c);this.own(this._dndContainer.on("DndDrop",f.hitch(this,this._onDndDrop)));this._dndContainer.insertNodes(!1,this._nodes)},_createFieldInputs:function(c,a,b,h){var t=new n({value:a,"class":b?b:""});t.placeAt(c);"esriCTBearingRow"===b?(t.validator=f.hitch(this,function(c){"*tb"!==
c&&"*"===c.charAt(0)&&(c=c.slice(1));return this._bearingValidator(c,["*tb"])}),t.invalidMessage=this.nls.newTraverse.invalidBearingMessage):"esriCTLengthRow"===b?(t.validator=f.hitch(this,this._lengthValidator),t.invalidMessage=this.nls.newTraverse.invalidLengthMessage):"esriCTRadiusRow"===b&&(t.validator=f.hitch(this,this._radiusValidator),t.invalidMessage=this.nls.newTraverse.invalidRadiusMessage);this.own(k(t,"blur",f.hitch(this,function(){var a=parseInt(B.get(c,"rowIndex"),10);this._updateParcelValues(t,
a,h)})));this.own(k(t,"keypress",f.hitch(this,function(a){(a.charCode||a.keyCode)===z.ENTER&&(a=parseInt(B.get(c,"rowIndex"),10),this._updateParcelValues(t,a,h));setTimeout(f.hitch(this,function(){t.validate(!1)}),100)})))},_createRow:function(c,a){var b,h;b=r.create("div",{"class":"dojoDndItem esriCTRow",rowIndex:a});h=r.create("div",{rowIndex:a},b);this._createLineSelector(h,c.LineSymbol,a);h=this._getBearingAccordingToPlanSettings(c.BearingConversions);c.isTB&&(h="*"+h);this._createFieldInputs(b,
h,"esriCTBearingRow");c.RadiusConversions?(h=this._getRoundedValue(c.RadiusConversions,"Radius"),c="radiusAndArcLength"===this._planSettings.circularCurveParameters?this._getRoundedValue(c.ArcLengthConversions,"Length"):this._getRoundedValue(c.ChordLengthConversions,"Length")):(h="",c=this._getRoundedValue(c.LengthConversions,"Length"));this._createFieldInputs(b,c,"esriCTLengthRow");this._createFieldInputs(b,h,"esriCTRadiusRow");this._createDeleteButton(b,a);this._nodes.push(b);this._dndContainer.clearItems();
this._dndContainer.insertNodes(!1,this._nodes)},_createLineSelector:function(c,a,b){var h;h=new w({hideOnSelect:!0,symbolData:this.config.lineTypes},c);l.add(h.domNode,"esriCTSymbolContainer");a?(h.selectSymbol(a),B.set(h.domNode,"rowIndex",b),h.onSelect=f.hitch(this,function(c){var a;a=parseInt(B.get(h.domNode,"rowIndex"),10);this._itemList[a].LineSymbol=c;this.setStartPoint(this.startPoint)})):h.setDefault();return h},_createDeleteButton:function(c,a){var b;b=r.create("div",{"class":"esriCTDeleteRow"},
c);a=r.create("div",{"class":"esriCTDeleteIcon",rowIndex:a,title:this.nls.traverseSettings.deleteButtonTitle},b);this.own(k(a,"click",f.hitch(this,function(a){a=parseInt(B.get(a.currentTarget,"rowIndex"),10);this._deleteRow(c,a)})))},_deleteRow:function(c,a){var b;if(this._itemList.length){this._dndContainer.delItem(c.id);r.destroy(c);this._nodes.splice(a,1);this._itemList.splice(a,1);this._dndContainer.sync();this._updateRowIndexes();if(this._itemList[a]&&this._itemList[a].isTB){if(1===this._itemList.length||
0===a)this._itemList[0].isTB=!1,a++;1<this._itemList.length&&(b=this._updateTBFromIndex(a))}this.appliedCompassRule?this.setParcelClosure(!0,!0):this.setStartPoint(this.startPoint,!0);b&&this._reGenerateTraverseGrid();this._showHideTraverseTools()}},_updateRowIndexes:function(){var c;c=C(".esriCTRow",this.traverseGrid);p.forEach(c,f.hitch(this,function(c,a){var b;B.set(c,"rowIndex",a);(b=C(".esriCTDeleteIcon",c)[0])&&B.set(b,"rowIndex",a);(c=C(".esriCTSymbolContainer",c)[0])&&B.set(c,"rowIndex",a)}))},
_onDndDrop:function(){var c,a=[],b;this._dndContainer.sync();c=this._dndContainer.getAllNodes();c.forEach(f.hitch(this,function(c){c=parseInt(B.get(c,"rowIndex"),10);a.push(this._itemList[c])}));this._nodes=c;this._itemList=[];this._itemList=a;this._updateRowIndexes();for(c=0;c<this._itemList.length;c++)0===c&&this._itemList[c].isTB&&(this._itemList[c].isTB=!1,b=!0),this._itemList[c]&&this._itemList[c].isTB&&(this._itemList[c]=this._setTangentBearing(this._itemList[c],this._itemList[c-1]),b=!0);this.setStartPoint(this.startPoint,
!0);b&&this._reGenerateTraverseGrid()},_updateParcelValues:function(c,a,b){var h,t,d,m=!1,k;if(h=this._itemList[a])if(d=(d=c.get("value"))?f.trim(d.toString()):"",l.contains(c.domNode,"esriCTBearingRow")&&String(this._getBearingAccordingToPlanSettings(h.BearingConversions))!==d?(t="Bearing",h.Bearing=d,m=!0,-1===d.indexOf("*")&&(h.isTB=!1)):l.contains(c.domNode,"esriCTLengthRow")&&String(this._getRoundedValue(h.LengthConversions,"Length"))!==d?(t="Length",h.Length=d,m=!0):l.contains(c.domNode,"esriCTRadiusRow")&&
String(h.Radius)!==d&&(h.RadiusConversions?String(this._getRoundedValue(h.RadiusConversions,"Radius"))!==d&&(t="Radius",h.Radius=d,m=!0):(t="Radius",h.Radius=d,m=!0)),m)if(d=this._getValidatedValues(h,t,a)){if("Bearing"===t?(t=this._getBearingAccordingToPlanSettings(d.BearingConversions),h.Bearing=this._getBearingAccordingToPlanSettings(d.BearingConversions,!0),h.isTB&&(t="*"+t),c.set("value",t),k=this._updateTBFromIndex(a+1)):"Length"===t?(t=this._getRoundedValue(h.LengthConversions,"Length"),h.Length=
h.LengthConversions[this._planSettings.distanceAndLengthUnits],h.RadiusConversions&&(h=this._createValuesForArc(h)),c.set("value",t),k=this._updateTBFromIndex(a)):"Radius"===t&&(h.RadiusConversions?(h.Radius=h.RadiusConversions[this._planSettings.distanceAndLengthUnits],t=this._getRoundedValue(h.RadiusConversions,"Radius")):t=h.Radius="",h=this._createValuesForArc(h),c.set("value",t),k=this._updateTBFromIndex(a)),this.appliedCompassRule?this.setParcelClosure(!0,!0):this.setStartPoint(this.startPoint,
!0),k||b)this._reGenerateTraverseGrid(),b&&this._popupCoords&&this._openPopup(this._popupCoords)}else this._updateValues(h,t,c)},_updateValues:function(c,a,b){var h;"Bearing"===a?(c.Bearing=this._getBearingAccordingToPlanSettings(c.BearingConversions,!0),h=this._getBearingAccordingToPlanSettings(c.BearingConversions)):"Length"===a?(c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits],h=this._getRoundedValue(c.LengthConversions,"Length")):"Radius"===a&&(c.RadiusConversions?(c.Radius=
c.RadiusConversions[this._planSettings.distanceAndLengthUnits],h=this._getRoundedValue(c.RadiusConversions,"Radius")):h=c.Radius="");b.set("value",h)},_showHideTraverseTools:function(){this._itemList&&0<this._itemList.length?(l.remove(this.expandCollapseNode,"esriCTHidden"),l.remove(this.zoomToNode,"esriCTHidden")):(l.add(this.expandCollapseNode,"esriCTHidden"),l.add(this.zoomToNode,"esriCTHidden"))},_getBearingAccordingToPlanSettings:function(c,a){if("northAzimuth"===this._planSettings.directionOrAngleType&&
"decimalDegree"===this._planSettings.directionOrAngleUnits)return a?c.naDD:c.naDDRound;if("northAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return c.naDMS;if("southAzimuth"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return a?c.saDD:c.saDDRound;if("southAzimuth"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return c.saDMS;
if("quadrantBearing"===this._planSettings.directionOrAngleType&&"decimalDegree"===this._planSettings.directionOrAngleUnits)return a?c.qb3DD:c.qb3DDRound;if("quadrantBearing"===this._planSettings.directionOrAngleType&&"degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits)return c.qb3DMS},_getRoundedValue:function(c,a){var b;c=c[this._planSettings.distanceAndLengthUnits];switch(a){case "Length":b=this.lengthFieldPlaces;break;case "Radius":b=this.radiusFieldPlaces;break;case "MiscloseDistance":b=
this.miscloseDistanceFieldPlaces}return x.honourPopupRounding(b,c)},_resetEntryRow:function(c){this.bearingNode.set("value","");this.lengthNode.set("value","");this.radiusNode.set("value","");this.bearingNode.reset();this.lengthNode.reset();this.radiusNode.reset();0<this._itemList.length&&(c=this._itemList[this._itemList.length-1].isTB?"*tb":c?this._getBearingAccordingToPlanSettings(this._itemList[this._itemList.length-1].BearingConversions):this._itemList[this._itemList.length-1].Bearing,this.bearingNode.set("value",
c),this.bearingNode.textbox.setSelectionRange(0,c.length))},_reGenerateTraverseGrid:function(){this._dndContainer&&(this._dndContainer.destroy(),this._dndContainer=null);r.empty(this.traverseGrid);this._createTraverseGrid()},_showRotationPoint:function(){var c,a,b=this.startPoint;this.config.startOrRotaionSymbol?a=G.fromJson(this.config.startOrRotaionSymbol):(c={color:[136,136,136,255],size:11.25,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[29,29,53,255],width:.75,
type:"esriSLS",style:"esriSLSSolid"}},a=G.fromJson(c));this._rotationPointInfo&&this._rotationPointInfo.rotationPoint&&(b=this._rotationPointInfo.rotationPoint);4326!==this.map.spatialReference.wkid?u.getProjectedGeometry(b,this.map.spatialReference,this.geometryService).then(f.hitch(this,function(c){c&&(c=new m(c),c.setSymbol(a),this.rotationPointsGraphicsLayer.clear(),this.rotationPointsGraphicsLayer.add(c))})):(c=new m(b),c.setSymbol(a),this.rotationPointsGraphicsLayer.clear(),this.rotationPointsGraphicsLayer.add(c))},
resetRotationPoint:function(c){this._setRotationPoint(0,c)},_setRotationPoint:function(c,a){var b=a;a=new y(4326);u.getProjectedGeometry(b,a,this.geometryService).then(f.hitch(this,function(a){b=a;this._rotationPointInfo={rotationPointIndex:c,rotationPoint:b}}))},_updateStartPointFromRotationPoint:function(){var c=this._rotationPointInfo.rotationPoint,a=this._rotationPointInfo.rotationPointIndex;if(null!==this._rotationAngle){for(--a;0<=a;a--){var b,h;h=this._itemList[a];var d=Number(h.BearingConversions.naDD)+
this._rotationAngle;b=h.LengthConversions.meters;this._scaleValue&&(b*=this._scaleValue);d=x.getSouthAzimuthFromNorthAzimuth(d);""===h.Radius||"0"===h.Radius||0===h.Radius?c=u.getDestinationPoint(c,d,b):(b=h.RadiusConversions.meters,h=h.ChordLengthConversions.meters,this._scaleValue&&(b*=this._scaleValue,h*=this._scaleValue),c=this.getArcInfo(c,d,b,h),c=c.endPoint)}this.setStartPoint(c)}},_reDrawParcel:function(){this.parcelLinesGraphicsLayer.clear();this.parcelPointsGraphicsLayer.clear();this._arrayOfAllBoundaryLines=
[];this._drawPoint(this.startPoint);p.forEach(this._itemList,f.hitch(this,function(c){""===c.Radius||"0"===c.Radius||0===c.Radius?this._drawStraightLine(c,!1):this._drawArc(c,!1)}));this._setExtentToLayer(this.parcelLinesGraphicsLayer);this.setParcelClosure()},setStartPoint:function(c,a,b){var h=new y(4326);u.getProjectedGeometry(c,h,this.geometryService).then(f.hitch(this,function(h){b&&this._rotationPointInfo?(this._setRotationPoint(this._rotationPointInfo.rotationPointIndex,h),this._updateStartPointFromRotationPoint()):
(this.startPoint=h,a&&this.resetRotationPoint(this.startPoint),this._showRotationPoint(),this._startPointForNextLine=f.clone(h),this._orgStartPointForNextLine=f.clone(h),this.appliedCompassRule=!1,0<this._itemList.length?this._reDrawParcel():(this.parcelPointsGraphicsLayer.clear(),this.parcelLinesGraphicsLayer.clear(),this._arrayOfAllBoundaryLines=[],this._drawPoint(c)))}))},_addProjectedGraphic:function(c,a,b,h){var d,t={};t.rowIndex=c.graphics.length;a.attributes=t;4326!==this.map.spatialReference.wkid?
u.getProjectedGeometry(a.geometry,this.map.spatialReference,this.geometryService).then(f.hitch(this,function(k){k&&(d=new m(k),d.setAttributes(t),d.setSymbol(a.symbol),c.add(d),b&&(this._setExtentToLayer(c),h&&this.setParcelClosure()))})):(c.add(a),b&&(this._setExtentToLayer(c),h&&this.setParcelClosure()))},_drawPoint:function(a){a=new m(a,G.fromJson(this.config.pointSymbol));this._addProjectedGraphic(this.parcelPointsGraphicsLayer,a,!1,!1)},_drawLineAndEndPoint:function(a,b,d,h){var c;c=!0;a?(b=
u.getLineBetweenPoints(b))?(d=new m(b,G.fromJson(d.LineSymbol.symbol)),this._addProjectedGraphic(this.parcelLinesGraphicsLayer,d,h,!0),this._startPointForNextLine=f.clone(a),this.appliedCompassRule&&this.parcelLinesGraphicsLayer.graphics.length===this._itemList.length&&(c=!1),c&&this._drawPoint(a)):this._showMessage(this.nls.newTraverse.unableToDrawLineMessage):this._showMessage(this.nls.newTraverse.invalidEndPointMessage)},setInfoForCalculatingMisclose:function(a,b,d){a.startPoint=f.clone(this._orgStartPointForNextLine);
a.endpoint=f.clone(b);d=u.getLineBetweenPoints(d);if(a.LineSymbol.type===this.config.BoundaryLineType)for(var c=0;c<d.paths.length;c++)this._arrayOfAllBoundaryLines.push(d.paths[c]);this._orgStartPointForNextLine=f.clone(b);return a},getArcInfo:function(a,b,d,h){var c,t,m;c=u.getDestinationPoint(a,b,Math.abs(h));t=Math.abs(h)/2;m=u.getDestinationPoint(a,b,t);a={distance:h,radius:d,initBearing:b,chordMidPoint:m,centerAndChordDistance:Math.sqrt(Math.abs(d*d-t*t)),chordEndPoint:c,chordStartPoint:a};
b=u.getArcParam(a);b.startAngle=b.startAngle>b.endAngle?b.startAngle-360:b.startAngle;b=u.getPointsForArc(b.startAngle,b.endAngle,b.centerPoint,d);0===b.length&&(b.push(a.chordStartPoint),b.push(a.chordEndPoint));0>d&&b.reverse();return{endPoint:c,arcGeometryPointsArray:b}},_drawStraightLine:function(a,b){var c,h,d;c=a.BearingConversions.naDD;h=a.LengthConversions.meters;if(a.adjustedValues&&this.adjustPoints){c=a.adjustedValues.adjustedBearing;if("S"===a.BearingConversions.qb3DDRound.charAt(0)||
0>a.adjustedValues.lat)c=a.adjustedValues.adjustedBearingNADD;h=a.adjustedValues.adjustedLength;this.appliedCompassRule=!0}this._rotationAngle&&(c=Number(c)+this._rotationAngle);this._scaleValue&&(h*=this._scaleValue);d=u.getDestinationPoint(this._orgStartPointForNextLine,a.BearingConversions.naDD,a.LengthConversions.meters);c=u.getDestinationPoint(this._startPointForNextLine,c,h);a=this.setInfoForCalculatingMisclose(a,d,[this._orgStartPointForNextLine,d]);this._drawLineAndEndPoint(c,[this._startPointForNextLine,
c],a,b)},_drawArc:function(a,b){var c,h,d,m;d=a.BearingConversions.naDD;c=a.RadiusConversions.meters;h=a.ChordLengthConversions.meters;if(a.adjustedValues&&this.adjustPoints){d=a.adjustedValues.adjustedBearing;if("S"===a.BearingConversions.qb3DDRound.charAt(0)||0>a.adjustedValues.lat)d=a.adjustedValues.adjustedBearingNADD;h=a.adjustedValues.adjustedLength;0>a.ChordLengthConversions.meters&&(h*=-1);this.appliedCompassRule=!0}this._rotationAngle&&(d=Number(d)+this._rotationAngle);this._scaleValue&&
(h*=this._scaleValue,c*=this._scaleValue);m=this.getArcInfo(this._orgStartPointForNextLine,a.BearingConversions.naDD,a.RadiusConversions.meters,a.ChordLengthConversions.meters);a=this.setInfoForCalculatingMisclose(a,m.endPoint,m.arcGeometryPointsArray);c=this.getArcInfo(this._startPointForNextLine,d,c,h);this._drawLineAndEndPoint(c.endPoint,c.arcGeometryPointsArray,a,b)},_setExtentToLayer:function(a,b){0<a.graphics.length&&(a=L.graphicsExtent(a.graphics),!b&&this.map.extent.contains(a)||this.map.setExtent(a.expand(1.5)))},
_showMessage:function(a){this.emit("showMessage",a)},updateAccordingToPlanSettings:function(a){this._planSettings=a;this.bearingNode.set("placeHolder",this._getAbbreviatedUnits(a.directionOrAngleUnits));this.lengthNode.set("placeHolder",this._getAbbreviatedUnits(a.distanceAndLengthUnits));this.radiusNode.set("placeHolder",this._getAbbreviatedUnits(a.distanceAndLengthUnits));this._reGenerateTraverseGrid();this._misCloseDetailsInstance&&(a=this._misCloseDetailsInstance.getMiscloseDetails())&&(a=this._getMiscloseDetailsAccordingToPlanSettings(a),
this._misCloseDetailsInstance.updateAccordingToPlanSettings(a))},deActivateUpdateRotationPointTool:function(){l.remove(this.updateRotationPointNode,"esriCTEnableButton")},deActivateDigitizationTool:function(){l.remove(this.screenDigitizationNode,"esriCTEnableButton")},pointAddedFromDigitization:function(a){var c,b,h,d;d=new y(4326);u.getProjectedGeometry(a,d,this.geometryService).then(f.hitch(this,function(a){c=u.getAngleBetweenPoints(this._startPointForNextLine,a);360===c&&(c=0);b=u.getDistanceBetweenPoints(this._startPointForNextLine,
a);h=this.getAngleFromDDTOQB(c);this.bearingNode.set("value",h);"uSSurveyFeet"===this._planSettings.distanceAndLengthUnits&&(b=x.metersToUSSurveyFeet(b));0<this._scaleValue&&(b/=this._scaleValue);this.lengthNode.set("value",b);this.radiusNode.set("value","");this._addNewItem(!0)}))},getParcelCloseDetails:function(){var a,b,d,h,m,k,n,e,g;h={isClosed:!1,compassStartPoint:null,compassEndPoint:null};m=!0;b=a=d=0;p.forEach(this._itemList,f.hitch(this,function(c,h){c.LineSymbol.type===this.config.BoundaryLineType?
(0===d?k=c.startPoint:n=c.endpoint,d++,a+=Math.cos(c.BearingConversions.naDD/180*Math.PI)*c.LengthConversions.meters,b+=Math.sin(c.BearingConversions.naDD/180*Math.PI)*c.LengthConversions.meters):0<h&&0!==d&&(m=!1)}));1<d&&m&&(e=Math.sqrt(a*a+b*b),e=u.removeNegativeExponents(e),k.x=x.showFixedPlacesAfterDecimal(k.x,6),k.y=x.showFixedPlacesAfterDecimal(k.y,6),n.x=x.showFixedPlacesAfterDecimal(n.x,6),n.y=x.showFixedPlacesAfterDecimal(n.y,6),g=u.getAngleBetweenPoints(n,k),h.isClosed=!0,h.compassStartPoint=
k,h.compassEndPoint=n,h.miscloseDistance=e,h.miscloseBearing=g);return h},setParcelClosure:function(a,b){var c;c=this.getParcelCloseDetails();if(c.isClosed)c=this.getCalculatedMiscloseDetails(c),this._misCloseDetailsInstance.setMiscloseDetails(c),c.adjustPoints?((this.adjustPoints=this._applyCompassRule(c))&&!this.appliedCompassRule||a)&&this.setStartPoint(this.startPoint,b):(this.adjustPoints=!1,(this.appliedCompassRule||a)&&this.setStartPoint(this.startPoint,b));else if(this._misCloseDetailsInstance.setMiscloseDetails(null),
this.adjustPoints=!1,this.appliedCompassRule||a)this.appliedCompassRule=!1,this.setStartPoint(this.startPoint,b)},_getMiscloseDetailsAccordingToPlanSettings:function(a){var c,b;c={};a.BearingConversions&&(c.miscloseBearing=this._getBearingAccordingToPlanSettings(a.BearingConversions));b=this._getRoundedValue(a.LengthConversions,"MiscloseDistance");c.miscloseDistance=b+" "+this._getAbbreviatedUnits(this._planSettings.distanceAndLengthUnits);a.AreaConversions?(a=a.AreaConversions[this._planSettings.areaUnits],
isNaN(parseFloat(a))||(a=x.honourPopupRounding(2,a.toFixed(1)))):a=0;a=a+" "+this._getAbbreviatedUnits(this._planSettings.areaUnits);c.calculatedArea=a;return c},getCalculatedMiscloseDetails:function(a){var c,b={},d=c=0,d=0,m=!1;c=a.compassStartPoint;if(a.compassEndPoint&&c){c=a.miscloseDistance;d=a.miscloseBearing;0===c&&(d=0);d=this.getAngleFromDDTOQB(d);if(a=x.categorizeBearingFormat(d,this._planSettings))b.BearingConversions=a;b.AreaConversions=this._getCalculatedArea();a=this._getMiscloseRatioInfo(c);
d=a.miscloseRatio;b.miscloseValue=a.miscloseValue;c=x.categorizeLengthFormat(c,"meters");b.LengthConversions=c;c=c[this.config.miscloseSnapDistanceUnit+"Round"];1E5<=d&&(m=!0);b.miscloseRatio=d;b.accuracy=m;b=f.mixin(b,this._getMiscloseDetailsAccordingToPlanSettings(b));if(0<c&&c<=this.config.miscloseSnapDistance||isFinite(d)&&d>=this.config.miscloseRatioSnap)b.adjustPoints=!0,b.compassCompleteLength=a.compassCompleteLength}return b},_getPolygonAtOrigin:function(){var a=new O(0,0,new y(4326)),b=[];
p.forEach(this._itemList,f.hitch(this,function(c){var d,m;if(c.LineSymbol.type===this.config.BoundaryLineType){if(""===c.Radius||"0"===c.Radius||0===c.Radius){if(c.adjustedValues&&this.adjustPoints){m=c.adjustedValues.adjustedBearing;if("S"===c.BearingConversions.qb3DDRound.charAt(0)||0>c.adjustedValues.lat)m=c.adjustedValues.adjustedBearingNADD;d=c.adjustedValues.adjustedLength}else m=c.BearingConversions.naDD,d=c.LengthConversions.meters;c=u.getDestinationPoint(a,m,d);d=u.getLineBetweenPoints([a,
c])}else{if(c.adjustedValues&&this.adjustPoints){m=c.adjustedValues.adjustedBearing;if("S"===c.BearingConversions.qb3DDRound.charAt(0)||0>c.adjustedValues.lat)m=c.adjustedValues.adjustedBearingNADD;d=c.adjustedValues.adjustedLength;0>c.ChordLengthConversions.meters&&(d*=-1)}else m=c.BearingConversions.naDD,d=c.ChordLengthConversions.meters;d=this.getArcInfo(a,m,c.RadiusConversions.meters,d);c=d.endPoint;d=u.getLineBetweenPoints(d.arcGeometryPointsArray)}a=c;for(c=0;c<d.paths.length;c++)b.push(d.paths[c])}}));
return u.getPolygonFromPolyLines(b,!0)},_getCalculatedArea:function(){var a,b;this._arrayOfAllBoundaryLines&&0<this._arrayOfAllBoundaryLines.length&&(b=this._getPolygonAtOrigin())&&(a=new m(b),this.parcelPolygonGraphicsLayer.clear(),this.parcelPolygonGraphicsLayer.add(a),a=u.getAreaOfGeometry(b));return a},_applyCompassRule:function(a){var c,b,d,m,k,n;k=m=0;n={};for(d=0;d<this._itemList.length;d++)b=this._itemList[d],b.LineSymbol.type===this.config.BoundaryLineType&&(""===b.Radius||"0"===b.Radius||
0===b.Radius?c=b.LengthConversions.meters:b.ChordLengthConversions&&(c=b.ChordLengthConversions.meters),c=Math.abs(c),b.lat=c*Math.cos(Math.PI/180*b.BearingConversions.naDD),b.dep=c*Math.sin(Math.PI/180*b.BearingConversions.naDD),m+=b.lat,k+=b.dep);n.sumOfLat=m;n.sumOfDep=k;n.sumOfAllLinesLength=a.compassCompleteLength;for(d=0;d<this._itemList.length;d++)b=this._itemList[d],""===b.Radius||"0"===b.Radius||0===b.Radius?c=b.LengthConversions.meters:b.ChordLengthConversions&&(c=b.ChordLengthConversions.meters),
c=Math.abs(c),b.LineSymbol.type===this.config.BoundaryLineType&&(b.adjustedValues=this._adjustBearingAndDistance(b.lat,b.dep,c,n));for(d=c=a=0;d<this._itemList.length;d++)b=this._itemList[d],b.LineSymbol.type===this.config.BoundaryLineType&&(a+=parseFloat(b.adjustedValues.lat.toFixed(2)),c+=parseFloat(b.adjustedValues.dep.toFixed(2)),a=parseFloat(a.toFixed(2)),c=parseFloat(c.toFixed(2)));return 0===parseInt(a,10)&&0===parseInt(c,10)?!0:!1},_adjustBearingAndDistance:function(a,b,d,m){var c,h;c={};
a=parseFloat(a.toFixed(6));b=parseFloat(b.toFixed(6));d=parseFloat(d.toFixed(6));h=-m.sumOfLat/m.sumOfAllLinesLength*d;d*=-m.sumOfDep/m.sumOfAllLinesLength;h=parseFloat(h.toFixed(6));d=parseFloat(d.toFixed(6));b+=d;a=parseFloat((a+h).toFixed(6));b=parseFloat(b.toFixed(6));h=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));d=Math.atan(b/a);d=parseFloat(d.toFixed(6));c.lat=a;c.dep=b;c.adjustedLength=h;c.adjustedBearing=180/Math.PI*d;a=x.categorizeBearingFormat(c.adjustedBearing,{directionOrAngleType:"southAzimuth",
directionOrAngleUnits:"decimalDegree"});c.adjustedBearingNADD=a.naDD;return c},_getMiscloseRatioInfo:function(a){var b,c=b=0,d;d=0;this._arrayOfAllBoundaryLines&&0<this._arrayOfAllBoundaryLines.length&&(b=u.getPolyLineFromPaths(this._arrayOfAllBoundaryLines),b=u.getLengthOfGeometry(b),0<b&&(c=1/(a/b),10>c?c=0:1E5>c&&(d=parseInt(c,10),c="1:"+parseInt(c,10))));return{miscloseRatio:c,miscloseValue:d,compassCompleteLength:b}},getAngleFromDDTOQB:function(a){var b,c;c=f.clone(this._planSettings);c.directionOrAngleType=
"northAzimuth";c.directionOrAngleUnits="decimalDegree";(a=x.categorizeBearingFormat(a,c))&&(b="degreeMinuteSeconds"===this._planSettings.directionOrAngleUnits?a.qb3DMS:a.qb3DD);return b},initEditing:function(a,b,d){var c,m,k,n,e;this._planInfoInstance.setParcelInformation(this.polygonDeleteArr,b.features);c=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.rotation.name];(k=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.scale.name])||(k=1);m=this.polygonDeleteArr[0].attributes[this.config.polygonLayer.statedArea.name];
this._parcelToolInstance.setRotation(c);this._parcelToolInstance.setScale(k);null!==m&&void 0!==m&&this._misCloseDetailsInstance.traverseStatedArea.set("value",m);k=[];n=u.getUnitValueForSR(d);e=f.clone(this._planSettings);e.directionOrAngleType="northAzimuth";e.directionOrAngleUnits="decimalDegree";for(d=0;d<b.features.length;d++){c={};c.Bearing=b.features[d].attributes[this.config.polylineLayer.bearing.name];c.BearingConversions=x.categorizeBearingFormat(c.Bearing,e);c.Bearing=this._getBearingAccordingToPlanSettings(c.BearingConversions,
!0);c.Length=b.features[d].attributes[this.config.polylineLayer.distance.name];null!==c.Length&&""!==c.Length&&(c.LengthConversions=this._validateLength(c.Length,n),c.Length=c.LengthConversions[this._planSettings.distanceAndLengthUnits]);if(m=this.getLineSymbolForType(b.features[d].attributes[this.config.polylineLayer.lineType.name]))c.LineSymbol=m;c.Radius=b.features[d].attributes[this.config.polylineLayer.radius.name];null!==c.Radius&&""!==c.Radius?(c.RadiusConversions=this._validateLength(c.Radius,
n),c.Radius=c.RadiusConversions[this._planSettings.distanceAndLengthUnits],c.ArcLength=b.features[d].attributes[this.config.polylineLayer.arcLength.name],null!==c.ArcLength&&""!==c.ArcLength&&(c.ArcLengthConversions=this._validateLength(c.ArcLength,n),c.ArcLength=c.ArcLengthConversions[this._planSettings.distanceAndLengthUnits]),c.ChordLength=b.features[d].attributes[this.config.polylineLayer.chordLength.name],null!==c.ChordLength&&""!==c.ChordLength&&(c.ChordLengthConversions=this._validateLength(c.ChordLength,
n),c.ChordLength=c.ChordLengthConversions[this._planSettings.distanceAndLengthUnits]),"radiusAndArcLength"===this._planSettings.circularCurveParameters?(c.Length=c.ArcLength,c.LengthConversions=f.clone(c.ArcLengthConversions)):(c.Length=c.ChordLength,c.LengthConversions=f.clone(c.ChordLengthConversions))):(c.Radius="",c.RadiusConversions=null);k.push(c)}this._itemList=k;this._reGenerateTraverseGrid();this._showHideTraverseTools();this.setStartPoint(a,!0);this.setBoundaryLineSymbol()},setBoundaryLineSymbol:function(){this._symbolSelector&&
p.some(this.config.lineTypes,f.hitch(this,function(a){if(this.config.BoundaryLineType===a.type)return this._symbolSelector.selectSymbol(a),!1}))},getLineSymbolForType:function(a){var c;p.some(this.config.lineTypes,f.hitch(this,function(b){if(b.type===a)return c=f.clone(b),!0}));return c},deactivateParcelTools:function(){this._parcelToolInstance.disableRotating();this._parcelToolInstance.disableScaling()},clearAll:function(){this.parcelLinesGraphicsLayer.clear();this.parcelPointsGraphicsLayer.clear();
this.parcelPolygonGraphicsLayer.clear();this.rotationPointsGraphicsLayer.clear();this._resetEntryRow();this._dndContainer.clearItems();r.empty(this.traverseGrid);this._itemList=[];this._nodes=[];this._showHideTraverseTools();this._orgStartPointForNextLine=this._startPointForNextLine=this.startPoint=null;this._rotationAngle=0;this._scaleValue=1;this._symbolSelector.setDefault();l.remove(this.screenDigitizationNode,"esriCTEnableButton");l.remove(this.updateRotationPointNode,"esriCTEnableButton");this._parcelToolInstance.resetTools();
this.deactivateParcelTools();this._misCloseDetailsInstance.setMiscloseDetails(null);this._arrayOfAllBoundaryLines=[];this.polygonDeleteArr=[];this.polylineDeleteArr=[];this.domNode.scrollTop=0;this._planInfoInstance.resetValues();this._misCloseDetailsInstance.traverseStatedArea.set("value",null);this._rotationPointInfo=null;this.closePopup()},_showParcelPopup:function(a){var c,b,d=[];c=new M;b=this._pointToExtent(a.mapPoint,8);d=p.filter(this.parcelLinesGraphicsLayer.graphics,function(a){return b.intersects(a.geometry)});
d[0]?(this._createPopupContent(a,d[0]),c.resolve(!0)):(this.closePopup(),c.resolve(!1));return c},_getAbbreviatedUnits:function(a){return window.jimuNls.units[a+"Abbr"]},_pointToExtent:function(a,b){var c;c=this.map.extent.getWidth()/this.map.width;b*=c;return new N(a.x-b,a.y-b,a.x+b,a.y+b,this.map.spatialReference)},_createPopupContent:function(a,b){var c,d,m;if(m=this._itemList[b.attributes.rowIndex])c=r.create("div",{"class":"esriCTParcelInfoPopup "+this.baseClass},null),d=r.create("div",{"class":"esriCTLabelRows"},
c),this._createFieldLabels(d,this.nls.traverseSettings.bearingLabel),this._createFieldLabels(d,this.nls.traverseSettings.lengthLabel),this._createFieldLabels(d,this.nls.traverseSettings.radiusLabel),b=r.create("div",{"class":"esriCTRowContainer esriCTRow",rowIndex:b.attributes.rowIndex},c),this._createFieldInputs(b,this._getBearingAccordingToPlanSettings(m.BearingConversions),"esriCTBearingRow",!0),(d=m.RadiusConversions)?(d=this._getRoundedValue(m.RadiusConversions,"Radius"),m="radiusAndArcLength"===
this._planSettings.circularCurveParameters?this._getRoundedValue(m.ArcLengthConversions,"Length"):this._getRoundedValue(m.ChordLengthConversions,"Length")):(d="",m=this._getRoundedValue(m.LengthConversions,"Length")),this._createFieldInputs(b,m,"esriCTLengthRow",!0),this._createFieldInputs(b,d,"esriCTRadiusRow",!0),J.position(this.traverseEntryNode)&&J.position(this.traverseEntryNode).w&&(m=J.position(this.traverseEntryNode).w-42,v.set(this._popupDialog.domNode,"width",m+"px")),this._popupDialog.setContent(c),
this._popupCoords={pageX:a.pageX,pageY:a.pageY},this._openPopup(a)},_openPopup:function(a){v.set(this._popupDialog.domNode,"opacity",.9);K.open({popup:this._popupDialog,x:a.pageX,y:a.pageY})},closePopup:function(){this._popupDialog&&K.close(this._popupDialog)},_createFieldLabels:function(a,b){r.create("div",{innerHTML:b,title:b,"class":"esriCTParcelInfoLabels"},a)},_createTooltip:function(){this._popupDialog=new I({"class":"esriCTEditParcelDialog"});this._popupDialog.startup()},validateNumericField:function(a,
b){var c,d=/^[-+]?[0-9]+\.[0-9]+$/,m=/^[-+]?[0-9]+$/;a=f.trim(a);switch(b){case "esriFieldTypeSmallInteger":b=parseInt(a,10);c=a.match(m)&&-32768<=b&&32767>=b&&0!==a.length?!0:!1;break;case "esriFieldTypeInteger":b=parseInt(a,10);c=a.match(m)&&-2147483648<=b&&2147483647>=b&&0!==a.length?!0:!1;break;case "esriFieldTypeSingle":b=parseFloat(a);c=(a.match(m)||a.match(d))&&b>=-3.4*Math.pow(10,38)&&b<=1.2*Math.pow(10,38)&&0!==a.length?!0:!1;break;case "esriFieldTypeDouble":b=parseFloat(a),c=(a.match(m)||
a.match(d))&&b>=-2.2*Math.pow(10,308)&&b<=1.8*Math.pow(10,38)&&0!==a.length?!0:!1}return c}})})},"widgets/ParcelDrafter/SymbolSelector":function(){define("dojo/_base/declare jimu/BaseWidget dojo/_base/lang dojo/on dojo/dom-construct dojo/_base/array jimu/symbolUtils esri/symbols/jsonUtils dijit/popup dijit/TooltipDialog dojo/_base/html".split(" "),function(g,b,a,d,e,f,p,l,r,v,q){return g([b],{_tooltipDialog:null,selectedSymbol:null,symbolData:[],constructor:function(b){a.mixin(this,b)},postCreate:function(){this.symbolData||
(this.symbolData=[]);this._createSelectedSymbolNode();this._hideTooltipDialog();this.symbolData&&0<this.symbolData.length&&(this._createTooltipDialog(),this.selectSymbol(this.symbolData[0]));this.own(d(document.body,"click",a.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})))},setDefault:function(){this.selectSymbol(this.symbolData[0])},_createSelectedSymbolNode:function(){var a=e.create("div",{},this.domNode);this.selectedSymbolNode=e.create("div",{"class":"esriCTSelectedSymbol"},
a)},_createTooltipDialog:function(){var b=this._createSymbolListMenu();this._tooltipDialog=new v({content:b,"class":"esriCTSymbolPopup"});this.own(d(this.domNode,"click",a.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(d(document.body,"click",a.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})))},_createSymbolListMenu:function(){var b,d;b=e.create("div",
{"class":"esriCTSymbolListContainer"},null);d=e.create("div",{"class":"esriCTSymbolListContent"},b);f.forEach(this.symbolData,a.hitch(this,function(a){var b,k;b=e.create("div",{"class":"esriCTSymbolOption",title:a.label},d);this._attachRowClick(b,a);k=e.create("div",{"class":"esriCTSymbolIcon"},b);e.create("div",{"class":"esriCTSymbolName",innerHTML:a.label},b);b=e.create("div",{},k);this._createSymbol(a,b)}));return b},_attachRowClick:function(b,n){this.own(d(b,"click",a.hitch(this,function(){this.selectSymbol(n);
this.hideOnSelect&&this._hideTooltipDialog()})))},_createSymbol:function(a,b){a&&(a=l.fromJson(a.symbol),(a=p.createSymbolNode(a))||(a=e.create("div")),e.place(a,b))},selectSymbol:function(a){e.empty(this.selectedSymbolNode);this.selectedSymbol={label:a.label||a.type,type:a.type,symbol:a.symbol};this._createSymbol(this.selectedSymbol,this.selectedSymbolNode);this.onSelect(a)},destroy:function(){r.close(this._tooltipDialog);this._tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var b;
b=this._tooltipDialog.domNode;return a===b||q.isDescendant(a,b)},onSelect:function(a){return a},_showTooltipDialog:function(){r.open({parent:this.getParent(),popup:this._tooltipDialog,around:this.domNode,"class":"esriCTSymbolPopup"});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){r.close(this._tooltipDialog);this._isTooltipDialogOpened=!1}})})},"widgets/ParcelDrafter/MiscloseDetails":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./MiscloseDetails.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/dom-attr".split(" "),
function(g,b,a,d,e,f,p,l){return g([b,a,f],{baseClass:"jimu-widget-ParcelDrafter-MisclosedDetails",templateString:d,details:null,constructor:function(a){e.mixin(this,a)},postCreate:function(){this.inherited(arguments);p.add(this.domNode,"esriCTFullWidth");this.config.polygonLayer.statedArea&&this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(p.remove(this.traverseStatedAreaNode,"esriCTHidden"),this.traverseStatedArea.trim=!0,this.config.polygonLayer.statedArea.nullable||(this.traverseStatedArea.required=
!0),0<=this.numberFieldTypes.indexOf(this.config.polygonLayer.statedArea.type)&&(this.traverseStatedArea.validator=e.hitch(this,function(a){return!this.config.polygonLayer.statedArea.nullable&&(null===a||""===a)||""!==a&&!this.validateNumericField(a,this.config.polygonLayer.statedArea.type)?!1:!0})));this._setBackgroundColorForDartTheme()},_setBackgroundColorForDartTheme:function(){"DartTheme"===this.appConfig.theme.name&&p.add(this.traverseDetailsContainer,"esriCTMiscloseHeaderDiv")},getMiscloseDetails:function(){return this.details},
updateAccordingToPlanSettings:function(a){l.set(this.miscloseBearingNode,"innerHTML",a.miscloseBearing);l.set(this.miscloseDistanceNode,"innerHTML",a.miscloseDistance);l.set(this.calculatedAreaNode,"innerHTML",a.calculatedArea)},setMiscloseDetails:function(a){(this.details=a)?(l.set(this.miscloseBearingNode,"innerHTML",a.miscloseBearing),l.set(this.miscloseDistanceNode,"innerHTML",a.miscloseDistance),0!==a.miscloseRatio?(p.remove(this.traverseMiscloseRatioNode,"esriCTHidden"),l.set(this.miscloseRatioNode,
"innerHTML",a.miscloseRatio)):p.add(this.traverseMiscloseRatioNode,"esriCTHidden"),a.accuracy?(p.add(this.traverseMiscloseRatioNode,"esriCTHidden"),p.remove(this.traverseAccuracyNode,"esriCTHidden")):p.add(this.traverseAccuracyNode,"esriCTHidden"),a.calculatedArea?(l.set(this.calculatedAreaNode,"innerHTML",a.calculatedArea),p.remove(this.traverseCalculatedAreaNode,"esriCTHidden")):p.add(this.traverseCalculatedAreaNode,"esriCTHidden"),p.add(this.noMiscloseCalculated,"esriCTHidden"),p.remove(this.miscloseDetailsContainer,
"esriCTHidden")):(p.add(this.miscloseDetailsContainer,"esriCTHidden"),p.remove(this.noMiscloseCalculated,"esriCTHidden"))}})})},"widgets/ParcelDrafter/ParcelTools":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./ParcelTools.html dojo/_base/lang dojo/Evented dojo/dom-class dojo/on dojo/keys dijit/form/NumberTextBox".split(" "),function(g,b,a,d,e,f,p,l,r){return g([b,a,f],{baseClass:"jimu-widget-ParcelDrafter-ParcelTools",templateString:d,rotationAngle:0,
scaledValue:1,constructor:function(a){e.mixin(this,a)},postCreate:function(){this.inherited(arguments);p.add(this.domNode,"esriCTFullWidth");this.rotationTxt.constraints={min:-360,max:360,places:3};this.scaleTxt.constraints={min:.1,places:3};this.rotationTxt.set("value",this.rotationAngle);this.scaleTxt.set("value",this.scaledValue);this.own(l(this.rotationTxt,"blur",e.hitch(this,function(){this.setRotation(this.rotationTxt.displayedValue)})));this.own(l(this.scaleTxt,"blur",e.hitch(this,function(){this.setScale(this.scaleTxt.displayedValue)})));
this.own(l(this.rotateButton,"click",e.hitch(this,function(){this._toggleRotating()})));this.own(l(this.scaleButton,"click",e.hitch(this,function(){this._toggleScaling()})));this.own(l(this.rotationTxt,"keypress",e.hitch(this,function(a){(a.charCode||a.keyCode)===r.ENTER&&this.setRotation(this.rotationTxt.displayedValue)})));this.own(l(this.scaleTxt,"keypress",e.hitch(this,function(a){(a.charCode||a.keyCode)===r.ENTER&&this.setScale(this.scaleTxt.displayedValue)})))},setScale:function(a){var b=this.scaledValue;
isNaN(Number(a))||(this.scaleTxt.set("value",Number(a)),this.scaleTxt.set("value",Number(this.scaleTxt.displayedValue)));this.scaleTxt.isValid()?this.scaleGeometries():(this.scaleTxt.set("value",Number(b)),this.scaleTxt.set("value",Number(this.scaleTxt.displayedValue)))},scaleGeometries:function(){var a;a=Number(this.scaleTxt.get("value"));isNaN(a)||(this.scaledValue=a,this.emit("scaleGeometries",a))},setRotation:function(a){var b=this.rotationAngle;isNaN(Number(a))||(this.rotationTxt.set("value",
Number(a)),this.rotationTxt.set("value",Number(this.rotationTxt.displayedValue)));this.rotationTxt.isValid()?this.rotateGeometries():(this.rotationTxt.set("value",Number(b)),this.rotationTxt.set("value",Number(this.rotationTxt.displayedValue)))},rotateGeometries:function(){var a;a=Number(this.rotationTxt.get("value"));isNaN(a)||(this.rotationAngle=a,this.emit("rotateGeometries",a))},resetTools:function(){this.rotationAngle=0;this.scaledValue=1;this.rotationTxt.set("value",Number(0));this.scaleTxt.set("value",
Number(1))},_toggleRotating:function(){p.contains(this.rotateButton.parentElement,"esriCTDisableButton")?(p.remove(this.rotateButton.parentElement,"esriCTDisableButton"),this.disableScaling(),this.emit("toggleRotating",!0)):(this.disableRotating(),this.emit("toggleRotating",!1))},_toggleScaling:function(){p.contains(this.scaleButton.parentElement,"esriCTDisableButton")?(p.remove(this.scaleButton.parentElement,"esriCTDisableButton"),this.disableRotating(),this.emit("toggleScaling",!0)):(this.disableScaling(),
this.emit("toggleScaling",!1))},disableRotating:function(){p.add(this.rotateButton.parentElement,"esriCTDisableButton")},disableScaling:function(){p.add(this.scaleButton.parentElement,"esriCTDisableButton")}})})},"widgets/ParcelDrafter/PlanInfo":function(){define("dojo/_base/declare jimu/BaseWidget dijit/_WidgetsInTemplateMixin dojo/text!./PlanInfo.html dojo/_base/lang dojo/_base/array dojo/Evented dojo/dom-class dijit/form/ValidationTextBox dojo/store/Memory dijit/form/ComboBox dojo/on esri/geometry/Polyline esri/graphic esri/tasks/query esri/tasks/QueryTask jimu/dijit/Message ./geometryUtils".split(" "),
function(g,b,a,d,e,f,p,l,r,v,q,k,n,w,E,D,F,u){return g([b,a,p],{baseClass:"jimu-widget-ParcelDrafter-PlanInfo",templateString:d,_itemList:null,_polygonLayer:null,parcelNameTextBox:null,planNameTextBox:null,documentTypeControl:null,planSettings:null,_savedPolygonObjectId:null,_savedPolyLines:null,constructor:function(a){e.mixin(this,a)},postCreate:function(){this.inherited(arguments);l.add(this.domNode,"esriCTFullWidth");this.config.polygonLayer.documentType.hasOwnProperty("name")&&(l.remove(this.documentTypeRow,
"esriCTHidden"),this._createDocumentTypeControl());this.config.polygonLayer.parcelName.hasOwnProperty("name")&&(l.remove(this.parcelNameRow,"esriCTHidden"),this.parcelNameTextBox=this._createFieldInputs(this.config.polygonLayer.parcelName,this.parcelName,this.nls.planInfo.parcelNamePlaceholderText,!this.config.polygonLayer.parcelName.nullable));this.config.polygonLayer.planName.hasOwnProperty("name")&&(l.remove(this.planNameRow,"esriCTHidden"),this.planNameTextBox=this._createFieldInputs(this.config.polygonLayer.planName,
this.planName,this.nls.planInfo.planNamePlaceholderText,!this.config.polygonLayer.planName.nullable));this.own(k(this.planInfoCancelButton,"click",e.hitch(this,function(){this.emit("cancelTraversedParcel")})));this.own(k(this.planInfoSaveButton,"click",e.hitch(this,function(){this.emit("saveTraversedParcel")})));this.own(k(this.planInfoDeleteButton,"click",e.hitch(this,this.deleteParcel)))},resetValues:function(){this.parcelNameTextBox&&this.parcelNameTextBox.set("value","");this.planNameTextBox&&
this.planNameTextBox.set("value","");this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",null):this.documentTypeControl.set("value",""));l.add(this.planInfoDeleteButton,"esriCTHidden")},_showMessage:function(a){this.emit("showMessage",a)},_createDocumentTypeControl:function(){this.config.polygonLayer.documentType.domain?(this.documentTypeControl=this._createFieldSelect(this.documentType,this.nls.planInfo.parcelDocumentTypeText,!this.config.polygonLayer.documentType.nullable),
this.own(k(this.documentTypeControl,"change",e.hitch(this,function(a){""===a||null===a||void 0===a||this.documentTypeControl.store.data.some(function(b){return b.name===a})||(this.documentTypeControl.set("item",null),this._showMessage(this.nls.planInfo.enterValidDocumentTypeMessage))})))):this.documentTypeControl=this._createFieldInputs(this.config.polygonLayer.documentType,this.documentType,this.nls.planInfo.parcelDocumentTypeText,!this.config.polygonLayer.documentType.nullable)},_createFieldInputs:function(a,
b,d,k){d=k?d+" "+this.nls.planInfo.requiredText:d+" "+this.nls.planInfo.optionalText;d=new r({placeHolder:d,"class":"esriCTFullWidth",required:k});0<=this.numberFieldTypes.indexOf(a.type)&&(d.validator=e.hitch(this,function(b){return""===b||this.validateNumericField(b,a.type)?!0:!1}));d.placeAt(b);return d},_createFieldSelect:function(a,b,d){var m;m=this._createDocTypeDataArr();m=new v({data:m});b=d?b+" "+this.nls.planInfo.requiredText:b+" "+this.nls.planInfo.optionalText;return this.selectBox=new q({placeHolder:b,
"class":"esriCTFullWidth",required:d,store:m},a)},_createDocTypeDataArr:function(){var a=[];this.config.polygonLayer.documentType.domain.codedValues&&f.forEach(this.config.polygonLayer.documentType.domain.codedValues,e.hitch(this,function(b){a.push({name:b.name,id:b.code})}));return a},saveData:function(a){if(a.miscloseDetails&&(0===a.miscloseDetails.LengthConversions.meters||a.appliedCompassRule))this._saveParcel(a);else{var b;b=new F({message:this.nls.planInfo.saveNonClosedParcelConfirmationMessage,
type:"question",buttons:[{label:this.nls.common.yes,onClick:e.hitch(this,function(){b.close();this._saveParcel(a)})},{label:this.nls.common.no}]})}},_saveParcel:function(a){this._itemList=a.itemList;this.planSettings=a.planSettings;a.miscloseDetails&&(0===a.miscloseDetails.LengthConversions.meters||a.appliedCompassRule)?0===a.polygonDeleteArr.length?this._createPolygonData(a):this._deletePolygonBeforeSaving(a):0<a.polygonDeleteArr.length?this._deletePolygonBeforeSaving(a):this._createPolylineData(null)},
_createParcelPolygon:function(){var a,b,d,k,e;d=[];k=this.parcelLinesGraphicsLayer.graphics;for(a=0;a<k.length;a++)if(this._itemList[a].LineSymbol.type===this.config.BoundaryLineType)for(b=0;b<k[a].geometry.paths.length;b++)d.push(k[a].geometry.paths[b]);0<d.length&&(e=u.getPolygonFromPolyLines(d,!1,!0,k[0].geometry.spatialReference))&&(this.parcelPolygonGraphicsLayer.clear(),a=new w(e),this.parcelPolygonGraphicsLayer.add(a),e=this.parcelPolygonGraphicsLayer.graphics[0].geometry);return e},_createPolygonData:function(a){var b,
d,k,e,n;a.miscloseDetails&&(0===a.miscloseDetails.LengthConversions.meters||a.appliedCompassRule)?(this.loading.show(),b=[],d={},n=this.polygonLayerUnit,e=null,this.documentTypeControl&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.hasOwnProperty("item")&&this.documentTypeControl.item&&this.documentTypeControl.item.hasOwnProperty("id")&&(e=this.documentTypeControl.item.id):""!==this.documentTypeControl.get("value")&&(e=this.documentTypeControl.get("value"))),(k=this._createParcelPolygon())?
(d[this.config.polygonLayer.rotation.name]=a.rotation,d[this.config.polygonLayer.scale.name]=a.scale,d[this.config.polygonLayer.miscloseRatio.name]=a.miscloseDetails.miscloseValue,d[this.config.polygonLayer.miscloseDistance.name]=this._getValueAccToFeatureLayerUnit(n,a.miscloseDetails,"LengthConversions"),this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(d[this.config.polygonLayer.statedArea.name]=a.statedArea),this.parcelNameTextBox&&(d[this.config.polygonLayer.parcelName.name]=this.parcelNameTextBox.get("value")),
this.planNameTextBox&&(d[this.config.polygonLayer.planName.name]=this.planNameTextBox.get("value")),this.documentTypeControl&&(d[this.config.polygonLayer.documentType.name]=e),a=new w(k,null,d),b.push(a),this._saveParcelPolygon(b)):this._showMessage(this.nls.planInfo.unableToCreatePolygonParcel)):this._createPolylineData(null)},setParcelInformation:function(a,b){var d=this.map.getLayer(this.config.polygonLayer.id).objectIdField;this._savedPolygonObjectId=a[0].attributes[d];this._savedPolyLines=b;
l.remove(this.planInfoDeleteButton,"esriCTHidden");this.parcelNameTextBox&&this.parcelNameTextBox.set("value",a[0].attributes[this.config.polygonLayer.parcelName.name]);this.planNameTextBox&&this.planNameTextBox.set("value",a[0].attributes[this.config.polygonLayer.planName.name]);this.documentTypeControl&&(a=a[0].attributes[this.config.polygonLayer.documentType.name],null!==a&&""!==a&&void 0!==a&&(this.config.polygonLayer.documentType.domain?this.documentTypeControl.set("item",this.documentTypeControl.store.get(a)):
this.documentTypeControl.set("value",a)))},_rollbackSavedPolygon:function(){var a,b,d;b={attributes:{}};(a=this.map.getLayer(this.config.polygonLayer.id))&&null!==this._savedPolygonObjectId&&(b.attributes[a.objectIdField]=this._savedPolygonObjectId,d=a.applyEdits(null,null,[b]));return d},_rollbackSavedPolyLines:function(a){var b,d,k,n;d=[];b=this.map.getLayer(this.config.polylineLayer.id);f.forEach(a,e.hitch(this,function(a){k={attributes:{}};a.hasOwnProperty("objectId")?(k.attributes[b.objectIdField]=
a.objectId,d.push(k)):a.attributes.hasOwnProperty(b.objectIdField)&&(k.attributes[b.objectIdField]=a.attributes[b.objectIdField],d.push(k))}));b&&0<d.length&&(n=b.applyEdits(null,null,d));return n},_deletePolygonBeforeSaving:function(a){(this._polygonLayer=this.map.getLayer(this.config.polygonLayer.id))?this._polygonLayer.applyEdits(null,null,a.polygonDeleteArr,e.hitch(this,function(){this._deleteLinesBeforeSaving(a)}),e.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)})):
this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)},_deleteLinesBeforeSaving:function(a){var b;(b=this.map.getLayer(this.config.polylineLayer.id))?b.applyEdits(null,null,a.polylineDeleteArr,e.hitch(this,function(){this._createPolygonData(a)}),e.hitch(this,function(){this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)})):this._showMessage(this.nls.planInfo.unableToUpdateParcelLines)},_saveParcelPolygon:function(a){(this._polygonLayer=this.map.getLayer(this.config.polygonLayer.id))?
(this._savedPolygonObjectId=null,this._polygonLayer.applyEdits(a,null,null,e.hitch(this,function(a){a&&0<a.length&&a[0].success?(this._savedPolygonObjectId=a[0].objectId,this._polygonLayer.refresh(),a=new E,a.objectIds=[this._savedPolygonObjectId],a.returnGeometry=!1,a.outFields=[this.config.polygonLayer.relatedGUID.name],(new D(this._polygonLayer.url)).execute(a,e.hitch(this,function(a){this.loading.hide();this._createPolylineData(a.features[0].attributes[this.config.polygonLayer.relatedGUID.name])}),
e.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)}))):(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))}),e.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.unableToSavePolygonParcel)}))):(this.loading.hide(),this._showMessage(this.nls.planInfo.unableToSavePolygonParcel))},_getValueAccToFeatureLayerUnit:function(a,b,d){if(b.hasOwnProperty(d)&&b[d])switch(a){case "meters":case "degrees":return b[d].meters;
case "feet":return b[d].feet;case "uSSurveyFeet":return b[d].uSSurveyFeet;default:return null}else return null},_createPolylineData:function(a){var b,d,k,e,f,g;this.loading.show();f=this.parcelLinesGraphicsLayer.graphics;k=this.polylineLayerUnit;g=this._itemList;e=[];for(var l=0;l<f.length;l++)b={},d=g[l],b[this.config.polylineLayer.bearing.name]=d.BearingConversions.naDD,b[this.config.polylineLayer.distance.name]=this._getValueAccToFeatureLayerUnit(k,d,"LengthConversions"),b[this.config.polylineLayer.lineType.name]=
d.LineSymbol.type,b[this.config.polylineLayer.radius.name]=this._getValueAccToFeatureLayerUnit(k,d,"RadiusConversions"),null!==b[this.config.polylineLayer.radius.name]&&""!==b[this.config.polylineLayer.radius.name]&&void 0!==b[this.config.polylineLayer.radius.name]?(b[this.config.polylineLayer.arcLength.name]=this._getValueAccToFeatureLayerUnit(k,d,"ArcLengthConversions"),d=this._getValueAccToFeatureLayerUnit(k,d,"ChordLengthConversions"),b[this.config.polylineLayer.chordLength.name]=d,b[this.config.polylineLayer.distance.name]=
d):(b[this.config.polylineLayer.arcLength.name]=null,b[this.config.polylineLayer.chordLength.name]=null),b[this.config.polylineLayer.relatedGUID.name]=a,b[this.config.polylineLayer.sequenceId.name]=l,d=f[l].geometry.toJson(),d=new n(d),b=new w(d,null,b,null),e.push(b);this._saveParcelLines(e)},_saveParcelLines:function(a){var b;(b=this.map.getLayer(this.config.polylineLayer.id))?b.applyEdits(a,null,null,e.hitch(this,function(b){var d=[],k=[];f.forEach(b,function(a){a.success?k.push(a):d.push(a)});
0<d.length?(this._rollbackSavedPolygon(),0<k.length&&d.length!==a.length&&this._rollbackSavedPolyLines(k),this._showMessage(this.nls.planInfo.unableToSaveParcelLines)):(this._showMessage(this.nls.planInfo.parcelSavedSuccessMessage),this._savedPolygonObjectId=null,this.emit("displayMainPageAfterSave"));this.loading.hide()}),e.hitch(this,function(){this._rollbackSavedPolygon();this.loading.hide();this._showMessage(this.nls.planInfo.unableToSaveParcelLines)})):(this._rollbackSavedPolygon(),this.loading.hide(),
this._showMessage(this.nls.planInfo.unableToSaveParcelLines))},validateParcelDetails:function(a){var b={};if(this.parcelNameTextBox&&!this.parcelNameTextBox.isValid())return b.status=!1,b.message=this.nls.planInfo.enterValidParcelNameMessage,b;if(this.planNameTextBox&&!this.planNameTextBox.isValid())return b.status=!1,b.message=this.nls.planInfo.enterValidPlanNameMessage,b;if(this.documentTypeControl&&!this.documentTypeControl.isValid())return b.status=!1,b.message=this.nls.planInfo.enterValidDocumentTypeMessage,
b;if(this.config.polygonLayer.statedArea&&this.config.polygonLayer.statedArea.hasOwnProperty("name")&&(!this.config.polygonLayer.statedArea.nullable&&(null===a||""===a)||null!==a&&""!==a&&-1<this.numberFieldTypes.indexOf(this.config.polygonLayer.statedArea.type)&&!this.validateNumericField(a,this.config.polygonLayer.statedArea.type)))return b.status=!1,b.message=this.nls.planInfo.enterValidStatedAreaNameMessage,b;b.status=!0;return b},deleteParcel:function(){this.loading.show();this._rollbackSavedPolygon().then(e.hitch(this,
function(){this._rollbackSavedPolyLines(this._savedPolyLines).then(e.hitch(this,function(){this.loading.hide();this._showMessage(this.nls.planInfo.parcelDeletedSuccessMessage);this._savedPolygonObjectId=null;this.emit("displayMainPageAfterSave")}),e.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;this._showMessage(this.nls.planInfo.parcelDeleteErrorMessage);this.emit("displayMainPageAfterSave")}))}),e.hitch(this,function(){this.loading.hide();this._savedPolygonObjectId=null;
this._showMessage(this.nls.planInfo.parcelDeleteErrorMessage);this.emit("displayMainPageAfterSave")}))}})})},"widgets/ParcelDrafter/geometryUtils":function(){define("esri/geometry/Point esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils dojo/Deferred dojo/_base/array dojo/_base/lang esri/geometry/geometryEngine esri/SpatialReference esri/geometry/scaleUtils".split(" "),function(g,b,a,d,e,f,p,l,r,v){var q={getProjectedGeometry:function(a,b,f){var k,n;k=new e;d.canProject(a,
b)?(n=d.project(a,b),k.resolve(n)):f.project([a],b,function(a){n=a[0];k.resolve(n)});return k.promise},getDestinationPoint:function(a,b,d){var k=a.x*Math.PI/180,e=b*Math.PI/180;b=Math.sin(e);var e=Math.cos(e),n=.9966471893352243*Math.tan(a.y*Math.PI/180);a=1/Math.sqrt(1+n*n);var f=n*a,l=Math.atan2(n,e),n=a*b,m=1-n*n,w=2.7233160610984375E11*m/4.040829998465916E13,p=1+w/16384*(4096+w*(-768+w*(320-175*w))),q=w/1024*(256+w*(-128+w*(74-47*w))),v,C,y,z=d/(6356752.314245*p),A,I=0;do w=Math.cos(2*l+z),v=
Math.sin(z),C=Math.cos(z),y=q*v*(w+q/4*(C*(-1+2*w*w)-q/6*w*(-3+4*v*v)*(-3+4*w*w))),A=z,z=d/(6356752.314245*p)+y;while(1E-12<Math.abs(z-A)&&200>++I);if(200<=I)return console.log("Formula failed to converge"),null;d=f*v-a*C*e;d=Math.atan2(f*C+a*v*e,.9966471893352243*Math.sqrt(n*n+d*d));m=2.0955066654848088E-4*m*(4+.003352810664775694*(4-3*m));k=(k+(Math.atan2(v*b,a*C-f*v*e)-.003352810664775694*(1-m)*n*(z+m*v*(w+m*C*(-1+2*w*w))))+3*Math.PI)%(2*Math.PI)-Math.PI;d=180*d/Math.PI;k=180*k/Math.PI;return new g(k,
d,new r(4326))},getInverseCalculations:function(a,b){var d=b.x*Math.PI/180-a.x*Math.PI/180,k=.9966471893352243*Math.tan(a.y*Math.PI/180);a=1/Math.sqrt(1+k*k);var k=k*a,e=.9966471893352243*Math.tan(b.y*Math.PI/180);b=1/Math.sqrt(1+e*e);var e=e*b,n,f,g,m,l,p,r,q,v,y=d,z,A=0;do{n=Math.sin(y);f=Math.cos(y);g=b*n*b*n+(a*e-k*b*f)*(a*e-k*b*f);g=Math.sqrt(g);if(0==g)return{distance:0,initialBearing:0,finalBearing:0};m=k*e+a*b*f;l=Math.atan2(g,m);p=a*b*n/g;r=1-p*p;q=m-2*k*e/r;isNaN(q)&&(q=0);v=2.0955066654848088E-4*
r*(4+.003352810664775694*(4-3*r));z=y;y=d+.003352810664775694*(1-v)*p*(l+v*g*(q+v*m*(-1+2*q*q)))}while(1E-12<Math.abs(y-z)&&200>++A);if(200<=A)return null;y=2.7233160610984375E11*r/4.040829998465916E13;A=y/1024*(256+y*(-128+y*(74-47*y)));d=Math.atan2(b*n,a*e-k*b*f);a=Math.atan2(a*n,-k*b+a*e*f);d=(d+2*Math.PI)%(2*Math.PI);a=(a+2*Math.PI)%(2*Math.PI);k=Number((6356752.314245*(1+y/16384*(4096+y*(-768+y*(320-175*y))))*(l-A*g*(q+A/4*(m*(-1+2*q*q)-A/6*q*(-3+4*g*g)*(-3+4*q*q))))).toFixed(3));d=180*d/Math.PI;
a=180*a/Math.PI;return{distance:k,initialBearing:d,finalBearing:a}},getLineBetweenPoints:function(a){var d,k=[];f.forEach(a,p.hitch(this,function(a){k.push([q.removeNegativeExponents(a.x),q.removeNegativeExponents(a.y)])}));0<k.length&&(d=new b({paths:[k],spatialReference:{wkid:4326}}));return d},getAngleBetweenPoints:function(a,b){a=q.getInverseCalculations(a,b);return null===a?0:a.initialBearing},getDistanceBetweenPoints:function(a,b){a=q.getInverseCalculations(a,b);return null===a?0:a.distance},
getLengthOfGeometry:function(a){return(a=l.simplify(a))?l.geodesicLength(a,9001):0},getAreaOfGeometry:function(a){var b;a=l.simplify(a);b={};a?(b.acres=l.geodesicArea(a,109402),b.squareMeters=l.geodesicArea(a,109404),b.squareFeet=l.geodesicArea(a,109405),b.squareUSSurveyFeet=l.geodesicArea(a,109406)):(b.acres=0,b.squareMeters=0,b.squareFeet=0,b.squareUSSurveyFeet=0);return b},getPolyLineFromPaths:function(a){var d,e;d=new b(new r({wkid:4326}));for(e=0;e<a.length;e++)d.addPath(a[e]);return d},getPolygonFromPolyLines:function(b,
d,e,f){var k,g,n;k=[];f=f?new a(new r(f)):new a(new r({wkid:4326}));for(g=0;g<b.length;g++)for(n=0;n<b[g].length;n++)k.push(b[g][n]);d?k.push(p.clone(k[0])):e&&(k[k.length-1][0]=k[0][0],k[k.length-1][1]=k[0][1]);f.isClockwise(k)||k.reverse();f.addRing(k);return f},getPointsForArc:function(a,b,d,e){var k,f=[],g,n;k=b-a;b=parseInt(k,10);0>=b&&(b=1);g=Math.abs(k)/Math.abs(b);if(0<g)for(k=0;k<Math.abs(b)+1;k++)n=a+g*k,(n=q.getDestinationPoint(d,n,Math.abs(e)))&&f.push(n);return f},getArcParam:function(a){var b;
b={};0>a.distance?0>a.radius?(b.bearing=a.initBearing+90,b.centerPoint=q.getDestinationPoint(a.chordMidPoint,b.bearing,a.centerAndChordDistance),b.startAngle=q.getAngleBetweenPoints(b.centerPoint,a.chordEndPoint),b.endAngle=q.getAngleBetweenPoints(b.centerPoint,a.chordStartPoint)):(b.bearing=a.initBearing-90,b.centerPoint=q.getDestinationPoint(a.chordMidPoint,b.bearing,a.centerAndChordDistance),b.startAngle=q.getAngleBetweenPoints(b.centerPoint,a.chordStartPoint),b.endAngle=q.getAngleBetweenPoints(b.centerPoint,
a.chordEndPoint)):0<a.radius?(b.bearing=a.initBearing+90,b.centerPoint=q.getDestinationPoint(a.chordMidPoint,b.bearing,a.centerAndChordDistance),b.startAngle=q.getAngleBetweenPoints(b.centerPoint,a.chordStartPoint),b.endAngle=q.getAngleBetweenPoints(b.centerPoint,a.chordEndPoint)):(b.bearing=a.initBearing-90,b.centerPoint=q.getDestinationPoint(a.chordMidPoint,b.bearing,a.centerAndChordDistance),b.startAngle=q.getAngleBetweenPoints(b.centerPoint,a.chordEndPoint),b.endAngle=q.getAngleBetweenPoints(b.centerPoint,
a.chordStartPoint));return b},removeNegativeExponents:function(a){return 1<a.toString().toLowerCase().split("e-").length?0:a},getChordLengthFromArcLength:function(a,b){var d;a=Math.abs(a);d=Math.PI*Math.abs(b);b=Math.abs(b)*Math.sin(Math.abs(a)/Math.abs(b)/2);return a<=d?2*b:-2*b},getArcLengthFromChordLength:function(a,b){var d;d=Math.abs(a);b=Math.abs(b);d=2*Math.asin(d/(2*b))*b;0>a&&(d=2*Math.PI*b-d);return d},chordBearingToTangentBearing:function(a,b,d){var e;e=180/Math.PI*Math.acos(Math.abs(d)/
2/Math.abs(b));b/=Math.abs(b);a=a+90*b-d/Math.abs(d)*b*e;return q.removeNegativeExponents(0>a?a+360:360<=a?a%360:a)},tangentBearingToChordBearing:function(a,b,d){var e;e=180/Math.PI*Math.acos(Math.abs(d)/2/Math.abs(b));b/=Math.abs(b);a=a+90*b-d/Math.abs(d)*b*e;return q.removeNegativeExponents(0>a?a+360:360<=a?a%360:a)},getUnitValueForSR:function(a){switch(v.getUnitValueForSR(a)){case 1:return"meters";case 111194.87428468118:return"meters";case .3048:return"feet";case .3048006096:case .3048006096012192:return"uSSurveyFeet"}},
getRotationAngleBetweenPoints:function(a,b){var e,f;a=d.project(a,new r(102100));b=d.project(b,new r(102100));e=b.x-a.x;a=b.y-a.y;b=180*Math.atan2(Math.abs(e),Math.abs(a))/Math.PI;f=180*Math.atan2(Math.abs(a),Math.abs(e))/Math.PI;e=q.removeNegativeExponents(e);a=q.removeNegativeExponents(a);b=q.removeNegativeExponents(b);f=q.removeNegativeExponents(f);if(0===a){if(0===e)return 0;if(0<e)return 90;if(0>e)return 270}else if(0<a){if(0===e)return 0;if(0<e)return b;if(0>e)return 270+f}else if(0>a){if(0===
e)return 180;if(0<e)return 90+f;if(0>e)return 180+b}},getScaleDistanceBetweenPoints:function(a,b){a=d.project(a,new r(102100));b=d.project(b,new r(102100));a=l.distance(a,b,9001);return q.removeNegativeExponents(a)}};return q})},"widgets/ParcelDrafter/MapTooltipHandler":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/Evented dojo/dom-style dojo/dom-construct dojo/on".split(" "),function(g,b,a,d,e,f,p){return g([b,d],{baseClass:"jimu-widget-ParcelDrafter-MapTooltipHandler",
map:null,handleClickFor:null,_mapTooltip:null,_mapMoveHandler:null,_mapClickHandler:null,_mouseDragHandler:null,constructor:function(b){a.mixin(this,b)},startup:function(){this.handleClickFor||(this.handleClickFor=this.map);this._createTooltip()},connectEventHandler:function(b){b&&this.updateTooltip(b);this._disableWebMapPopup();this._mapClickHandler=this.own(p(this.handleClickFor,"click",a.hitch(this,function(a){this._clicked(a)})))[0];"ontouchstart"in document.documentElement?e.set(this._mapTooltip,
"display","none"):(this._mapMoveHandler=this.own(this.map.on("mouse-move",a.hitch(this,this._onMapMouseMove)))[0],this.own(this.map.on("mouse-out",a.hitch(this,function(){e.set(this._mapTooltip,"display","none")}))))},disconnectEventHandler:function(){this._enableWebMapPopup();this._mapClickHandler&&this._mapClickHandler.remove();this._mapMoveHandler&&(this._mapMoveHandler.remove(),this._mapTooltip.style.display="none");this.disconnectMouseDragHandler()},connectMouseDragHandler:function(b){b&&this.updateTooltip(b);
this._disableWebMapPopup();this._mapClickHandler&&this._mapClickHandler.remove();this.map.disableMapNavigation();this._mouseDragHandler=this.own(this.map.on("mouse-drag",a.hitch(this,function(a){this._onDragging(a)})))[0]},disconnectMouseDragHandler:function(){this._mouseDragHandler&&(this._mouseDragHandler.remove(),this._mapTooltip.style.display="none");this.map.enableMapNavigation()},_createTooltip:function(){this._mapTooltip=f.create("div",{"class":"esriCTMapTooltip",innerHTML:this.toolTipText},
this.map.container);e.set(this._mapTooltip,"position","fixed");e.set(this._mapTooltip,"display","none")},_enableWebMapPopup:function(){this.map&&(this.map.infoWindow.hide(),this.map.setInfoWindowOnClick(!0))},_disableWebMapPopup:function(){this.map&&(this.map.infoWindow.hide(),this.map.setInfoWindowOnClick(!1))},_onMapMouseMove:function(a){var b,d;a.clientX||a.pageY?(b=a.clientX,d=a.clientY):(b=a.clientX+document.body.scrollLeft-document.body.clientLeft,d=a.clientY+document.body.scrollTop-document.body.clientTop);
e.set(this._mapTooltip,"display","none");e.set(this._mapTooltip,{left:b+15+"px",top:d+"px"});e.set(this._mapTooltip,"display","");this._onMoving(a)},_clicked:function(a){this.emit("clicked",a)},_onDragging:function(a){this.emit("dragging",a)},_onMoving:function(a){this.emit("moving",a)},updateTooltip:function(a){this.toolTipText=a;this._mapTooltip.innerHTML=this.toolTipText}})})},"widgets/ParcelDrafter/layerUtils":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/_base/array","dojo/_base/lang"],
function(g,b,a,d){return g([b],{map:null,getPopupInfo:!0,getRenderer:!0,postCreate:function(){},getLayerDetailsFromMap:function(b,f,g){var e={},p;this.map&&this.map.webMapResponse&&this.map.webMapResponse.itemInfo&&this.map.webMapResponse.itemInfo.itemData&&this.map.webMapResponse.itemInfo.itemData.operationalLayers&&a.forEach(this.map.webMapResponse.itemInfo.itemData.operationalLayers,d.hitch(this,function(l){l.layerObject&&("ArcGISMapServiceLayer"===l.layerType||"ArcGISTiledMapServiceLayer"===l.layerType?
(p=g&&g.substring(0,g.lastIndexOf("_")),p&&l.id!==p||(e.isMapServer=!0,b.substring(0,b.length-1)===l.url&&(a.forEach(l.resourceInfo.layers,d.hitch(this,function(a){a.id===parseInt(f,10)&&(e.title=a.name)})),a.forEach(l.layers,d.hitch(this,function(a){a.id===parseInt(f,10)&&(a.name&&(e.title=a.name),this.getPopupInfo&&(e.popupInfo=a.popupInfo),a.layerDefinition&&(a.layerDefinition.definitionExpression&&(e.definitionExpression=a.layerDefinition.definitionExpression),this.getRenderer&&a.layerDefinition.drawingInfo&&
a.layerDefinition.drawingInfo.renderer&&(e.renderer=a.layerDefinition.drawingInfo.renderer)))}))))):g&&l.id!==g||l.url.replace(/.*?:\/\//g,"").toLowerCase()!==(b+f).replace(/.*?:\/\//g,"").toLowerCase()||l.id!==g||(e.isMapServer=!1,e.title=l.title,this.getPopupInfo&&(e.popupInfo=l.popupInfo),l.layerDefinition&&(l.layerDefinition.definitionExpression&&(e.definitionExpression=l.layerDefinition.definitionExpression),this.getRenderer&&l.layerDefinition.drawingInfo&&l.layerDefinition.drawingInfo.renderer&&
(e.renderer=l.layerDefinition.drawingInfo.renderer))))}));return e}})})},"widgets/ParcelDrafter/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/ParcelDrafter/PlanSettings.html":'\x3cdiv\x3e\r\n    \x3c!-- Direction or Angle Type Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.directionOrAngleTypeLabel}"\x3e\r\n            ${nls.planSettings.directionOrAngleTypeLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"directionOrAngleType" style\x3d"width: 100%" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Direction or Angle Units Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.directionOrAngleUnitsLabel}"\x3e\r\n            ${nls.planSettings.directionOrAngleUnitsLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"directionOrAngleUnits" style\x3d"width: 100%" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Distance and Length Units Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.distanceAndLengthUnitsLabel}"\x3e\r\n            ${nls.planSettings.distanceAndLengthUnitsLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"distanceAndLengthUnits" style\x3d"width: 100%" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Area Units Selector--\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.areaUnitsLabel}"\x3e\r\n            ${nls.planSettings.areaUnitsLabel}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"areaUnits" style\x3d"width: 100%" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Circular Curve Parameters Selector --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow"\x3e\r\n        \x3cdiv class\x3d"esriCTDropdownLabel esriCTEllipsis" title\x3d"${nls.planSettings.circularCurveParameters}"\x3e\r\n            ${nls.planSettings.circularCurveParameters}\x3c/div\x3e\r\n        \x3cselect data-dojo-attach-point\x3d"circularCurveParameters" style\x3d"width: 100%" data-dojo-type\x3d"dijit/form/Select"\x3e\r\n        \x3c/select\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/XYInput.html":'\x3cdiv class\x3d"esriCTAlignCenter" data-dojo-attach-point\x3d"newTraverseXYInputNode"\x3e\r\n  \x3cdiv class\x3d"xyRowWrapper" data-dojo-attach-point\x3d"xRowWrapper"\x3e\r\n    X: \x3cdiv data-dojo-attach-point\x3d"newTraverseX" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"xyRowWrapper" data-dojo-attach-point\x3d"yRowWrapper"\x3e\r\n    Y: \x3cdiv data-dojo-attach-point\x3d"newTraverseY" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"jimu-btn jimu-trailing-margin1" title\x3d"${nls.newTraverseButtonLabel}" data-dojo-attach-point\x3d"xyStartButton"\x3e\r\n    ${nls.newTraverseButtonLabel}\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/ParcelDrafter/NewTraverse.html":'\x3cdiv\x3e\r\n    \x3c!-- Traverse grid container--\x3e\r\n    \x3cdiv class\x3d"esriCTNewTraverseContainer"\x3e\r\n        \x3c!-- Traverse grid title--\x3e\r\n        \x3cdiv class\x3d"esriCTNewTraverseLabelDiv"\x3e\r\n            \x3cdiv class\x3d"esriCTGridEmptyLabel"\x3e\r\n                \x26nbsp\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis esriCTGridBearingLabel" title\x3d"${nls.traverseSettings.bearingLabel}"\x3e\r\n                ${nls.traverseSettings.bearingLabel}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.lengthLabel}"\x3e\r\n                ${nls.traverseSettings.lengthLabel}\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTGridLabels esriCTEllipsis" title\x3d"${nls.traverseSettings.radiusLabel}"\x3e\r\n                ${nls.traverseSettings.radiusLabel}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid items--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"traverseGrid" class\x3d"esriCTTraverseGrid"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid initial entry row--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"traverseEntryNode" class\x3d"esriCTEntrtyNodeContent esriCTRow"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"lineSymbolNode" class\x3d"esriCTSymbolContainer"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"bearingNode" class\x3d"esriCTBearingRow" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"lengthNode" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"radiusNode" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTAddRow"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"addButton" class\x3d"esriCTAddIcon"\r\n                title\x3d"${nls.traverseSettings.addButtonTitle}"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Traverse grid tools container--\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseTool"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseToolContainer"\x3e\r\n                \x3c!-- Update rotation point tool--\x3e\r\n                \x3cdiv class\x3d"esriCTTraverseToolIcons ecriCTUpdateRotationPointIcon esriCTCursorPointer" title\x3d"${nls.planSettings.updateRotationPointTooltipText}"\r\n                    data-dojo-attach-point\x3d"updateRotationPointNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Screen digitization tool--\x3e\r\n                \x3cdiv class\x3d"esriCTTraverseToolIcons ecriCTLocationIcon esriCTCursorPointer" title\x3d"${nls.planSettings.onScreenDigitizationTooltipText}"\r\n                    data-dojo-attach-point\x3d"screenDigitizationNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Zoom tool--\x3e\r\n                \x3cdiv class\x3d"esriCTHidden esriCTTraverseToolIcons ecriCTZoomToIcon esriCTCursorPointer" title\x3d"${nls.planSettings.zoomToLocationTooltipText}"\r\n                    data-dojo-attach-point\x3d"zoomToNode"\x3e\r\n                \x3c/div\x3e\r\n                \x3c!-- Expand/Collapse grid tool--\x3e\r\n                \x3cdiv class\x3d"esriCTHidden  esriCTTraverseToolIcons esriCTCollapse esriCTCursorPointer" title\x3d"${nls.planSettings.collapseGridTooltipText}"\r\n                    data-dojo-attach-point\x3d"expandCollapseNode"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Misclose details container--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"misCloseDetailsNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Parcel tools (rotation/scale) container--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"parcelToolsNode"\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Parcel info (polygon layer fields) \x26 save/cancle button container--\x3e\r\n    \x3cdiv class\x3d"esriCTPlanInfoNode" data-dojo-attach-point\x3d"planInfoNode"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/MiscloseDetails.html":'\x3cdiv class\x3d"esriCTTraverseDetailContainer esriCTFullWidth" data-dojo-attach-point\x3d"traverseDetailsContainer"\x3e\r\n    \x3c!-- Message div shown when misclose is not calculated --\x3e\r\n    \x3cdiv class\x3d"esriCTTraverseResultContainer esriCTEllipsis"\r\n    data-dojo-attach-point\x3d"noMiscloseCalculated"\x3e\r\n        ${nls.traverseSettings.noMiscloseCalculated}\r\n    \x3c/div\x3e\r\n    \x3c!-- Misclose details container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTHidden" data-dojo-attach-point\x3d"miscloseDetailsContainer"\x3e\r\n        \x3c!-- Misclose Bearing Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseMiscloseBearingNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseMiscloseBearing}"\x3e\r\n                ${nls.traverseSettings.traverseMiscloseBearing}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv  esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"miscloseBearingNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Misclose Distance Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseDistanceNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseDistance}"\x3e\r\n                ${nls.traverseSettings.traverseDistance}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"miscloseDistanceNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Misclose Ratio Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseMiscloseRatioNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseMiscloseRatio}"\x3e\r\n                ${nls.traverseSettings.traverseMiscloseRatio}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"miscloseRatioNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Accuracy Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseAccuracyNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseAccuracy}"\x3e\r\n                ${nls.traverseSettings.traverseAccuracy}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"accuracyNode"\x3e\r\n                ${nls.traverseSettings.accuracyHigh}\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Stated Area Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer esriCTHidden" data-dojo-attach-point\x3d"traverseStatedAreaNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseStatedArea}"\x3e\r\n                ${nls.traverseSettings.traverseStatedArea}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"traverseStatedArea" style\x3d"font-weight:normal; width: 100px; height: 25px;" data-dojo-type\x3d"dijit/form/ValidationTextBox"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!-- Calculated Area Container --\x3e\r\n        \x3cdiv class\x3d"esriCTTraverseResultContainer" data-dojo-attach-point\x3d"traverseCalculatedAreaNode"\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis" title\x3d"${nls.traverseSettings.traverseCalculatedArea}"\x3e\r\n                ${nls.traverseSettings.traverseCalculatedArea}:\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseResultsDiv esriCTEllipsis esriCTTraversedValueDiv" data-dojo-attach-point\x3d"calculatedAreaNode"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/ParcelTools.html":'\x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n    \x3c!-- Rotation tool container--\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n        \x3cdiv class\x3d"esriCTRotationButton esriCTButtonIcon esriCTParcelToolButtonIcon esriCTCursorPointer" title\x3d" ${nls.parcelTools.rotationToolLabel}"\r\n            data-dojo-attach-point\x3d"rotateButton"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolButtonLabel esriCTEllipsis" title\x3d" ${nls.parcelTools.rotationToolLabel}"\x3e\r\n            ${nls.parcelTools.rotationToolLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolInputNode" data-dojo-type\x3d"dijit/form/NumberTextBox" trim\x3d"true" required\x3d"true" data-dojo-attach-point\x3d"rotationTxt"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Scale tool container--\x3e\r\n    \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n        \x3cdiv class\x3d"esriCTScaleButton esriCTButtonIcon esriCTParcelToolButtonIcon esriCTCursorPointer" title\x3d"${nls.parcelTools.scaleToolLabel}"\r\n            data-dojo-attach-point\x3d"scaleButton"\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolButtonLabel esriCTEllipsis" title\x3d"${nls.parcelTools.scaleToolLabel}"\x3e\r\n            ${nls.parcelTools.scaleToolLabel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTParcelToolInputNode" data-dojo-type\x3d"dijit/form/NumberTextBox" trim\x3d"true" required\x3d"true" data-dojo-attach-point\x3d"scaleTxt"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/PlanInfo.html":'\x3cdiv class\x3d"esriCTFullWidth"\x3e\r\n    \x3c!-- Parcel name input container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"parcelNameRow"\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"parcelName"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- DocumentType input container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"documentTypeRow"\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"documentType"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Plan name input container --\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingRow esriCTHidden" data-dojo-attach-point\x3d"planNameRow"\x3e\r\n        \x3cdiv class\x3d"esriCTFullWidth" data-dojo-attach-point\x3d"planName"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Save/Cancle button container --\x3e\r\n    \x3cdiv class\x3d"esriCTPlanInfoNode"\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1" title\x3d"${nls.common.save}" data-dojo-attach-point\x3d"planInfoSaveButton"\x3e\r\n            ${nls.common.save}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn jimu-trailing-margin1 esriCTHidden" title\x3d"${nls.common.deleteText}" data-dojo-attach-point\x3d"planInfoDeleteButton"\x3e\r\n            ${nls.common.deleteText}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTPlanInfoButton jimu-btn" title\x3d"${nls.common.cancel}" data-dojo-attach-point\x3d"planInfoCancelButton"\x3e\r\n            ${nls.common.cancel}\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/ParcelDrafter/Widget.html":'\x3cdiv style\x3d"height: calc(100% - 10px);" class\x3d"esriCTFullHeight" data-dojo-attach-point\x3d"mainNode"\x3e\r\n    \x3cdiv class\x3d"esriCTFullHeight esriCTFullWidth" data-dojo-attach-point\x3d"widgetMainNode"\x3e\r\n        \x3c!--Main Page Node--\x3e\r\n        \x3cdiv class\x3d"esirCTMainPage" data-dojo-attach-point\x3d"mainPageNode"\x3e\r\n            \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n                \x3cdiv class\x3d"esriCTButtonLabel esriCTEllipsis" title\x3d"${nls.newTraverseButtonLabel}"\x3e\r\n                    ${nls.newTraverseButtonLabel}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTNewTraverseButton esriCTButtonIcon esriCTCursorPointer" title\x3d"${nls.newTraverseButtonLabel}" data-dojo-attach-point\x3d"newTraverseButton"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTMainPageRow"\x3e\r\n                \x3cdiv class\x3d"esriCTButtonLabel esriCTEllipsis" title\x3d"${nls.editTraverseButtonLabel}"\x3e\r\n                    ${nls.editTraverseButtonLabel}\x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTEditTraverseButton esriCTButtonIcon esriCTCursorPointer" title\x3d"${nls.editTraverseButtonLabel}" data-dojo-attach-point\x3d"editTraverseButton"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"newTraverseSelectMessageNodeWrapper" class\x3d"esriCTHidden"\x3e\r\n              \x3cdiv class\x3d"esriCTMainPageRow esriCTAlignCenter" data-dojo-attach-point\x3d"newTraverseSelectMessageNode"\x3e\r\n              \x3c/div\x3e\r\n              \x3c!-- XYInput Widget get inserted here --\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--Traverse Page Node--\x3e\r\n        \x3cdiv class\x3d"esriCTFullHeight esriCTHidden" data-dojo-attach-point\x3d"traversePageNode"\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTNewTraverseHeader"\x3e\r\n                \x3cdiv class\x3d"esriCTBackButton esriCTCursorPointer" title\x3d"${nls.common.back}" data-dojo-attach-point\x3d"traversePanelBackButton"\x3e\r\n                    \x3cdiv class\x3d"esriCTItemLeftArrow"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.newTraverseTitle}"  data-dojo-attach-point\x3d"traverseTitleNode"\x3e\r\n                    ${nls.newTraverseTitle}\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTPlanSettingsIcon esriCTCursorPointer" title\x3d"${nls.planSettings.planSettingsTitle}" data-dojo-attach-point\x3d"planSettingsButton"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTTraverseNode" data-dojo-attach-point\x3d"traverseNode"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--Plan Settings Node--\x3e\r\n        \x3cdiv class\x3d"esriCTHidden esriCTFullHeight" data-dojo-attach-point\x3d"planSettingsPageNode"\x3e\r\n            \x3cdiv class\x3d"esriCTFullWidth esriCTPlanSettingHeader"\x3e\r\n                \x3cdiv class\x3d"esriCTBackButton esriCTCursorPointer" title\x3d"${nls.common.back}" data-dojo-attach-point\x3d"planSettingsPanelBackButton"\x3e\r\n                    \x3cdiv class\x3d"esriCTItemLeftArrow"\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"esriCTTitleDiv esriCTEllipsis" title\x3d"${nls.planSettings.planSettingsTitle}"\x3e\r\n                    ${nls.planSettings.planSettingsTitle}\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPlanSettingsNode" data-dojo-attach-point\x3d"planSettingsNode"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTWidgetErrorNode esriCTHidden" data-dojo-attach-point\x3d"widgetErrorNode"\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/ParcelDrafter/css/style.css":".esriCTMainContainer{min-width: 222px; height: 100%; -webkit-overflow-scrolling: touch; overflow: hidden;}.esriCTOverridePanelStyle{padding: 15px 0 0 0 !important;}.esriCTMapTooltip{width: 100px; word-wrap: break-word; border: 1px solid #7EABCD; background-color: white; padding: 5px; font-size: 9pt; z-index: 9999; -o-border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; border-radius: 4px;}.jimu-widget-ParcelDrafter .esriCTWidgetErrorNode{padding: 0px 20px;}.jimu-widget-ParcelDrafter .esriCTFullHeight{height: 100%;}.jimu-widget-ParcelDrafter .esriCTFullWidth{width: 100%;}.jimu-widget-ParcelDrafter .esriCTEllipsis{overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-ParcelDrafter .esriCTCursorPointer{cursor: pointer;}.jimu-widget-ParcelDrafter .esriCTCursorDefault{cursor: pointer;}.jimu-widget-ParcelDrafter .esriCTAlignCenter{text-align: center;}.jimu-widget-ParcelDrafter .esriCTMainPageRow{width: calc(100% - 40px); margin: 20px 20px 20px 20px; display: inline-block;}.jimu-widget-ParcelDrafter .esriCTButtonLabel{float: left; width: calc(100% - 45px); line-height: 35px; padding: 5px 5px 5px 0;}.jimu-widget-ParcelDrafter .esriCTEditTraverseButton{background: url(\"../images/edit-traverse.png\") no-repeat;}.jimu-widget-ParcelDrafter .esriCTNewTraverseButton{background: url(\"../images/new-traverse.png\") no-repeat;}.jimu-widget-ParcelDrafter .esriCTNewTraverseActive{background: url(\"../images/new-traverse-selected.png\") no-repeat; background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .esriCTEditTraverseActive{background: url(\"../images/edit-traverse-selected.png\") no-repeat; background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .esriCTButtonIcon{height: 45px; width: 45px; float: right; background-size: 45px;}.jimu-widget-ParcelDrafter .esriCTParcelToolButtonIcon{height: 45px; width: 45px; float: left; background-size: 45px 45px; background-color: #8e8e8e;}.esriRtl .jimu-widget-ParcelDrafter .esriCTButtonIcon{float: left;}.jimu-widget-ParcelDrafter .esriCTTraverseTool{float: left; padding: 5px 5px 0 0; width: calc(100% - 20px);}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseTool{float: right; padding: 5px 0 0 5px;}.jimu-widget-ParcelDrafter .esriCTTraverseToolContainer{float: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseToolContainer {float: left;}.jimu-widget-ParcelDrafter .esriCTTraverseToolIcons{height: 24px; width: 24px; background-size: 24px; float: left; background-repeat: no-repeat; margin: 5px 0px 5px 20px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseToolIcons{float: right; margin: 5px 20px 5px 0px;}.jimu-widget-ParcelDrafter .ecriCTLocationIcon{background-image: url('../images/digitization.png');}.jimu-widget-ParcelDrafter .ecriCTUpdateRotationPointIcon{background-image: url('../images/update-rotation.png');}.jimu-widget-ParcelDrafter .ecriCTLocationIcon.esriCTEnableButton{background-image: url('../images/digitization-selected.png'); background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .ecriCTUpdateRotationPointIcon.esriCTEnableButton{background-image: url('../images/update-rotation-selected.png'); background-color: #8e8e8e;}.jimu-widget-ParcelDrafter .ecriCTZoomToIcon{background-image: url('../images/zoom.png');}.jimu-widget-ParcelDrafter .esriCTCollapse{background-image: url('../images/collapse.png');}.jimu-widget-ParcelDrafter .esriCTExpand{background-image: url('../images/expand.png');}.jimu-widget-ParcelDrafter .esriCTNewTraverseHeader{float: left; height: 30px; border-bottom: 1px solid #464646; padding: 0px 10px;}.jimu-widget-ParcelDrafter .esriCTPlanSettingsIcon{background-image: url('../images/settings.png'); height: 20px; width: 20px; background-size: 20px; float: right; background-repeat: no-repeat;}.jimu-widget-ParcelDrafter .esriCTTraverseDetailContainer{float: left; border-top: 1px solid #464646; border-bottom: 1px solid #464646; margin-top: 20px; background-color: #E4E4ED;}.jimu-widget-ParcelDrafter .esriCTMiscloseHeaderDiv{background-color: rgba(0,0,0,0.5);}.jimu-widget-ParcelDrafter .esriCTTraverseResultContainer{width: 100%; height: 25px; line-height: 25px; padding: 0 10px; float: left; text-align: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseResultContainer{text-align: right;}.jimu-widget-ParcelDrafter .esriCTGridEmptyLabel{width: 50px; float: left; text-align: left;}.jimu-widget-ParcelDrafter .esriCTGridLabels{width: 70px; float: left; text-align: left; padding-left: 4px;}.jimu-widget-ParcelDrafter .esriCTGridBearingLabel{width: calc(100% - 210px);}.esriRtl .jimu-widget-ParcelDrafter .esriCTGridEmptyLabel{float: right; text-align: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTGridLabels{float: right; text-align: right; padding-right: 4px; padding-left: 0px;}.jimu-widget-ParcelDrafter .dijitTextBox .dijitInputInner{height: 21px;}.jimu-widget-ParcelDrafter .dijitTextBoxFocused .dijitInputContainer{background: transparent;}.jimu-widget-ParcelDrafter .esriCTTraverseResultsDiv{max-width: 49%; float: left; padding-right: 5px;}.jimu-widget-ParcelDrafter .esriCTTraversedValueDiv{font-weight: bold;}.jimu-widget-ParcelDrafter .esriCTNewTraverseGrid{height: calc(100% - 40px); overflow: auto;}.jimu-widget-ParcelDrafter .esriCTNewTraverseContainer{padding: 10px; width: 100%; display: inline-block;}.jimu-widget-ParcelDrafter .esriCTNewTraverseLabelDiv{display: inline-block; width: 100%;}.jimu-widget-ParcelDrafter .esriCTTraverseGrid{width: 100%; display: table; border-collapse: collapse;}.jimu-widget-ParcelDrafter .esriCTHidden{display: none;}::-ms-clear{display: none;}.jimu-widget-ParcelDrafter .esriCTRotationButton{background-image: url('../images/scale-rotation-active.png');}.jimu-widget-ParcelDrafter .esriCTScaleButton{background-image: url('../images/scale-active.png');}.jimu-widget-ParcelDrafter .esriCTDisableButton .esriCTParcelToolButtonIcon{background-color: inherit;}.jimu-widget-ParcelDrafter .esriCTDisableButton .esriCTRotationButton{background-image: url('../images/scale-rotation.png');}.jimu-widget-ParcelDrafter .esriCTDisableButton .esriCTScaleButton{background-image: url('../images/scale.png');}.jimu-widget-ParcelDrafter .esriCTParcelToolButtonLabel{float: left; max-width: calc(100% - 145px); line-height: 35px; padding: 5px 20px;}.jimu-widget-ParcelDrafter .esriCTParcelToolInputNode{width: 100px; height: 25px; margin-top: 10px; float: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelToolButtonIcon{float: right;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelToolInputNode{float: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTParcelToolButtonLabel{float: right;}.jimu-widget-ParcelDrafter .esriCTPlanInfoNode{margin: 0 4px; display: inline-block; width: calc(100% - 8px)}.jimu-widget-ParcelDrafter .esriCTPlanInfoButton{width: 80px; margin-top: 10px;}.jimu-widget-ParcelDrafter .esriCTPlanSettingsNode{width: 100%; height: calc(100% - 30px); display: inline-block; overflow-y: auto;}.jimu-widget-ParcelDrafter .esriCTPlanSettingsContainer{margin: 20px; display: inline-block; width: calc(100% - 40px);}.jimu-widget-ParcelDrafter .esriCTPlanSettingRow{padding-bottom: 20px;}.jimu-widget-ParcelDrafter .esriCTDropdownLabel{padding-bottom: 5px;}.jimu-widget-ParcelDrafter .esriCTPlanSettingHeader{float: left; height: 30px; border-bottom: 1px solid #464646; padding: 0px 10px;}.jimu-widget-ParcelDrafter .esriCTBackButton{width: 25%;}.jimu-widget-ParcelDrafter .esriCTTitleDiv{line-height: 10px; font-weight: bold; text-align: center; width: calc(100% - 50px); padding: 5px; display: inline-block;}.jimu-widget-ParcelDrafter .esriCTItemLeftArrow{background-image: url('../images/left-arrow.png'); float: left; margin: 0px 5px 0px 0px; width: 15px; height: 20px; background-repeat: no-repeat; background-position: center center;}.jimu-widget-ParcelDrafter .dijitSelect .dijitButtonContents{border-style: none none none none; background-color: #fafafc;}.jimu-widget-ParcelDrafter .dijitSelect .dijitButtonContentsDartTheme {background-color: inherit;}.jimu-widget-ParcelDrafter .dijitSelect .dijitArrowButton{background-color: #fafafc; background-image: none; border-color: #fafafc;}.jimu-widget-ParcelDrafter .dijitSelect .dijitArrowButtonDartTheme {background-color: rgba(0, 0, 0, 0.5) !important;}.jimu-widget-ParcelDrafter .dijitMenuItem{color: #7989a0;}.jimu-widget-ParcelDrafter .dijitSelect .dijitInputField{margin-right: 8px;}input[type\x3dtext]::-ms-clear{display: none;}.jimu-widget-ParcelDrafter .esriCTRow {clear: both; display: table-row; width: 100%;}.jimu-widget-ParcelDrafter .esriCTNewTraverseGrid{float: left; width: 100%; position: relative; text-align: center; margin: 10px 0px;}.jimu-widget-ParcelDrafter .dijitTextBox .dijitPlaceHolder{font-size: 12px;}.jimu-widget-ParcelDrafter .esriCTRow .dijitTextBox{margin: 0; width: 70px; display: table-cell;}.jimu-widget-ParcelDrafter .dijitTextBoxError {border-color: #d9dde0 !important; box-shadow: inset 0 0 0 2px #d46464;}.jimu-widget-ParcelDrafter .esriCTRow .dijitTextBoxHover{border-color: #d9dde0;}.jimu-widget-ParcelDrafter .esriCTRow .dijitTextBoxFocused{border-color: #d9dde0 !important; box-shadow: none; outline: none;}.jimu-widget-ParcelDrafter .esriCTBearingRow{width: calc(100% - 210px) !important;}.jimu-widget-ParcelDrafter .dojoDndItemAfter .esriCTSymbolContainer, .jimu-widget-ParcelDrafter .dojoDndItemBefore .esriCTSymbolContainer{background: #E4E4ED !important;}.jimu-widget-ParcelDrafter .dojoDndItem, .jimu-widget-demo .dojoDndItemAnchor, .jimu-widget-demo .dojoDndItemSelected, .dojoDndContainerOver, .dojoDndItemOver{background: none; border: none; padding: 0; cursor: move;}.jimu-widget-ParcelDrafter .esriCTDeleteRow, .jimu-widget-ParcelDrafter .esriCTAddRow{color: #CCC; display: table-cell; vertical-align: middle; font-size: 18px; width: 15px;}.jimu-widget-ParcelDrafter .esriCTDeleteIcon, .jimu-widget-ParcelDrafter .esriCTAddIcon{cursor: pointer; height: 30px; width: 15px; margin-left: 5px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTDeleteIcon,.esriRtl .jimu-widget-ParcelDrafter .esriCTAddIcon{margin-right: 5px; margin-left: 0;}.jimu-widget-ParcelDrafter .esriCTDeleteIcon{background: url('../images/delete.png') no-repeat center center;}.jimu-widget-ParcelDrafter .esriCTAddIcon{background: url('../images/add.png') no-repeat center center;}.jimu-widget-ParcelDrafter .esriCTEntryNodeContainer{float: left; width: 100%;}.jimu-widget-ParcelDrafter .esriCTEntrtyNodeContent{width: 100%; display: table; border-collapse: collapse;}.esriCTSymbolContainer{border: 1px solid #dedede; width: 50px; height: 30px; padding: 0px 5px; vertical-align: middle; display: table-cell;}.esriCTSymbolPopup .dijitTooltipContainer{padding: 0px;}.esriCTSymbolListContainer{max-height: 150px; overflow: auto; margin: 6px 0px; width: 170px;}.esriCTSymbolListContent{margin: 0px 6px;}.esriCTSelectedSymbol{width: 30px; height: 25px; overflow: hidden; margin-top: 4px; cursor: pointer;}.esriCTSymbolIcon{width: 35px; vertical-align: middle; margin: 2px 3px 0px 3px; overflow: hidden; display: inline-block;}.esriCTSymbolOption{height: 25px; width: 100%; cursor: pointer;}.esriCTSymbolOption:hover{background-color: #edf2f5;}.esriCTSymbolName{display: inline-block; white-space: nowrap; margin-left: 5px; overflow: hidden; text-overflow: ellipsis; width: 95px; color: #7989a0; vertical-align: middle;}.esriRtl .jimu-widget-ParcelDrafter .esriCTButtonLabel{float: right; padding: 5px 0px 5px 5px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTItemLeftArrow{float: right; margin: 0px 0px 00px 10px;}.esriRtl .jimu-widget-ParcelDrafter .esriCTPlanSettingsIcon{float: left;}.esriRtl .jimu-widget-ParcelDrafter .esriCTItemLeftArrow{background-image: url('../images/right-arrow.png');}.esriRtl .jimu-widget-ParcelDrafter .esriCTTraverseResultsDiv{float: right;}.esriRtl .jimu-widget-ParcelDrafter .dijitSelect .dijitInputField{margin-left: 8px; margin-right: 0;}.jimu-widget-ParcelDrafter .esriCTEditParcelDialog{position: absolute; width: 250px; z-index:100;}.jimu-widget-ParcelDrafter .esriCTParcelInfoPopup{display: table; border-collapse: collapse; width: 100%;}.jimu-widget-ParcelDrafter .esriCTParcelInfoLabels{height: 20px; display: table-cell; text-align: center; text-overflow: ellipsis; overflow: hidden; word-wrap: nowrap; margin-right: 5px;}.jimu-widget-ParcelDrafter .esriCTLabelRows{display: table-row;}.jimu-widget-ParcelDrafter .esriCTParcelInfoPopup .esriCTRowContainer{display: table-row;}.jimu-widget-ParcelDrafter .jimu-widget-ParcelDrafter-XYInput .xyRowWrapper {margin: 5px;}",
"*now":function(g){g(['dojo/i18n!*preload*widgets/ParcelDrafter/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare jimu/BaseWidget dojo/_base/array dojo/_base/lang dojo/dom-class dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/on ./PlanSettings ./XYInput ./NewTraverse ./MapTooltipHandler ./layerUtils esri/tasks/GeometryService jimu/dijit/Message jimu/dijit/LoadingIndicator esri/tasks/query esri/request".split(" "),function(g,b,a,d,e,f,p,l,r,v,q,k,n,w,E,D,F,u,x){return g([b],{baseClass:"jimu-widget-ParcelDrafter",_prevOpenPanel:"mainPage",_newTraverseInstance:null,_planSettingsInstance:null,
_mapTooltipHandler:null,_startPoint:null,geometryService:null,_lineLayerSpatialReference:null,_polygonLayerSpatialReference:null,_isUpdateStartPoint:null,_featureReductionEnabledLayers:[],postMixInProperties:function(){this.nls.common={};d.mixin(this.nls.common,window.jimuNls.common)},postCreate:function(){this.inherited(arguments);if(this.appConfig.geometryService){this.geometryService=new E(this.appConfig.geometryService);if(!this._isValidConfig())return this._showErrorInWidgetPanel(this.nls.invalidConfigMsg),
!1;this._layerUtils=new w({map:this.map,getPopupInfo:!0,getRenderer:!1});d.mixin(this.config.polylineLayer,this._layerUtils.getLayerDetailsFromMap(this.config.polylineLayer.baseURL,this.config.polylineLayer.layerId,this.config.polylineLayer.id));d.mixin(this.config.polygonLayer,this._layerUtils.getLayerDetailsFromMap(this.config.polygonLayer.baseURL,this.config.polygonLayer.layerId,this.config.polygonLayer.id));this._initLoading();this._getSpatialReferenceOfParcelLayers()}else this._showErrorInWidgetPanel(this.nls.geometryServiceURLNotFoundMSG)},
startup:function(){this.inherited(arguments);e.add(this.domNode.parentElement,"esriCTOverridePanelStyle");this._featureReductionEnabledLayers=[];a.forEach(this.config.snappingLayers,function(a){a=this.map.getLayer(a.id);a.isFeatureReductionEnabled&&a.isFeatureReductionEnabled()&&this._featureReductionEnabledLayers.push(a)},this)},onOpen:function(){this._mapTooltipHandler&&"mainPage"!==this._prevOpenPanel&&(this._isUpdateStartPoint=!0,this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdateStartPoint),
this._toggleSnapping(!0))},onActive:function(){a.forEach(this._featureReductionEnabledLayers,function(a){a.disableFeatureReduction()})},onDeActive:function(){a.forEach(this._featureReductionEnabledLayers,function(a){a.enableFeatureReduction()})},onClose:function(){if("planSettingsPage"===this._prevOpenPanel)this._planSettingsInstance.onClose();this._mapTooltipHandler&&(this._toggleSnapping(!1),this._mapTooltipHandler.disconnectEventHandler(),e.replace(this.newTraverseButton,"esriCTNewTraverseButton",
"esriCTNewTraverseActive"),e.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive"),this.newTraverseSelectMessageNode.innerHTML="",e.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden"),this._newTraverseInstance.deActivateDigitizationTool(),this._newTraverseInstance.deactivateParcelTools(),this._newTraverseInstance.closePopup())},destroy:function(){a.forEach(this._featureReductionEnabledLayers,function(a){a.enableFeatureReduction()});this.inherited(arguments)},
_initWidgetWorkFlow:function(){this._handleClickEvents();this._createMapTooltipHandler();this._createNewTraverse();this._createPlanSettings();this._createXYInput()},_isValidConfig:function(){var a;a=!0;this.config?(this.config.polygonLayer&&this.map.getLayer(this.config.polygonLayer.id)||(a=!1),this.config.polylineLayer&&this.map.getLayer(this.config.polylineLayer.id)||(a=!1)):a=!1;return a},_initLoading:function(){this.loading=new F({hidden:!0});this.loading.placeAt(this.domNode);this.loading.startup()},
_getSpatialReferenceOfParcelLayers:function(){var a;this.loading.show();x({url:this.config.polylineLayer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(d.hitch(this,function(b){this._lineLayerSpatialReference=b.extent.spatialReference;a=x({url:this.config.polygonLayer.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});a.then(d.hitch(this,function(a){this.loading.hide();this._polygonLayerSpatialReference=a.extent.spatialReference;this._initWidgetWorkFlow()}))}))},
_handleClickEvents:function(){this.own(r(this.planSettingsButton,"click",d.hitch(this,function(){this._showPanel("planSettingsPage")})));this.own(r(this.newTraverseButton,"click",d.hitch(this,function(){this._mapTooltipHandler.disconnectEventHandler();this._newTraverseInstance.clearAll();e.contains(this.newTraverseButton,"esriCTNewTraverseActive")?(this._toggleSnapping(!1),e.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive"),this.newTraverseSelectMessageNode.innerHTML=
"",e.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden")):(e.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive"),e.replace(this.newTraverseButton,"esriCTNewTraverseActive","esriCTNewTraverseButton"),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForStartNewTraverse),this._isUpdateStartPoint=!0,this._toggleSnapping(!0),this.newTraverseSelectMessageNode.innerHTML=this.nls.mapTooltipForStartNewTraverse,e.remove(this.newTraverseSelectMessageNodeWrapper,
"esriCTHidden"))})));this.own(r(this.editTraverseButton,"click",d.hitch(this,function(){this._mapTooltipHandler.disconnectEventHandler();this._newTraverseInstance.clearAll();e.contains(this.editTraverseButton,"esriCTEditTraverseActive")?(e.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive"),this.newTraverseSelectMessageNode.innerHTML="",e.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden")):(e.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive"),
e.replace(this.editTraverseButton,"esriCTEditTraverseActive","esriCTEditTraverseButton"),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForEditNewTraverse),this.newTraverseSelectMessageNode.innerHTML=this.nls.mapTooltipForEditNewTraverse)})));this.own(r(this.planSettingsPanelBackButton,"click",d.hitch(this,function(){this._planSettingsInstance.onClose();this._showPanel("traversePage")})));this.own(r(this.traversePanelBackButton,"click",d.hitch(this,this._confirmCancelTraverse)))},
_setSnappingLayers:function(){var a=[],b,d;if(this.config.snappingLayers&&this.config.snappingLayers.length)for(d=0;d<this.config.snappingLayers.length;d++)(b=this.map.getLayer(this.config.snappingLayers[d].id))&&a.push({layer:b});this._isUpdateStartPoint||this._newTraverseInstance.parcelPointsGraphicsLayer&&a.push({layer:this._newTraverseInstance.parcelPointsGraphicsLayer});this.map.snappingManager&&this.map.snappingManager.setLayerInfos(a)},_toggleSnapping:function(a){this.map.snappingManager&&
(this.map.snappingManager._deactivateSnapping(),this.map.disableSnapping());a&&!this.map.snappingManager&&(this.map.enableSnapping({tolerance:this.config.snappingTolerance,snapToEdge:!0,snapToPoint:!0,snapToVertex:!0,alwaysSnap:!0}),this._setSnappingLayers(),this.map.snappingManager._setUpSnapping())},_confirmCancelTraverse:function(){var a;this._newTraverseInstance.closePopup();a=new D({message:this.nls.clearingDataConfirmationMessage,type:"question",buttons:[{label:this.nls.common.yes,onClick:d.hitch(this,
function(){a.close();this._resetOnBackToMainPage()})},{label:this.nls.common.no}]})},_resetOnBackToMainPage:function(){this._startPoint=null;e.replace(this.newTraverseButton,"esriCTNewTraverseButton","esriCTNewTraverseActive");e.replace(this.editTraverseButton,"esriCTEditTraverseButton","esriCTEditTraverseActive");this.newTraverseSelectMessageNode.innerHTML="";e.add(this.newTraverseSelectMessageNodeWrapper,"esriCTHidden");this._toggleSnapping(!1);this._mapTooltipHandler.disconnectEventHandler();this._newTraverseInstance.clearAll();
this._showPanel("mainPage")},_createMapTooltipHandler:function(){this._mapTooltipHandler=new n({toolTipText:this.nls.mapTooltipForStartNewTraverse,map:this.map});this._isUpdateStartPoint=!0;this.own(this._mapTooltipHandler.on("clicked",d.hitch(this,function(a){var b;this.map&&this.map.snappingManager?(b=this.map.snappingManager.getSnappingPoint(a.screenPoint),b.then(d.hitch(this,function(b){this._onMapPointSelected(b?b:a.mapPoint)}))):this._onMapPointSelected(a.mapPoint)})));this.own(this._mapTooltipHandler.on("dragging",
d.hitch(this,function(a){this._startPoint&&(this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForRotate?this._newTraverseInstance.setRotation(a.mapPoint):this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForScale&&this._newTraverseInstance.setScaling(a.mapPoint))})));this.own(this._mapTooltipHandler.on("moving",d.hitch(this,function(a){this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForUpdateStartPoint&&this._startPoint&&this._newTraverseInstance._showParcelPopup(a).then(d.hitch(this,
function(a){a&&l.set(this._mapTooltipHandler._mapTooltip,"display","none")}))})));this._mapTooltipHandler.startup()},_onMapPointSelected:function(a){this._mapTooltipHandler.toolTipText!==this.nls.mapTooltipForUpdatingRotaionPoint&&(this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForScreenDigitization?this._newTraverseInstance.pointAddedFromDigitization(a):(this._startPoint||(this._mapTooltipHandler.toolTipText===this.nls.mapTooltipForEditNewTraverse?(this._startPoint=a,this._getPolygonForEdits(a)):
(f.set(this.traverseTitleNode,"innerHTML",this.nls.newTraverseTitle),f.set(this.traverseTitleNode,"title",this.nls.newTraverseTitle),this._showPanel("traversePage"),this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint))),this._startPoint=a,this._newTraverseInstance.setStartPoint(this._startPoint,!0,!0)))},_getPolygonForEdits:function(a){var b,e;this.loading.show();e=(new Date).getTime();b=new u;b.geometry=a;b.outSpatialReference=this.map.spatialReference;b.returnGeometry=!1;
b.outFields=["*"];b.where=e+"\x3d"+e;(a=this.map.getLayer(this.config.polygonLayer.id))?a.queryFeatures(b,d.hitch(this,function(a){this.loading.hide();if(a&&0<a.features.length)for(this._newTraverseInstance.polygonDeleteArr=a.features;0<a.features.length;){this._getLinesForEdits(a.features[0]);break}else this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelMessage)}),d.hitch(this,function(){this.loading.hide();this._startPoint=null;this._showMessage(this.nls.unableToFetchParcelMessage)})):
(this.loading.hide(),this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelMessage))},_sortFeatureAccToSequenceID:function(a){var b;b=this.config.polylineLayer.sequenceId.name;a.sort(function(a,d){return a.attributes[b]-d.attributes[b]});return a},_getLinesForEdits:function(a){var b;this.loading.show();b=a.attributes[this.config.polygonLayer.relatedGUID.name];a=new u;a.outSpatialReference=this.map.spatialReference;a.returnGeometry=!0;a.outFields=["*"];a.where=this.config.polylineLayer.relatedGUID.name+
"\x3d'"+b+"'";(b=this.map.getLayer(this.config.polylineLayer.id))?b.queryFeatures(a,d.hitch(this,function(a){this.loading.hide();a&&0<a.features.length?(a.features=this._sortFeatureAccToSequenceID(a.features),this._newTraverseInstance.polylineDeleteArr=a.features,this._startPoint=a.features[0].geometry.getPoint(0,0),f.set(this.traverseTitleNode,"innerHTML",this.nls.editTraverseTitle),f.set(this.traverseTitleNode,"title",this.nls.editTraverseTitle),this._newTraverseInstance.initEditing(this._startPoint,
a,this._lineLayerSpatialReference),this._toggleSnapping(!0),this._showPanel("traversePage"),this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint)):(this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelLinesMessage))}),d.hitch(this,function(){this.loading.hide();this._startPoint=null;this._showMessage(this.nls.unableToFetchParcelLinesMessage)})):(this.loading.hide(),this._startPoint=null,this._showMessage(this.nls.unableToFetchParcelLinesMessage))},_createNewTraverse:function(){this._newTraverseInstance=
new k({nls:this.nls,config:this.config,map:this.map,loading:this.loading,geometryService:this.geometryService,appConfig:this.appConfig,lineLayerSpatialReference:this._lineLayerSpatialReference,polygonLayerSpatialReference:this._polygonLayerSpatialReference},this.traverseNode);this.own(this._newTraverseInstance.on("showMessage",d.hitch(this,this._showMessage)));this.own(this._newTraverseInstance.on("activateDigitizationTool",d.hitch(this,function(){this._onActivateDigitization()})));this.own(this._newTraverseInstance.on("deActivateDigitizationTool",
d.hitch(this,function(){this._onDeactivateDigitization()})));this.own(this._newTraverseInstance.on("activateUpdateRotationPointTool",d.hitch(this,function(){this._onActivateUpdateRotationPoint()})));this.own(this._newTraverseInstance.on("deActivateUpdateRotationPointTool",d.hitch(this,function(){this._onDeactivateUpdateRotationPoint()})));this.own(this._newTraverseInstance.on("cancelTraverse",d.hitch(this,function(){this._confirmCancelTraverse()})));this.own(this._newTraverseInstance.on("displayMainPageAfterSave",
d.hitch(this,function(){this._resetOnBackToMainPage()})));this.own(this._newTraverseInstance.on("toggleRotating",d.hitch(this,function(a){this._toggleRotating(a)})));this.own(this._newTraverseInstance.on("toggleScaling",d.hitch(this,function(a){this._toggleScaling(a)})))},_toggleRotating:function(a){a?(this._mapTooltipHandler.connectMouseDragHandler(this.nls.mapTooltipForRotate),this._newTraverseInstance.deActivateDigitizationTool(),this._newTraverseInstance.deActivateUpdateRotationPointTool()):(this._isUpdateStartPoint=
!0,this._mapTooltipHandler.disconnectEventHandler(),this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdateStartPoint));this._toggleSnapping(!a)},_toggleScaling:function(a){a?(this._mapTooltipHandler.connectMouseDragHandler(this.nls.mapTooltipForScale),this._newTraverseInstance.deActivateDigitizationTool(),this._newTraverseInstance.deActivateUpdateRotationPointTool()):(this._newTraverseInstance.distance=null,this._isUpdateStartPoint=!0,this._mapTooltipHandler.disconnectEventHandler(),
this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdateStartPoint));this._toggleSnapping(!a)},_onActivateDigitization:function(){this._mapTooltipHandler.disconnectEventHandler();this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForScreenDigitization);this._newTraverseInstance.deactivateParcelTools();this._isUpdateStartPoint=!1;this._toggleSnapping(!0)},_onDeactivateDigitization:function(){this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint);this._isUpdateStartPoint=
!0;this._toggleSnapping(!0)},_onActivateUpdateRotationPoint:function(){this._mapTooltipHandler.disconnectEventHandler();this._mapTooltipHandler.connectEventHandler(this.nls.mapTooltipForUpdatingRotaionPoint);this._newTraverseInstance.deactivateParcelTools();this._isUpdateStartPoint=!1;this._toggleSnapping(!0)},_onDeactivateUpdateRotationPoint:function(){this._mapTooltipHandler.updateTooltip(this.nls.mapTooltipForUpdateStartPoint);this._isUpdateStartPoint=!0;this._toggleSnapping(!0)},_createPlanSettings:function(){this._planSettingsInstance=
new v({nls:this.nls,config:this.config,appConfig:this.appConfig,widgetId:this.id},p.create("div",{},this.planSettingsNode));this.own(this._planSettingsInstance.on("planSettingsChanged",d.hitch(this,function(a){this._newTraverseInstance.updateAccordingToPlanSettings(a)})));this._planSettingsInstance.startup()},_createXYInput:function(){this._xyInputInstance=(new q({nls:this.nls,config:this.config,appConfig:this.appConfig,map:this.map})).placeAt(this.newTraverseSelectMessageNodeWrapper,"last");this.own(this._xyInputInstance.on("newPoint",
d.hitch(this,function(a){this._onMapPointSelected(a)})));this._xyInputInstance.startup()},_showPanel:function(a){var b;this._prevOpenPanel&&(b=this._getNodeByName(this._prevOpenPanel),e.add(b,"esriCTHidden"));b=this._getNodeByName(a);e.remove(b,"esriCTHidden");this._prevOpenPanel=a},_showMessage:function(a){(new D({message:a,buttons:[{label:this.nls.common.ok}]})).message=a},_showErrorInWidgetPanel:function(a){f.set(this.widgetErrorNode,"innerHTML",a);e.add(this.widgetMainNode,"esriCTHidden");e.remove(this.widgetErrorNode,
"esriCTHidden")},_getNodeByName:function(a){var b;switch(a){case "mainPage":b=this.mainPageNode;break;case "traversePage":b=this.traversePageNode;break;case "planSettingsPage":b=this.planSettingsPageNode}return b}})});