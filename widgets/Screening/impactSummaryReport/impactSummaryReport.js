// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Screening/impactSummaryReport/impactSummaryReport.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"esriCTImpactSummaryLayerContainer" data-dojo-attach-point\x3d"impactSummaryLayerContainer"\x3e\r\n    \x3c!--title \x26 field icon table--\x3e\r\n    \x3cdiv class\x3d"esriCTLayerTitleAndFieldParentContainer esriCTLayerSectionDisabled esriCTCursorPointer" data-dojo-attach-point\x3d"layerTitleAndFieldParentContainer"\x3e\r\n      \x3c!--title \x26 field icon row--\x3e\r\n      \x3cdiv class\x3d"esriCTLayerTitleAndFieldChildContainer"\x3e\r\n        \x3cdiv class\x3d"esriCTLayerPanelIcon esriCTLayerPanelExpand" data-dojo-attach-point\x3d"layerSectionIcon"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--title--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerTitle" data-dojo-attach-point\x3d"impactSummaryLayerTitle"\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--field icon--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerFieldIcon esriCTImpactSummaryLayerFieldIconDisabled" data-dojo-attach-point\x3d"impactSummaryLayerField"\r\n          title\x3d"${nls.reportsTab.attributeChooserTooltip}"\x3e\x3c/div\x3e\r\n        \x3c!--feature count--\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerFeatureCount esriCTLoadingIcon" data-dojo-attach-point\x3d"impactSummaryLayerFeatureCount"\x3e\x3c/div\x3e\r\n        \x3c!-- Hint for count exceeding max record count --\x3e\r\n        \x3cdiv class\x3d"esriCTImpactSummaryLayerMaxRecordHint esriCTHidden" title\x3d"${nls.reportsTab.unableToAnalyzeText}" data-dojo-attach-point\x3d"impactSummaryLayerMaxRecordHint"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--layer description--\x3e\r\n    \x3cdiv class\x3d"esriCTImpactSummaryLayerDetailContainer esriCTHidden" data-dojo-attach-point\x3d"impactSummaryLayerDetailContainer"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"impactSummaryLayerDetailsMsg"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"impactSummaryLayerDetails"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noFieldsSelectedContainer" class\x3d"esriCTNoFieldSelectedContainer esriCTHidden"\x3e\r\n        ${nls.reportsTab.noFieldsSelected}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/text!./impactSummaryReport.html dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/array dojo/Evented jimu/BaseWidget dojo/on dojo/dom-class dojo/dom-attr esri/geometry/geometryEngine esri/geometry/Polyline esri/SpatialReference esri/graphic dojo/dom-construct esri/tasks/query esri/tasks/QueryTask dojo/Deferred ../geometryUtils ../conversionUtils ../highlightSymbolUtils ../fieldSelectorPopup/fieldSelectorPopup esri/lang jimu/utils dojo/query dojo/number dojo/promise/all".split(" "),
function(A,B,C,g,l,D,E,n,h,m,q,F,G,v,p,w,x,t,y,H,I,J,K,r,z,u,L){return A([E,C,D],{baseClass:"jimu-widget-screening-impactSummaryReport",templateString:B,_feetUnitData:[],_milesUnitData:[],_metersUnitData:[],_kilometersUnitData:[],_hectaresUnitData:[],_printCompleteData:{},_printData:{},_feetUnitInfo:[],_milesUnitInfo:[],_metersUnitInfo:[],_kilometersUnitInfo:[],_hectaresUnitInfo:[],_intersectFeatureCount:0,isExceedingMaxRecordCount:!1,intersectingFeatureIdsToTolerance:[],intersectingFeatureIds:[],
_analysisUnitsArray:[],_aggregatedFeatureGeometries:[],_featureIntersectResultArr:[],_layerDefinition:null,_isFieldsSelectorClick:!1,_selectedFields:[],constructor:function(a){this._feetUnitData=[];this._milesUnitData=[];this._metersUnitData=[];this._kilometersUnitData=[];this._hectaresUnitData=[];this._printCompleteData={};this._printData={};this._feetUnitInfo=[];this._milesUnitInfo=[];this._metersUnitInfo=[];this._kilometersUnitInfo=[];this._hectaresUnitInfo=[];this._intersectFeatureCount=0;this.isExceedingMaxRecordCount=
!1;this.intersectingFeatureIdsToTolerance=[];this.intersectingFeatureIds=[];this._analysisUnitsArray=[];this._aggregatedFeatureGeometries=[];this._featureIntersectResultArr=[];this._layerDefinition=null;this._isFieldsSelectorClick=!1;this._selectedFields=[];g.mixin(this,a)},postCreate:function(){this._layerDefinition=r.getFeatureLayerDefinition(this.featureLayer);this._analysisUnitsArray=["Feet","Miles","Meters","Kilometers","Hectares"];this.own(n(this.impactSummaryLayerMaxRecordHint,"click",g.hitch(this,
function(a){a.stopPropagation();a.preventDefault();this.isExceedingMaxRecordCount?this.emit("showMessage",this.nls.reportsTab.unableToAnalyzeText):this.emit("showMessage",this.nls.reportsTab.layerNotVisibleText)})))},_displayLayerNotVisibleText:function(){h.add(this.impactSummaryLayerFeatureCount,"esriCTHidden");h.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled");m.set(this.impactSummaryLayerMaxRecordHint,"title",this.nls.reportsTab.layerNotVisibleText);h.remove(this.impactSummaryLayerMaxRecordHint,
"esriCTHidden");h.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth");this._showMessage(this.nls.reportsTab.layerNotVisibleText)},generateReport:function(a,b,c){var d,e,f;d=new t;this._setAttributeToFeatureLayerContainer();this._setFeatureLayerTitle();this._attachEventToLayerTitle();this._aggregatedFeatureGeometries=[];this._featureIntersectResultArr=[];(f=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))&&f.isVisible()&&f.isInScale()||f&&!f.isVisible()&&!this.config.allowVisibleLayerAnalysisOnly||
f&&!f.isInScale()&&!this.config.allowVisibleLayerAnalysisOnly||this.isFeatureCollectionLayer?this._getIntersectingFeaturesCount(c).then(g.hitch(this,function(c){this._getIntersectingFeaturesCount(b).then(g.hitch(this,function(k){this.intersectingFeatureIdsToTolerance=this._getUniqueIds(c,k);this._getIntersectingFeaturesCount(a).then(g.hitch(this,function(c){var f;this.intersectingFeatureIds=g.clone(c);c=this._getUniqueIds(k,c);this.isExceedingMaxRecordCount?(this._setFeatureLayerIntersectFeatureCount(c.length),
this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null),this._printData={},this._printData=g.clone(this._printCompleteData),this._showMessage(this.nls.reportsTab.unableToAnalyzeText),h.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled"),this._showReport(),d.resolve(this._getReportLayerDetails([]))):(f=a||b,this._getFeatureByChunks(c,f).then(g.hitch(this,function(b){var c;c=[];this._featureIntersectResultArr=[];l.forEach(b,g.hitch(this,function(b){a&&q.touches(b.geometry,
a)||c.push(b)}));b=[];this._setFeatureLayerIntersectFeatureCount(c.length);0<c.length?("esriGeometryPolyline"!==this.featureLayer.geometryType&&"esriGeometryPolygon"!==this.featureLayer.geometryType||!a?b=c:(e=this._polygonToPolyline(a),b=this._getCutOrWithInFeatures(e,c,a)),this._createLayerDetails(b,this.featureLayer.geometryType),this._filterPrintDataObjAccToConfiguredFields(this.configuredField),h.remove(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")):(this._pushDataInPrintDataObj(this.configuredLayerLabel,
null,null),this._printData={},this._printData=g.clone(this._printCompleteData),this._showMessage(this.nls.reportsTab.noDetailsAvailableText));h.remove(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled");this._featureIntersectResultArr=b;this._showReport();d.resolve(this._getReportLayerDetails(b))})))}))}))})):(this._displayLayerNotVisibleText(),d.resolve());return d.promise},retainLastSelectedField:function(){null!==this.retainSelectedFieldsArr&&(this._selectedFields=this.retainSelectedFieldsArr,
h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._filterFieldsForReport(this.retainSelectedFieldsArr))},_getReportLayerDetails:function(a){var b={};b.id=this.id;b.featureLayerId=this.featureLayer.id;b.features=a;b.printInfo={};b.printInfo.isExceedingMaxRecordCount=this.isExceedingMaxRecordCount;b.printInfo.featureCount=this._intersectFeatureCount;b.printInfo.info=this._printData;b.printInfo.feetUnitInfo=this._feetUnitInfo;b.printInfo.milesUnitInfo=this._milesUnitInfo;
b.printInfo.metersUnitInfo=this._metersUnitInfo;b.printInfo.kilometersUnitInfo=this._kilometersUnitInfo;b.printInfo.hectaresUnitInfo=this._hectaresUnitInfo;b.printInfo.geometryType=this.featureLayer.geometryType;return b},_setAttributeToFeatureLayerContainer:function(){m.set(this.impactSummaryLayerContainer,"featureLayerID",this.featureLayer.id)},_setFeatureLayerTitle:function(){this.configuredLayerLabel||(this.configuredLayerLabel=this.featureLayer.name);m.set(this.impactSummaryLayerTitle,"innerHTML",
this.configuredLayerLabel);m.set(this.impactSummaryLayerTitle,"title",this.configuredLayerLabel)},_attachEventToLayerTitle:function(){this.own(n(this.layerTitleAndFieldParentContainer,"click",g.hitch(this,function(a){h.contains(a.target,"esriCTImpactSummaryLayerFieldIcon")?h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")||this._createFieldSelectorPopupWidget():h.contains(this.layerTitleAndFieldParentContainer,"esriCTLayerSectionDisabled")||this._showOrHideLayerDetailsContainer()})))},
_createFieldSelectorPopupWidget:function(){this._isFieldsSelectorClick=!0;if(this._fieldSelectorWidget)this._fieldSelectorWidget.onFieldsSelectorClick();else this._fieldSelectorWidget=new J({outFields:this.configuredField,popupTitle:this.configuredLayerLabel,fieldTitle:this.nls.reportsTab.selectReportFieldTitle,nls:this.nls,appConfig:this.appConfig,retainSelectedFieldsArr:this.retainSelectedFieldsArr}),n(this._fieldSelectorWidget,"onFieldSelectComplete",g.hitch(this,function(a){this._selectedFields=
a;this._filterFieldsForReport(a)})),n(this._fieldSelectorWidget,"onCancel",g.hitch(this,function(){this._selectedFields=null!==this.retainSelectedFieldsArr?this.retainSelectedFieldsArr:this._getAllFields()})),n(this._fieldSelectorWidget,"onClose",g.hitch(this,function(){this._selectedFields=null!==this.retainSelectedFieldsArr?this.retainSelectedFieldsArr:this._getAllFields()})),this._fieldSelectorWidget.startup();"DartTheme"===this.appConfig.theme.name&&h.add(this._fieldSelectorWidget.fieldsPopup.domNode,
"esriCTDartPanel")},_getAllFields:function(){var a,b;b=[];for(a in this.configuredField)this.configuredField.hasOwnProperty(a)&&(this.configuredField[a].hasOwnProperty("fieldName")&&b.push(this.configuredField[a].fieldName),this.configuredField[a].hasOwnProperty("name")&&b.push(this.configuredField[a].name));return b},getSelectedFields:function(){return h.contains(this.impactSummaryLayerField,"esriCTImpactSummaryLayerFieldIconDisabled")?0<this._selectedFields.length?this._selectedFields:0===this._selectedFields.length&&
null===this.retainSelectedFieldsArr?this._getAllFields():0===this._selectedFields.length&&0===this.retainSelectedFieldsArr.length?[]:this._getAllFields():this._isFieldsSelectorClick&&0<this._selectedFields.length?this._selectedFields:this._isFieldsSelectorClick&&0===this._selectedFields.length?[]:!this._isFieldsSelectorClick&&0<this._selectedFields.length?this._selectedFields:this._isFieldsSelectorClick||0!==this._selectedFields.length||null!==this.retainSelectedFieldsArr?this._isFieldsSelectorClick||
0!==this._selectedFields.length||0!==this.retainSelectedFieldsArr.length?this._getAllFields():[]:this._getAllFields()},_filterFieldsForReport:function(a){var b=g.clone(this.configuredField),c;for(c in this.configuredField)-1>=a.indexOf(c)&&delete b[c];this._filterPrintDataObjAccToConfiguredFields(b);(a=z(".esriCTAttrTableHighlighted",this.domNode.parentElement))&&0<a.length&&m.get(a[0],"esriCTLayerId")===this.featureLayer.id&&(h.remove(a[0],"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear());
this._showReport();this.emit("printDataUpdated",{id:this.id,printData:this._printData})},_showOrHideLayerDetailsContainer:function(){h.toggle(this.layerTitleAndFieldParentContainer,"esriCTBoldFont");h.toggle(this.impactSummaryLayerDetailContainer,"esriCTHidden");h.contains(this.layerSectionIcon,"esriCTLayerPanelExpand")?h.replace(this.layerSectionIcon,"esriCTLayerPanelCollapse","esriCTLayerPanelExpand"):h.replace(this.layerSectionIcon,"esriCTLayerPanelExpand","esriCTLayerPanelCollapse")},_getIntersectingFeaturesCount:function(a){var b,
c,d,e;b=new t;if(a)if(this.isFeatureCollectionLayer){c=[];if(0<this.featureLayer.graphics.length)for(e=0;e<this.featureLayer.graphics.length;e++)(d=this.featureLayer.graphics[e].geometry?q.intersects(a,this.featureLayer.graphics[e].geometry):null)&&c.push(e);b.resolve(c)}else{var f;c=new w;d=new x(this.featureLayer.url);(f=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))&&(e=f.getFilter()?f.getFilter():"1\x3d1");e&&(c.where=e);c.geometry=a;d.executeForIds(c,g.hitch(this,function(a){a&&0!==
a.length?(a.length>this.maxFeaturesForAnalysis&&(h.remove(this.impactSummaryLayerMaxRecordHint,"esriCTHidden"),h.add(this.impactSummaryLayerTitle,"esriCTLayerTitleOverrideWidth"),this.isExceedingMaxRecordCount=!0,this.emit("exceedingMaxRecordCount")),b.resolve(a)):b.resolve([])}),g.hitch(this,function(){b.resolve([])}))}else b.resolve([]);return b.promise},_getFeatureByChunks:function(a,b){var c,d,e;d=new t;c=[];e=this.featureLayer.maxRecordCount;if(this.isFeatureCollectionLayer)c.push(this._getIntersectFeature(a,
b));else for(;0<a.length;)c.push(this._getIntersectFeature(a.splice(0,e),b));L(c).then(g.hitch(this,function(a){var b;b=[];l.forEach(a,g.hitch(this,function(a){b=b.concat(a)}));d.resolve(b)}));return d.promise},_getIntersectFeature:function(a,b){var c,d,e;c=new t;if(this.isFeatureCollectionLayer){d=[];if(0<this.featureLayer.graphics.length)for(a=0;a<this.featureLayer.graphics.length;a++)(e=this.featureLayer.graphics[a].geometry?q.intersects(b,this.featureLayer.graphics[a].geometry):null)&&d.push(this.featureLayer.graphics[a]);
c.resolve(d.splice(0,this.maxFeaturesForAnalysis))}else d=new w,d.outFields=["*"],d.returnGeometry=!0,d.objectIds=a,d.outSpatialReference=b.spatialReference,b=new x(this.featureLayer.url),b.execute(d,g.hitch(this,function(a){a.features?c.resolve(a.features):c.resolve([])}),g.hitch(this,function(){c.resolve([])}));return c.promise},_setFeatureLayerIntersectFeatureCount:function(a){this._intersectFeatureCount=u.format(a);h.remove(this.impactSummaryLayerFeatureCount,"esriCTLoadingIcon");m.set(this.impactSummaryLayerFeatureCount,
"innerHTML","("+this._intersectFeatureCount+")");m.set(this.impactSummaryLayerFeatureCount,"title","("+this._intersectFeatureCount+")")},_isDonutPolygon:function(a){var b;b=!1;"polygon"===a.type&&1<a.rings.length&&l.forEach(a.rings,g.hitch(this,function(c){a.isClockwise(c)||(b=!0)}));return b},_getCutOrWithInFeatures:function(a,b,c){var d,e;d=[];for(var f=0;f<a.length;f++)for(var k=0;k<b.length;k++)e=q.cut(b[k].geometry,a[f]),0<e.length?d=this._getWithinFeature({cutFeatureArr:e,bufferGeometry:c,featureIntersectResultArr:d,
intersectFeatureArr:b,index:k}):q.within(b[k].geometry,c)&&(e=new v(b[k].geometry,null,b[k].attributes),d.push(e));return d},_getWithinFeature:function(a){var b,c,d,e,f,k;b=a.cutFeatureArr;c=a.bufferGeometry;d=a.intersectFeatureArr;f=a.featureIntersectResultArr;e=a.index;l.forEach(b,g.hitch(this,function(a){q.within(a,c)&&(k=new v(a,null,d[e].attributes),f.push(k))}));return f},_polygonToPolyline:function(a){var b,c,d,e,f;b=[];c=new F(new G({wkid:102100}));for(f=0;f<a.rings.length;f++){e=[];for(d=
0;d<a.rings[f].length;d++)e.push(a.rings[f][d]);c.addPath(e)}b.push(c);return b},_updateFormattedAttribute:function(a){l.forEach(a,g.hitch(this,function(b,c){var d,e,f;d=b.attributes[this.featureLayer.objectIdField];f=null;-1===this.intersectingFeatureIds.indexOf(d)&&(e=!0);this.isFeatureCollectionLayer||(d=this.layerInfosObj.getLayerInfoById(this.featureLayer.id),f=d.originOperLayer.popupInfo);d=this._getFormatedAttrs(g.clone(b.attributes),this.featureLayer.fields,f);a[c].setAttributes(d);l.forEach(this.featureLayer.fields,
g.hitch(this,function(b){var d;a[c].attributes.hasOwnProperty(b.name)||(a[c].attributes[b.name]=this.nls.reportsTab.noDataText);a[c].attributes.hasOwnProperty(b.name)&&(d=a[c].attributes[b.name],void 0===d||""===d||null===d?a[c].attributes[b.name]=this.nls.reportsTab.noDataText:""===g.trim(d.toString())&&(a[c].attributes[b.name]=this.nls.reportsTab.noDataText))}));if(!e||"esriGeometryPolygon"!==this.featureLayer.geometryType&&"esriGeometryPolyline"!==this.featureLayer.geometryType)switch(this.featureLayer.geometryType){case "esriGeometryPolygon":b=
y.getAreaOfGeometry(b.geometry);this._feetUnitData.push(b.squareFeet);this._milesUnitData.push(b.acres);this._metersUnitData.push(b.squareMeters);this._kilometersUnitData.push(b.squareKilometer);this._hectaresUnitData.push(b.hectares);break;case "esriGeometryPolyline":b=y.getLengthOfGeometry(b.geometry),this._feetUnitData.push(b.feet),this._milesUnitData.push(b.miles),this._metersUnitData.push(b.meters),this._kilometersUnitData.push(b.kilometers),this._hectaresUnitData.push(b.kilometers)}else this._feetUnitData.push(0),
this._milesUnitData.push(0),this._metersUnitData.push(0),this._kilometersUnitData.push(0),this._hectaresUnitData.push(0)}));return a},_getFieldText:function(a,b){return a.label?a.label:a.alias?a.alias:b},_createLayerDetails:function(a,b){var c,d,e,f;f=Object.keys(this.configuredField).length;a=this._updateFormattedAttribute(a);this._pushDataInPrintDataObj(this.configuredLayerLabel,null,null);for(e in this.configuredField)for(c=this.configuredField[e],c=this._getFieldText(c,e),this._printCompleteData.cols.push(c),
c=0;c<a.length;c++)switch((d=a[c].attributes[e])||0===d?this._pushDataInPrintDataObj(null,c,d):this._pushDataInPrintDataObj(null,c,""),b){case "esriGeometryPolygon":case "esriGeometryPolyline":this._printCompleteData.cols.length===f&&(this._feetUnitInfo.push(this._feetUnitData[c]),this._milesUnitInfo.push(this._milesUnitData[c]),this._metersUnitInfo.push(this._metersUnitData[c]),this._kilometersUnitInfo.push(this._kilometersUnitData[c]),this._hectaresUnitInfo.push(this._hectaresUnitData[c]));break;
case "esriGeometryPoint":this._printCompleteData.cols.length===f&&(this._feetUnitInfo.push(1),this._milesUnitInfo.push(1),this._metersUnitInfo.push(1),this._kilometersUnitInfo.push(1),this._hectaresUnitInfo.push(1))}},_pushDataInPrintDataObj:function(a,b,c){a?(this._printCompleteData={},this._feetUnitInfo=[],this._milesUnitInfo=[],this._metersUnitInfo=[],this._kilometersUnitInfo=[],this._hectaresUnitInfo=[],this._printCompleteData.title=a,this._printCompleteData.rows=[],this._printCompleteData.cols=
[]):(c===this.nls.reportsTab.noDataText&&(c="\x3ci\x3e"+c+"\x3c/i\x3e"),this._printCompleteData.rows[b]||this._printCompleteData.rows.push([]),this._printCompleteData.rows[b].push(c))},_filterPrintDataObjAccToConfiguredFields:function(a){var b,c,d;this._printData={};this._printData=g.clone(this._printCompleteData);for(b=this._printData.cols.length-1;0<=b;--b){c=!1;for(d in a)switch(this._printData.cols[b]){case a[d].label:c=!0;break;case a[d].alias:c=!0;break;case d:c=!0}if(!c)for(this._printData.cols.splice(b,
1),c=0;c<this._printData.rows.length;c++)this._printData.rows[c].splice(b,1)}},_getFormatedAttrs:function(a,b,c){function d(a){if(c&&K.isDefined(c.fieldInfos))for(var b=0,d=c.fieldInfos.length;b<d;b++){var e=c.fieldInfos[b];if(e.fieldName===a)return e.format}return null}var e=[null,void 0,""],f={};l.forEach(b,g.hitch(this,function(c,g){if(-1===e.indexOf(a[c.name])){var k="esriFieldTypeDate"===c.type,h=c.name;if("esriFieldTypeDate"===b[g].type)f[h]=r.fieldFormatter.getFormattedDate(a[c.name],d(c.name));
else if("esriFieldTypeDouble"===b[g].type||"esriFieldTypeSingle"===b[g].type||"esriFieldTypeInteger"===b[g].type||"esriFieldTypeSmallInteger"===b[g].type)f[h]=this._getFormattedNumber(a[c.name],d(c.name));k||(f[h]=h in f?f[h]:a[c.name],(c=r.getDisplayValueForCodedValueOrSubtype(this._layerDefinition,c.name,a))&&c.isCodedValueOrSubtype&&c.hasOwnProperty("displayValue")&&-1===e.indexOf(c.displayValue)&&(c=c.displayValue,f[h]=c||isFinite(c)?c:""))}}));return f},_getFormattedNumber:function(a,b){if("number"===
typeof a){var c=(a.toString().split(".")[1]||"").length;return(a=r.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):c,digitSeparator:b&&b.digitSeparator}}))||""}return a},_getArrayIndex:function(a,b){var c,d,e,f=[];for(c=0;c<a.length;++c)if(b.length===a[c].length){e=a[c];for(d=0;d<b.length&&b[d]===e[d];)++d;d===b.length&&f.push(c)}return f},getSum:function(a,b){a=(b&&0<b.length?l.filter(a,function(a,d){return-1<b.indexOf(d)}):a).reduce(function(a,b){return a+
b},0);return.01<a?H.honourPopupRounding(2,a):a},_getAggregatedColTitle:function(a){var b;switch(a){case "esriGeometryPoint":b=this.nls.reportsTab.featureCountText;break;case "esriGeometryPolyline":b=this.nls.reportsTab.featureLengthText;break;case "esriGeometryPolygon":b=this.nls.reportsTab.featureAreaText}return b},_getUnitsForGeometry:function(a,b){var c;switch(a){case "esriGeometryPoint":c="";break;case "esriGeometryPolyline":c=this._getAnalysisUnitForGeometry(b,a);break;case "esriGeometryPolygon":c=
this._getAnalysisUnitForGeometry(b,a)}return c},_getAnalysisUnitForGeometry:function(a,b){var c;switch(a){case "Feet":c="esriGeometryPolygon"===b?this.nls.units.feetAbbr+"\x26sup2":this.nls.units.feetAbbr;break;case "Miles":c="esriGeometryPolygon"===b?this.nls.units.acresAbbr:this.nls.units.milesAbbr;break;case "Meters":c="esriGeometryPolygon"===b?this.nls.units.metersAbbr+"\x26sup2":this.nls.units.metersAbbr;break;case "Kilometers":c="esriGeometryPolygon"===b?this.nls.units.kilometersAbbr+"\x26sup2":
this.nls.units.kilometersAbbr;break;case "Hectares":c="esriGeometryPolygon"===b?this.nls.reportsTab.hectaresAbbr:this.nls.units.kilometersAbbr}return c},_showMessage:function(a){p.empty(this.impactSummaryLayerDetails);m.set(this.impactSummaryLayerDetailsMsg,"innerHTML",a);h.add(this.impactSummaryLayerDetailsMsg,"esriCTLayerDetailCenterText")},_showReport:function(){var a,b,c,d,e,f=[];a=this._printData;p.empty(this.impactSummaryLayerDetails);if(!a.cols.length&&0<a.rows.length)this._showMessage(this.nls.reportsTab.noFieldsSelected);
else if(a.rows&&0<a.rows.length){m.set(this.impactSummaryLayerDetailsMsg,"innerHTML","");h.remove(this.impactSummaryLayerDetailsMsg,"esriCTLayerDetailCenterText");b=[];d={};for(var k=0;k<a.rows.length&&(0>b.indexOf(k)&&(c=this._getArrayIndex(a.rows,a.rows[k]),d[k]=c,b=b.concat(c)),b.length!==a.rows.length);k++);b={rows:[],cols:g.clone(a.cols)};c=this._getAggregatedColTitle(this.featureLayer.geometryType);b.cols.push(c);b.cols.push(c);b.cols.push(c);b.cols.push(c);b.cols.push(c);for(e in d)c=g.clone(a.rows[parseInt(e,
10)]),c.push(this.getSum(this._feetUnitInfo,d[parseInt(e,10)])),c.push(this.getSum(this._milesUnitInfo,d[parseInt(e,10)])),c.push(this.getSum(this._metersUnitInfo,d[parseInt(e,10)])),b.rows.push(c),c.push(this.getSum(this._kilometersUnitInfo,d[parseInt(e,10)])),k=this.getSum(this._hectaresUnitInfo,d[parseInt(e,10)]),c.push(k),this._featureIntersectResultArr&&f.push({features:this._getAggregatedFeatures(d[e]),sortValue:k});this._renderReport(b,f)}},_getAggregatedFeatures:function(a){var b=[];l.forEach(a,
g.hitch(this,function(a){b.push(this._featureIntersectResultArr[a])}));return b},_sortFeatureArray:function(a,b){var c=a.length-1;return a[c]<b[c]?1:a[c]>b[c]?-1:0},_sortArrayByKey:function(a,b){return a.sortValue<b.sortValue?1:a.sortValue>b.sortValue?-1:0},_createTemplateNode:function(){var a;a=p.create("table",{"class":"esriCTAttrTable esriCTCursorPointer",cellpadding:"0px",cellspacing:"0px"},this.impactSummaryLayerDetails);p.create("div",{"class":"esriCTInfoDataSeparator"},this.impactSummaryLayerDetails);
this.own(n(a,"click",g.hitch(this,this._highlightSelection)));return a},_renderReport:function(a,b){a.rows&&0<a.rows.length&&(a.rows=a.rows.sort(this._sortFeatureArray),this._aggregatedFeatureGeometries=b=b.sort(this._sortArrayByKey),l.forEach(a.rows,g.hitch(this,function(b,d){var c,f;c=this._createTemplateNode();m.set(c,"esriCTTableIndex",d);m.set(c,"esriCTLayerId",this.featureLayer.id);l.forEach(b,g.hitch(this,function(d,e){var g,k,l,n;f=p.create("tr",{valign:"top"},c);n=p.create("td",{"class":"esriCTAttrName"},
f);l=p.create("td",{"class":"esriCTAttrValue"},f);d=r.fieldFormatter.getFormattedUrl(d);g=a.cols[e]+": ";k=d;e>=b.length-5&&(e-=b.length-5,.01<=d?(d="esriGeometryPoint"!==this.featureLayer.geometryType?u.format(d,{places:2}):u.format(d),k=g+d+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._analysisUnitsArray[e])):k=.01>d&&0!==d?g+"  \x3c "+u.format(.01)+" "+this._getUnitsForGeometry(this.featureLayer.geometryType,this._analysisUnitsArray[e]):g+" "+this.nls.reportsTab.notApplicableText,
g="",h.add(n,"esriCTReportsTabInfoData"),h.add(l,"esriCTInfoDataMeasurement esriCTReportsTabInfoData esriCTFieldDistinct"+this._analysisUnitsArray[e]+"UnitData"),this.config.areaUnits!==this._analysisUnitsArray[e]&&h.add(l,"esriCTHidden"));m.set(n,"innerHTML",g);m.set(l,"innerHTML",k)}))})))},_getUniqueIds:function(a,b){if(0===a.length)return b;if(0===b.length)return a;l.forEach(a,g.hitch(this,function(a){a=b.indexOf(a);-1!==a&&b.splice(a,1)}));return a.concat(b)},_highlightSelection:function(a){var b;
b=a.currentTarget;h.contains(b,"esriCTAttrTableHighlighted")?(h.remove(b,"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear()):((a=z(".esriCTAttrTableHighlighted",this.domNode.parentElement))&&0<a.length&&h.remove(a[0],"esriCTAttrTableHighlighted"),this.highlightGraphicsLayer.clear(),h.add(b,"esriCTAttrTableHighlighted"),a=m.get(b,"esriCTTableIndex"),a=this._aggregatedFeatureGeometries[parseInt(a,10)].features,l.forEach(a,g.hitch(this,function(a){a=I.getHighLightSymbol(a,this.featureLayer);
this.highlightGraphicsLayer.add(a)})))}})});